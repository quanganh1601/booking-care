(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4780],{81463:function(t){!function(){"use strict";t.exports=".advertising-info{background-color:#fff;border-radius:2px;font-size:14px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);margin-bottom:20px;padding:16px;display:flex}.add-attribute{position:absolute;right:4px;top:4px;z-index:999;display:flex;align-items:flex-end;justify-content:space-between}.advertising-table{margin-top:10px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);border:none !important}.advertising-table .ant-empty-normal{margin:0px}.advertising-table .ant-table-body{overflow:auto !important;max-height:537px !important}.advertising-table .ant-table-body .ant-select-selection-item span{top:0px !important}.advertising-table .ant-table-body::-webkit-scrollbar{width:5px}.advertising-table .ant-table{border-bottom:0 !important;border-radius:2px}.advertising-table .ant-table .ant-input{min-height:32px;border-radius:2px !important}.advertising-table .ant-table .ant-table-header .ant-table-thead tr th{right:0px !important}.advertising-table .ant-table-footer{background-color:#fff}.advertising-table .info-product{display:flex;align-items:center}.advertising-table .info-product .icon-close-product{margin-right:5px;display:none}.advertising-table .info-product .icon-close-product:hover{color:#f04134}.advertising-table .info-product .ant-tag{margin:0 5px}.advertising-table .info-product:hover .icon-close-product{display:inline}.advertising-label{margin-right:5px}.advertising-footer{display:flex;justify-content:flex-end;padding-top:15px}.product-search-bar-advertising-cost .ant-select-selection-search-input{padding:0 11px !important}"}()},77729:function(t){!function(){"use strict";t.exports=".clone-transaction .ant-modal-body{padding:0 10px}.modal-cloning .ant-modal-body{display:flex;flex-direction:column;align-items:center}.modal-cloning .ant-modal-body .cloning-info{width:100%;height:300px;display:flex;flex-direction:column;border:1px solid #d9d9d9;border-radius:2px;margin-top:10px;padding:10px;font-size:14px;overflow:auto}.modal-cloning .ant-modal-body .cloning-info .success{color:#00a854}.modal-cloning .ant-modal-body .cloning-info .fail{color:#f04134}.row-clone-transaction .gutter-row{padding:5px 16px !important}.list-clone-transaction{overflow:auto;max-height:calc(100vh - 259px)}.list-clone-transaction .ant-list-header{padding:10px 0px !important}.list-clone-transaction .ant-list-header .header-clone-transaction{display:flex;align-items:center}.list-clone-transaction .ant-list-header .header-clone-transaction .cell-clone-transaction{white-space:nowrap}.list-clone-transaction .ant-list-items{overflow:auto;max-height:calc(100vh - 302px)}.list-clone-transaction .contents-clone-transaction{padding:5px 0px !important}.list-clone-transaction .contents-clone-transaction:hover{background-color:#fafafa}.list-clone-transaction .cell-clone-transaction{padding:0 4px;display:flex;align-items:center;justify-content:center}.list-clone-transaction .cell-clone-transaction .anticon{border-radius:4px}.list-clone-transaction .justify-content-left{justify-content:left}"}()},14320:function(t){!function(){"use strict";t.exports="@media screen and (max-width: 1110px){body .container-layout{margin-top:5px !important}}\nbody .container-layout .status-dropdown .ant-radio-group{z-index:20;margin-bottom:-1px}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper{background-color:#fff;border-radius:2px 2px 0 0}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper .status-title{margin-left:5px}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper .ant-tag{margin-right:0;margin-left:5px}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper:not(:first-child){margin-left:5px}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper-checked{border-color:#d9d9d9;border-bottom-color:#f7f7f7;background-color:#f7f7f7;box-shadow:none}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper-checked span{color:rgba(0,0,0,.85) !important}\nbody .container-layout .status-dropdown .ant-radio-group .ant-radio-button-wrapper-checked .ant-tag{border-color:transparent;background-color:#096dd9;color:#fff !important}\nbody .container-layout .transaction-table .transaction-container .ant-table-body .ant-table-row{cursor:pointer}\nbody .container-layout .transaction-table .transaction-container .ant-table-body .ant-table-row .ant-btn-sm{height:22px !important;font-size:12px !important;width:118px}\nbody .container-layout .transaction-table .transaction-container .ant-table-body .ant-table-row .ellipsis-column div p{overflow:hidden;text-overflow:ellipsis}\nbody .del-cancel .modal-content .modal-top{padding-bottom:10px}\nbody .del-cancel .modal-content .payment-type{display:flex;flex-direction:row;border-radius:4px;height:32px;border:1px solid #d9d9d9;margin-bottom:16px;margin-top:2px}\nbody .del-cancel .modal-content .payment-type .payment-type-item{width:50%;display:flex;flex-direction:row;justify-content:center;align-items:center;padding:5px 12px;gap:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}\nbody .del-cancel .modal-content span{display:inline-block}\nbody .del-cancel .modal-content .modal-middle{padding:10px 0}\nbody .del-cancel .modal-content .modal-bottom{padding-top:10px}\nbody .del-cancel .modal-content .modal-bottom .anticon{font-size:15px}\nbody .del-cancel .modal-content label{font-size:14px;font-weight:500}\nbody .del-cancel .ant-modal-footer .ant-btn:first-child{display:none}\nbody .transaction-modal{top:40px}\nbody .transaction-modal .ant-modal-content .ant-modal-close-x{height:48px;width:48px;line-height:48px}\nbody .transaction-modal .ant-modal-content .ant-modal-header{height:48px}\nbody .transaction-modal .ant-modal-content .ant-modal-header .ant-modal-title{font-weight:500;font-size:14px}\nbody .transaction-modal .ant-modal-content .ant-modal-body{background-color:#ededed;padding:16px 24px;max-height:calc(100vh - 160px);overflow-y:auto}\nbody .transaction-modal .ant-modal-content .ant-modal-body label{font-weight:500;font-size:14px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content{background-color:#fff;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);padding:16px;border-radius:2px !important}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content label{font-weight:500;font-size:14px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-top{display:grid;margin-bottom:16px;line-height:2}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-top .name-transaction .ant-input{border-radius:2px !important}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .payment-type{display:flex;flex-direction:row;border-radius:4px;height:32px;border:1px solid #d9d9d9;margin-bottom:16px;margin-top:2px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .payment-type .payment-type-item{width:50%;display:flex;flex-direction:row;justify-content:center;align-items:center;padding:5px 12px;gap:8px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle{line-height:2;margin-bottom:16px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle .amount-changes .ant-input-group-wrapper .ant-input-wrapper .ant-input-group .ant-input:hover{border-color:#ff3860}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle .amount-changes .ant-input-affix-wrapper{border-radius:2px !important}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle .amount-changes .ant-input-affix-wrapper .ant-input{border-radius:2px !important;text-align:right !important}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle .amount-changes .box-input-number-wrapper{height:32px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-middle .amount-changes .box-input-number-wrapper .ant-input-suffix{padding-bottom:12px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .payments-content{margin-bottom:16px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked{margin-bottom:16px;display:flex;flex-direction:row}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_receipts{margin-left:10px;width:65%;float:right}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_receipts .ant-radio-wrapper{margin-right:10px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_receipts .ant-radio-wrapper:first-child span{color:#000000bf}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_payment{margin-left:10px;width:65%;float:right}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_payment .ant-radio-wrapper{margin-right:10px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-checked .radio-changes_payment .ant-radio-wrapper:last-child span{color:#000000bf}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-bottom{padding-top:12px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .radio-content .radio-content-bottom textarea{margin-top:3px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .image-content{display:flex}\nbody .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-list-item{padding:2px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-list-picture-card-container,body .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-select-picture-card{height:75px;width:75px}\nbody .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-list-picture-card-container .ant-upload-text,body .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-select-picture-card .ant-upload-text{margin-top:8px;font-size:12px;color:#666}\nbody .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-animate-inline-appear,body .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-animate-inline-enter,body .transaction-modal .ant-modal-content .ant-modal-body .image-content .transaction-detail-image .ant-upload-list .ant-upload-animate-inline-leave{-webkit-animation-duration:.1s;animation-duration:.1s}\nbody .transaction-modal .ant-modal-content .ant-modal-body .container-tab .ant-tabs-nav{margin-bottom:0 !important}\nbody .transaction-modal .ant-modal-content .ant-modal-body .container-tab .ant-tabs-nav .ant-tabs-tab{padding:8px 15px !important}\nbody .export-opt{padding:10px 0;border-bottom:1px solid #d9d9d9;width:100%;font-size:14px;display:flex;justify-content:space-between}\nbody .export-checkbox{border-bottom:none;padding:0px;padding-top:10px}\nbody .transaction-logs .ant-modal-body{max-height:600px;padding-right:0px}\nbody .transaction-logs .ant-collapse-item{background-color:#f7f7f7;border:0;margin-bottom:10px;border-radius:2px;margin-right:24px}\nbody .transaction-logs .ant-collapse-item .ant-collapse-header{padding-right:12px}\n.row-checkbox{line-height:2;display:flex;margin-bottom:16px}\n.row-checkbox div:last-child{margin-left:20px}\n.spin{width:40px;height:40px;z-index:9999;position:absolute;top:40%;left:calc(50% - 20px)}\n.transaction-update-tags .updating-info{width:100%;height:300px;display:flex;flex-direction:column;border:1px solid #d9d9d9;border-radius:2px;margin-top:10px;padding:10px;font-size:14px;overflow:auto}\n.transaction-update-tags .updating-info .success{color:#00a854}\n.transaction-update-tags .updating-info .fail{color:#f04134}"}()},36966:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return Ln}});var a,o=n(14321),r=n(89552),s=n(55673),i=n(5789),c=n(10149),l=n(11187),d=n(62443),u=n(28465),p=n(56697),g=n(42378),m=n(91229),h=n(65400),f=n(31059),v=n(28140),y=n(82891),b=n(12386),_=n(32292),C=n(94055),x=n(59361),k=n(809),S=n.n(k),T=n(92447),Z=n(74047),w=n(4706),I=n(52700),N=n(33814),A=n(44102),O=n(20775),M=n(26265),R=n(51024),E=n(64749),P=n(64713),D=n(44908),F=n.n(D),L=n(50361),U=n.n(L),j=n(23279),B=n.n(j),V=n(65988),z=n(67294),Y=n(7945),H=n(95642),K=n(84189),W=n(90631),q=n(50161),G=n(99165),$=n(24616),X=n(79508),J=n(12044),Q=n(76570),tt=n(7085),et=n(49101),nt=n(92104),at=n(25592),ot=n(1058),rt=n(7145),st=n.n(rt),it=n(30381),ct=n.n(it),lt=n(65644),dt=n(83049),ut=n(31731),pt=n(74229),gt=n(74806),mt=n(9669),ht=n.n(mt),ft=n(78598),vt=n(14494),yt=n(36934),bt=n(95213),_t=n(87217),Ct=n(31432),xt=z.createElement;function kt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function St(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kt(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Tt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var Zt,wt=P.default.Group,It=(0,_t.Z)()(a=function(t){(0,N.Z)(n,t);var e=Tt(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"componentDidMount",(function(){var t=a.props.shopId;if("undefined"!==typeof localStorage&&localStorage.getItem("export_advertising_cost_".concat(t)))try{a.setState({isCheckExportAdvertisingCost:JSON.parse(localStorage.getItem("export_advertising_cost_".concat(t)))})}catch(e){console.log(e,"eror")}})),(0,M.Z)((0,w.Z)(a),"handleCancel",(function(){a.setState({transactions:[],advertisingCosts:[],totalEntries:0,totalSuccess:0})})),(0,M.Z)((0,w.Z)(a),"handleFetchTransactions",(function(){var t=a.props,e=t.selectedRowKeys,n=t.defaultParams;if(a.setState({isLoading:!0}),(null===e||void 0===e?void 0:e.length)>0){var o=(0,bt.F33)(e),r=(0,v.Z)(a.state.transactions),s=(0,v.Z)(a.state.advertisingCosts),i=0;o.map((function(t){a.sendRequest({transaction_ids:t,page:-1}).then((function(n){i+=t.length,r=r.concat(n.transactions||[]),s=s.concat(n.advertisingCosts||[]),a.setState({transactions:r,advertisingCosts:s,totalSuccess:a.state.totalSuccess+t.length,totalEntries:e.length},(function(){i==e.length&&a.setState({isLoading:!1},(function(){return a.handleFetchData()}))}))}))}))}else{var c=St({},n);a.sendRequest(c)}})),(0,M.Z)((0,w.Z)(a),"sendRequest",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=a.props,n=e.shopId,o=e.accessToken,r=e.loadAdvertisingCosts,s=a.state.isCheckExportAdvertisingCost,i=(0,v.Z)(a.state.transactions),c="".concat((0,bt.LpH)(),"/shops/").concat(n,"/transactions?access_token=").concat(o);return ht().get(c,{params:t}).then(function(){var e=(0,T.Z)(S().mark((function e(c){var l,d,u;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c.data.success){e.next=19;break}if(l=c.data.data,d=[],l.map((function(t){t.advertising_cost_id&&d.push(t.advertising_cost_id)})),u=[],!(s&&d.length>0)){e.next=8;break}return e.next=8,r(o,n,d).then((function(e){t.transaction_ids?u=u.concat(e):(u=(0,v.Z)(a.state.advertisingCosts),(null===e||void 0===e?void 0:e.length)>0&&a.setState({advertisingCosts:u.concat(e)}))}));case 8:if(t.transaction_ids){e.next=18;break}if(a.setState({totalEntries:c.data.total_entries,transactions:i.concat(l)}),!(c.data.page_number<c.data.total_pages)){e.next=15;break}return t.page=t.page+1,e.abrupt("return",a.sendRequest(t));case 15:return e.abrupt("return",a.setState({isLoading:!1},(function(){return a.handleFetchData()})));case 16:e.next=19;break;case 18:return e.abrupt("return",{transactions:l,advertisingCosts:u});case 19:return e.abrupt("return",a.setState({isLoading:!1}));case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),(0,M.Z)((0,w.Z)(a),"getProgress",(function(){var t=a.props.selectedRowKeys,e=a.state,n=e.totalEntries,o=e.totalSuccess,r=e.transactions;return(null===t||void 0===t?void 0:t.length)>0?n>0?Math.round(o/n*100):0:n>0?Math.round(r.length/n*100):0})),(0,M.Z)((0,w.Z)(a),"renderOrderSource",(function(t){if(!t)return null;var e=a.props,n=e.currentShop,o=e.order_sources_custom,r=(0,bt.K5C)(o,n),s=[];(0,bt.caL)(n).map((function(t){r.find((function(e){return e.id==t.id}))||s.push(t)}));var i=r.concat(s),c=i.findIndex((function(e){return e.id==t.key||e.id&&e.id.toString()==t.key})),l=c>-1?i[c].name:"",d=null,u=t.page_id||t.account;return u&&(d=((i[c].nodes||[]).find((function(e){return e.custom_id==t.page_id||e.id==t.account}))||{}).name),d?l+"/"+d:"-1"==t.key&&u?l+"/"+u:l})),(0,M.Z)((0,w.Z)(a),"handleExport",(function(t,e,n){var o=a.props,r=o.t,s=o.currentShop,i={};return i[r("components.orderExportExcel.index")]=n?null:e+1,i.ID=n?null:t.display_id,i[r("pages.shop.transaction.tradingName")]=n?null:-1!=t.name.indexOf("#ref_display_id")?t.name.replace("#ref_display_id",t.ref_display_id):t.name,i[r("pages.shop.transaction.transationCreator")]=n?null:t.creator?t.creator.name:r("pages.admin.system").toUpperCase(),i[r("pages.shop.transaction.money")]=n?null:Math.abs(t.amount),i[r("pages.shop.transaction.typeOfBill")]=n?null:t.amount<0?"Chi":"Thu",i[r("components.orderAdvanceFilter.tag")]=n?null:((null===t||void 0===t?void 0:t.tag_ids)||[]).map((function(t){return(((null===s||void 0===s?void 0:s.transaction_tags)||[]).find((function(e){return e.key==t}))||{}).name})).join(", "),i[r("pages.shop.transaction.payment")]=n?null:(t.payments||[]).map((function(t){var e,n;return((0,bt.rWq)().find((function(e){return e.value==t}))||{}).text||(null===(e=s.bank_payments)||void 0===e||null===(n=e.find((function(e){return e.id==t})))||void 0===n?void 0:n.name)})).join(", "),i[r("pages.shop.transaction.effectiveAt")]=n?null:(0,bt.o0x)(a.props.timezone||7,t.posted_at,!0),i[r("pages.shop.transaction.timeIncurred")]=n?null:(0,bt.o0x)(a.props.timezone||7,t.time_incurred||t.inserted_at,!0),i[r("note")]=n?null:t.note||"",i[r("status")]=n?null:t.is_canceled?r("cancel"):r("components.tablePlan.active"),i})),(0,M.Z)((0,w.Z)(a),"handleFetchData",(function(){var t=a.props,e=t.t,n=t.users,o=t.warehouses,r=a.state,s=r.exportType,i=r.isCheckExportAdvertisingCost,c=(0,v.Z)(a.state.transactions),l=(0,v.Z)(a.state.advertisingCosts),d=(c=i?c.filter((function(t){return t.advertising_cost_id})):c.filter((function(t){return!t.advertising_cost_id}))).reduce((function(t,r,s){var c={};if(c=a.handleExport(r,s,!1),i){var d=l.find((function(t){return t.id==r.advertising_cost_id}));return((null===d||void 0===d?void 0:d.items)||[]).map((function(i,l){var d,u,p,g,m,h=(i.posts||[]).filter((function(t){return i.post_ids.includes(t.id)})),f=[];h.map((function(t){f.push(t.message)}));var v=n.find((function(t){return t.user_id==i.user_id}));l>0&&(c=a.handleExport(r,s,!0)),delete c[e("pages.shop.transaction.import.timeIncurred")];var y=o.find((function(t){return t.id==i.warehouse_id}));c=St(St({},c),{},(m={},(0,M.Z)(m,e("pages.shop.advertising.import.costDate"),l?null:(0,bt.o0x)(a.props.timezone||7,i.cost_date,!0)||null),(0,M.Z)(m,"Page",a.renderOrderSource(i.source)),(0,M.Z)(m,"Marketer",(null===v||void 0===v||null===(d=v.user)||void 0===d?void 0:d.name)||null),(0,M.Z)(m,e("pages.shop.transaction.import.warehouseId"),(null===y||void 0===y?void 0:y.custom_id)||(null===y||void 0===y?void 0:y.id)||null),(0,M.Z)(m,e("products.title"),(null===(u=i.product)||void 0===u?void 0:u.name)||null),(0,M.Z)(m,e("pages.shop.transaction.import.productId"),(null===(p=i.product)||void 0===p?void 0:p.custom_id)||(null===(g=i.product)||void 0===g?void 0:g.display_id)||null),(0,M.Z)(m,e("pages.shop.transaction.import.cost"),i.cost||null),(0,M.Z)(m,"Post",f.join("; ")||null),m));var b=i.utm||{};c=(0,bt.ybq)().reduce((function(t,e){return t=St(St({},t),{},(0,M.Z)({},e.label,b[e.value]))}),c),t.push(c)})),t}return t.push(c),t}),[]);if("excel"==s){var u={SheetNames:[],Sheets:{}},p=XLSX.utils.json_to_sheet(d);p["!cols"]=[{wch:10},{wch:10},{wch:10},{wch:20},{wch:20},{wch:20},{wch:20}];XLSX.utils.book_append_sheet(u,p,"DataSheet 1");var g=XLSX.write(u,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,ft.saveAs)(new Blob([(0,bt.$iI)(g)],{type:""}),"transactions.xlsx")}else{var m=[e("components.orderExportExcel.index"),"ID",e("pages.shop.transaction.tradingName"),e("components.orderAdvanceFilter.tag"),e("pages.shop.transaction.transationCreator"),e("pages.shop.transaction.money"),e("pages.shop.transaction.effectiveAt")],h="A4";i&&(m.push(e("pages.shop.advertising.import.costDate"),"Page","Marketer",e("pages.shop.advertising.cost"),"Post"),h="A3"),m.push(e("note"),e("status"));var f=[m];d.forEach((function(t){var e=[];m.forEach((function(n){t[n]?e.push(t[n]):e.push("-")})),f.push(e)}));var y=[];m.map((function(t,n){t!=e("note")?n!=m.length-1?y.push("auto"):y.push("*"):y.push(90)}));var b={pageSize:h,content:[{layout:"lightHorizontalLines",table:{headerRows:1,widths:y,body:f},fontSize:10}]};pdfMake.createPdf(b).download("transactions")}a.handleCancel()})),(0,M.Z)((0,w.Z)(a),"handleChangeAdvertisingCost",(function(t){var e=a.props.shopId;a.setState({isCheckExportAdvertisingCost:t.target.checked},(function(){localStorage.setItem("export_advertising_cost_".concat(e),JSON.stringify(t.target.checked))}))})),(0,M.Z)((0,w.Z)(a),"handleChangeType",(function(t){t.stopPropagation(),a.setState({exportType:t.target.value})})),(0,M.Z)((0,w.Z)(a),"popoverContent",(function(){var t=a.state,e=t.exportType,n=t.isLoading,o=t.isCheckExportAdvertisingCost,r=a.props.t;return xt("div",null,xt("div",{className:"export-opt"},xt("span",{style:{marginRight:10}},xt(K.Z,null)," ",r("components.tablePlan.typeFile")),xt(wt,{value:e,onChange:a.handleChangeType},xt(P.default,{value:"pdf"},"PDF"),xt(P.default,{value:"excel"},"Excel"))),xt("div",{className:"export-opt export-checkbox"},xt(f.default,{onChange:a.handleChangeAdvertisingCost,checked:o},r("pages.shop.statistic.transaction.transactionAdvertising"))),n?xt("div",{className:"customer-send-messages-content",style:{textAlign:"center"}},xt(gt.default,{percent:a.getProgress(),style:{width:300,fontSize:16}})):xt(h.default,{style:{width:"100%",marginTop:10},onClick:a.handleFetchTransactions,type:"primary",icon:xt(n?tt.Z:W.Z,null)},r("components.customerExportExcel.download")))})),a.state={exportType:"pdf",isLoading:!1,transactions:[],isCheckExportAdvertisingCost:!1,advertisingCosts:[],visible:!1,totalEntries:0,totalSuccess:0},a}return(0,I.Z)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.t,a=e.selectedRowKeys,o=e.isButton,r=e.title,s=this.state.visible;return xt("div",{style:{display:"inline"}},xt(p.Z,{title:n("components.tablePlan.exportHistoryTransaction"),visible:s,onCancel:function(){return t.setState({visible:!1},(function(){return t.handleCancel()}))},footer:null},this.popoverContent()),xt(ut.Z,{tooltip:a.length>0?"".concat(n("components.orderExportExcel.export")," ").concat(a.length," ").concat(n("pages.shop.product.purchase.exportSelectToExcel")):n("pages.shop.product.purchase.exportSelectToExcel"),icon:xt(W.Z,null),isButton:o,title:r,onClick:function(){return t.setState({visible:!0})}}))}}]),n}(z.Component))||a,Nt=(0,vt.$j)((function(t){return{order_sources_custom:(0,Ct.ME)(t),users:t.user.users,warehouses:t.warehouse.warehouses}}),{fetchListOfTransactions:yt.iYf,loadAdvertisingCosts:yt.ha2})(It),At=n(4863),Ot=n(48176),Mt=n(20920),Rt=n(22318),Et=z.createElement;function Pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Dt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Pt(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ft(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var Lt=(0,_t.Z)()(Zt=function(t){(0,N.Z)(n,t);var e=Ft(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"componentDidMount",(function(){a.setState({isImportAdvertisingCost:!!localStorage.getItem("import_advertising_costs")&&JSON.parse(localStorage.getItem("import_advertising_costs"))})})),(0,M.Z)((0,w.Z)(a),"handleCloseModal",(function(){a.setState({isShowResult:!1,modalVisible:!1,fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[],dataError:[],stop:!1})})),(0,M.Z)((0,w.Z)(a),"onDrop",(function(t){var e=t.file,n=a.props.t,o=new FileReader;o.readAsBinaryString(e),o.onload=function(t){var o=t.target.result,r=XLSX.read(o,{type:"binary"}),s=r.SheetNames[0],i=XLSX.utils.sheet_to_json(r.Sheets[s],{raw:!0});if(0!=i.length){var c=(0,bt.wOl)(r.Sheets[s]),l=a.checkFields(c);0!=l.length?(Rt.Z.error(n("error"),"".concat(n("components.orderImportExcel.fieldsNotFound"),": ").concat(l.join())),a.setState({transactionFile:[],fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[]})):a.setState({transactionFile:i,fileName:e.name,importedCount:0,disableImportBtn:!1,isImporting:!1})}else Rt.Z.error(n("error"),n("components.productImportExcel.index.fileExcelEmpty")),a.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]})}})),(0,M.Z)((0,w.Z)(a),"checkFields",(function(t){return[(0,a.props.t)("pages.shop.transaction.import.tradingName")].reduce((function(e,n){return-1==t.findIndex((function(t){return t==n}))&&e.push(n),e}),[])})),(0,M.Z)((0,w.Z)(a),"confirmImport",(function(){a.setState({isShowResult:!0,importedCount:0,disableImportBtn:!0,isImporting:!0},(function(){a.sendRequest(0)}))})),(0,M.Z)((0,w.Z)(a),"loopChildren",(function(t,e,n){var a=null;return t.filter((function(t){return e==t.key})).map((function(t){var e=t.children.find((function(t){return(0,bt.Mle)(t.title)==(0,bt.Mle)(n)}));e&&(a={key:t.key.toString(),account:e.value,page_id:e.page_id})})),a})),(0,M.Z)((0,w.Z)(a),"renerSource",(function(t){var e=a.props,n=e.sources_custom,o=e.currentShop,r=(0,Mt.tF)(n,o),s=(t=t.split("/"))[t.length-1],i=r.find((function(t){return(0,bt.Mle)(t.title)==(0,bt.Mle)(s)}));if(!i){var c=r.reduce((function(t,e){return t.push({key:e.key,children:e.children||[]}),t}),[]),l=r.find((function(e){return(0,bt.Mle)(e.title)==(0,bt.Mle)(t[0])})).value;return a.loopChildren(c,l,s)}return{key:i.value.toString(),account:null,page_id:null}})),(0,M.Z)((0,w.Z)(a),"renderUserId",(function(t){var e=a.props.users;if(t){var n=e.find((function(e){return(0,bt.Mle)(e.user.name)==(0,bt.Mle)(t)}));return n?n.user_id:void 0}})),(0,M.Z)((0,w.Z)(a),"renderTags",(function(t){var e=a.props.currentShop.transaction_tags||[],n=t.includes(";")?";":",";t=t.toString().trim().split(n).filter((function(t){return t}));var o=[],r=[];return t.map((function(t){var n=e.find((function(e){return(0,bt.Mle)(e.name)==(0,bt.Mle)(t)}));n?o.push(n.key):r.push(t)})),{tagIds:o,errorTags:r}})),(0,M.Z)((0,w.Z)(a),"sendRequest",function(){var t=(0,T.Z)(S().mark((function t(e){var n,o,r,s,i,c,l,d,u,p,g,m,h,f,v,y,b,_,C,x,k,T,Z,w,I,N,A,O,M,R,E,P,D,F,L,U,j,B,V,z;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.props,o=n.shopId,r=n.accessToken,s=n.t,i=n.currentShop,c=a.state,l=c.transactionFile,d=c.importedCount,u=c.isImporting,p=c.dataError,g=c.isImportAdvertisingCost,!(e>l.length-1)){t.next=5;break}return a.setState({stop:!0}),t.abrupt("return");case 5:if(m=l[e],h={line_number:e+2,name:m[s("pages.shop.transaction.import.tradingName")],amount:m[s("pages.shop.transaction.import.money")],note:m[s("pages.shop.transaction.import.note")],tag_ids:m[s("pages.shop.transaction.import.tag")],payments:m[s("pages.shop.transaction.import.payment")],posted_at:m[s("pages.shop.transaction.effectiveAt")],is_accounting:m[s("pages.shop.transaction.isAccounting")],time_incurred:m[s("pages.shop.transaction.import.timeIncurred")],cost_date:m[s("pages.shop.advertising.import.costDate")]},f={page:m.Page,user_id:m.Marketer,cost:m[s("pages.shop.transaction.import.cost")],post_ids:m.Post,warehouse_id:m[s("pages.shop.transaction.import.warehouseId")],product_id:m[s("pages.shop.transaction.import.productId")]},v=a.validateFields(e,m),y=!v,b=m[s("pages.shop.transaction.import.tag")]?a.renderTags(m[s("pages.shop.transaction.import.tag")]):{tagIds:[],errorTags:[]},_=b.tagIds,C=b.errorTags,x=a.renderUserId(m.Marketer),!(!m[s("pages.shop.transaction.import.tradingName")]||!y||C.length>0||m.Marketer&&!x&&g)){t.next=28;break}return t.next=15,a.getTransactionNextLine([f],e+1,1,!0,[f]);case 15:return k=t.sent,k.items,T=k.count,Z=k.itemErrors,w=[],m[s("pages.shop.transaction.import.tradingName")]||w.push({message:s("pages.shop.transaction.errorTradingName"),success:!1}),y||w.push({message:v,success:!1}),C.length>0&&w.push({message:s("pages.shop.transaction.errorTags",{errorTags:C.join(", ")}),success:!1}),m.Marketer&&!x&&g&&w.push({message:s("pages.shop.transaction.errorUser",{errorUser:m.Marketer}),success:!1}),a.setState(st()(a.state,{resultArr:{$push:w},importedCount:{$set:d+1}})),h=Dt(Dt({},h),{},{items:Z}),p.push(h),t.abrupt("return",a.sendRequest(e+T));case 28:return I=m.Post?m.Post.toString().trim().split(";"):[],N=m.Page?a.renerSource(m.Page.toString().trim()):null,A={page:N,user_id:x,cost:m[s("pages.shop.transaction.import.cost")],post_ids:I,warehouse_id:m[s("pages.shop.transaction.import.warehouseId")],product_id:m[s("pages.shop.transaction.import.productId")],line_number:e+2},O=g?[A]:[],t.next=34,a.getTransactionNextLine(O,e+1,1,!1,[]);case 34:if(M=t.sent,R=M.items,E=M.count,P=M.itemErrors,!(R.length<E&&g)){t.next=44;break}return a.setState({importedCount:d+1}),P.unshift(f),h=Dt(Dt({},h),{},{items:P}),p.push(h),t.abrupt("return",a.sendRequest(e+E));case 44:D=(0,bt.Mle)(m[s("pages.shop.transaction.import.typeOfBill")])===(0,bt.Mle)(s("pages.shop.transaction.pay"))?-m[s("pages.shop.transaction.import.money")]:m[s("pages.shop.transaction.import.money")],F=(0,bt._MS)(m[s("pages.shop.transaction.effectiveAt")]),L=(0,bt._MS)(m[s("pages.shop.advertising.import.costDate")]),U=(0,bt._MS)(m[s("pages.shop.transaction.import.timeIncurred")]),j=(j=m[s("pages.shop.transaction.import.payment")]?m[s("pages.shop.transaction.import.payment")].toString().trim().split(";"):[]).reduce((function(t,e){var n=(0,bt.rWq)(i.bank_payments).find((function(t){return(0,bt.Mle)(t.text)==(0,bt.Mle)(e)}));return n&&t.push(n.value),t}),[]),B=(0,bt.Mle)(m[s("pages.shop.transaction.isAccounting")])===(0,bt.Mle)(s("pages.shop.transaction.yesValue")),h=Dt(Dt({},h),{},{posted_at:F,time_incurred:U,payments:j,tags:_,is_accounting:B,cost_date:L}),V={},g||(V={transaction:Dt(Dt({},h),{},{amount:parseInt(D)}),type:"import"}),g&&(V={transaction:h,items:R}),a.state.modalVisible&&u&&(z=g?"".concat((0,bt.LpH)(),"/shops/").concat(o,"/adv_costs/import?access_token=").concat(r):"".concat((0,bt.LpH)(),"/shops/").concat(o,"/transactions?access_token=").concat(r),ht().post(z,V).then((function(t){var n=t.data;if(n.success){var o=n.data.message;if(o)p.push(V),a.setState(st()(a.state,{resultArr:{$push:[{message:o,success:!1}]}}));else{a.setState(st()(a.state,{resultArr:{$push:[{message:null,success:!0}]}}));var r=g?n.shop_transaction:n.data;a.props.createTransactionSuccess(r)}}else p.push(V),a.setState(st()(a.state,{resultArr:{$push:[{message:n.message,success:!1}]}}));return a.setState({importedCount:d+1}),a.sendRequest(e+E)})).catch((function(t){p.push(V);var n=t.response&&t.response.data&&t.response.data.message;a.setState(st()(a.state,{resultArr:{$push:[{message:n||s("action.unknownError"),success:!1}]},importedCount:{$set:d+1}})),a.sendRequest(e+E)})));case 56:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,M.Z)((0,w.Z)(a),"getTransactionNextLine",(function(t,e,n,o,r){var s=a.state,i=s.transactionFile,c=s.isImportAdvertisingCost,l=a.props.t,d=i[e];if(e>i.length-1||d[l("pages.shop.transaction.import.tradingName")])return{items:t,count:n,itemErrors:r};var u=d.Post?d.Post.toString().trim().split(";"):[],p=d.Page?a.renerSource(d.Page.toString().trim()):null,g=a.renderUserId(d.Marketer),m={page:o?d.Page:p,user_id:o?d.Marketer:g,cost:d[l("pages.shop.transaction.import.cost")],post_ids:o?d.Post:u,warehouse_id:d[l("pages.shop.transaction.import.warehouseId")],product_id:d[l("pages.shop.transaction.import.productId")],line_number:e+2},h=a.validateFields(e,d);if(h||d.Marketer&&!g&&c){var f=[];return h&&f.push({message:h,success:!1}),d.Marketer&&!g&&c&&f.push({message:l("pages.shop.transaction.errorUser",{errorUser:d.Marketer}),success:!1}),a.setState(st()(a.state,{resultArr:{$push:f}})),a.getTransactionNextLine(t,e+1,n+1,o,r.concat(m))}return a.getTransactionNextLine(t.concat(m),e+1,n+1,o,r.concat(m))})),(0,M.Z)((0,w.Z)(a),"validateFields",(function(t,e){var n=a.props,o=n.t,r=n.currentShop.currency,s=a.state.isImportAdvertisingCost,i=bt.cvg.includes(r),c="".concat(o("components.productImportExcel.index.errorNumber")," ").concat(t+2,": ");return e[o("pages.shop.transaction.import.money")]&&(!Number.isInteger((0,bt.WNN)(e[o("pages.shop.transaction.import.money")]))&&i||e[o("pages.shop.transaction.import.money")]<0)&&(c+="".concat(o("pages.shop.transaction.import.money")," ").concat(o("pages.shop.transaction.errorMoney"))),s&&(!e[o("pages.shop.transaction.import.cost")]||!Number.isInteger((0,bt.WNN)(e[o("pages.shop.transaction.import.cost")]))&&i||e[o("pages.shop.transaction.import.cost")]<=0)&&(c+="".concat(o("pages.shop.transaction.import.cost")," ").concat(o("pages.shop.transaction.errorMoney"))),c!="".concat(o("components.productImportExcel.index.errorNumber")," ").concat(t+2,": ")&&c})),(0,M.Z)((0,w.Z)(a),"renderError",(function(){return a.state.resultArr.map((function(t,e){var n=e+1;return t.success?void 0:Et("div",{key:e,style:{width:"100%",color:"red"}},Et("span",null," ",Et("strong",null,"#".concat(n))," "),"\xa0",Et("span",{className:"text-danger"}," ",t.message," "))}))})),(0,M.Z)((0,w.Z)(a),"renderSuccess",(function(){var t=a.state.resultArr,e=a.props.t;return t.map((function(t,n){var a=n+1;return t.success?Et("div",{key:n,style:{width:"100%",color:"green"}},Et("span",null," ",Et("strong",null,"#".concat(a))," "),"\xa0",Et("span",{className:"text-success"},e("success"))):void 0}))})),(0,M.Z)((0,w.Z)(a),"downloadListError",(function(){var t=a.state.dataError,e=a.props.t,n=[];t.map((function(t){t.items.map((function(a,o){var r,s;0==o?n.push((r={},(0,M.Z)(r,e("pages.shop.transaction.import.tradingName"),t.name||""),(0,M.Z)(r,e("pages.shop.transaction.import.typeOfBill"),t.amount&&parseInt(t.amount)<0?e("pages.shop.transaction.collect"):e("pages.shop.transaction.pay")),(0,M.Z)(r,e("pages.shop.transaction.import.money"),t.amount?parseInt(t.amount):""),(0,M.Z)(r,e("pages.shop.transaction.import.note"),t.note||""),(0,M.Z)(r,e("pages.shop.transaction.import.tag"),t.tags||""),(0,M.Z)(r,e("pages.shop.transaction.import.payment"),t.payments||""),(0,M.Z)(r,e("pages.shop.transaction.effectiveAt"),t.posted_at||""),(0,M.Z)(r,e("pages.shop.transaction.import.timeIncurred"),t.time_incurred||""),(0,M.Z)(r,e("pages.shop.advertising.import.costDate"),t.cost_date),(0,M.Z)(r,"Page",a.page),(0,M.Z)(r,"Marketer",a.user_id),(0,M.Z)(r,e("pages.shop.transaction.import.cost"),a.cost),(0,M.Z)(r,"Post",a.post_ids),r)):n.push((s={Page:a.page,Marketer:a.user_id},(0,M.Z)(s,e("pages.shop.transaction.import.cost"),a.cost),(0,M.Z)(s,"Post",a.post_ids),s))}))}));var o={SheetNames:[],Sheets:{}},r=XLSX.utils.json_to_sheet(n);n.length&&(r["!cols"]=Object.keys(n[0]).map((function(t){var e=t?10*t.toString().length:150;return{wpx:e>120?e:120}})));XLSX.utils.book_append_sheet(o,r,"DataSheet 1");var s=XLSX.write(o,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,ft.saveAs)(new Blob([(0,bt.$iI)(s)],{type:""}),"error_file.xlsx")})),(0,M.Z)((0,w.Z)(a),"renderListFileError",(function(){var t=a.props.t;return Et("div",{style:{marginTop:10}},Et("span",{style:{marginTop:10,fontSize:15}},t("pages.shop.transaction.downloadErrorListFile")),Et("strong",{style:{cursor:"pointer",color:"#003399",fontWeight:"bold"},onClick:function(){return a.downloadListError()}},Et(W.Z,null)," ",t("components.productSupplierImportExcel.here")))})),(0,M.Z)((0,w.Z)(a),"handleCheckBox",(function(t){t.stopPropagation(),a.setState({isImportAdvertisingCost:t.target.checked}),localStorage.setItem("import_advertising_costs",JSON.stringify(t.target.checked))})),(0,M.Z)((0,w.Z)(a),"getModalContent",(function(){var t=a.state,e=t.isImporting,n=t.fileName,o=t.disableImportBtn,r=t.transactionFile,s=t.importedCount,i=t.resultArr,c=t.isImportAdvertisingCost,l=a.props,d=l.t,p=l.i18n,g=i.filter((function(t){return t.success})).length,m=i.filter((function(t){return!t.success})).length,v=r.filter((function(t){return t[d("pages.shop.transaction.import.tradingName")]})).length||r.length,y="vi"==p.language?"/static/files/import_transactions.xlsx":"/static/files/import_transactions_en.xlsx";return Et("div",null,!e&&Et(At.default,{message:d("notes"),description:Et("div",{style:{fontSize:14}},d("pages.shop.transaction.writtenInTheCorrectFormat")," (",Et("a",{target:"_blank",href:y},d("components.productImportExcel.index.sampleFile")),")"),type:"warning",showIcon:!0}),!e&&Et("div",{style:{borderBottom:"1px dashed #d9d9d9",borderTop:"1px dashed #d9d9d9",display:"flex",padding:"5px 0"}},Et(f.default,{onChange:a.handleCheckBox,checked:c},d("pages.shop.advertising.advertisingCost"))),e?null:Et("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},Et(u.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:a.onDrop},Et(h.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},n?Et("span",null,Et(X.Z,null),n):Et("span",null,Et(Ot.Z,null)," ",d("components.productSupplierImportExcel.chooseFile")))),Et(h.default,{type:"primary",onClick:a.confirmImport,disabled:o},d("components.productSupplierImportExcel.start"))),Et("div",null,s<=r.length&&e?Et("div",{style:{width:520,display:"flex",flexDirection:"column",alignItems:"center"}},Et(gt.default,{type:"circle",percent:Math.floor(100*s/v),style:{marginBottom:10}})):null,e&&s>0&&s==r.filter((function(t){return void 0!=t[d("pages.shop.transaction.import.tradingName")]})).length?Et("h4",{style:{textAlign:"center"}},Et("span",{style:{color:"#00a854"}},"".concat(d("components.productImportExcel.index.importSuccess")," ").concat(g," ").concat(d("components.productSupplierImportExcel.productSupplier"))),Et("span",{style:{color:"#f04134"}},"".concat(m>0?", ".concat(d("pages.admin.failure")," ").concat(m," ").concat(d("components.productSupplierImportExcel.productSupplier")):""))):null,e?Et("div",{style:{maxHeight:700,width:"100%",display:"flex",flexDirection:"column",border:"1px solid #d9d9d9",borderRadius:2,marginTop:10,padding:10,overflow:"auto"},id:"importing-info"},a.renderError(),a.renderSuccess()):null))})),a.state={modalVisible:!1,fileName:"",transactionFile:[],disableImportBtn:!0,isShowResult:!1,isImporting:!1,resultArr:[],dataError:[],stop:!1,isImportAdvertisingCost:!1},a}return(0,I.Z)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.t,a=e.isButton,o=e.title,r=this.state,s=r.modalVisible,i=r.stop;return Et("div",{style:{display:"inline"}},Et(ut.Z,{title:o,icon:Et(K.Z,null),color:"#00d1b2",onClick:function(){return t.setState({modalVisible:!0})},isButton:a}),s&&Et(p.Z,{visible:s,onCancel:function(){t.setState({isShowResult:!1,modalVisible:!1,fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[],dataError:[],stop:!1})},title:n("pages.shop.transaction.importTransactions"),footer:null,wrapClassName:"modal-updating"},this.getModalContent(),Et("div",null,i?this.renderListFileError():"")))}}]),n}(z.Component))||Zt,Ut=(0,vt.$j)((function(t){return{sources_custom:(0,Ct.ME)(t),users:t.user.users}}),{fetchListOfTransactions:yt.iYf,createTransactionSuccess:yt.zGg})(Lt),jt=n(2603),Bt=n(57254),Vt=z.createElement;function zt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Yt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zt(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ht(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var Kt,Wt=function(t){(0,N.Z)(n,t);var e=Ht(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"getStatus",(function(){var t=a.props.transaction,e=t.id,n=t.is_locked,o=t.transaction_ref_id;if(n)return[];if(!e)return[0,1,2];switch(a.state.status){case 0:return[1,3];case 1:return o?[3]:[2,3];case 2:return[3];case 3:return[]}})),(0,M.Z)((0,w.Z)(a),"onClick",(function(t){var e=t.key,n=a.props,o=n.onChange,r=n.updateTransactions,s=n.accessToken,i=n.shopId,c=n.transaction,l=n.callback;o?a.props.onChange(parseInt(e)):(a.setState({isLoading:!0}),r(s,i,Yt(Yt({},c),{},{status:e})).then((function(){return a.setState({isLoading:!1,status:parseInt(e)},l)})))})),(0,M.Z)((0,w.Z)(a),"getTransactionStatusAction",(function(){return{0:{text:a.props.t("pages.shop.transaction.new")},1:{text:a.props.t("pages.shop.transaction.approval")},2:{text:a.props.t("pages.shop.transaction.cancel")},3:{text:a.props.t("pages.shop.transaction.remove")}}})),a.state={isLoading:!1,status:t.transaction.status},a}return(0,I.Z)(n,[{key:"render",value:function(){var t=this,e=this.state.isLoading,n=this.props,a=n.size,o=n.transaction,r=(0,bt.Lvs)()[o.status],s=this.getStatus();return"large"==a&&(s=F()(s.concat([this.state.status]))),Vt(d.default,{content:Vt(b.default,{className:"dropdown-container",onClick:this.onClick},s.map((function(n){var a=t.getTransactionStatusAction()[n];return Vt(b.default.Item,{disabled:e,key:n},a.text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},Vt(h.default,{disabled:e||o.is_locked,type:"primary",style:{fontSize:"large"==a?14:12,width:"large"==a?170:140,height:"large"==a?32:22,background:r.bgColor,borderColor:r.bgColor,position:"relative",overflow:"hidden",padding:"0 5px",color:"#fff"}},r.text,this.state.isLoading&&Vt(tt.Z,{style:{position:"absolute",left:5,top:"calc((100% / 2) - 6px)"}}),o.is_locked?Vt(jt.Z,{style:{position:"absolute",right:6,top:"calc((100% / 2) - 6px)"}}):s.length>0&&Vt(Bt.Z,{style:{position:"absolute",right:5,top:"calc((100% / 2) - 5px)"}})))}}]),n}(z.Component),qt=(0,vt.$j)(null,{updateTransactions:yt.Cib})(Wt),Gt=n(50916),$t=n(60676),Xt=n(28969),Jt=n(68157),Qt=n(92902),te=n(48519),ee=n(14320),ne=n.n(ee),ae=n(2307),oe=n(45578),re=n.n(oe),se=n(18446),ie=n.n(se),ce=n(73218),le=n(81463),de=n.n(le),ue=n(7463),pe=n(82732),ge=n(97705),me=n(24894),he=z.createElement;function fe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function ve(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?fe(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ye(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var be,_e=E.default.Option,Ce={cost_date:null,creator_id:null,items:[{source:null,user_id:null,cost:0,post_ids:[],posts:[],key:(0,bt.uuG)()}]},xe=(0,_t.Z)()(Kt=function(t){(0,N.Z)(n,t);var e=ye(n);function n(t){var a;(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"columns",[{title:"Page",dataIndex:"pageId",ellipsis:!0,fixed:"left"},{title:a.props.t("pages.shop.advertising.warehouse"),dataIndex:"warehouse",ellipsis:!0},{title:"Marketer",dataIndex:"marketer",ellipsis:!0},{title:a.props.t("products.title"),dataIndex:"productId",width:"15%"},{title:a.props.t("pages.shop.advertising.typeCustomer"),dataIndex:"typeCustomer",ellipsis:!0},{title:"Livestream",dataIndex:"livestream",ellipsis:!0,align:"center",width:"7%"},{title:a.props.t("pages.shop.advertising.cost"),dataIndex:"cost",ellipsis:!0,width:"13%"},{title:"Post Id",dataIndex:"postId",ellipsis:!0,width:"15%"},{title:"Link",dataIndex:"link_utm",ellipsis:!0},{title:"UTM source",dataIndex:"utm_source",ellipsis:!0},{title:"UTM medium",dataIndex:"utm_medium",ellipsis:!0},{title:"UTM campaign",dataIndex:"utm_campaign",ellipsis:!0},{title:"UTM term",dataIndex:"utm_term",ellipsis:!0},{title:"UTM content",dataIndex:"utm_content",ellipsis:!0},{dataIndex:"delete",width:"5%",align:"center",fixed:"right",title:function(){return he("div",null,"show"!=a.props.type&&he(h.default,{onClick:function(){return a.handleAddItem()},type:"primary",size:"small",icon:he(et.Z,null)}))}}]),(0,M.Z)((0,w.Z)(a),"handleSyncData",(function(){var t=a.state.params,e=a.props.type;["create","update"].includes(e)&&a.props.sync(t)})),(0,M.Z)((0,w.Z)(a),"handleChange",(function(t,e,n){var o=a.state.params,r=U()(o);r.items[n][t]=e,"product_id"==t&&(r.items[n].product=e),"variation_id"==t&&(r.items[n].variation=e),a.setState({params:r},(function(){return a.handleSyncData()}))})),(0,M.Z)((0,w.Z)(a),"handleChangeUTM",(function(t,e,n){var o=a.state.params,r=U()(o),s=r.items[n].utm;s||(s={link_utm:null,utm_source:null,utm_medium:null,utm_campaign:null,utm_term:null,utm_content:null}),s[t]=e,r.items[n].utm=s,a.setState({params:r},(function(){return a.handleSyncData()}))})),(0,M.Z)((0,w.Z)(a),"compareSources",(function(t,e){return e.count-t.count})),(0,M.Z)((0,w.Z)(a),"onChangeCascaderOrderSource",function(){var t=(0,T.Z)(S().mark((function t(e,n){var o,r,s,i,c,l,d,u,p,g,m,h;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=a.state,r=o.optionsSource,s=o.params,i=a.props.currentShop,c=U()(s),l=e[0],d=e[1]||null,u=i.pages.find((function(t){return t.id==d})),p={key:l,account:d,page_id:u?u.id:null},l||d||(p={}),r.map((function(t){if(t.value==l){t.count+=1;var e=(t.children||[]).findIndex((function(t){return t.value==d}));e>-1&&(t.children[e].count+=1)}})),g=[],r.sort(a.compareSources).map((function(t){var e;e=t.children&&t.children.length>0?t.children.sort(a.compareSources):t.children||[],g.push(ve(ve({},t),{},{children:e}))})),m=[],g.map((function(t){var e;t.children&&t.children.length>0&&(e=t.children.map((function(t){return{count:t.count,value:t.value}}))),m.push({value:t.value,count:t.count,childrenSort:e})})),localStorage.setItem("adv_cost_sources_sort",JSON.stringify(m)),!u||c.items[n].id&&c.items[n].source.page_id==u.id){t.next=21;break}return t.next=17,a.loadPost(u.id);case 17:h=t.sent,c.items[n].posts=h,t.next=23;break;case 21:c.items[n].post_ids=[],c.items[n].posts=[];case 23:c.items[n].source=p,a.setState({params:c,optionsSource:g},(function(){return a.handleSyncData()}));case 25:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),(0,M.Z)((0,w.Z)(a),"getValueCascader",(function(t){var e=a.props,n=e.sources_custom,o=e.currentShop;!t||t.key&&"-1"!=t.key||re()((0,bt.K5C)(n,o).concat((0,bt.caL)(o)),"id").map((function(e){e.id&&"-1"==e.id.toString()&&t&&(t.key="-1")}));return t&&t.key?[t.key,t.account]:void 0})),(0,M.Z)((0,w.Z)(a),"onSelectProduct",(function(t,e){return function(n){var o=a.state,r=o.searchResult,s=o.isSearchId,i=r.find((function(t){return t.id==n})),c=U()(a.state.params);c.items[e].product_id=n,c.items[e].product=i;var l=s.findIndex((function(e){return e==t}));l>-1&&s.splice(l,1),a.setState({params:c,isSearchId:s},(function(){return a.handleSyncData()}))}})),(0,M.Z)((0,w.Z)(a),"renderProduct",(function(t){return he("div",null,he("div",{style:{marginRight:3}},(null===t||void 0===t?void 0:t.name)||""),null!==t&&void 0!==t&&t.display_id?he(x.default,{style:{marginRight:3},color:"green"},t.custom_id||(0,bt.pyT)(t.display_id,0)):null)})),(0,M.Z)((0,w.Z)(a),"getData",(function(){var t,e=a.props,n=e.users,o=e.currentShop,r=e.t,s=e.timezone,i=e.accessToken,c=e.type,l=e.warehouses,d=e.shopId,u=(e.sources_custom,a.state),p=u.optionsSource,g=u.searchResult,m=a.state.isSearchId,h=function(t,e){return e.some((function(e){return(0,bt.Mle)(e.title).indexOf((0,bt.Mle)(t))>-1}))},y=function(t,e,n,a){return e.map((function(e,a){var o=e.title,r=(0,bt.Mle)(t),s=(0,bt.Mle)(o).indexOf(r)>-1?function(t,e,n){var a=(0,bt.Mle)(t).indexOf(e);if(a>-1){var o=t.substr(0,a),r=t.substr(a,e.length),s=t.substr(a+e.length,t.length);return he("span",null,o,he("span",{className:"".concat(n,"-menu-item-keyword")},r),s)}return t}(o,r,n):o;return 0===a?s:[" / ",s]}))};return null===(t=a.state.params)||void 0===t?void 0:t.items.map((function(t,e){var u,b,_,k,S,T,Z,w=t.product,I=t.id||t.key;return{key:I,pageId:he(me.Z,{className:"order-source-options",popupClassName:"order-source-popup",optionsSource:p,source:(null===(u=t.source)||void 0===u?void 0:u.key)||null,placeholder:r("containers.formBox.selectOrderSource"),value:a.getValueCascader(t.source),onChange:function(t){return a.onChangeCascaderOrderSource(t,e)},changeOnSelect:!0,showSearch:{filter:h,render:y,sort:function(){return 0}}}),warehouse:he(E.default,{value:t.warehouse_id,style:{width:"100%"},allowClear:!0,onChange:function(t){return a.handleChange("warehouse_id",t,e)},placeholder:r("pages.shop.advertising.selectWarehouse"),className:"select-advertising",dropdownMatchSelectWidth:!1},l.map((function(t){return he(_e,{key:t.id,value:t.id},t.name)}))),marketer:he(E.default,{style:{width:"100%"},placeholder:r("pages.shop.advertising.selectEmployee"),value:t.user_id,onChange:function(t){return a.handleChange("user_id",t,e)},allowClear:!0,showSearch:!0,filterOption:function(t,e){return(0,bt.st5)(t,e.name)},dropdownMatchSelectWidth:!1},n.map((function(t,e){return he(_e,{key:e,value:t.user_id,name:t.user.name},he("div",{style:{display:"flex"}},he(Gt.Z,{name:t.user.name,style:{marginRight:7},avatar_url:t.user.avatar_url,id:t.user.fb_id,seed:t.user_id,size:[25,25]}),he("span",{style:{lineHeight:2}},t.user.name)))}))),productId:!w||m.includes(I)?he(ge.Z,{accessToken:i,shopId:d,searchResult:g,callback:function(t){return a.setState({searchResult:t})},style:{width:"100%",margin:0},filterProduct:!0,onSelect:a.onSelectProduct(I,e),is_filter:!0,combo_by:"product",type:"advertising-cost",autoFocus:!0,callbackOnBlur:function(){var t=m.findIndex((function(t){return t==I}));t>-1&&m.splice(t,1),a.setState({isSearchId:m})},allowClear:!0}):he(C.default,{title:a.renderProduct(w),placement:"topLeft"},he("a",{onClick:function(){-1==m.findIndex((function(t){return t==I}))&&m.push(I),a.setState({isSearchId:m})},className:"info-product"},he("div",null,(null===w||void 0===w?void 0:w.name)||"",null!==w&&void 0!==w&&w.display_id?he(x.default,{color:"green"},w.custom_id||(0,bt.pyT)(w.display_id,0)):null,he(ce.Z,{className:"icon-close-product",onClick:function(){return a.handleChange("product_id",null,e)}})))),cost:he(ue.default,{currency:o.currency,isMoney:!0,value:t.cost,callBack:function(t){return a.handleChange("cost",t,e)},suffix:(0,bt.jKf)(o.currency)}),postId:he(E.default,{mode:"tags",placeholder:r("pages.shop.advertising.postId"),value:t.post_ids,optionLabelProp:"label",onChange:function(t){return a.handleChange("post_ids",t,e)},disabled:(!t.posts||0==t.posts.length)&&(!t.source||!t.source.page_id),style:{width:"100%"},className:"select-advertising",dropdownMatchSelectWidth:!1},t&&t.posts&&t.posts.length&&t.posts.map((function(t,e){return he(_e,{key:e,value:t.id,label:t.id},(0,pe.JS)(t,{accessToken:i,timezone:s,isCascader:!1}))}))),typeCustomer:he(E.default,{placeholder:r("pages.shop.advertising.typeCustomer"),value:t.type_customer,onChange:function(t){return a.handleChange("type_customer",t,e)},style:{width:"100%"},dropdownClassName:"dropdown-select-type-customer",allowClear:!0,dropdownMatchSelectWidth:!1},he(_e,{key:"Wholesale",value:"Wholesale"},r("components.orderAdvanceFilter.wholesale")),he(_e,{key:"Retail",value:"Retail"},r("components.orderAdvanceFilter.retail"))),livestream:he(f.default,{checked:t.is_livestream,onChange:function(t){return a.handleChange("is_livestream",t.target.checked,e)}}),link_utm:he(R.default,{placeholder:r("containers.formBox.link"),value:null===(b=t.utm)||void 0===b?void 0:b.link_utm,onChange:function(t){return a.handleChangeUTM("link_utm",t.target.value,e)}}),utm_source:he(R.default,{placeholder:r("containers.formBox.utmSource"),value:null===(_=t.utm)||void 0===_?void 0:_.utm_source,onChange:function(t){return a.handleChangeUTM("utm_source",t.target.value,e)}}),utm_medium:he(R.default,{placeholder:r("containers.formBox.utmMedium"),value:null===(k=t.utm)||void 0===k?void 0:k.utm_medium,onChange:function(t){return a.handleChangeUTM("utm_medium",t.target.value,e)}}),utm_campaign:he(R.default,{placeholder:r("containers.formBox.utmCampaign"),value:null===(S=t.utm)||void 0===S?void 0:S.utm_campaign,onChange:function(t){return a.handleChangeUTM("utm_campaign",t.target.value,e)}}),utm_term:he(R.default,{placeholder:r("containers.formBox.utmTerm"),value:null===(T=t.utm)||void 0===T?void 0:T.utm_term,onChange:function(t){return a.handleChangeUTM("utm_term",t.target.value,e)}}),utm_content:he(R.default,{placeholder:r("containers.formBox.utmContent"),value:null===(Z=t.utm)||void 0===Z?void 0:Z.utm_content,onChange:function(t){return a.handleChangeUTM("utm_content",t.target.value,e)}}),delete:a.state.params&&a.state.params.items.length>1&&"show"!=c?he(ce.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){var t=a.state.params,n=(0,v.Z)(t.items);n.splice(e,1),t.items=n,a.setState({params:t},(function(){return a.handleSyncData()}))}}):""}}))})),(0,M.Z)((0,w.Z)(a),"loadPost",function(){var t=(0,T.Z)(S().mark((function t(e){var n,o,r,s,i;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=a.props,o=n.accessToken,r=n.shopId,s=n.loadPost,i=[],t.next=4,s(o,r,{page_id:e}).then((function(t){i=t}));case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,M.Z)((0,w.Z)(a),"onChangeFilterDate",(function(t,e){var n=ve({},a.state.params);n.cost_date=t?t.toDate().toISOString():null,a.setState({params:n},(function(){return a.handleSyncData()}))})),(0,M.Z)((0,w.Z)(a),"handleAddItem",(function(){var t=a.state.params,e=U()(t);e.items.push({source:null,user_id:null,cost:0,posts:[],post_ids:[]}),a.setState({params:e},(function(){return a.handleSyncData()}))}));var o=t.params;return o=U()(o)||Ce,a.state={isLoading:!1,params:o,isCreating:!t.params||!t.params.id,isLoadingItem:!o.items,optionsSource:(0,bt.Uc_)((0,Mt.tF)(t.sources_custom,t.currentShop)),searchResult:[],isSearchId:[]},a}return(0,I.Z)(n,[{key:"componentDidUpdate",value:function(t){if(!ie()(t.params,this.props.params)){var e=this.props.params||Ce;this.setState({params:e,isCreating:!this.props.params||!this.props.params.id,isLoadingItem:!e.items||!1})}}},{key:"render",value:function(){var t,e,n,a,s,i,c,l,d=this.props,u=d.t,p=d.timezone,g=d.currentShop,m=d.type,h=this.state,f=h.params,v=h.isLoadingItem,y="show"==m,b=["livestream","delete"],_=this.columns.map((function(t){return t.dataIndex?b.includes(t.dataIndex)||(t.width=200):t.width=0,"livestream"==t.dataIndex&&(t.width=100),t})),x=(0,bt.f2Q)(_);return he("div",null,he("div",{className:"advertising-info"},he("div",{style:null!==f&&void 0!==f&&f.display_id?{flex:1}:{}},he("div",{style:{fontWeight:500,marginBottom:4}},u("pages.shop.advertising.dateAdvertisingCost")),he(o.default,{style:{width:220},format:"DD/MM/YYYY",onChange:this.onChangeFilterDate,disabled:y,value:null!==f&&void 0!==f&&f.cost_date?ct()("".concat((0,bt.o0x)(p,f.cost_date,!1,"DD/MM/YYYY")),"DD/MM/YYYY"):null})),f&&f.display_id&&he("div",{style:{flex:2,alignSelf:"flex-end"}},he("div",{style:{display:"flex"}},he("div",{style:{flex:1,display:"flex",alignItems:"center"}},he("strong",{className:"advertising-label"},u("pages.shop.advertising.creator"),":"),he("div",{style:{display:"contents"}},he(Gt.Z,{name:null===(t=f.creator)||void 0===t?void 0:t.name,style:{marginRight:5},avatar_url:null===(e=f.creator)||void 0===e?void 0:e.avatar_url,id:f.creator.fb_id,seed:null===(n=f.creator)||void 0===n?void 0:n.id,size:[25,25]}),he("span",{style:{marginLeft:5}},f.creator.name))),he("div",{style:{flex:1,display:"flex",alignItems:"center"}},he("strong",{className:"advertising-label"},u("pages.shop.advertising.inserted"),":"),he("div",{style:{display:"contents"}},he("span",null,(0,bt.o0x)(p,f.inserted,!0))))),he("div",{style:{display:"flex"}},he("div",{style:{flex:1,display:"flex",alignItems:"center"}},he("strong",{className:"advertising-label"},u("pages.shop.advertising.editor"),":"),he("div",{style:{display:"contents"}},he(Gt.Z,{name:null===(a=f.last_editor)||void 0===a?void 0:a.name,style:{marginRight:5},avatar_url:null===(s=f.last_editor)||void 0===s?void 0:s.avatar_url,id:null===(i=f.last_editor)||void 0===i?void 0:i.fb_id,seed:null===(c=f.last_editor)||void 0===c?void 0:c.id,size:[25,25]}),he("span",{style:{marginLeft:5}},null===(l=f.last_editor)||void 0===l?void 0:l.name))),he("div",{style:{flex:1,display:"flex",alignItems:"center"}},he("strong",{className:"advertising-label"},u("pages.shop.advertising.updated"),":"),he("div",{style:{display:"contents"}},he("span",null,(0,bt.o0x)(p,f.updated,!0))))))),v?he("div",{style:{width:"100%",textAlign:"center"}},he(r.default,null)):he("div",{style:{position:"relative"}},he(ae.Z,{bordered:!0,columns:this.columns,dataSource:this.getData(),size:"small",scroll:{x:x,y:195},pagination:!1,className:"advertising-table",footer:function(){var t=0;return f&&f.items.map((function(e){t+=e.cost})),he("div",{style:{textAlign:"right"}},he("span",null,he(C.default,{title:"".concat(u("pages.shop.advertising.total"),": ").concat((0,bt.ufS)(t,g.currency))},u("pages.shop.advertising.total"),":",he("strong",null," ",(0,bt.ufS)(t,g.currency)))))}})),he("style",{dangerouslySetInnerHTML:{__html:de()}}))}}]),n}(z.Component))||Kt,ke=(0,vt.$j)((function(t){return{currentShop:t.shop.currentShop,users:t.user.users,creator:t.navigation.user.uid,sources_custom:(0,Ct.ME)(t),warehouses:(0,Ct.op)(t)}}),{createAdvertisingCost:yt.id8,updateAdvertisingCost:yt.jZ8,loadPost:yt.HVw})(xe),Se=n(7690),Te=n(33786),Ze=n(57557),we=n.n(Ze),Ie=n(76043),Ne=n(8212),Ae=n(73171),Oe=n(88282),Me=n(87307),Re=n(63144),Ee=n(51181),Pe=z.createElement;function De(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Fe(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?De(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Le(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var Ue,je=(0,_t.Z)()(be=function(t){(0,N.Z)(n,t);var e=Le(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"onExpand",(function(t){a.setState({expandedKeys:t,autoExpandParent:!1})})),(0,M.Z)((0,w.Z)(a),"onSearchChange",(function(t){var e=t.target.value,n=(0,v.Z)(a.state.expandedKeys);e&&(n=[],a.state.tags.forEach((function(t){(0,bt.Mle)(t.name).indexOf((0,bt.Mle)(e))>-1&&n.push(t.key)})),n=F()(n)),a.setState({search:e,autoExpandParent:!0,expandedKeys:n})})),(0,M.Z)((0,w.Z)(a),"getTagNodes",(function(t,e){if(!t||t&&0==t.length)return[];var n=a.state,o=n.action,r=n.editting;return t.filter((function(t){return t.parent_key===e})).map((function(e){var n={height:40};return"createChildren"==o&&e.key==r.parent_key&&(n={height:88,background:"#F0F5FF"}),"update"==o&&e.key==r.key&&(n={height:46,background:"#F0F5FF"}),"delete"==o&&e.key==r.key&&(n={height:96,background:"#FFF1F0"}),{title:a.renderItemTitle(e),key:e.key,value:e.key,children:a.getTagNodes(t,e.key),style:Fe(Fe({},n),{},{width:"100%",display:"flex",borderTop:t.filter((function(t){return!t.parent_key})).map((function(t){return t.key})).includes(e.key)?"1px solid #D9D9D9":"none"})}}))})),(0,M.Z)((0,w.Z)(a),"renderUpdateItem",(function(){var t=a.state,e=t.editting,n=t.isLoading,o=t.action,r=a.props.t,s={};return"create"==o&&(s={border:"1px solid #ADC6FF",marginBottom:16,borderRadius:2,padding:"8px 16px",background:"#F0F5FF"}),"createChildren"==o&&(s={borderTop:"1px solid #ADC6FF",marginTop:8,borderRadius:2,paddingTop:8}),Pe("div",{style:Fe({display:"flex",justifyContent:"space-between",alignItems:"center"},s)},Pe(R.default,{value:e.name,onChange:function(t){return a.onChangeData(t.target.value,"name")},placeholder:"Nh\u1eadp t\xean th\u1ebb",style:{width:"100%"},ref:function(t){return a.input=t}}),Pe(d.default,{overlayClassName:"popover-color-type",placement:"bottom",content:Pe("div",{onClick:function(t){return t.stopPropagation()}},Pe(Re.AI,{style:{border:"none"},color:e.color||"#3922a8",onChangeComplete:function(t){return a.onChangeData(t.hex,"color")}}))},Pe("div",{style:{width:32,height:32,borderRadius:"50%",backgroundColor:e.color||"#3922a8",marginLeft:10}},Pe(Ie.Z,{style:{cursor:"pointer",fontSize:20,color:"#fff",padding:6}}))),Pe("div",{style:{display:"flex",marginLeft:16}},Pe(h.default,{onClick:function(){return a.setState({editting:{},action:"",selected:{}})},style:{marginRight:12},disabled:n},r("cancel")),Pe(h.default,{loading:n,icon:Pe(nt.Z,null),onClick:a.handleSave,type:"primary"},r("pages.shop.setting.application.save"))))})),(0,M.Z)((0,w.Z)(a),"renderItemTitle",(function(t){var e=a.state,n=e.action,o=e.search,r=e.editting,s=a.props.t,i=(0,bt.Mle)(t.name).indexOf((0,bt.Mle)(o)),c=t.name.substr(0,i),l=t.name.substr(i,o.length),d=t.name.substr(i+o.length);return"update"==n&&t.key==r.key?a.renderUpdateItem(t.key):i>-1?Pe("div",null,Pe("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},Pe("div",{style:{display:"flex",alignItems:"center"}},Pe("div",{style:{width:14,height:14,borderRadius:"50%",background:t.color,marginRight:8,marginLeft:4}}),c,Pe("span",{style:{color:"#f50"}},l),d),!n&&Pe("div",{className:"actions"},Pe(Ne.Z,{style:{marginRight:10},onClick:function(e){e.stopPropagation(),a.handleAction("update",t)}}),Pe(et.Z,{style:{marginRight:10},onClick:function(e){e.stopPropagation(),a.handleAction("createChildren",t)}}),Pe(Ae.Z,{onClick:function(e){e.stopPropagation(),a.handleAction("delete",t)}}))),"createChildren"==n&&r.parent_key==t.key&&a.renderUpdateItem(t.key),"delete"==n&&r.key==t.key&&Pe("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderTop:"1px solid #FFA39E",paddingTop:6,marginTop:6}},Pe("div",null,Pe("div",null,"B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n x\xf3a th\u1ebb?"),Pe("div",null,"Sau khi xo\xe1 c\xe1c phi\u1ebfu thu\u1ed9c th\u1ebb n\xe0y s\u1ebd kh\xf4ng c\xf3 th\u1ebb")),Pe("div",null,Pe(h.default,{onClick:function(t){t.stopPropagation(),a.setState({editting:{},action:"",selected:{}})},style:{marginRight:12}},s("cancel")),Pe(h.default,{onClick:a.handleDelete,icon:Pe(Ae.Z,null),type:"danger"},s("delete"))))):Pe("div",{style:{display:"flex",alignItems:"center"}},Pe("div",{style:{width:14,height:14,borderRadius:"50%",background:t.color,marginRight:8,marginLeft:4}}),Pe("div",null,t.name))})),(0,M.Z)((0,w.Z)(a),"flattenTags",(function(t){return(t||[]).reduce(function t(e){return function(n,a){e=e||0;var o=a.children||[];return n.push(Fe(Fe({},a),{},{childrenNodeIndex:e})),o.length&&!a.is_removed&&(n=n.concat(o.reduce(t(e+1),[]))),n}}(),[])})),(0,M.Z)((0,w.Z)(a),"handleAction",(function(t,e){e=e||a.state.selected;var n=a.state.tags,o={name:"",key:(0,bt.uuG)(),color:"#3922a8"},r=U()(n);if("create"!=t&&"createChildren"!=t&&(o=Fe({},e)),"delete"==t){var s=a.getTagNodes(n,o.key),i=[o.key];s.length>0&&(i=i.concat(a.flattenTags(s).map((function(t){return t.key})))),r=r.map((function(t){return Fe(Fe({},t),{},{is_removed:i.includes(t.key)})})),o.is_removed=!0}"createChildren"==t&&e&&(o.parent_key=e.key),"delete"!=t&&setTimeout((function(){var t;return null===(t=a.input)||void 0===t?void 0:t.focus()}),100),a.setState({editting:o,action:t,tags:r})})),(0,M.Z)((0,w.Z)(a),"onChangeData",(function(t,e){var n=Fe({},a.state.editting);n[e]=t,a.setState({editting:n})})),(0,M.Z)((0,w.Z)(a),"handleSave",(function(){var t=a.state,e=t.editting,n=t.tags,o=a.props,r=o.t,s=o.accessToken,i=o.shopId,c=o.updateShop;if(!e.name)return l.default.warning(r("components.productCategory.nameTagNotEmpty"));var d=n.findIndex((function(t){return t.key==e.key})),u=U()(n);d>-1?u[d]=e:u=u.concat([e]),u=u.filter((function(t){return!t.is_removed})).map((function(t){return we()(t,"id")})),a.setState({isLoading:!0}),c(s,{id:i,transaction_tags:u},!1).then((function(t){a.props.callback({transactionTags:u}),a.setState({isLoading:!1,editting:{},selected:{},tags:u,action:""})}))})),(0,M.Z)((0,w.Z)(a),"handleDelete",(function(){a.handleSave(),a.setState({action:"",editting:{},selected:{}})})),(0,M.Z)((0,w.Z)(a),"customSwitcherIcon",(function(t){var e=t.isLeaf,n=t.expanded;return e?Pe("img",{style:{width:16,height:16},src:"/static/img/TagChevron.svg"}):Pe(n?Oe.Z:Me.Z,null)})),(0,M.Z)((0,w.Z)(a),"getValidExpandsKeys",(function(t,e){if(!e.length||!a.state.search)return t;var n=function t(n){return n.find((function(n){var a;return!!e.includes(n.key)||!(null===(a=n.children)||void 0===a||!a.length)&&t(n.children)}))};return t.filter((function(t){return e.includes(t.key)||n(t.children)}))})),a.state={modalVisible:!1,selected:{},search:"",selectedKeys:[],expandedKeys:[],editting:{},isLoading:!1,autoExpandParent:!0,tags:t.tags||[],action:""},a}return(0,I.Z)(n,[{key:"render",value:function(){var t=this,e=this.state,n=e.modalVisible,a=e.expandedKeys,o=e.selectedKeys,r=e.action,s=e.autoExpandParent,i=e.tags,c=e.search,l=this.props,d=l.t,u=l.isButton,g=l.title,m=70*window.innerHeight/100-150,f=this.getTagNodes(i);return Pe("div",{style:{display:"inline-block"}},Pe(ut.Z,{icon:Pe(H.Z,null),title:g,onClick:function(){return t.setState({modalVisible:!0})},isButton:u}),Pe(p.Z,{visible:n,title:d("pages.shop.transaction.manageTransactionTag"),closable:!1,width:900,footer:Pe(At.default,{message:d("components.productCategory.suggest"),type:"info",showIcon:!0,style:{width:"fit-content"}}),onCancel:function(){return t.setState({modalVisible:!1,editting:{},selected:{},expandedKeys:[],selectedKeys:[],action:""})},className:"drag-categories-tree"},Pe("div",null,Pe(R.default,{placeholder:"T\xecm ki\u1ebfm th\u1ebb",style:{width:"100%"},onChange:this.onSearchChange,value:c,prefix:Pe(Q.Z,null)}),Pe("div",{style:{display:"flex",justifyContent:"space-between",margin:"16px 0px",alignItems:"center"}},Pe("div",{style:{color:"#595959"}},Pe("span",{style:{fontWeight:700}},d("pages.shop.actionTools.totalTags"),":"),"\xa0",Pe("span",null,i.length)),Pe(h.default,{icon:Pe(et.Z,null),type:"primary",onClick:function(){return t.handleAction("create")},disabled:"create"==r},d("components.productCategory.create"))),"create"==r&&this.renderUpdateItem(),i.length?Pe(Ee.Z,{autoExpandParent:s,selectedKeys:o,expandedKeys:a,onExpand:this.onExpand,treeData:this.getValidExpandsKeys(f,a),height:m,showIcon:!1,virtual:!1,switcherIcon:this.customSwitcherIcon,rootClassName:"categories-tree"}):Pe("div",{className:"empty-text"},"Ch\u01b0a c\xf3 th\u1ebb n\xe0o"))))}}]),n}(z.Component))||be,Be=(0,vt.$j)((function(t){return{tags:t.shop.currentShop.transaction_tags}}),{updateShop:yt.tUB})(je),Ve=n(37508),ze=n(49485),Ye=n(24781),He=n(96129),Ke=n(7859),We=n(88460),qe=n(56590),Ge=n(67724),$e=n(77729),Xe=n.n($e),Je=z.createElement;function Qe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function tn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Qe(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Qe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function en(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var nn,an=qe.default.Item,on=(0,_t.Z)()(Ue=function(t){(0,N.Z)(n,t);var e=en(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"openModal",(function(){var t=a.props,e=t.t,n=t.showAdvertisingCost,o=t.accessToken,r=t.shopId,s=[];U()(a.props.selectedTransactions).map((function(t){t.advertising_cost_id?n(o,r,t.advertising_cost_id).then((function(n){s=s.concat({cost_date:n.cost_date,creator_id:n.creator.id,items:n.items,transaction:tn(tn({},t),{},{status:1,time_incurred:ct()(),id:null,display_id:null,name:"".concat(e("pages.shop.product.management.copy")," ").concat(t.name)})}),a.setState({newTransactions:s})})):s.push(tn(tn({},t),{},{display_id:null,id:null,status:1,time_incurred:ct()(),name:"".concat(e("pages.shop.product.management.copy")," ").concat(t.name)}))})),a.setState({newTransactions:s,visible:!0,isCloning:!1,isLoading:!1})})),(0,M.Z)((0,w.Z)(a),"onChangeTransaction",(function(t,e){return function(n){var o;switch(e){case"name":o=n.target.value;break;case"status":o=Number(n.key);break;case"time_incurred":o=n.startOf("minute").toDate().toISOString()}var r=(0,v.Z)(a.state.newTransactions);r[t]=tn(tn({},r[t]),{},(0,M.Z)({},e,o)),a.setState({newTransactions:r})}})),(0,M.Z)((0,w.Z)(a),"onChangeAdvCost",(function(t,e){return function(n){var o;switch(e){case"name":o=n.target.value;break;case"status":o=Number(n.key);break;default:o=n.startOf("minute").toDate().toISOString()}var r=(0,v.Z)(a.state.newTransactions);if("cost_date"==e)r[t]=tn(tn({},r[t]),{},(0,M.Z)({},e,o));else{var s=r[t].transaction;s=tn(tn({},s),{},(0,M.Z)({},e,o)),r[t]=tn(tn({},r[t]),{},{transaction:s})}a.setState({newTransactions:r})}})),(0,M.Z)((0,w.Z)(a),"handleFocus",(function(t){var e;null===(e=a.refsArray[t])||void 0===e||e.focus()})),(0,M.Z)((0,w.Z)(a),"columnsProperties",[{title:a.props.t("components.accessoriesCreator.attributeName"),width:"25%",dataIndex:"attributeName",ellipsis:!0},{title:a.props.t("components.productCreatorFirstStep.value"),dataIndex:"attributeValue",ellipsis:!0},{title:"",dataIndex:"btn",width:"8%",ellipsis:!0}]),(0,M.Z)((0,w.Z)(a),"getTransactionStatusAction",(function(){return{0:{text:a.props.t("pages.shop.transaction.new")},1:{text:a.props.t("pages.shop.transaction.approval")},2:{text:a.props.t("pages.shop.transaction.cancel")}}})),(0,M.Z)((0,w.Z)(a),"getStatus",(function(t,e){var n=e.id,a=e.is_locked,o=e.transaction_ref_id;if(a)return[];if(!n)return[0,1,2];switch(t){case 0:return[1,3];case 1:return o?[3]:[2,3];case 2:return[3];case 3:return[]}})),(0,M.Z)((0,w.Z)(a),"addTransaction",(function(t){var e=a.state.newTransactions;e.splice(t+1,0,e[t]),a.setState({newTransactions:e})})),(0,M.Z)((0,w.Z)(a),"removeTransaction",(function(t){var e=a.state.newTransactions;e.splice(t,1),a.setState({newTransactions:e})})),(0,M.Z)((0,w.Z)(a),"renderListTransactionCopy",(function(){var t=a.props.t,e=a.state,n=e.newTransactions,r=e.isLoading;return Je(s.default,{gutter:0,className:"row-clone-transaction"},Je(i.default,{className:"gutter-row",span:24},Je(qe.default,{header:Je("div",{className:"header-clone-transaction"},Je("div",{className:"cell-clone-transaction",style:{width:"7%"}}),Je("div",{className:"cell-clone-transaction",style:{width:"10%"}},t("components.orderExportExcel.index")),Je("div",{className:"cell-clone-transaction",style:{width:"20%"}},t("pages.shop.transaction.tradingName")),Je("div",{className:"cell-clone-transaction",style:{width:"20%"}},t("pages.shop.transaction.timeIncurred")),Je("div",{className:"cell-clone-transaction",style:{width:"20%"}},t("pages.shop.advertising.costDate")),Je("div",{className:"cell-clone-transaction",style:{width:"23%"}},t("importTranslate.TRANG_THAI"))),className:"list-clone-transaction",dataSource:n,renderItem:function(e,n){var s,i,c=!!e.transaction;return c?(s=a.getStatus(e.transaction.status,e.transaction),i=(0,bt.Lvs)()[e.transaction.status]):(s=a.getStatus(e.status,e),i=(0,bt.Lvs)()[e.status]),Je(an,{className:"contents-clone-transaction",key:null===e||void 0===e?void 0:e.id},Je("div",{className:"cell-clone-transaction",style:{width:"7%",textAlign:"center"}},Je(C.default,{title:t("crm.add")},Je(et.Z,{style:{fontSize:14,color:"#096dd9",marginRight:10},onClick:function(){return a.addTransaction(n)}})),Je(C.default,{title:t("crm.delete")},Je(ot.Z,{style:{fontSize:14,color:"rgb(240, 65, 52)"},onClick:function(){return a.removeTransaction(n)}}))),Je("div",{className:"cell-clone-transaction",style:{width:"10%"}},n+1),Je("div",{className:"cell-clone-transaction",style:{width:"20%"},onClick:function(t){return t.stopPropagation()}},Je(R.default,{value:c?e.transaction.name:e.name||"",onChange:c?a.onChangeAdvCost(n,"name"):a.onChangeTransaction(n,"name"),placeholder:t("pages.shop.transaction.tradingName")})),Je("div",{className:"cell-clone-transaction",style:{width:"20%"},onClick:function(t){return t.stopPropagation()}},Je(o.default,{style:{width:"100%"},showTime:!0,format:"HH:mm DD/MM/YYYY",allowClear:!1,value:c?ct()(e.transaction.time_incurred):ct()(e.time_incurred),onChange:c?a.onChangeAdvCost(n,"time_incurred"):a.onChangeTransaction(n,"time_incurred")})),Je("div",{className:"cell-clone-transaction",style:{width:"20%"},onClick:function(t){return t.stopPropagation()}},c&&Je(o.default,{style:{width:"100%"},showTime:!0,format:"HH:mm DD/MM/YYYY",allowClear:!1,value:ct()(e.cost_date),onChange:a.onChangeAdvCost(n,"cost_date")})),Je("div",{className:"cell-clone-transaction",style:{width:"23%"},onClick:function(t){return t.stopPropagation()}},Je(d.default,{content:Je(b.default,{className:"dropdown-container",onClick:c?a.onChangeAdvCost(n,"status"):a.onChangeTransaction(n,"status")},s.map((function(t){var e=a.getTransactionStatusAction()[t];return Je(b.default.Item,{key:t},e.text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},Je(h.default,{disabled:r,type:"primary",style:{fontSize:12,width:140,height:22,background:i.bgColor,borderColor:i.bgColor,position:"relative",overflow:"hidden",padding:"0 5px",color:"#fff"}},i.text,a.state.isLoading&&Je(tt.Z,{style:{position:"absolute",left:5,top:"calc((100% / 2) - 6px)"}}),e.is_locked?Je(jt.Z,{style:{position:"absolute",right:6,top:"calc((100% / 2) - 6px)"}}):s.length>0&&Je(Bt.Z,{style:{position:"absolute",right:5,top:"calc((100% / 2) - 5px)"}})))))}})))})),(0,M.Z)((0,w.Z)(a),"handleCloneTransactions",(function(){var t=a.props.t,e=a.state.newTransactions;if(a.setState({isLoading:!0,isCloning:!0}),0==e.length)return Rt.Z.error(t("pages.admin.failure"),t("pages.shop.transaction.clone.noTransactionsSelected"));setTimeout((function(){return a.sendRequest(0)}))})),(0,M.Z)((0,w.Z)(a),"sendRequest",(function(t){t>0&&a.scrollCloningInfo();var e=a.props,n=e.accessToken,o=e.shopId,r=e.t,s=e.fetchTransactions,i=a.state.newTransactions,c=!!i[t].transaction,l="".concat((0,bt.LpH)(),"/shops/").concat(o,"/transactions?access_token=").concat(n),d="".concat((0,bt.LpH)(),"/shops/").concat(o,"/adv_costs?access_token=").concat(n),u=c?d:l,p=function(t,e,n,o){var r=a.state.cloningInfo;r.push({transactionId:o,message:e,success:t}),a.setState({cloningInfo:r}),o+1<n.length&&setTimeout((function(){a.sendRequest(o+1)}),900),o+1==n.length&&s(!0)};ht().post(u,c?{params:i[t]}:{transaction:i[t]}).then((function(e){if(e.data.success)return p(!0,r("pages.shop.transaction.clone.copyTransactionSuccessful"),i,t);var n,a=null===(n=e.data)||void 0===n?void 0:n.message;return p(!1,a||r("pages.shop.copyError"),i,t)})).catch((function(e){var n,a;return null!==e&&void 0!==e&&null!==(n=e.response)&&void 0!==n&&null!==(a=n.data)&&void 0!==a&&a.message?p(!1,e.response.data.message,i,t):p(!1,r("pages.shop.copyError"),i,t)}))})),(0,M.Z)((0,w.Z)(a),"renderUpdate",(function(){var t=a.props.t,e=a.state,n=e.cloningInfo,o=e.newTransactions,r=n.filter((function(t){return 1==t.success})).length,s=n.filter((function(t){return 0==t.success})).length;return Je("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},Je(gt.default,{type:"circle",percent:Math.floor(100*n.length/o.length)}),n.length==o.length?Je("h4",null,Je("span",{style:{color:"#00a854"}},t("pages.shop.copySuccessful")," ","".concat(r)," ",t("pages.shop.transaction.clone.transaction")),Je("span",{style:{color:"#f04134"}},"".concat(s>0?", ".concat(t("pages.admin.failure")," ").concat(s," ").concat(t("pages.shop.transaction.clone.transaction")):""))):Je("div",null,Je("h4",{style:{color:"#096dd9"}},Je(tt.Z,null)," ",t("pages.shop.transaction.clone.copyingTransactions"))),Je("div",{id:"cloning-transaction",className:"cloning-info"},n.map((function(t,e){if(null!=t.success)return Je("div",{key:e},Je("span",null,Je("strong",{className:t.success?"success":"fail"},"#".concat(t.transactionId+1))),"\xa0",Je("span",{className:t.success?"success":"fail"},t.message))}))))})),(0,M.Z)((0,w.Z)(a),"onCancel",(function(){var t=a.props.close;a.setState({newTransactions:[],visible:!1,cloningInfo:[]}),t()})),(0,M.Z)((0,w.Z)(a),"handleBackTransactionError",(function(){var t=a.state,e=t.newTransactions,n=t.cloningInfo,o=[];n.map((function(t){t.success||o.push(e[t.transactionId])})),a.setState({isCloning:!1,newTransactions:o,isLoading:!1,cloningInfo:[]})})),a.state={newTransactions:[],isLoading:!1,isCloning:!1,cloningInfo:[],visible:!1},a.refsArray=[],a}return(0,I.Z)(n,[{key:"scrollCloningInfo",value:function(){var t=document.getElementById("cloning-transaction");t.scrollTop=t.scrollHeight}},{key:"render",value:function(){var t=this,e=this.props,n=e.t,a=e.selectedRowKeys,o=e.isButton,r=e.title,s=this.state,i=s.isLoading,c=s.isCloning,l=s.cloningInfo,d=s.visible,u=l.find((function(t){return!t.success}));return Je("span",null,Je(p.Z,{wrapClassName:"clone-transaction ".concat(c&&"modal-cloning"),title:n("pages.shop.transaction.clone.copyTransactions"),visible:d,onCancel:function(){return t.onCancel()},width:900,footer:Je("div",null,c?null:Je(h.default,{icon:Je(i?tt.Z:nt.Z,null),disabled:i,type:"primary",onClick:this.handleCloneTransactions},n("pages.shop.copy")),u&&c&&Je(h.default,{onClick:function(){return t.handleBackTransactionError()},icon:Je(Ge.Z,null),danger:!0},n("containers.formBoxModal.back")))},c?this.renderUpdate():this.renderListTransactionCopy()),Je(ut.Z,{tooltip:a.length>0?"".concat(n("pages.shop.copy")," ").concat(a.length," ").concat(n("pages.shop.transaction.clone.selectedTransaction")):n("pages.shop.transaction.clone.pleaseSelectTransaction"),icon:Je(G.Z,null),isButton:o,title:r,onClick:function(){a.length>0&&t.openModal()}}),Je("style",{dangerouslySetInnerHTML:{__html:Xe()}}))}}]),n}(z.Component))||Ue,rn=(0,vt.$j)(null,{showAdvertisingCost:yt.gqy})(on),sn=n(41850),cn=n(45812),ln=n(42258),dn=z.createElement;function un(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function pn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?un(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):un(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function gn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var mn=E.default.Option,hn={display:"block",height:"30px",lineHeight:"30px"},fn=["COST_DATE","POST_IDS","PAGE","WAREHOUSE","TYPE_CUSTOMER","PRODUCT","IS_LIVESTREAM","MARKETER"],vn=(0,_t.Z)()(nn=function(t){(0,N.Z)(n,t);var e=gn(n);function n(t){var a;return(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"sendRequest",(function(t){var e=a.props,n=e.accessToken,o=e.shopId,r=e.t,s=e.updateTransactionsSuccess,i=e.selectedTransactions,c=e.checkedListTransaction,l=a.state,d=l.selectedTags,u=l.typeUpdate,p=l.typeQuickUpdate,g=l.statusUpdate,m=l.transactions,h=l.timeIncurred,f=U()(a.state.updatingInfo),v=i[t],y=null!==d&&void 0!==d&&d.length?d:[];switch(u){case"add":y=F()(((null===v||void 0===v?void 0:v.tag_ids)||[]).concat(y));break;case"remove":y=((null===v||void 0===v?void 0:v.tag_ids)||[]).filter((function(t){return!y.includes(t)}))}var b={};switch(p){case"lock":b={is_locked:!0};break;case"unlock":b={is_locked:!1};break;case"accounting":b={is_accounting:!0};break;case"cancelAccounting":b={is_accounting:!1};break;case"tag":b={tag_ids:y};break;case"status":b={status:g};break;case"timeIncurred":b={time_incurred:h}}var _=null===v||void 0===v?void 0:v.advertising_cost;delete v.advertising_cost;var C="".concat((0,bt.LpH)(),"/shops/").concat(o,"/transactions/").concat(v.id,"?access_token=").concat(n);ht().put(C,{transaction:pn(pn({},v),b)}).then(function(){var e=(0,T.Z)(S().mark((function e(n){var o;return S().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.data.success){e.next=11;break}return o=n.data.data,(0,He.P0)(c,fn)&&_&&(o=pn(pn({},o),{},{advertising_cost:_})),e.next=5,s(o);case 5:f.push({message:r("success"),success:n.data.success}),m[t]=o,a.setState({updatingInfo:f,transactions:m}),t+1<i.length&&a.sendRequest(t+1),e.next=14;break;case 11:f.push({message:n.data.message||r("pages.admin.failure"),success:!1}),a.setState({updatingInfo:f}),t+1<i.length&&a.sendRequest(t+1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),(0,M.Z)((0,w.Z)(a),"renderResult",(function(){var t=a.state.updatingInfo,e=a.props,n=e.selectedTransactions,o=e.t,r=function(t,e,a){return dn("div",{key:n[e].id},dn("span",null,dn("strong",{className:a},"#".concat(n[e].name))),"\xa0",dn("span",{className:a},t.message&&""!=t.message?t.message:o("action.unknownError")))};return dn("div",null,t.map((function(t,e){if(t.success)return dn("div",{key:e},r(t,e,"success"))})),t.map((function(t,e){if(!t.success)return dn("div",{key:e},r(t,e,"fail"))})))})),(0,M.Z)((0,w.Z)(a),"handleConfirm",(function(){a.setState({isUpdating:!0}),a.sendRequest(0)})),(0,M.Z)((0,w.Z)(a),"renderTypeUpdate",(function(){var t=a.props.t;return dn("div",{style:{marginBottom:5}},dn(P.default.Group,{value:a.state.typeUpdate,onChange:function(t){return a.setState({typeUpdate:t.target.value})},defaultValue:"update"},dn(P.default,{style:hn,value:"add"},t("pages.shop.transaction.addTag")),dn(P.default,{style:hn,value:"remove"},t("pages.shop.transaction.removeTags"))))})),(0,M.Z)((0,w.Z)(a),"handleCloseModal",(function(){a.setState({modalVisible:!1,isLoading:!1,isUpdating:!1,updatingInfo:[],typeQuickUpdate:void 0,selectedTags:[]}),a.props.callBack()})),a.state={transactions:t.selectedTransactions,modalVisible:!1,isLoading:!1,isUpdating:!1,updatingInfo:[],typeUpdate:"add",selectedTags:[],statusUpdate:void 0,timeIncurred:ct()()},a}return(0,I.Z)(n,[{key:"render",value:function(){var t=this,e=this.state,n=e.modalVisible,a=e.isUpdating,r=e.updatingInfo,s=e.typeQuickUpdate,i=e.selectedTags,c=e.statusUpdate,d=e.timeIncurred,u=this.props,g=u.selectedRowKeys,m=u.t,f=u.title,v=u.isButton,y=u.transactionTags,b=u.selectedTransactions,_=u.currentShop,C=r.filter((function(t){return t.success})).length,x=b.length-C;return dn("div",{style:{display:"inline"}},dn(ut.Z,{icon:dn(q.Z,null),tooltip:0==g.length?m("pages.shop.statistic.transaction.quickUpdate.pleaseSelectTransaction"):"".concat(m("components.productUpdateCategory.quickUpdate")," ").concat(g.length," ").concat(m("pages.shop.transaction.clone.selectedTransaction")),onClick:function(){g.length?t.setState({isLoading:!0,modalVisible:!0}):l.default.warning(t.props.t("pages.shop.transaction.noSelect"))},title:f,isButton:v}),n&&dn(p.Z,{onCancel:this.handleCloseModal,visible:n,footer:dn("div",null,a?dn(h.default,{onClick:this.handleCloseModal},m("components.productUpdateCategory.exit")):dn(h.default,{type:"primary",disabled:!s,onClick:this.handleConfirm},m("pages.dashboard.update"))),wrapClassName:"modal-updating",title:"".concat(m("components.productUpdateCategory.quickUpdate")," ").concat(g.length," ").concat(m("pages.shop.transaction.clone.selectedTransaction"))},this.props.isLoading?dn("span",null,dn(tt.Z,null)," ",m("components.quickUpdateCustomer.loadingSelectedCustomer")):a?dn("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},dn(gt.default,{type:"circle",percent:Math.floor(100*r.length/b.length),style:{marginBottom:10}}),r.length==b.length?dn("h4",null,dn("span",{style:{color:"#00a854"}},"".concat(m("components.productUpdateCategory.updateSucceed")," ").concat(C," ").concat(m("pages.shop.transaction.clone.transaction"))),dn("span",{style:{color:"#f04134"}},"".concat(x>0?", ".concat(m("pages.admin.failure")," ").concat(x," ").concat(m("pages.shop.transaction.clone.transaction")):""))):dn("div",null,dn("h4",{style:{color:"#096dd9"}},m("components.productUpdateCategory.updatingCategory"))),dn("div",{id:"updating-info",className:"updating-info"},this.renderResult())):dn("div",{style:{width:"100%"}},dn("div",null,dn("div",{style:{fontWeight:500,marginBottom:5}},dn(q.Z,null),dn("span",{style:{marginLeft:3}},m("components.productUpdateCategory.typeUpdate"),":")),dn(E.default,{placeholder:m("components.productUpdateCategory.selectTypeUpdate"),value:s,allowClear:!0,style:{width:"100%"},onChange:function(e){return t.setState({typeQuickUpdate:e})}},dn(mn,{key:"tag",value:"tag"},m("Th\u1ebb thu chi")),dn(mn,{key:"status",value:"status"},m("systemLogs.status")),dn(mn,{key:"lock",value:"lock"},m("systemLogs.shop_transactions.is_locked")),dn(mn,{key:"unlock",value:"unlock"},m("pages.shop.statistic.transaction.quickUpdate.unlockTransaction")),dn(mn,{key:"accounting",value:"accounting"},m("pages.shop.statistic.transaction.quickUpdate.accounting")),dn(mn,{key:"cancelAccounting",value:"cancelAccounting"},m("pages.shop.statistic.transaction.quickUpdate.cancelAccounting")),dn(mn,{key:"timeIncurred",value:"timeIncurred"},m("pages.shop.transaction.timeIncurred")))),s&&dn("div",{style:{marginTop:15}},"tag"==s&&dn("div",null,this.renderTypeUpdate(),dn(E.default,{placeholder:m("pages.shop.transaction.selectTagsTransaction"),mode:"multiple",allowClear:!0,value:i,style:{width:"100%"},onChange:function(e){return t.setState({selectedTags:e})}},y.map((function(t){return dn(mn,{key:t.key,value:t.key},t.name)})))),"status"==s&&dn("div",null,dn(E.default,{placeholder:m("components.updateStatusTransfer.selectStatus"),style:{width:200,marginTop:5,marginLeft:5},value:c,onChange:function(e){return t.setState({statusUpdate:e})}},[0,1,2,3].map((function(t){var e=(0,bt.Lvs)()[t];return dn(mn,{value:t,key:t},e.text)})))),"timeIncurred"==s&&dn("div",null,dn(o.default,{style:{width:200},showTime:!0,format:"HH:mm DD/MM/YYYY",allowClear:!1,value:ct().utc(d).utcOffset(parseFloat(_.timezone)||7),onChange:function(e){return t.setState({timeIncurred:e})}}))))))}}]),n}(z.Component))||nn,yn=(0,vt.$j)(null,{updateCustomer:yt.uGj,fetchListOfCustomers:yt.ezi,updateCustomerAction:ln.VE,updateTransactionsSuccess:yt.EiF})(vn),bn=n(65471),_n=n(49677),Cn=z.createElement;function xn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function kn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?xn(Object(n),!0).forEach((function(e){(0,M.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Sn(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,O.Z)(t);if(e){var o=(0,O.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,A.Z)(this,n)}}var Tn=P.default.Group,Zn=P.default.Button,wn=E.default.Option,In=R.default.TextArea,Nn=["30","50","100"],An={page:1,page_size:30,startDateTime:ct()().add(-30,"days").startOf("day").unix(),endDateTime:ct()().endOf("day").unix(),status:"-1",collect_pay:void 0,creator_id:void 0},On="TIME_INCURRED",Mn="shop-transaction-table",Rn=["ID","TRADING_NAME","TRANSACTION_CREATOR","TAGS","AO_MONEY","PAYMENTS","INSERTED_AT","EFFECTIVE_AT","IS_ACCOUNTING","NOTE"],En=["ID","TRADING_NAME","TRANSACTION_CREATOR","TAGS","AO_MONEY","PAYMENTS","INSERTED_AT","EFFECTIVE_AT"],Pn=["COST_DATE","POST_IDS","PAGE","WAREHOUSE","TYPE_CUSTOMER","PRODUCT","IS_LIVESTREAM","MARKETER","LINK_UTM","UTM_SOURCE","UTM_MEDIUM","UTM_CAMPAIGN","UTM_TERM","UTM_CONTENT"],Dn=[],Fn=function(t){(0,N.Z)(n,t);var e=Sn(n);function n(t){var a;(0,Z.Z)(this,n),a=e.call(this,t),(0,M.Z)((0,w.Z)(a),"componentDidMount",(0,T.Z)(S().mark((function t(){var e,n,o,r,s,i,c,l,d,u,p,g,m,h,f,v,y,b,_,C;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.state,o=n.params,r=n.pageSize,(0,bt.oSE)(Mn),s=a.props,i=s.isServer,c=s.fetchListOfTransactions,l=s.countersTransactions,d=s.accessToken,u=s.shopId,p=s.totalAmountTransaction,g=s.users,m=s.creator,h=s.currentShop,f=localStorage.getItem("columnsTransaction"),v=localStorage.getItem("columnsWidthTransaction"),f&&a.setState({checkedListTransaction:JSON.parse(f).checkedListTransaction}),v&&a.setState({columnsWidth:JSON.parse(v)}),(y=!!f&&(0,He.P0)(JSON.parse(f).checkedListTransaction,Pn))&&i&&a.loadAdvertisingCosts(!0),i){t.next=16;break}return o.page_size=r,y&&(o.is_load_advertising=!0),t.next=14,c(d,u,o).then((function(){a.setState({isLoading:!1})}));case 14:l(d,u,o),p(d,u,o);case 16:b=((null===(e=g.find((function(t){return t.user_id==m})))||void 0===e?void 0:e.transaction_tags)||[]).filter((function(t){return"all"!=t})),_=U()(h.transaction_tags)||[],b.length>0&&(C=_.filter((function(t){return b.includes(t.key)})),_=C.reduce((function(t,e){if(e.parent_key){delete e.parent_key;var n=(0,bt.hOJ)([e.key],_);t=t.concat(n)}return t.push(e),t}),[])),a.setState({transactionTags:_,transactionTagsUser:b});case 20:case"end":return t.stop()}}),t)})))),(0,M.Z)((0,w.Z)(a),"payments",[{value:"cash",text:a.props.t("pages.shop.transaction.cash"),color:"#096dd9"},{value:"transfer_money",text:a.props.t("pages.shop.transaction.transferMoney"),color:"#87d068"},{value:"charged_by_card",text:a.props.t("pages.shop.transaction.chargedByCard"),color:"#2db7f5"},{value:"charged_by_momo",text:"MoMo",color:"#ae2070"},{value:"charged_by_vnpay",text:"VNPay",color:"#dd3d43"},{value:"charged_by_kredivo",text:"Kredivo",color:"#fc843c"},{value:"charged_by_fundiin",text:"Fundiin",color:"#5bc0f7"},{value:"charged_by_qrpay",text:"QRpay",color:"#0279c6"}]),(0,M.Z)((0,w.Z)(a),"fetchTransactions",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=a.props,n=e.accessToken,o=e.shopId,r=e.countersTransactions,s=e.totalAmountTransaction,i=e.fetchListOfTransactions,c=t?st()(a.state.params,{$merge:t.page?t:kn(kn({},t),{},{page:1})}):kn(kn({},An),{},{page_size:a.state.pageSize}),l={params:c,isLoading:!0};t.timeRange&&(l.timeRange=t.timeRange),a.setState(l);var d=(0,He.P0)(a.state.checkedListTransaction,Pn);d&&(c=kn(kn({},c),{},{is_load_advertising:!0})),i(n,o,c).then((function(){a.setState({isLoading:!1})})),r(n,o,c),s(n,o,c)})),(0,M.Z)((0,w.Z)(a),"loadAdvertisingCosts",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=a.props,n=e.shopId,o=e.accessToken,r=e.loadAdvertisingCosts,s=e.fetchTransactionSuccess,i=U()(a.props.transactions),c=a.state.checkedListTransaction;if((0,He.P0)(c,Pn)||t){var l=i.data.map((function(t){return t.advertising_cost_id})).filter((function(t){return t}));if(!l.length)return;r(o,n,l).then((function(t){var e=[];t.map((function(t){var n=i.data.findIndex((function(e){return e.advertising_cost_id==t.id}));n>-1&&(i.data[n].advertising_cost=t);var a=t.items.reduce((function(t,e){var n;if((null===(n=e.post_ids)||void 0===n?void 0:n.length)>0){var a=e.source.page_id,o=e.post_ids.map((function(t){return"".concat(a,"_").concat(t)}));t=t.concat(o)}return t}),[]);e=e.concat(a)})),s(i)}))}})),(0,M.Z)((0,w.Z)(a),"handleSearchEmployee",(function(t,e){var n=t.target?t.target.value:t;a.props.pushUsersTextSearch(n,a.props.users,e,"transactionFilter")})),(0,M.Z)((0,w.Z)(a),"showModalCreate",(function(t){try{void 0!=typeof localStorage&&localStorage["status-adv-cost"]&&a.setState({status:JSON.parse(localStorage.getItem("status-adv-cost"))})}catch(e){console.log(e)}a.setState({visibleModalCreate:!0,modalCreateValue:{aoMoney:t.AO_MONEY,id:t.ID,tradingName:t.TRADING_NAME,note:t.NOTE},fileList:[],images:[]})})),(0,M.Z)((0,w.Z)(a),"onCreateRadio",(function(t){a.setState({value:t.target.value})})),(0,M.Z)((0,w.Z)(a),"onChangeRadio",(function(t){a.setState({modalChangeValue:kn(kn({},a.state.modalChangeValue),{},{aoMoney:-1*a.state.modalChangeValue.aoMoney})})})),(0,M.Z)((0,w.Z)(a),"handleInputNumberCreate",(function(t){a.setState({inputAmount:t})})),(0,M.Z)((0,w.Z)(a),"handleInputNumberChange",(function(t){return Number.isNaN(t)&&(t=0),a.state.modalChangeValue.aoMoney>=0?a.setState({modalChangeValue:kn(kn({},a.state.modalChangeValue),{},{aoMoney:Number.isInteger(t)?1*t:t})}):a.setState({modalChangeValue:kn(kn({},a.state.modalChangeValue),{},{aoMoney:Number.isInteger(t)?-1*t:t})})})),(0,M.Z)((0,w.Z)(a),"handleInputTextCreate",(function(t){a.setState({inputName:t.target.value})})),(0,M.Z)((0,w.Z)(a),"handleInputTextChange",(function(t){a.setState({modalChangeValue:kn(kn({},a.state.modalChangeValue),{},{tradingName:t.target.value})})})),(0,M.Z)((0,w.Z)(a),"handleAreaCreate",(function(t){a.setState({areaNote:t.target.value})})),(0,M.Z)((0,w.Z)(a),"handleAreaChange",(function(t){a.setState({modalChangeValue:kn(kn({},a.state.modalChangeValue),{},{note:t.target.value})})})),(0,M.Z)((0,w.Z)(a),"handleOpenModalOrder",(function(){a.setState({visibleOrderModal:!0})})),(0,M.Z)((0,w.Z)(a),"handleShowOrder",(function(t){a.fetchOrderDetail(t).then(function(){var t=(0,T.Z)(S().mark((function t(e){return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.props.openForm({data:e});case 2:a.setState({formBoxVisible:!0});case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())})),(0,M.Z)((0,w.Z)(a),"fetchOrderDetail",(function(t){var e=a.props,n=e.shopId,o=e.accessToken,r="".concat((0,bt.LpH)(),"/shops/").concat(n,"/orders/").concat(t,"?access_token=").concat(o);return ht().get(r).then((function(t){return t.data.data}))})),(0,M.Z)((0,w.Z)(a),"columns",(function(){var t=[];return"vinmec"==a.props.currentShop.third_party_id&&t.push({title:"M\xe3 giao d\u1ecbch",dataIndex:"THIRD_PARTY_TRANSACTION_IDS",width:"8%",align:"left",ellipsis:!0,render:function(t,e){var n,a;return null===(n=e.action.order)||void 0===n||null===(a=n.third_party_infomation)||void 0===a?void 0:a.transaction_ids}}),[].concat(t,[{title:"ID",dataIndex:"ID",width:"8%",align:"left",ellipsis:!0},{title:a.props.t("pages.shop.transaction.tradingName"),dataIndex:"TRADING_NAME",width:"14%",ellipsis:!0},{title:a.props.t("pages.shop.transaction.transationCreator"),dataIndex:"TRANSACTION_CREATOR",width:"10%",ellipsis:!0,render:function(t){return a.renderCreator(t)}},{title:a.props.t("components.orderAdvanceFilter.tag"),dataIndex:"TAGS",className:"order-tag-column",align:"center",ellipsis:!0,width:"10%"},{title:a.props.t("pages.shop.transaction.money"),dataIndex:"AO_MONEY",align:"right",ellipsis:!0,width:"10%",render:function(t){var e=(0,bt.ufS)(Math.abs(t),a.props.currentShop.currency);return Cn("span",{style:{color:t<0?"#ff3860":"#096dd9"}},e)}},{title:a.props.t("pages.shop.transaction.payment"),dataIndex:"PAYMENTS",align:"center",ellipsis:!0},{title:a.props.t("pages.shop.transaction.insertedAt"),dataIndex:"INSERTED_AT",align:"right",ellipsis:!0,width:"8%"},{title:a.props.t("pages.shop.transaction.effectiveAt"),dataIndex:"EFFECTIVE_AT",align:"right",ellipsis:!0,width:"8%"},{title:a.props.t("pages.shop.transaction.timeIncurred"),dataIndex:On,align:"right",ellipsis:!0,width:"8%"},{title:a.props.t("pages.shop.advertising.costDateAdvertising"),dataIndex:"COST_DATE",align:"right",ellipsis:!0},{title:"Post id",dataIndex:"POST_IDS",align:"right",ellipsis:!0},{title:"Page",dataIndex:"PAGE",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.advertising.warehouse"),dataIndex:"WAREHOUSE",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.advertising.typeCustomer"),dataIndex:"TYPE_CUSTOMER",align:"center",ellipsis:!0},{title:a.props.t("products.title"),dataIndex:"PRODUCT",align:"right",ellipsis:!0},{title:"Livestream",dataIndex:"IS_LIVESTREAM",align:"center",ellipsis:!0},{title:"Marketer",dataIndex:"MARKETER",align:"center",ellipsis:!0},{title:a.props.t("pages.shop.transaction.isAccounting"),dataIndex:"IS_ACCOUNTING",align:"center",ellipsis:!0},{title:a.props.t("pages.shop.transaction.reasonAndNote"),dataIndex:"NOTE",align:"center",ellipsis:!0},{title:"Link",dataIndex:"LINK_UTM",ellipsis:!0},{title:"UTM source",dataIndex:"UTM_SOURCE",ellipsis:!0},{title:"UTM medium",dataIndex:"UTM_MEDIUM",ellipsis:!0},{title:"UTM campaign",dataIndex:"UTM_CAMPAIGN",ellipsis:!0},{title:"UTM term",dataIndex:"UTM_TERM",ellipsis:!0},{title:"UTM content",dataIndex:"UTM_CONTENT",ellipsis:!0}])})),(0,M.Z)((0,w.Z)(a),"onChangeColumns",(function(t){a.setState({checkedListTransaction:t},(function(){return a.loadAdvertisingCosts()})),localStorage.setItem("columnsTransaction",JSON.stringify({checkedListTransaction:t}))})),(0,M.Z)((0,w.Z)(a),"renderSettingColumn",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=a.state.checkedListTransaction,n=a.props,o=n.t,r=n.currentShop,s=a.columns().reduce((function(t,e){var n=e.dataIndex,a=e.title;return t[n]=a,t}),{}),i=Rn.concat(Pn);"vinmec"==r.third_party_id&&i.push("THIRD_PARTY_TRANSACTION_IDS");var c=i.filter((function(t){return!e.includes(t)}));return Cn(ze.Z,{defaultCheckedList:Dn,onChange:function(t){return a.onChangeColumns(t)},translate:s,t:o,title:o("pages.shop.setting.crmProfile.columnsSetting"),isIcon:!1,displayColumns:e,addOptionColumns:c,isButton:t,isTools:!0})})),(0,M.Z)((0,w.Z)(a),"getListActionTools",(function(){var t=a.props,e=t.accessToken,n=t.shopId,o=t.currentShop,r=t.timezone,s=t.t,i=a.state,c=i.params,l=i.selectedRowKeys,d=i.selectedTransactions,u=i.transactionTags,p=i.checkedListTransaction;return[{icon:Cn(Y.Z,null),title:s("pages.shop.actionTools.print"),key:"purchase_transaction_printer",content:function(t){return Cn($t.Z,{accessToken:e,shopId:n,selectedRowKeys:l,selectedData:d,printer:"transaction",defaultParams:c,isButton:t})}},{icon:Cn(H.Z,null),title:s("pages.shop.product.management.tag"),key:"transaction_tag",content:function(t){return Cn(Be,{accessToken:e,shopId:n,callback:function(t){return a.setState(t)},isButton:t,title:s("pages.shop.product.management.tag")})}},{icon:Cn(K.Z,null),title:s("pages.shop.actionTools.importExcel"),key:"transaction_import_excel",content:function(t){return Cn(Ut,{accessToken:e,shopId:n,currentShop:o,isButton:t,title:s("pages.shop.actionTools.importExcel")})}},{icon:Cn(W.Z,null),title:s("pages.shop.statistic.inventory.exportExcel"),key:"transaction_export_excel",content:function(t){return Cn(Nt,{accessToken:e,shopId:n,currentShop:o,timezone:r,selectedRowKeys:l,defaultParams:c,isButton:t,title:s("pages.shop.statistic.inventory.exportExcel")})}},{icon:Cn(q.Z,null),title:s("pages.shop.actionTools.quickUpdate"),key:"transaction_quick_update",content:function(t){return Cn(yn,{currentShop:o,accessToken:e,shopId:n,title:s("pages.shop.actionTools.quickUpdate"),selectedRowKeys:l,isButton:t,selectedTransactions:d,transactionTags:u,checkedListTransaction:p,callBack:function(){return a.setState({selectedRowKeys:[],selectedTransactions:[]})}})}},{icon:Cn(G.Z,null),title:s("pages.shop.transaction.clone.copyTransactions"),key:"copy_transaction",content:function(t){return Cn(rn,{accessToken:e,shopId:n,isButton:t,close:function(){return a.setState({selectedTransactions:[],selectedRowKeys:[]})},fetchTransactions:function(){return a.fetchTransactions()},selectedTransactions:d,selectedRowKeys:l,title:s("pages.shop.transaction.clone.copyTransactions")})}},{icon:Cn($.Z,null),title:s("pages.shop.setting.crmProfile.columnsSetting"),key:"setting_column",content:a.renderSettingColumn}]})),(0,M.Z)((0,w.Z)(a),"renderCreator",(function(t){if(!t)return Cn(x.default,{color:"#00707f"},a.props.t("pages.shop.transaction.system"));return Cn("div",{style:{display:"flex",alignItems:"center"}},t.fb_id?Cn(Gt.Z,{allowHover:!0,avatar_url:t.avatar_url,name:t.name,id:t.fb_id,size:[20,20],style:{marginRight:5}}):Cn(Gt.Z,{allowHover:!0,name:t.name,color:function(t){var e=t?parseInt(t.toString().split(/ /)[0].replace(/[^\d]/g,"")):t;return(0,bt.YrT)(e)}(t.id),size:[20,20],style:{marginRight:5}}),Cn("p",null,t.name))})),(0,M.Z)((0,w.Z)(a),"renderAdvertisingCostInfo",(function(t,e){var n;if(null!==t&&void 0!==t&&null!==(n=t.items)&&void 0!==n&&n.length){var o,r=a.props,s=r.warehouses,i=r.users,c=r.t,l=t.items.reduce((function(t,n){var a;"post_ids"==e&&(t=t.concat(n.post_ids||[])),(n[e]&&!["source","post_ids"].includes(e)||"source"==e&&null!==(a=n[e])&&void 0!==a&&a.key)&&t.push(n[e]);var o=n.utm||{};return e.includes("utm")&&o[e]&&t.push(o[e]),t}),[]);switch(e){case"post_ids":o=F()(l).join("; ");break;case"source":var d=l.map((function(t){return a.getOrderSource(t)}));o=F()(d).join("; ");break;case"warehouse_id":var u=F()(l);o=s.filter((function(t){return u.includes(t.id)})).map((function(t){return t.name})).join("; ");break;case"type_customer":o=F()(l).map((function(t){return c("components.orderAdvanceFilter.".concat(t.toLowerCase()))})).join("; ");break;case"product":var p=l.map((function(t){return t.id}));o=(p=F()(p)).map((function(t){return l.find((function(e){return e.id==t})).name})).join("; ");break;case"is_livestream":if(l.find((function(t){return t})))return c("components.orderAdvanceFilter.have");case"user_id":var g=F()(l),m=i.filter((function(t){return g.includes(t.user_id)})).map((function(t){return t.user}));return 1==m.length?a.renderCreator(m[0]):(0,He.n1)(m,{size:20,count:2});case"link_utm":case"utm_source":case"utm_medium":case"utm_campaign":case"utm_term":case"utm_content":o=l[0];break;default:o=""}return Cn(C.default,{title:o,placement:"topLeft"},Cn("span",null,o))}})),(0,M.Z)((0,w.Z)(a),"getOrderSource",(function(t){var e=a.props,n=e.order_sources_custom,o=e.currentShop,r=[],s=(0,Mt.tF)(n,o,!1),i=function e(n,a){n.value==(a?t.key:t.account)&&r.push(n.title),(n.children||[]).map((function(t){return e(t,!1)}))};return s.map((function(t){return i(t,!0)})),r.filter((function(t){return t})).join(" / ")})),(0,M.Z)((0,w.Z)(a),"getDebts",(function(t){if("debts"==t.table_name){var e=a.props,n=e.shopId,o=e.accessToken,r=a.state.modalChangeValue,s="".concat((0,bt.LpH)(),"/shops/").concat(n,"/debt?access_token=").concat(o);ht().get(s,{params:{selectedRowKeys:[t.ref_id]}}).then((function(t){if(t.data.success){var e=t.data.data[0],n=null;e&&(e.order_id||e.purchase_id||e.export_id)&&(n="debts"),r.tableName=n,a.setState({modalChangeValue:r})}}))}})),(0,M.Z)((0,w.Z)(a),"handleRowClick",(function(t){var e=t.action,n=a.props,o=n.accessToken,r=n.shopId,s=e.is_locked&&!e.is_locked_by_user||[2,3].includes(e.status);e.advertising_cost_id&&(a.setState({loadAdvCost:!0}),a.props.showAdvertisingCost(o,r,e.advertising_cost_id).then((function(t){a.setState({advCost:t,loadAdvCost:!1})})));var i,c,l,d=(e.images||[]).map((function(t,e){return{uid:e,response:{content_url:t},status:"done",url:t}}));return e.is_locked!=e.is_locked_by_user||e.transaction_ref_id||[2,3].includes(e.status)?a.setState({visibleModalView:!0,modalViewValue:{aoMoney:e.amount,display_id:e.display_id,tradingName:null===(i=e.name)||void 0===i?void 0:i.replace("#ref_display_id","#".concat(e.ref_display_id)),note:e.note,inserted_at:e.inserted_at,creator:e.creator,posted_at:e.posted_at,tag_ids:e.tag_ids,isAccounting:e.is_accounting,isLocked:e.is_locked,payments:e.payments,supplier_products_id:e.supplier_products_id,advertising_cost_id:e.advertising_cost_id,id:e.id,transaction_ref_id:e.transaction_ref_id,paymentDebtsToSuppliers:e.payment_debts_to_suppliers,status:e.status,images:e.images,time_incurred:e.time_incurred||e.inserted_at,order:e.order},fileList:d},(function(){return a.getDebts(e)})):a.setState({visibleModalChange:!0,modalChangeValue:(l={aoMoney:e.amount,id:e.display_id,tradingName:null===(c=e.name)||void 0===c?void 0:c.replace("#ref_display_id","#".concat(e.ref_display_id)),note:e.note},(0,M.Z)(l,"id",e.id),(0,M.Z)(l,"isLocked",e.is_locked),(0,M.Z)(l,"disabledAllView",s),(0,M.Z)(l,"tag_ids",e.tag_ids||[]),(0,M.Z)(l,"payments",e.payments),(0,M.Z)(l,"supplier_products_id",e.supplier_products_id),(0,M.Z)(l,"isAccounting",e.is_accounting),(0,M.Z)(l,"timeIncurred",e.time_incurred||e.inserted_at),(0,M.Z)(l,"advertising_cost_id",e.advertising_cost_id),(0,M.Z)(l,"transaction_id",e.id),(0,M.Z)(l,"tableName",e.table_name),(0,M.Z)(l,"paymentDebtsToSuppliers",e.payment_debts_to_suppliers),(0,M.Z)(l,"status",e.status),(0,M.Z)(l,"images",e.images),(0,M.Z)(l,"order",e.order),l),fileList:d},(function(){return a.getDebts(e)}))})),(0,M.Z)((0,w.Z)(a),"handleTableChange",(function(t){var e=a.state.params;e.page=t.current,a.setState({pageSize:t.pageSize},(function(){localStorage.setItem("transactionPageSize",t.pageSize),e.page_size=t.pageSize,a.fetchTransactions(e)})),document.querySelector(".ant-table-body").scrollTop=0})),(0,M.Z)((0,w.Z)(a),"onChangeSearchText",(function(t){t.persist();var e=a.state.params,n=t.target.value;n?a.setState({params:st()(e,{$merge:{search:n}})}):a.setState({params:st()(e,{$unset:["search"]})}),a.delaySearch()})),(0,M.Z)((0,w.Z)(a),"delaySearch",B()((function(){return a.fetchTransactions()}),400)),(0,M.Z)((0,w.Z)(a),"onChangeFilter",(function(t,e){var n=a.state,o=n.isFilterMultipleTags,r=n.isFilterMultiplePayments,s=n.filterTags,i=n.isFilterExcludeTags,c={};switch(e){case"is_tag":var l=[];o?t.map((function(t){"tag"==t.key&&l.push(t.value)})):l=t.find((function(t){return"tag"==t.key}))?[t.find((function(t){return"tag"==t.key})).value]:[],l.includes("no_tag")&&("no_tag"==l[l.length-1]?(l=["no_tag"],a.setState({filterTags:s.filter((function(t){return!("tag"==t.key&&"no_tag"!=t.value)}))})):(l=l.filter((function(t){return!["no_tag"].includes(t)})),a.setState({filterTags:s.filter((function(t){return!["no_tag"].includes(t.value)}))}))),c={tag:l,is_filter_exclude_tags:i};break;case"is_payment":var d=[];t.map((function(t){"payments"==t.key&&d.push(t.value)})),c={payments:d,is_filter_multiple_payments:r};break;case"is_supplier":c={supplier_products_ids:t.reduce((function(t,e){return"supplier_products_ids"==e.key&&t.push(e.value),t}),[])};break;default:if(["warehouse_ids"].includes(t.key)){var u=[];"warehouse_ids"==t.key&&(u=s.filter((function(t){return"warehouse_ids"==t.key&&null!=t.value})).map((function(t){return t.value}))),c=(0,M.Z)({},t.key,u)}else c="wholesaleOrRetail"==t.key?{type_customer:null!=t.value?"wholesale"==t.value?"Wholesale":"Retail":null}:(0,M.Z)({},t.key,t.value)}a.fetchTransactions(c)})),(0,M.Z)((0,w.Z)(a),"onChangeFilterDate",(function(t){var e=t.timeRange,n=t.range,o=t.optionValue,r=(0,_.Z)(n,2),s=r[0],i=r[1],c=a.state,l=c.params,d=c.filterTags;l.startDateTime=s&&s.unix(),l.endDateTime=i&&i.unix(),l.page=1,l.timeRange=e,l.fieldTime=o;var u=["cost_date","time_incurred","inserted_at"],p=d.findIndex((function(t){return u.includes(t.key)}));if(s&&i){var g={key:o,value:{startDate:s,endDate:i}};p>-1?d[p]=g:d.push(g)}else p>-1&&d.splice(p,1);return a.setState({filterTags:d}),a.fetchTransactions(l)})),(0,M.Z)((0,w.Z)(a),"renderTag",(function(t){var e=a.state,n=e.transactionTags,o=e.modalViewValue,r=e.transactionTagsUser,s=a.props.t;t.includes("advCost")&&(t=t.filter((function(t){return"advCost"!=t})));var i=U()(n);return(o.advertising_cost_id||t.indexOf("advCost")>-1&&o.transaction_ref_id&&(!r.length||r.includes("advCost")))&&i.push({key:"advCost",color:"#f46e65",name:s("pages.shop.advertising.advertisingCost"),id:null}),Cn("div",{style:{margin:"0 7px"}},t.map((function(t){var e=i.find((function(e){return e.key==t}));return e?Cn(x.default,{color:e.color,key:e.key},e.name):t?Cn(x.default,{key:t},s("pages.shop.advertising.advertisingCost")):void 0})))})),(0,M.Z)((0,w.Z)(a),"renderColumnTag",(function(t){var e,n=a.state,o=n.transactionTags,r=n.transactionTagsUser,s=a.props,i=s.transactions,c=s.t,l=[],d=i.data.find((function(e){return e.id==t})),u=U()(o);d&&null!==(e=d.tag_ids)&&void 0!==e&&e.length&&(!r.length||r.includes("advCost"))&&(d.advertising_cost_id||d.tag_ids.indexOf("advCost")>-1&&d.transaction_ref_id)&&u.push({key:"advCost",color:"#f46e65",name:c("pages.shop.advertising.advertisingCost"),id:null});var p=u.filter((function(t){return(d&&d.tag_ids||[]).includes(t.key)}))||[];return u.map((function(t){var e=p.findIndex((function(e){return e.key==t.key}));if("advCost"!=(null===t||void 0===t?void 0:t.key))return e>-1?l.unshift(Cn(b.default.Item,{key:t.key,style:{display:"flex",justifyContent:"space-between"}},Cn("div",null,t.name),Cn(X.Z,{style:{marginLeft:8,marginTop:3,fontSize:12}}))):l.push(Cn(b.default.Item,{key:t.key,style:{display:"flex",justifyContent:"space-between"}},t.name))})),d&&d.is_locked?Cn("div",null,p.map((function(t,e){return Cn(Jt.Z,{color:t.color,key:t.key,text:e==p.length-1?t.name:""})}))):u.length>0?Cn("div",{onClick:function(t){return t.stopPropagation()}},Cn(y.default,{getPopupContainer:function(t){return t.parentNode},overlay:Cn(b.default,{onClick:function(t){return a.handleAddTags(d,t)}},l)},p.length?Cn("div",null,p.map((function(t,e){return Cn(Jt.Z,{color:t.color,key:t.key,text:e==p.length-1?t.name:""})}))):Cn("a",{className:"add-order-tag"},"\xa0",c("containers.formBox.addTag")))):Cn("div",{onClick:function(t){return t.stopPropagation()}},Cn("a",{onClick:a.showModal,className:"add-order-tag"},"\xa0",c("containers.formBox.addTag")))})),(0,M.Z)((0,w.Z)(a),"handleAddTags",(function(t,e){var n=a.props,o=n.t,r=n.shopId,s=n.accessToken,i=n.updateTransactions,c=t.tag_ids?t.tag_ids:[],l=c.indexOf(e.key);"advCost"!=e.key?(-1==l?c.push(e.key):c.splice(l,1),i(s,r,kn(kn({},t),{},{tag_ids:c}))):Rt.Z.warning(o("pages.admin.failure"),o("pages.shop.advertising.changeTag"))})),(0,M.Z)((0,w.Z)(a),"onChangeCheckBoxFilterMultipleTag",(function(t){var e=a.state.filterTags;a.setState({isFilterMultipleTags:t.target.checked},(function(){e.find((function(t){return"tag"==t.key}))&&(a.state.isFilterMultipleTags?a.onChangeFilter(a.state.filterTags,"is_tag"):(a.setState({filterTags:[]}),a.fetchTransactions(!1)))}))})),(0,M.Z)((0,w.Z)(a),"onChangeFilterExclude",(function(t){var e=a.state,n=e.filterTags,o=e.params,r=null===n||void 0===n?void 0:n.find((function(t){return"tag"==t.key}));a.setState({isFilterExcludeTags:t.target.checked},(function(){r&&a.fetchTransactions(kn(kn({},o),{},{is_filter_exclude_tags:t.target.checked}))}))})),(0,M.Z)((0,w.Z)(a),"onChangeCheckBoxFilterMultiplePayment",(function(t){var e=a.state.filterTags;a.setState({isFilterMultiplePayments:t.target.checked},(function(){e.find((function(t){return"payments"==t.key}))&&(a.state.isFilterMultiplePayments?a.onChangeFilter(a.state.filterTags,"is_payment"):(a.setState({filterTags:[]}),a.fetchTransactions(!1)))}))})),(0,M.Z)((0,w.Z)(a),"handleFilterByOrderSources",(function(){var t=a.state.params,e=U()(a.state.filterTags),n="order_sources",o=U()(a.state.orderSources),r=o.findIndex((function(t){return t.includes("search_")}));if(r>-1){var s=o[r].split("_")[1];o[r]=s}var i={key:n,value:o},c=e.findIndex((function(t){return t.key==n}));-1!=c?e[c]={key:n,value:o}:e.push(i),a.setState({filterTags:e},(function(){t=kn(kn({},t),{},(0,M.Z)({},i.key,i.value)),a.fetchTransactions(t)}))})),(0,M.Z)((0,w.Z)(a),"handleFilterByPageId",(function(t){a.setState({searchPageId:t})})),(0,M.Z)((0,w.Z)(a),"getTableName",(function(){var t=a.props.t;return[{value:"no_table_name",label:t("pages.shop.transaction.handmade")},{value:"purchases",label:t("pages.shop.product.purchase.purchase")},{value:"shop_transactions_order",label:t("pages.shop.transaction.shopTransactionOrder")},{value:"purchase_accessories",label:t("pages.shop.transaction.purchaseAccessories")},{value:"export_accessories",label:t("pages.shop.transaction.exportAccessories")},{value:"debts",label:t("debts.title")},{value:"export",label:t("pages.shop.product.export.export")}]})),(0,M.Z)((0,w.Z)(a),"getTransactionTags",(function(t,e){return!t||t&&0==t.length?[]:t.filter((function(t){return t.parent_key===e})).map((function(e){return{label:e.name,key:e.key,value:e.key,disabled:e.disabled||!1,children:a.getTransactionTags(t,e.key)}}))})),(0,M.Z)((0,w.Z)(a),"showMenuFilter",(function(){var t=a.props,e=t.t,n=t.users,o=t.currentShop,r=t.employeeList,s=t.order_sources_custom,i=t.warehouses,c=t.accessToken,l=t.shopId,d=t.supplier_products,u=a.state,p=u.isFilterMultipleTags,g=u.isFilterMultiplePayments,m=u.searchPageId,y=u.searchResult,b=u.filterTags,_=u.transactionTagsUser,C=u.isFilterExcludeTags,x=(0,v.Z)(a.state.transactionTags),k=r&&r.length?r.findIndex((function(t){return"creator_id"==t.which&&"transactionFilter"==t.type})):-1,S=-1==k?n:r[k].users,T=k>-1?r[k].text:void 0,Z=S.map((function(t){var e=t.user,n=e.name,a=e.fb_id,o=e.avatar_url;return{value:t.user_id,label:Cn("div",{style:{display:"flex",alignItems:"center"}},Cn(Gt.Z,{avatar_url:o,id:a,size:[25,25],style:{marginRight:10}}),Cn("span",null,n))}}));Z.unshift({value:100,label:Cn("div",{onClick:function(t){return t.stopPropagation()}},Cn(R.default,{onChange:function(t){return a.handleSearchEmployee(t,"creator_id")},value:T,placeholder:e("components.orderAdvanceFilter.enterEmployee"),allowClear:!0}))});var w=a.getTransactionTags(x),I=(0,bt.rWq)(o.bank_payments).map((function(t){return{value:t.value,label:t.text}}));I.push({value:"null",label:e("components.orderAdvanceFilter.unknown")}),_.length&&!_.includes("advCost")||w.unshift({value:"advCost",label:e("pages.shop.advertising.advertisingCost")}),w.unshift({label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(f.default,{checked:p,onChange:a.onChangeCheckBoxFilterMultipleTag},e("components.orderAdvanceFilter.filterMultipleTag"))),value:"is_filter_multiple_tags"},{label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(f.default,{checked:C,onChange:a.onChangeFilterExclude},e("components.orderAdvanceFilter.filterExclude"))),value:"is_filter_Exclude_tags"},{label:Cn("span",null,Cn(J.Z,null)," ",e("components.orderAdvanceFilter.noTag")),value:"no_tag"}),I.unshift({label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(f.default,{checked:g,onChange:a.onChangeCheckBoxFilterMultiplePayment},e("components.orderAdvanceFilter.filterMultipleMethod"))),value:"is_filter_multiple_tags"});var N=(0,bt.K5C)(s,o),A=[];(0,bt.caL)(o).map((function(t){N.find((function(e){return e.id==t.id}))||A.push(t)}));var O=[];N.concat(A).concat({name:e("components.orderAdvanceFilter.noSource"),id:"null"}).sort((function(t){var e=t.id;return e&&"-1"==e.toString()||e&&"-10"==e.toString()||e&&"-11"==e.toString()?-1:1})).map((function(t){var n,o,r,s,i,c,l,d,u,p=[],g=(null===(o=p="-1"==(null===(n=t.id)||void 0===n?void 0:n.toString())&&m?(t.nodes||[]).filter((function(t){return(0,bt.C6S)((0,bt.Mle)(m),(0,bt.Mle)(t.name))||t.page_id&&t.page_id==m})):t.nodes)||void 0===o?void 0:o.length)>0?p.map((function(e){var n,a,o;return{label:t.id&&"-1"==t.id.toString()||t.id&&"-8"==t.id.toString()&&"zl"==(null===(n=e.page_id)||void 0===n?void 0:n.slice(0,2))||t.id&&"-10"==t.id.toString()&&"wa"==(null===(a=e.page_id)||void 0===a?void 0:a.slice(0,2))||t.id&&"-11"==t.id.toString()&&"ig"==(null===(o=e.page_id)||void 0===o?void 0:o.slice(0,2))?Cn("div",{style:{display:"flex",justifyItems:"center"}},Cn(Te.Z,{ids:[e.page_id],width:25,height:25,name:e.name,seed:e.id}),"\xa0",Cn("span",null,e.name)):e.name,value:(e.custom_id||e.id).toString(),isLeaf:!0}})):"-1"==(null===(r=t.id)||void 0===r?void 0:r.toString())&&(null===(s=t.nodes)||void 0===s?void 0:s.length)>0?[]:null;"-1"==(null===(i=t.id)||void 0===i?void 0:i.toString())&&g&&!g.find((function(t){return"page_id"==t.value}))&&(g.unshift({value:"page_id",label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(R.default,{onClick:function(t){return t.target.focus()},placeholder:e("components.orderAdvanceFilter.enterPageId"),onChange:function(t){return a.handleFilterByPageId(t.target.value)},suffix:Cn(Q.Z,null),value:m,allowClear:!0}))}),m&&g.push({label:m,value:"search_".concat(m),isLeaf:!0}));var h="-1"==(null===(c=t.id)||void 0===c?void 0:c.toString())?!((null===(l=p)||void 0===l?void 0:l.length)>0||m&&(null===(d=p)||void 0===d||!d.length)):!((null===(u=p)||void 0===u?void 0:u.length)>0);O.push({label:Cn("span",null,t.icon&&Cn("img",{style:{width:18,height:18},src:t.icon}),Cn("span",{style:{fontWeight:450,marginLeft:8}},t.name)),value:t.id.toString(),isLeaf:h,children:g})})),O.unshift({value:100,label:Cn("div",{onClick:function(t){return t.stopPropagation()}},Cn(h.default,{style:{height:32,width:"100%",cursor:"pointer"},type:"primary",onClick:function(){return a.handleFilterByOrderSources()},disabled:!(a.state.orderSources.length>0)||!a.state.visibleFilterOrderSources},e("crm.filter")))});var M=a.getTableName().map((function(t){return{value:t.value,label:t.label}})),E=[{value:"supplier_products_ids",label:e("pages.shop.debt.supplierProducts"),isRoot:!0,children:d.data.map((function(t){return{value:t.id,label:Cn("div",{style:{display:"flex",justifyContent:"space-between"}},Cn("div",null,t.name),(b||[]).find((function(e){return"supplier_products_ids"==e.key&&e.value==t.id}))&&Cn("div",{style:{marginLeft:10}},Cn(X.Z,{style:{color:"#1890ff"}})))}}))}],P=[{value:"collect_pay",label:e("pages.shop.statistic.transaction.collect")+"/"+e("pages.shop.statistic.transaction.pay"),isRoot:!0,children:[{value:"0",label:e("pages.shop.statistic.transaction.collect")},{value:"1",label:e("pages.shop.statistic.transaction.pay")}]},{value:"creator_id",label:e("pages.shop.transaction.creator"),isRoot:!0,children:Z.concat([{value:"null",label:Cn("div",{style:{display:"flex",alignItems:"center"}},Cn(Gt.Z,{id:null,size:[25,25],color:"#00707f",style:{marginRight:10},name:e("components.orderAdvanceFilter.system")}),Cn("span",null,e("components.orderAdvanceFilter.creatorBySystem")))}])},{value:"sale_group",label:e("pages.shop.setting.employee.teamSale"),isRoot:!0,children:(o.sale_groups||[]).map((function(t){return{value:t.id,label:t.name}}))},{value:"tag",label:e("components.orderAdvanceFilter.tag"),isRoot:!0,children:w},{value:"payments",label:e("pages.shop.transaction.payment"),isRoot:!0,children:I},{value:"is_accounting",label:e("pages.shop.transaction.isAccounting"),isRoot:!0,children:[{value:!0,label:e("pages.shop.product.export.yes")},{value:!1,label:e("pages.shop.product.export.no")}]},{value:"order_sources",label:e("pages.shop.transaction.orderSource"),isRoot:!0,children:O},{value:"is_proactive",label:e("pages.shop.transaction.handmade")},{value:"table_name",isRoot:!0,label:e("pages.shop.transaction.tableName"),children:M},{value:"adv",label:e("pages.shop.statistic.transaction.transactionAdvertising"),isRoot:!0,children:[{value:"warehouse_ids",label:e("pages.shop.advertising.warehouse"),children:i.map((function(t){return{value:t.id,label:t.name}}))},{value:"marketer",label:"Marketer",children:n.map((function(t){var e=t.user,n=e.name,a=e.fb_id,o=e.avatar_url;return{value:t.user_id,label:Cn("div",{style:{display:"flex",alignItems:"center"}},Cn(Gt.Z,{avatar_url:o,id:a,size:[25,25],style:{marginRight:10}}),Cn("span",null,n))}}))},{value:"product_id",label:e("products.title"),children:[{disabled:!0,value:"product_search",label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(ge.Z,{className:"custom-search-bar",accessToken:c,shopId:l,searchResult:y,callback:function(t){return a.setState({searchResult:t})},is_filter:!0,combo_by:"product",searchOnly:!0}))}].concat((0,v.Z)(a.renderResultProduct()))},{value:"wholesaleOrRetail",label:"".concat(e("pages.shop.customer.wholesale")," / ").concat(e("pages.shop.customer.retail")),children:[{value:"wholesale",label:e("pages.shop.customer.wholesale")},{value:"retail",label:e("pages.shop.customer.retail")}]},{value:"utm",label:"UTM",children:a.renderUTM(!0)}]}];return P=P.concat(E),(0,bt.QIx)(P,"".concat(a.props.shopId,"_filter_transaction_source_count"))})),(0,M.Z)((0,w.Z)(a),"renderResultProduct",(function(){var t=a.state.searchResult,e=a.props,n=e.t,o=e.currentShop,r=e.warehouses;return t.map((function(t,e){return{value:"product-".concat(e),label:Cn("div",{onClick:function(e){e.stopPropagation(),a.handleSelectProduct(t.id)}},Cn(Ve.Z,{width:300,t:n,key:e,currentShop:o,combo_by:"product",item:t,warehouses:r}))}}))})),(0,M.Z)((0,w.Z)(a),"handleSelectProduct",(function(t){var e=a.state,n=e.searchResult,o=e.filterTags,r=n.findIndex((function(e){return e.id==t})),s="".concat(n[r].name," (").concat(n[r].custom_id||n[r].display_id,")"),i=o.findIndex((function(t){return"product_id"==t.key}));-1!=i?o[i].value=s:o.push({key:"product_id",value:s}),a.fetchTransactions({product_id:t}),a.setState({filterTags:o,searchResult:[]})})),(0,M.Z)((0,w.Z)(a),"handleClose",(function(t){var e=a.state,n=e.filterTags,o=e.isFilterMultipleTags,r=e.isFilterMultiplePayments;if("tag"==n[t].key&&o)n.splice(t,1),a.onChangeFilter(n,"is_tag");else if("payments"==n[t].key&&r)n.splice(t,1),a.onChangeFilter(n,"is_payment");else if("supplier_products_ids"==n[t].key)n.splice(t,1),a.onChangeFilter(n,"is_supplier");else{var s=n[t];s.value=null,a.onChangeFilter(s),n.splice(t,1)}a.setState({filterTags:n})})),(0,M.Z)((0,w.Z)(a),"transactionTableHeighStyle",(function(t){return t?Cn(V.default,{id:"3975738569"},[".transaction-container .ant-table-body,.transaction-container .ant-table-body-inner{min-height:calc(100vh - 253px);}"]):Cn(V.default,{id:"2759922856"},[".transaction-container .ant-table-body,.transaction-container .ant-table-body-inner{min-height:calc(100vh - 211px);}"])})),(0,M.Z)((0,w.Z)(a),"onClearFilterClick",(function(){var t=kn(kn({},An),{},{startDateTime:null,endDateTime:null});a.setState({filterTags:[],searchPageId:null,params:t,timeRange:["30"]}),a.fetchTransactions(!1)})),(0,M.Z)((0,w.Z)(a),"renderStatus",(function(){var t=a.state,e=t.params,n=t.isLoading,o=a.props,r=o.counters,s=o.t,i=r&&r.length>0?r.reduce((function(t,e){return t+e.count}),0):0,c=function(t){var e=r&&r.length>0?r.filter((function(e){return 1==t&&!e.status||e.status==t})):[];return e.length>0?e.reduce((function(t,e){return t+e.count}),0):0},l=[{text:s("commons.all"),value:"-1",count:i},{text:s("pages.shop.transaction.new"),value:0,count:c(0)},{text:s("pages.shop.transaction.effective"),value:1,count:c(1)},{text:s("pages.shop.transaction.canceled"),value:2,count:c(2)},{text:s("pages.shop.transaction.removed"),value:3,count:c(3)}];return Cn("div",{className:"status-dropdown"},Cn(Tn,{id:"status-group",onChange:function(t){return a.fetchTransactions({status:t.target.value})},value:e.status},l.map((function(t){return Cn(Zn,{value:t.value,key:t.value},t.text,Cn(x.default,{key:t.value},n&&e.status==t.value?Cn(tt.Z,null):t.count))}))))})),(0,M.Z)((0,w.Z)(a),"renderFilterTag",(function(t,e){var n,o=a.props,r=o.t,s=o.currentShop,i=o.order_sources_custom,c=o.warehouses,l=o.users,d=o.supplier_products,u="",p="",g=U()(s.transaction_tags)||[];switch(t.key){case"collect_pay":switch(u=r("pages.shop.transaction.bill"),t.value){case"0":p=r("pages.shop.transaction.collect");break;case"1":p=r("pages.shop.transaction.pay")}break;case"creator_id":u=r("components.orderAdvanceFilter.creator"),p=l.find((function(e){return e.user_id==t.value}))?l.find((function(e){return e.user_id==t.value})).user.name:r("components.orderAdvanceFilter.system");break;case"tag":u=r("components.orderAdvanceFilter.tag");var m=s.transaction_tags?s.transaction_tags.findIndex((function(t){return"advCost"==t.key})):-1;"no_tag"!=t.value?(m<0&&(!a.state.transactionTagsUser.length||a.state.transactionTagsUser.includes("advCost"))&&g.push({key:"advCost",color:"#f46e65",name:r("pages.shop.advertising.advertisingCost"),id:null}),p=(g.find((function(e){return e.key==t.value}))||{}).name):p=r("components.orderAdvanceFilter.noTag");break;case"payments":u=r("pages.shop.transaction.payment"),p="null"==t.value?r("components.orderAdvanceFilter.unknown"):((0,bt.rWq)(s.bank_payments).find((function(e){return e.value==t.value}))||{}).text;break;case"is_accounting":u=r("pages.shop.transaction.isAccounting"),p=t.value?r("pages.shop.product.export.yes"):r("pages.shop.product.export.no");break;case"sale_group":u=r("pages.shop.setting.employee.teamSale"),p=null===(n=(s.sale_groups||[]).find((function(e){return e.id==t.value})))||void 0===n?void 0:n.name;break;case"order_sources":var h=(0,bt.K5C)(i,s),f=[];(0,bt.caL)(s).map((function(t){h.find((function(e){return e.id==t.id}))||f.push(t)}));var v=h.concat(f),y=v.findIndex((function(e){return e.id==t.value[0]||e.id&&e.id.toString()==t.value[0]})),b=y>-1?v[y].name:"",_=null;t.value.length>1&&(_=((v[y].nodes||[]).find((function(e){return e.custom_id==t.value[1]||e.id==t.value[1]}))||{}).name),u=r("components.orderAdvanceFilter.".concat("null"==t.value?"noSource":"orderSource")),p=_?b+"/"+_:"-1"==t.value[0]&&t.value.length>1?b+"/"+t.value[1]:b;break;case"is_proactive":u=r("pages.shop.transaction.handmade");break;case"table_name":u=r("pages.shop.transaction.tableName"),p=(a.getTableName().find((function(e){return e.value==t.value}))||{}).label;break;case"supplier_products_ids":u=r("pages.shop.debt.supplierProducts");var C=d.data.find((function(e){return e.id==t.value}));p=C?C.name:"";break;case"cost_date":case"time_incurred":case"inserted_at":u="cost_date"==t.key?r("pages.shop.transaction.timeAdvertisingCost"):"time_incurred"==t.key?r("pages.shop.transaction.timeIncurred"):r("pages.shop.product.purchase.time");var k=(0,bt.o0x)(a.props.timezone,t.value.startDate||"",!1,"DD/MM/YYYY"),S=(0,bt.o0x)(a.props.timezone,t.value.endDate||"",!1,"DD/MM/YYYY");p="".concat(r("pages.shop.product.purchase.from")," ").concat(k," - ").concat(r("pages.shop.product.purchase.to")," ").concat(S);break;case"warehouse_ids":u=r("pages.shop.advertising.warehouse");var T=c.find((function(e){return e.id==t.value}));p=(null===T||void 0===T?void 0:T.name)||"";break;case"marketer":u="Marketer";var Z=l.find((function(e){return e.user_id==t.value}));p=(null===Z||void 0===Z?void 0:Z.user.name)||"";break;case"product_id":u=r("products.title"),p=t.value;break;case"wholesaleOrRetail":u="".concat(r("pages.shop.customer.wholesale")," / ").concat(r("pages.shop.customer.retail")),p="wholesale"==t.value?r("pages.shop.customer.wholesale"):r("pages.shop.customer.retail");break;case"link_utm":case"utm_source":case"utm_medium":case"utm_campaign":case"utm_term":case"utm_content":var w=a.renderUTM().find((function(e){return e.value==t.key}));u=null===w||void 0===w?void 0:w.label,p=t.value}return Cn(x.default,{key:"tag"==t.key||"payments"==t.key?t.key+p.toString():t.key,closable:!0,onClose:function(){return a.handleClose(e)}},Cn("span",null,Cn("strong",null,u,p?":":""," "),p))})),(0,M.Z)((0,w.Z)(a),"renderUTM",(function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=a.props.t,n=(0,bt.ybq)();return t?n.map((function(t){return t=kn(kn({},t),{},{children:[{value:"search_".concat(t.value),label:Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(R.default,{placeholder:e("components.orderAdvanceFilter.enterSearch"),onClick:function(t){return t.target.focus()},onChange:function(e){return a.debounceHandleOnChangeUtm(e.target.value,t.value)},allowClear:!0}))}]})})):n})),(0,M.Z)((0,w.Z)(a),"debounceHandleOnChangeUtm",B()((function(t,e){t&&a.onSelectMenuItem([e,t])}),500)),(0,M.Z)((0,w.Z)(a),"setFilterOrderSources",(function(t,e){var n=e[e.length-1],o=[],r=!1;e.map((function(t){"order_sources"!=t.value&&o.push(t.value)})),e.length>1&&(r=!0),a.setState({orderSources:o,visibleFilterOrderSources:r},(function(){n.isLeaf&&100!=n.value&&a.handleFilterByOrderSources()}))})),(0,M.Z)((0,w.Z)(a),"onClickMenuItem",(function(t,e){if(1==e.length&&e[0].isRoot||e.length>=1&&["order_sources","adv"].includes(e[0].value)){if(e[1]&&100==e[1].value)return;return e.length>2&&"adv"==e[0].value&&!["product","utm"].includes(e[1].value)&&a.onSelectMenuItem(t),void("order_sources"==e[0].value&&a.setFilterOrderSources(t,e))}a.onSelectMenuItem(t)})),(0,M.Z)((0,w.Z)(a),"onchangeTransactionTag",(function(t,e){var n=a.state.transactionTag;if("name"===t)n.name=e;else{var o=e.hex.toLowerCase();n.color=o}a.setState({transactionTag:n})})),(0,M.Z)((0,w.Z)(a),"onSelectMenuItem",(function(t){var e=a.state,n=e.isFilterMultipleTags,o=e.isFilterMultiplePayments,r=a.state.filterTags,s=t[t.length-1],i="adv"==t[0]?t[1]:t[0],c={key:i,value:s},l=r?r.findIndex((function(t){return t.key==i})):-1;if(-1!=l){if("tag"==i&&n||"payments"==i&&o||"supplier_products_ids"==i){var d=r.findIndex((function(t){return t.value==c.value}));d<0?r.push(c):"supplier_products_ids"==i&&r.splice(d,1)}else["warehouse_ids"].includes(i)||(r[l].value=s);if("warehouse_ids"==i)r.findIndex((function(t){return t.key==i&&t.value==s}))<0&&r.push(c)}else r.push(c);(0,bt.iAs)(i,"".concat(a.props.shopId,"_filter_transaction_source_count")),a.setState({filterTags:r},(function(){"tag"==i?a.onChangeFilter(a.state.filterTags,"is_tag"):"payments"==i&&o?a.onChangeFilter(a.state.filterTags,"is_payment"):"supplier_products_ids"==i?a.onChangeFilter(a.state.filterTags,"is_supplier"):a.onChangeFilter(c)}))})),(0,M.Z)((0,w.Z)(a),"renderSelectTag",(function(t,e){var n=a.props.t,o=a.state.transactionTags.find((function(e){return e.key==t.value})),r="advCost"==t.value?"#f46e65":o?o.color:"#3922a8";return"advCost"==t.value?Cn(x.default,(0,m.Z)({style:{margin:2}},t,{color:r,closable:"create"==e}),n("pages.shop.advertising.advertisingCost")):Cn(x.default,(0,m.Z)({style:{margin:2}},t,{color:r}),t.label)})),(0,M.Z)((0,w.Z)(a),"onSelectChange",(function(t,e){var n=a.props.transactions,o=a.state,r=o.selectedRowKeys,s=o.selectedTransactions,i=e&&e.length>0?e:n.data,c=s.concat(t.filter((function(t){return!r.includes(t)})).map((function(t){return i.find((function(e){return e.display_id==t}))}))).filter((function(e){return t.includes(e.display_id)}));a.setState({selectedRowKeys:t,selectedTransactions:c})})),(0,M.Z)((0,w.Z)(a),"handleChangeTags",(function(t,e){var n,o=(null===(n=t)||void 0===n?void 0:n.length)>0?a.disabledParentTags(t,e):[];t=t.filter((function(t){return!o.find((function(e){return e.disabled&&e.key==t}))}));var r=a.state.modalChangeValue;if("create"===e)a.setState({tag_ids:t});else{var s=U()(r);(s.tag_ids||[]).includes("advCost")&&!t.includes("advCost")&&t.push("advCost"),s.tag_ids=t,a.setState({modalChangeValue:s})}})),(0,M.Z)((0,w.Z)(a),"disabledParentTags",(function(t,e){var n=a.state,o=n.transactionTags,r=(n.transactionTagsUser,a.props.t,U()(o));if(!t.length)return r;var s=r.filter((function(e){return t.includes(e.key)&&e.parent_key})).map((function(t){return t.parent_key}));return s.length?(s=function t(e,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];a.length||(a=a.concat(n));var o=e.filter((function(t){return n.includes(t.key)&&t.parent_key}));return o.length>0?(n=o.map((function(t){return t.parent_key})),a=a.concat(n),t(e,n,a)):a}(r,s),r.map((function(t){return s.includes(t.key)&&(t=kn(kn({},t),{},{disabled:!0})),t}))):r})),(0,M.Z)((0,w.Z)(a),"renderTransactionTag",(function(t,e,n){var o=a.props.t,r=a.disabledParentTags(e,t);return e.includes("advCost")&&(e=e.filter((function(t){return"advCost"!=t}))),Cn("div",{style:{marginBottom:16}},Cn("span",{style:{fontWeight:500,lineHeight:2}},o("components.orderAdvanceFilter.tag"),":"),Cn(g.ZP,{value:e,showSearch:!0,tagRender:function(e){return a.renderSelectTag(e,t)},treeData:a.getTransactionTags(r),onChange:function(e){return a.handleChangeTags(e,t)},multiple:!0,disabled:n,placeholder:o("pages.shop.setting.application.selectTag"),onSearch:function(t){return a.setState({categoryTerm:t})},treeDefaultExpandAll:!0,notFoundContent:"Ch\u01b0a c\u1ea5u h\xecnh th\u1ebb",filterTreeNode:function(t,e){return"th"==a.props.currentLanguage?e.props.title.indexOf(t)>=0:(0,bt.Mle)(e.props.title).indexOf((0,bt.Mle)(t))>=0},dropdownStyle:{maxHeight:400,overflow:"auto",fontSize:14},style:{width:"100%"}}))})),(0,M.Z)((0,w.Z)(a),"renderPayment",(function(t,e){var n=a.props,o=n.t,r=n.currentShop;return Cn("div",{className:"payments-content"},Cn("label",null,o("pages.shop.transaction.payment"),":"),Cn(E.default,{mode:"multiple",style:{width:"100%",marginTop:5,borderRadius:2},placeholder:o("pages.shop.transaction.selectPayment"),value:e,onChange:function(e){return a.onHandlePayment(t,e)}},(0,bt.rWq)(r.bank_payments).map((function(t){return Cn(wn,{key:t.value,value:t.value},t.text)}))))})),(0,M.Z)((0,w.Z)(a),"onHandlePayment",(function(t,e){var n=a.state,o=n.modalChangeValue,r=n.order;"create"==t?(r&&(e=[e[e.length-1]]),a.setState({payments:e})):(o.payments=e,a.setState({modalChangeValue:o}))})),(0,M.Z)((0,w.Z)(a),"renderPaymentcolumn",(function(t){return t.map((function(t){var e=(0,bt.rWq)(a.props.currentShop.bank_payments).find((function(e){return e.value==t}));return Cn(x.default,{color:null===e||void 0===e?void 0:e.color},(null===e||void 0===e?void 0:e.text)||a.props.t("tool.deleted"))}))})),(0,M.Z)((0,w.Z)(a),"onChangeSupplierProducts",(function(t){a.setState({supplier_products_id:t})})),(0,M.Z)((0,w.Z)(a),"onChangeValue",(function(t,e){var n=a.state.modalChangeValue;n[t]=e,a.setState({modalChangeValue:n})})),(0,M.Z)((0,w.Z)(a),"changeAdvCostLocked",(function(t){var e=a.props.t;p.Z.confirm({title:e("pages.shop.transaction.confirmUnlock"),content:e("pages.shop.transaction.confirmUnlock"),okText:e("confirmed"),cancelText:e("cancel"),onOk:function(){var e=a.props,n=e.accessToken,o=e.shopId,r=e.updateAdvertisingCost,s=a.state,i=s.advCost,c=s.modalViewValue;a.setState({isLoadingAdv:!0});var l=a.objectTransaction(c);l.is_locked=t,r(n,o,i=kn(kn({},i),{},{transaction:l})).then((function(t){a.setState({isLoadingAdv:!1,advCost:null,visibleModalView:!1})}))}})})),(0,M.Z)((0,w.Z)(a),"objectTransaction",(function(t){return{name:t.tradingName,payments:t.payments,note:t.note,tag_ids:t.tag_ids,is_locked:t.isLocked,images:t.images,time_incurred:t.timeIncurred}})),(0,M.Z)((0,w.Z)(a),"handleSaveAdvCost",(function(){var t=a.props,e=t.t,n=t.shopId,o=t.accessToken,r=t.createAdvertisingCost,s=t.creator,i=t.updateAdvertisingCost,c=a.state,l=c.advCost,d=c.inputName,u=c.payments,p=c.areaNote,g=c.isLocked,m=c.tag_ids,h=c.modalChangeValue,f=c.timeIncurred,v=c.checkedListTransaction,y=c.images,b=c.status;a.setState({isLoadingAdv:!0});var _=l?l.items.find((function(t){return t.cost<=0})):null,C=(0,He.P0)(v,Pn);if(l&&!l.id){var x={name:d,note:p,is_locked:g,time_incurred:f,images:y,status:b,payments:u,tag_ids:m};l.creator_id=s,l=kn(kn({},l),{},{transaction:x}),!_&&l.cost_date?r(o,n,l,C).then((function(){a.onCancel()})):(a.setState({isLoadingAdv:!1}),_?Rt.Z.warning(e("pages.admin.failure"),e("pages.shop.advertising.warnCost")):Rt.Z.warning(e("pages.admin.failure"),e("pages.shop.advertising.warnCostDate")))}else{var k=a.objectTransaction(h);l.last_editor_id=s,l=kn(kn({},l),{},{transaction:k}),!_&&l.cost_date?i(o,n,l,C).then((function(t){a.setState({isLoadingAdv:!1,advCost:null,visibleModalChange:!1})})):(a.setState({isLoadingAdv:!1}),_?Rt.Z.warning(e("pages.admin.failure"),e("pages.shop.advertising.warnCost")):Rt.Z.warning(e("pages.admin.failure"),e("pages.shop.advertising.warnCostDate")))}})),(0,M.Z)((0,w.Z)(a),"onCancel",(function(){a.setState({visibleModalCreate:!1,value:1,inputAmount:"",inputName:"",areaNote:"",isLocked:!1,isLoading:!1,tag_ids:[],payments:void 0,supplier_products_id:null,advCost:null,isLoadingAdv:!1,timeIncurred:null,images:[],fileList:[],isCreateAdvCost:!1})})),(0,M.Z)((0,w.Z)(a),"getInc",(function(){var t;return(null===(t=a.state.columnsWidth)||void 0===t?void 0:t.inc)||0})),(0,M.Z)((0,w.Z)(a),"onResize",(function(t,e){var n,o=a.state.columnsWidth;t==On&&(e=a.getInc()+e-((null===(n=document.getElementsByClassName(t)[0])||void 0===n?void 0:n.offsetWidth)||0));o[t=t==On?"inc":t]=e,a.setState({columnsWidth:o},(function(){localStorage.setItem("columnsWidthTransaction",JSON.stringify(o))}))})),(0,M.Z)((0,w.Z)(a),"onSelectRow",(function(){var t=a.props,e=t.shopId,n=t.accessToken,o=a.state.params,r="".concat((0,bt.LpH)(),"/shops/").concat(e,"/transactions?access_token=").concat(n);a.setState({loadingData:!0});(function t(e){return ht().get(r,{params:e}).then((function(n){var o=a.state,r=o.loadingData,s=o.selectedRowKeys,i=n.data.data,c=i.map((function(t){return t.display_id})),l=s.filter((function(t){return!c.includes(t)})).concat(c);return r&&a.onSelectChange(l,i),(l||[]).length>=n.data.total_entries||0==i.length||!r?void 0:(e.page+=1,t(e))}))})(kn(kn({},o),{},{page:1})).then((function(t){return a.setState({loadingData:!1})}))})),(0,M.Z)((0,w.Z)(a),"handlePreview",(function(t){a.setState({previewImage:t.response.content_url||t.thumbUrl,previewVisible:!0})})),(0,M.Z)((0,w.Z)(a),"handleBeforeUpload",(function(t){return new Promise((function(e){var n=new FileReader;n.onload=function(){var a=new Image;a.onload=function(){t.width=a.width,t.height=a.height,e(t)},a.src=n.result},n.readAsDataURL(t)}))})),(0,M.Z)((0,w.Z)(a),"handleChangeFiles",(function(t,e){var n,o=U()(a.state.modalChangeValue);"create"==e?(n=t.length?t.map((function(t){var e;return null!==t&&void 0!==t&&t.response?null===(e=t.response)||void 0===e?void 0:e.content_url:t})):-1,a.setState({images:n,fileList:t})):(t.length?o.images=t.map((function(t){var e;return null!==t&&void 0!==t&&t.response?null===(e=t.response)||void 0===e?void 0:e.content_url:t})):o.images=-1,a.setState({modalChangeValue:o,fileList:t}))})),(0,M.Z)((0,w.Z)(a),"handleSelectOrder",(function(t){var e=a.props.t,n=a.state.payments;n&&n.length>1&&a.setState({payments:[n[0]]}),a.setState({order:{id:t.id,display_id:t.custom_id||t.display_id},visibleOrderModal:!1}),Rt.Z.success(e("success"),"".concat(e("components.updateOrderTool.addOrderSuccess")," #").concat(t.custom_id||t.display_id))})),(0,M.Z)((0,w.Z)(a),"renderUploadImages",(function(t){var e=a.props.accessToken,n=a.state,o=n.previewVisible,r=n.previewImage,s=n.fileList;return Cn("div",{className:"image-content"},Cn(u.Z,{action:"".concat((0,bt.LpH)(),"/contents?access_token=").concat(e),listType:"picture-card",accept:"image/*",multiple:!0,className:"transaction-detail-image",beforeUpload:a.handleBeforeUpload,data:function(t){return{file:t,width:t.width,height:t.height}},fileList:s,onPreview:a.handlePreview,onChange:function(e){return a.handleChangeFiles(e.fileList,t)}},Cn("div",null,Cn(et.Z,null),Cn("div",{className:"ant-upload-text"},"Upload"))),Cn(p.Z,{visible:o,footer:null,onCancel:function(){return a.setState({previewVisible:!1})},wrapClassName:"image-preview"},Cn("img",{style:{width:"100%"},src:r})))})),(0,M.Z)((0,w.Z)(a),"renderSelectSupplier",(function(t,e){var n=a.props,o=n.supplier_products,r=n.t;return Cn("div",{className:"radio-content-middle"},Cn("label",null,r("pages.shop.transaction.supplier"),":"),Cn("div",{className:"amount-changes"},Cn(E.default,{style:{width:"100%"},placeholder:r("components.productPurchaseDetail.selectSupplier"),size:"default",value:t,onChange:function(t){"create"==e?a.onChangeSupplierProducts(t):a.onChangeValue("supplier_products_id",t)},showSearch:!0,allowClear:!0,filterOption:function(t,e){return(0,bt.st5)(t,e.children)}},o.data.map((function(t){return Cn(wn,{key:t.id,value:t.id},t.name)})))))})),(0,M.Z)((0,w.Z)(a),"handleChangeAdvCost",(function(t,e){t.push("advCost"),t=F()(t),a.setState({isCreateAdvCost:!e,tag_ids:t})})),(0,M.Z)((0,w.Z)(a),"onChangeStatus",(function(t){var e=t.key;a.setState({status:e}),localStorage.setItem("status-adv-cost",JSON.stringify(e))})),(0,M.Z)((0,w.Z)(a),"renderFooter",(function(){var t=a.state,e=t.isCreateAdvCost,n=t.isLoadingAdv,o=t.status,r=t.advCost,s=t.inputName,i=t.inputAmount,c=a.props.t;if(e){var l=(0,bt.Lvs)()[o];return Cn(d.default,{content:Cn(b.default,{className:"dropdown-container",onClick:a.onChangeStatus},[0,1,2,3].map((function(t){return Cn(b.default.Item,{disabled:n,key:t},(0,bt.Lvs)()[t].text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},Cn(h.default,{type:"primary",style:{background:l.bgColor,borderColor:l.bgColor,color:"#fff"},disabled:n||!r,onClick:a.handleSaveAdvCost,icon:Cn(n?tt.Z:nt.Z,null)},l.text))}return Cn(h.default,{type:"primary",disabled:!s&&!i,onClick:a.handleCreateTransaction.bind((0,w.Z)(a))},Cn("span",null,Cn(nt.Z,null)," ",c("pages.shop.transaction.created")))}));var o=t.isServer?En:localStorage.getItem("columnsTransaction")?JSON.parse(localStorage.getItem("columnsTransaction")).checkedListTransaction:En,r=t.isServer?{}:localStorage.getItem("columnsWidthTransaction")?JSON.parse(localStorage.getItem("columnsWidthTransaction")):{};return a.state={transaction:t.transaction,value:2,inputAmount:"",inputName:"",areaNote:"",isLocked:!1,isLoading:!t.isServer,tag_ids:[],params:kn({},An),selectedRowKeys:[],filterTags:[],transactionTags:t.currentShop&&t.currentShop.transaction_tags||[],transactionTag:{key:null,name:"",color:"#dc11cc"},isFilterExclude:!1,isFilterMultipleTags:!1,isFilterExcludeTags:!1,payments:[],isFilterMultiplePayments:!1,supplier_products_id:null,isAccounting:!0,pageSize:parseInt(localStorage.getItem("transactionPageSize")||30),timeIncurred:void 0,timeRange:["30"],isDetailAdvCost:!1,loadAdvCost:!1,advCost:null,isLoadingAdv:!1,isUpdateTags:!1,selectedTags:[],selectedTransactions:[],orderSources:[],visibleFilterOrderSources:!1,searchPageId:null,searchResult:[],checkedListTransaction:o,paymentDebtsToSuppliers:!0,transactionTagsUser:[],columnsWidth:r,loadingData:!1,fileList:[],previewVisible:!1,previewImage:"0",images:[],visibleOrderModal:!1,order:{},formBoxVisible:!1,isCreateAdvCost:!1,status:1},a.currencySymbol=(0,bt.jKf)(t.currentShop.currency),a}return(0,I.Z)(n,null,[{key:"getInitialProps",value:function(){var t=(0,T.Z)(S().mark((function t(e,n){var a,o,r,s;return S().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.isServer,o=e.store.dispatch,r=e.query,s=r.shopId,!a){t.next=9;break}return t.next=5,o((0,yt.iYf)(n,s,An));case 5:return t.next=7,o((0,yt.lP6)(n,s,An));case 7:return t.next=9,o((0,yt.WZk)(n,s,An));case 9:return t.abrupt("return",{isServer:a,shopId:s});case 10:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),(0,I.Z)(n,[{key:"handleCreateTransaction",value:function(){var t=this.state,e=t.inputAmount,n=t.inputName,a=t.areaNote,o=t.isLocked,r=t.value,s=t.tag_ids,i=t.payments,c=t.supplier_products_id,d=t.isAccounting,u=t.timeIncurred,p=t.paymentDebtsToSuppliers,g=t.images,m=t.order,h=this.props,f=h.accessToken,v=h.shopId,y=h.createTransactions;!m||!m.id||i&&0!=i.length?(y(f,v,{name:n,note:a,amount:1==r?e:-1*e,is_locked:o,is_locked_by_user:o,tag_ids:s,payments:i,supplier_products_id:c,is_accounting:d,time_incurred:u,payment_debts_to_suppliers:p,images:g,orderId:null===m||void 0===m?void 0:m.id}),this.setState({visibleModalCreate:!1,value:1,inputAmount:"",inputName:"",areaNote:"",isLocked:!1,isLoading:!1,tag_ids:[],payments:[],supplier_products_id:null,paymentDebtsToSuppliers:!0,order:null})):l.default.warning("B\u1ea1n ch\u01b0a ch\u1ecdn ph\u01b0\u01a1ng th\u1ee9c thanh to\xe1n")}},{key:"handleSaveTransaction",value:function(){var t=this.state.modalChangeValue,e=t.id,n=t.tradingName,a=t.note,o=t.aoMoney,r=t.isLocked,s=t.tag_ids,i=t.payments,c=t.supplier_products_id,l=t.isAccounting,d=t.timeIncurred,u=t.paymentDebtsToSuppliers,p=t.images,g=this.props,m=g.accessToken,h=g.shopId;(0,g.updateTransactions)(m,h,{id:e,name:n,note:a,amount:o,is_locked:r,is_locked_by_user:r,tag_ids:s,payments:i,supplier_products_id:c||this.state.supplier_products_id,is_accounting:l,time_incurred:d,payment_debts_to_suppliers:u,images:p}),this.setState({visibleModalChange:!1,value:1,isLoading:!1,supplier_products_id:null})}},{key:"getData",value:function(){var t=this,e=this.props,n=e.transactions,a=e.timezone,o=e.t,r=U()(n);return r?r.data.map((function(e){var n,r=["shop_transactions_order","purchases","debts"].includes(e.table_name);return{key:e.display_id,ID:Cn(We.default,{recordSrc:(0,bt.pyT)(e.display_id,0)},Cn(C.default,{title:o("containers.formBox.coppyId")},Cn("a",{style:{color:"#096dd9"}},(0,bt.pyT)(e.display_id,0)))),TRADING_NAME:Cn(C.default,{title:"".concat((e.name||"").replace("#ref_display_id","#".concat(e.ref_display_id)))},Cn("span",null,(e.name||"").replace("#ref_display_id","#".concat(e.ref_display_id)))),TRANSACTION_CREATOR:e.creator?{name:e.creator.name,fb_id:e.creator.fb_id,avatar_url:e.creator.avatar_url,id:e.creator.id}:null,AO_MONEY:e.amount,INSERTED_AT:(0,bt.o0x)(a||7,e.inserted_at),EFFECTIVE_AT:(0,bt.o0x)(a||7,e.posted_at),TIME_INCURRED:(0,bt.o0x)(a||7,e.time_incurred||e.inserted_at),NOTE:e.note,TAGS:t.renderColumnTag(e.id),PAYMENTS:t.renderPaymentcolumn(e.payments),COST_DATE:(null===(n=e.advertising_cost)||void 0===n?void 0:n.cost_date)&&(0,bt.o0x)(a,e.advertising_cost.cost_date,!1,"DD/MM/YYYY"),POST_IDS:t.renderAdvertisingCostInfo(e.advertising_cost,"post_ids"),PAGE:t.renderAdvertisingCostInfo(e.advertising_cost,"source"),WAREHOUSE:t.renderAdvertisingCostInfo(e.advertising_cost,"warehouse_id"),TYPE_CUSTOMER:t.renderAdvertisingCostInfo(e.advertising_cost,"type_customer"),PRODUCT:t.renderAdvertisingCostInfo(e.advertising_cost,"product"),IS_LIVESTREAM:t.renderAdvertisingCostInfo(e.advertising_cost,"is_livestream"),MARKETER:t.renderAdvertisingCostInfo(e.advertising_cost,"user_id"),IS_ACCOUNTING:r||e.is_accounting?o("pages.shop.transaction.accounted"):Cn("span",{className:"fw600",style:{color:"rgb(255, 56, 96)"}},o("pages.shop.transaction.notAccounted")),LINK_UTM:t.renderAdvertisingCostInfo(e.advertising_cost,"link_utm"),UTM_SOURCE:t.renderAdvertisingCostInfo(e.advertising_cost,"utm_source"),UTM_MEDIUM:t.renderAdvertisingCostInfo(e.advertising_cost,"utm_medium"),UTM_CAMPAIGN:t.renderAdvertisingCostInfo(e.advertising_cost,"utm_campaign"),UTM_TERM:t.renderAdvertisingCostInfo(e.advertising_cost,"utm_term"),UTM_CONTENT:t.renderAdvertisingCostInfo(e.advertising_cost,"utm_content"),action:e}})):[]}},{key:"render",value:function(){var t,e,n=this,a=this.state,l=a.visibleModalView,d=a.visibleModalCreate,u=a.visibleModalChange,g=a.modalViewValue,m=a.modalChangeValue,y=a.value,b=a.inputAmount,_=a.inputName,C=a.isLoading,x=a.params,k=a.selectedRowKeys,S=a.tag_ids,T=a.payments,Z=a.supplier_products_id,w=a.isAccounting,I=a.timeIncurred,N=a.pageSize,A=a.loadAdvCost,O=a.advCost,M=a.isLoadingAdv,E=a.filterTags,D=a.isUpdateTags,F=a.checkedListTransaction,L=a.paymentDebtsToSuppliers,U=a.columnsWidth,j=a.loadingData,B=a.visibleOrderModal,V=a.order,z=a.formBoxVisible,Y=a.isCreateAdvCost,H=this.props,K=H.accessToken,W=H.shopId,q=H.t,G=H.currentShop,$=(H.supplier_products,H.totalAmount),X=H.timezone,J=H.transactions.total_entries,rt={selectedRowKeys:k,onChange:function(t){return n.onSelectChange(t)},preserveSelectedRowKeys:!0,isSelection:!0,onSelectRow:this.onSelectRow},st=!(!u||null===m||void 0===m||!m.advertising_cost_id),it=!(!l||null===g||void 0===g||!g.advertising_cost_id),gt=["shop_transactions_order","purchases","debts"].includes(null===m||void 0===m?void 0:m.tableName),mt=0;O&&(Y||st||it)&&null!==(t=O.items)&&void 0!==t&&t.length&&O.items.map((function(t){mt+=t.cost}));var ht=this.columns(),ft=ht.map((function(t){return U&&U[t.dataIndex]?t.width=U[t.dataIndex]:t.width=160,t}));ft=F.map((function(t){return ht.find((function(e){return e.dataIndex==t}))}));var vt=[{title:this.props.t("pages.shop.transaction.timeIncurred"),dataIndex:On,align:"right",ellipsis:!0,width:160}],yt=[{title:this.props.t("status"),dataIndex:"status",align:"center",width:"160px",fixed:"right",render:function(t,e){return Cn("span",{onClick:function(t){return t.stopPropagation()}},Cn(qt,{accessToken:n.props.accessToken,shopId:n.props.shopId,transaction:e.action,t:n.props.t,callback:n.fetchTransactions}))}}];ft=(ft=[].concat((0,v.Z)(ft),vt,yt)).filter((function(t){return t}));var _t=(0,bt.f2Q)(ft,this.getInc());ft.map((function(t){return t.dataIndex==On&&t.width&&delete t.width,t})),ft=ft.map((function(t){return kn(kn({},t),{},{onHeaderCell:function(t){return{id:t.dataIndex,width:t.width,tableClassName:Mn,onResize:n.onResize,isInc:t.dataIndex==On}}})}));var Ct={header:{cell:Ke.Z}};return Cn(lt.Z,{className:"container-layout",style:{overflow:"visible"}},Cn("div",{className:"tools-container"},Cn(dt.Z,{onClick:this.showModalCreate.bind(this),title:q("pages.shop.transaction.creatNewOrder"),icon:Cn(et.Z,null),color:"#096DD9"}),Cn(ut.Z,{disabled:C,onClick:function(){return n.fetchTransactions()},title:q("pages.shop.orderControlInfo.sync"),icon:Cn(at.Z,null),isButton:!0}),Cn(Ye.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(t){return t.key})),keyView:"transaction",subWidth:k.length>0?120:0}),Cn(cn.Z,{selectedLength:k.length,loadingData:j,total:J,onClick:function(){return n.setState({loadingData:!1,selectedRowKeys:[],selectedTransactions:[]})}}),Cn("div",{className:"filter"},Cn(R.default,{placeholder:"".concat(q("components.orderPartnerImportExcel.orderId")," / ").concat(q("note")," / ").concat(q("pages.shop.transaction.tradingName")),onChange:this.onChangeSearchText,prefix:Cn(Q.Z,null),value:x.search}),Cn(Xt.Z,{allowClear:!0,returnValue:!0,range:this.state.timeRange||[x.startDateTime&&ct().unix(x.startDateTime),x.endDateTime&&ct().unix(x.endDateTime)],callback:this.onChangeFilterDate,options:[{label:q("pages.shop.transaction.timeIncurred"),value:"time_incurred"},{label:q("pages.shop.product.purchase.time"),value:"inserted_at"},{label:q("pages.shop.transaction.timeAdvertisingCost"),value:"cost_date"}]}),Cn("div",null,E.length>0&&Cn(h.default,{danger:!0,onClick:function(){return n.onClearFilterClick()}},q("pages.shop.statistic.customer.deleteFilter")),Cn(Se.Z,{options:this.showMenuFilter(),popupClassName:"cascader-filter-customer",onChange:this.onClickMenuItem,changeOnSelect:!0}))),E&&E.length>0&&Cn("div",{className:"tags-filter"},E.map(this.renderFilterTag))),this.renderStatus(),Cn("div",{style:{position:"absolute",zIndex:100,left:10,bottom:10,display:"flex"}},Cn("div",{style:{display:"flex",alignItems:"center"}},Cn("div",{style:{marginRight:5}},q("pages.shop.transaction.totalCollection"),":"),C?Cn(c.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Cn("b",{style:{color:"#096dd9",cursor:"pointer"}},(0,bt.ufS)($.total_collection,G.currency))),"\xa0\xa0",Cn("div",{style:{display:"flex",alignItems:"center"}},Cn("div",{style:{marginRight:5}},q("pages.shop.transaction.totalSpending"),":"),C?Cn(c.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Cn("b",{style:{color:"#FF3860",cursor:"pointer"}},(0,bt.ufS)(-$.total_spending,G.currency)))),Cn("div",{className:"transaction-table"},Cn(sn.Z,{components:Ct,className:"".concat(Mn," transaction-container ").concat(C?"blur-when-loading":""),pagination:{size:"small",pageSize:N,total:J,current:x.page,pageSizeOptions:Nn,showSizeChanger:!0},size:"small",onChange:this.handleTableChange.bind(this),onRow:function(t){return{onClick:function(e){return n.handleRowClick.bind(n)(t)}}},columns:ft,dataSource:this.getData.call(this),scroll:{x:_t,y:E&&E.length>0?"calc(100vh - 253px)":"calc(100vh - 211px)"},rowSelection:rt}),l&&Cn(p.Z,{className:"crm-modal del-cancel",title:q("pages.shop.transaction.bill")+" "+(g.aoMoney<0?q("pages.shop.transaction.pay"):q("pages.shop.transaction.collect"))+"#".concat(g.display_id),visible:l,onCancel:function(){return n.setState({visibleModalView:!1,loadAdvCost:!1,advCost:null})},footer:null,width:it&&!g.transaction_ref_id?"90%":620},Cn("div",{className:A&&it&&!g.transaction_ref_id?"blur-when-loading":""},Cn(s.default,{gutter:it&&!g.transaction_ref_id?22:0},Cn(i.default,{className:"gutter-row",span:it&&!g.transaction_ref_id?7:24,style:it&&!g.transaction_ref_id?{borderRight:"1px solid #d9d9d9",minHeight:"282px"}:{}},Cn("div",{className:"modal-content"},Cn("div",{className:"modal-top"},Cn("label",null,q("pages.shop.transaction.tradingName"),": "),Cn("span",{style:{color:g.aoMoney>0?"#096dd9":"#ff3860"}},g.tradingName)),Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.balanceChange"),": "),!it||g.transaction_ref_id||A&&it?Cn("span",{style:{color:g.aoMoney>0?"#096dd9":"#ff3860"}},(g.aoMoney,(0,bt.ufS)(g.aoMoney,this.props.currentShop.currency))):Cn("span",{style:{color:"#ff3860"}},(0,bt.ufS)(-mt,this.props.currentShop.currency))),g.aoMoney<0&&Cn("div",{className:"payment-type"},Cn("div",{className:"payment-type-item",style:it?{cursor:"pointer"}:{backgroundColor:"#27AE60",color:"#FFFFFF",cursor:"pointer"}},q("pages.shop.statistic.transaction.defaultPayment")),Cn("div",{className:"payment-type-item",style:it?{backgroundColor:"#27AE60",color:"#FFFFFF"}:{cursor:"pointer"}},q("pages.shop.statistic.transaction.advertisingPayment"))),g.tag_ids&&g.tag_ids.length>0&&Cn("div",{style:{display:"flex"}},Cn("label",null,q("components.orderAdvanceFilter.tag"),": "),this.renderTag(g.tag_ids)),Cn("div",{className:"modal-middle",style:{display:"flex"}},Cn("label",null,q("pages.shop.transaction.transationCreator"),": "),Cn("div",{style:{marginLeft:5}},this.renderCreator(g.creator))),g.order&&Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.relateOrder"),":"),Cn("span",null,"#",g.order.custom_id||(0,bt.pyT)(g.order.display_id))),Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.payment"),": "),Cn("span",null,this.renderPaymentcolumn(g.payments))),Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.insertedAt"),": "),Cn("span",null,(0,bt.o0x)(this.props.timezone||7,g.inserted_at))),Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.effectiveAt"),": "),Cn("span",null,(0,bt.o0x)(this.props.timezone||7,g.posted_at))),Cn("div",{className:"modal-middle"},Cn("label",null,q("pages.shop.transaction.timeIncurred"),": "),Cn("span",null,(0,bt.o0x)(this.props.timezone||7,g.time_incurred))),Cn("div",{className:"row-checkbox"},Cn("label",{style:{marginRight:20}},q("crm.add"),":"),it&&Cn("div",null,Cn(f.default,{checked:!0,disabled:!0},q("pages.shop.transaction.isAccounting"))),(0,te.zE)(this.props.currentShop.role).ql_dongtien&&Cn("div",{className:"radio-changes"},Cn(f.default,{onChange:function(t){return n.changeAdvCostLocked(t.target.checked)},checked:g.isLocked},q("lock")))),g.note&&Cn("div",{className:"modal-bottom"},Cn("label",null,q("pages.shop.transaction.reasonAndNote"),": "),Cn("i",null,g.note)))),it&&!g.transaction_ref_id&&Cn(i.default,{className:"gutter-row",span:17},Cn(ke,{params:O,accessToken:K,shopId:W,timezone:X,type:"show"}))),it&&A&&Cn("div",{className:"spin"},Cn(r.default,null)))),d&&Cn(p.Z,{className:"crm-modal transaction-modal",title:q("pages.shop.transaction.create"),visible:d,onCancel:function(){return n.onCancel()},width:Y?"calc(100% - 100px)":520,footer:this.renderFooter()},Cn(s.default,{gutter:Y?22:0},Cn(i.default,{className:"gutter-row",span:Y?7:24,style:Y?{borderRight:"1px solid #d9d9d9",minHeight:"282px"}:{}},Cn("div",{className:"radio-content"},Cn("div",{className:"radio-content-top"},Cn("label",null,q("pages.shop.transaction.tradingName"),":"),Cn("div",{className:"name-transaction"},Cn(R.default,{value:_,onChange:this.handleInputTextCreate.bind(this),placeholder:q("components.productComboDetail.enterName")}))),!Y&&Cn("div",{className:"radio-content-checked"},Cn("label",{style:{marginRight:10}},q("pages.shop.transaction.typeOfBill"),":"),Cn("div",{className:"radio-changes"},Cn(Tn,{onChange:this.onCreateRadio,value:y},Cn(P.default,{value:1},q("pages.shop.statistic.transaction.receipts")),Cn(P.default,{value:2},q("pages.shop.statistic.transaction.payment"))))),2==y&&Cn("div",{className:"payment-type"},Cn("div",{className:"payment-type-item",style:Y?{cursor:"pointer"}:{backgroundColor:"#27AE60",color:"#FFFFFF",cursor:"pointer"},onClick:function(){S.includes("advCost")?n.setState({isCreateAdvCost:!Y,tag_ids:S.filter((function(t){return"advCost"!=t}))}):n.setState({isCreateAdvCost:!Y})}},q("pages.shop.statistic.transaction.defaultPayment")),Cn("div",{className:"payment-type-item",style:Y?{backgroundColor:"#27AE60",color:"#FFFFFF"}:{cursor:"pointer"},onClick:function(){return n.handleChangeAdvCost(S,Y)}},q("pages.shop.statistic.transaction.advertisingPayment"))),this.renderTransactionTag("create",S,!1),!Y&&this.renderSelectSupplier(Z||void 0,"create"),Cn("div",{style:{display:"flex",justifyContent:"space-between",padding:"8px 0px"}},Cn("label",null,q("pages.shop.transaction.relateOrder"),":"),Cn("span",{style:{cursor:"pointer",fontWeight:500,color:"#096dd9"},onClick:function(){return n.handleOpenModalOrder()}},V&&V.display_id?"#".concat(V.display_id):q("pages.shop.transaction.addOrder"))),Cn("div",{className:"radio-content-middle"},Cn("label",null,q("pages.shop.transaction.balanceChange"),":"),Cn("div",{className:"amount-changes"},Y?Cn(R.default,{prefix:Cn("span",{style:{color:"#ff3860"}},Cn(ot.Z,null)),suffix:this.currencySymbol,value:(0,bt.ufS)(mt,this.props.currentShop.currency,!1),disabled:!0}):Cn(ue.default,{prefix:Cn("span",{style:{color:1==y?"#096dd9":"#ff3860"}},Cn(1==y?et.Z:ot.Z,null)),value:b,currency:G.currency,isMoney:!0,callBack:function(t){return n.handleInputNumberCreate(t)},suffix:this.currencySymbol}))),2==y&&!Y&&Z&&(null===(e=G.settings)||void 0===e?void 0:e.supplier)&&Cn("div",{className:"radio-content-middle"},Cn(f.default,{checked:L,onChange:function(t){return n.setState({paymentDebtsToSuppliers:t.target.checked})}},q("pages.shop.transaction.paymentDebtsToSuppliers"))),this.renderPayment("create",T),Cn("div",{className:"radio-content-middle"},Cn("label",null,q("pages.shop.transaction.timeIncurred"),":"),Cn("div",{className:"amount-changes"},Cn(o.default,{style:{width:"100%"},showTime:!0,format:"HH:mm DD/MM/YYYY",allowClear:!1,value:I,onChange:function(t){return n.setState({timeIncurred:t})}}))),Cn("div",{className:"row-checkbox"},Cn("label",{style:{marginRight:20}},q("crm.add"),":"),Cn("div",{className:"radio-changes"},Cn(f.default,Y?{checked:!0,disabled:!0}:{checked:w,onChange:function(t){return n.setState({isAccounting:t.target.checked})}},q("pages.shop.transaction.isAccounting"))),(0,te.zE)(this.props.currentShop.role).ql_dongtien&&Cn("div",{className:"radio-changes"},Cn(f.default,{onChange:function(t){return n.setState({isLocked:t.target.checked})}},q("lock")))),Cn("div",{className:"radio-content-middle",style:{marginBottom:0}},Cn("label",null,q("note"),":"),Cn(In,{rows:3,onChange:this.handleAreaCreate.bind(this),placeholder:q("pages.shop.transaction.reasonAndNote")}),Cn("div",{style:{marginTop:10,fontWeight:500}},q("pages.shop.product.variation.image"),":"),this.renderUploadImages("create")))),Y&&Cn(i.default,{className:"gutter-row",span:17},Cn(ke,{params:O,accessToken:K,shopId:W,timezone:X,sync:function(t){return n.setState({advCost:t})},type:"create"})))),u&&Cn(p.Z,{className:"crm-modal transaction-modal",title:m.disabledAllView?q("pages.shop.transaction.lockedBill"):q("pages.shop.transaction.changedInfoBill"),visible:u,onCancel:function(){return n.setState({visibleModalChange:!1,advCost:null})},width:st?"calc(100% - 100px)":520,footer:st?Cn(h.default,{type:"primary",icon:Cn(M?tt.Z:nt.Z,null),disabled:M||!O||A,onClick:this.handleSaveAdvCost},m.id?q("save"):q("pages.shop.advertising.create")):!m.disabledAllView&&Cn(h.default,{type:"primary",onClick:this.handleSaveTransaction.bind(this)},q("save"))},Cn(s.default,{gutter:st?22:0},Cn(i.default,{className:"gutter-row",span:st?7:24,style:st?{borderRight:"1px solid #d9d9d9",minHeight:"282px"}:{}},Cn("div",{className:"radio-content"},Cn("div",{className:"radio-content-top"},Cn("label",null,q("pages.shop.transaction.tradingName"),":"),Cn("div",{className:"name-transaction"},Cn(R.default,{value:m.tradingName,onChange:this.handleInputTextChange.bind(this)}))),Cn("div",{className:"radio-content-checked"},Cn("label",{style:{marginRight:10}},q("pages.shop.transaction.typeOfBill"),":"),Cn("div",{className:m.aoMoney>=0?"radio-changes_receipts":"radio-changes_payment"},Cn(Tn,{onChange:this.onChangeRadio,value:m.aoMoney>=0?1:2},Cn(P.default,{disabled:!0,value:1},q("pages.shop.statistic.transaction.receipts")),Cn(P.default,{disabled:!0,value:2},q("pages.shop.statistic.transaction.payment"))))),m.aoMoney<0&&Cn("div",{className:"payment-type"},Cn("div",{className:"payment-type-item",style:O?{}:{backgroundColor:"#27AE60",color:"#FFFFFF"}},q("pages.shop.statistic.transaction.defaultPayment")),Cn("div",{className:"payment-type-item",style:O?{backgroundColor:"#27AE60",color:"#FFFFFF"}:{}},q("pages.shop.statistic.transaction.advertisingPayment"))),this.renderTransactionTag("update",m.tag_ids,m.isLocked,m.advertising_cost_id),st&&Cn("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,lineHeight:2}},Cn("label",null,q("pages.shop.statistic.transaction.totalAdvertisingCosts")),Cn("label",null,(0,bt.ufS)(mt,G.currency))),!st&&this.renderSelectSupplier(m.supplier_products_id,"update"),m.order&&Cn("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:16,lineHeight:2}},Cn("label",null,q("pages.shop.transaction.relateOrder"),":"),Cn("span",{style:{color:"#096DD9",fontWeight:500,cursor:"pointer"},onClick:function(){var t;return n.handleShowOrder(null===(t=m.order)||void 0===t?void 0:t.id)}},"#",m.order.custom_id||(0,bt.pyT)(m.order.display_id))),!st&&Cn("div",{className:"radio-content-middle"},Cn("label",{style:{lineHeight:2}},q("pages.shop.transaction.balanceChange"),":"),Cn("div",{className:"amount-changes"},Cn(ue.default,{prefix:Cn("span",{style:{color:m.aoMoney>=0?"#096dd9":"#ff3860"}},m.aoMoney>=0?Cn(et.Z,null):Cn(ot.Z,null)),value:m.aoMoney<0&&Number.isInteger(m.aoMoney)?-1*m.aoMoney:m.aoMoney,currency:G.currency,isMoney:!0,callBack:function(t){return n.handleInputNumberChange(t)},suffix:this.currencySymbol}))),m.aoMoney<0&&!st&&m.supplier_products_id&&Cn("div",{className:"radio-content-middle"},Cn(f.default,{checked:m.paymentDebtsToSuppliers,onChange:function(t){return n.onChangeValue("paymentDebtsToSuppliers",t.target.checked)},disabled:m.status},q("pages.shop.transaction.paymentDebtsToSuppliers"))),this.renderPayment("update",m.payments),Cn("div",{className:"radio-content-middle"},Cn("label",null,q("pages.shop.transaction.timeIncurred"),":"),Cn("div",{className:"amount-changes"},Cn(o.default,{style:{width:"100%"},showTime:!0,format:"HH:mm DD/MM/YYYY",allowClear:!1,value:ct().utc(m.timeIncurred).utcOffset(parseFloat(X)),onChange:function(t){return n.onChangeValue("timeIncurred",t)}}))),Cn("div",{className:"row-checkbox"},Cn("label",{style:{marginRight:20}},q("crm.add"),":"),Cn("div",null,Cn(f.default,st?{checked:!0,disabled:!0}:{disabled:gt,onChange:function(t){return n.onChangeValue("isAccounting",t.target.checked)},checked:gt||m.isAccounting},q("pages.shop.transaction.isAccounting"))),(0,te.zE)(this.props.currentShop.role).ql_dongtien&&Cn("div",{className:"radio-changes"},Cn(f.default,{onChange:function(t){return n.setState({modalChangeValue:kn(kn({},m),{},{isLocked:t.target.checked})})},checked:m.isLocked},q("lock")))),Cn("div",{className:"radio-content-middle",style:{marginBottom:0}},Cn("label",null,q("note"),":"),Cn(In,{rows:3,onChange:this.handleAreaChange.bind(this),value:m.note,placeholder:q("pages.shop.transaction.reasonAndNote")}),Cn("div",{style:{marginTop:16,fontWeight:500}},q("pages.shop.product.variation.image"),":"),this.renderUploadImages("update")))),st&&m.advertising_cost_id&&Cn(i.default,{className:"gutter-row",span:17},Cn("div",{className:A?"blur-when-loading":""},Cn(ke,{params:O,accessToken:K,shopId:W,timezone:X,sync:function(t){return n.setState({advCost:t})},type:"update"})),A&&m.advertising_cost_id&&Cn("div",{className:"spin"},Cn(r.default,null)))))),B&&Cn(bn.Z,{visible:B,accessToken:K,shopId:G.id,close:function(){return n.setState({visibleOrderModal:!1})},onSelectOrder:this.handleSelectOrder,title:"Ch\u1ecdn \u0111\u01a1n h\xe0ng"}),z&&Cn(_n.Z,{accessToken:K,shopId:W,typeShop:G.type,visible:z,onOK:function(){return n.setState({formBoxVisible:!1})},onCancel:function(){return n.setState({formBoxVisible:!1})}}),C&&Cn(pt.Z,null),this.transactionTableHeighStyle(E&&E.length>0),D&&this.renderUpdateTags())}}]),n}(z.Component);(0,M.Z)(Fn,"pageInfo",{title:"transactions.title",sassStyle:ne()});var Ln=(0,vt.$j)((function(t){return{currentShop:t.shop.currentShop,transactions:(0,Ct.ig)(t),timezone:t.navigation.user.timezone,users:(0,Ct.YN)(t),counters:t.transaction.counters,totalAmount:t.transaction.total_amount,creator:t.navigation.user.uid,supplier_products:(0,Ct.AA)(t),employeeList:t.user.filterEmployeeList,order_sources_custom:(0,Ct.ME)(t),warehouses:(0,Ct.op)(t)}}),{openForm:yt.BQi,fetchListOfTransactions:yt.iYf,createTransactions:yt.yt$,updateTransactions:yt.Cib,countersTransactions:yt.lP6,totalAmountTransaction:yt.WZk,showAdvertisingCost:yt.gqy,createAdvertisingCost:yt.id8,updateAdvertisingCost:yt.jZ8,pushUsersTextSearch:yt.mw6,updateTransactionsSuccess:yt.EiF,loadAdvertisingCosts:yt.ha2,fetchTransactionSuccess:yt.cgY})((0,Qt.Z)(Fn))},75569:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shop/transaction",function(){return n(36966)}])}},function(t){t.O(0,[5460,1181,3732,2902,4517,2653,2837,9774,2888,179],(function(){return e=75569,t(t.s=e);var e}));var e=t.O();_N_E=e}]);