(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4010],{80470:function(t){!function(){"use strict";t.exports=".updating-progress .ant-progress-bg{border-radius:2px}.modal-updating .ant-modal-body{display:flex;flex-direction:column;align-items:center}.modal-updating .ant-modal-body .updating-info{width:100%;height:300px;display:flex;flex-direction:column;border:1px solid #d9d9d9;border-radius:2px;margin:10px 0;padding:10px;font-size:14px;overflow:auto}.modal-updating .ant-modal-body .updating-info .success{color:#00a854}.modal-updating .ant-modal-body .updating-info .fail{color:#f04134}.product-stocktaking{overflow:visible !important}.ant-select-disabled .ant-select-selection{cursor:default;color:rgba(0,0,0,.65)}.ant-select-disabled .ant-select-arrow{display:none}.printer{font-size:14px;font-family:Arial,Helvetica,sans-serif;color:#000;background-color:#fff}.printer table{width:100%;margin-top:10px}.printer tr,.printer td{page-break-inside:avoid}.printer table,.printer th,.printer td{border:1px solid #000;border-collapse:collapse}.printer th,.printer td{padding:6px}.printer .display-number{text-align:right}.printer .title{font-size:18px;display:flex;justify-content:center}.printer .info{margin-top:16px}.printer .info>div{padding-bottom:3px}.printer .info>div>div{padding-bottom:3px}"}()},78598:function(t,e,n){var a,o=o||function(t){"use strict";if(!("undefined"===typeof t||"undefined"!==typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,n=function(){return t.URL||t.webkitURL||t},a=e.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in a,i=/constructor/i.test(t.HTMLElement)||t.safari,r=/CriOS\/[\d]+/.test(navigator.userAgent),s=function(e){(t.setImmediate||t.setTimeout)((function(){throw e}),0)},c=function(t){setTimeout((function(){"string"===typeof t?n().revokeObjectURL(t):t.remove()}),4e4)},l=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},u=function(e,u,d){d||(e=l(e));var p,h=this,g="application/octet-stream"===e.type,f=function(){!function(t,e,n){for(var a=(e=[].concat(e)).length;a--;){var o=t["on"+e[a]];if("function"===typeof o)try{o.call(t,n||t)}catch(i){s(i)}}}(h,"writestart progress write writeend".split(" "))};if(h.readyState=h.INIT,o)return p=n().createObjectURL(e),void setTimeout((function(){a.href=p,a.download=u,function(t){var e=new MouseEvent("click");t.dispatchEvent(e)}(a),f(),c(p),h.readyState=h.DONE}));!function(){if((r||g&&i)&&t.FileReader){var a=new FileReader;return a.onloadend=function(){var e=r?a.result:a.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,h.readyState=h.DONE,f()},a.readAsDataURL(e),void(h.readyState=h.INIT)}(p||(p=n().createObjectURL(e)),g)?t.location.href=p:t.open(p,"_blank")||(t.location.href=p);h.readyState=h.DONE,f(),c(p)}()},d=u.prototype;return"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,n){return e=e||t.name||"download",n||(t=l(t)),navigator.msSaveOrOpenBlob(t,e)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(t,e,n){return new u(t,e||t.name||"download",n)})}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content);t.exports?t.exports.saveAs=o:null!==n.amdD&&null!==n.amdO&&(void 0===(a=function(){return o}.call(e,n,e,t))||(t.exports=a))},74018:function(t,e,n){"use strict";var a,o=n(51024),i=n(74047),r=n(52700),s=n(4706),c=n(33814),l=n(44102),u=n(20775),d=n(26265),p=n(18446),h=n.n(p),g=n(23279),f=n.n(g),m=n(67294),k=n(14494),v=n(87217),y=n(76570),_=n(7145),S=n.n(_),b=m.createElement;function w(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function I(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?w(Object(n),!0).forEach((function(e){(0,d.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function x(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,u.Z)(t);if(e){var o=(0,u.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,l.Z)(this,n)}}var Z=(0,v.Z)()(a=function(t){(0,c.Z)(n,t);var e=x(n);function n(t){var a;return(0,i.Z)(this,n),a=e.call(this,t),(0,d.Z)((0,s.Z)(a),"delaySearch",f()((function(){return a.props.fetch(a.state.params)}),800)),(0,d.Z)((0,s.Z)(a),"onChangeSearchText",(function(t){t.persist();var e=t.target.value;e?a.setState({params:I(I({},a.props.params),{},{search:e})}):a.setState({params:S()(a.props.params,{$unset:["search"]})}),a.delaySearch()})),a.state={params:I({},t.params)},a}return(0,r.Z)(n,[{key:"componentDidUpdate",value:function(t){h()(t.params,this.props.params)||this.setState({params:this.props.params})}},{key:"render",value:function(){var t=this.props,e=t.t,n=t.placeholder,a=this.state.params;return b(o.default,{placeholder:n||"".concat(e("pages.shop.product.purchase.displayId")," / ").concat(e("pages.shop.product.purchase.note")),onChange:this.onChangeSearchText,prefix:b(y.Z,null),value:a.search,className:"export-search-bar",style:{width:"44vw",left:450}})}}]),n}(m.Component))||a;e.Z=(0,k.$j)((function(t){return{currentShop:t.shop.currentShop}}),null)(Z)},74229:function(t,e,n){"use strict";var a=n(89552),o=n(67294),i=n(7085),r=o.createElement;e.Z=function(){return r("div",{className:"spinner"},r(a.default,{indicator:r(i.Z,{style:{fontSize:40}})}))}},65166:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return ie}});var a,o=n(65400),i=n(28140),r=n(51024),s=n(94055),c=n(59361),l=n(809),u=n.n(l),d=n(92447),p=n(74047),h=n(4706),g=n(52700),f=n(33814),m=n(44102),k=n(20775),v=n(26265),y=n(64713),_=n(14321),S=n(56697),b=n(18446),w=n.n(b),I=n(65988),x=n(67294),Z=n(9669),O=n.n(Z),E=n(7085),T=n(90631),D=n(84189),C=n(7945),A=n(49101),R=n(25592),N=n(14494),P=n(83049),q=n(31731),U=n(74229),M=n(50916),B=n(3845),j=n(74806),H=n(31059),F=n(4863),L=n(28465),z=n(64749),W=n(44908),Q=n.n(W),V=n(85564),K=n.n(V),Y=n(52628),X=n.n(Y),J=n(68630),$=n.n(J),G=n(7739),tt=n.n(G),et=n(50361),nt=n.n(et),at=n(45578),ot=n.n(at),it=n(87217),rt=n(48176),st=n(79508),ct=n(22318),lt=n(95213),ut=n(31432),dt=n(78598),pt=x.createElement;function ht(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function gt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ht(Object(n),!0).forEach((function(e){(0,v.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ht(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function ft(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,k.Z)(t);if(e){var o=(0,k.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,m.Z)(this,n)}}var mt,kt=z.default.Option,vt=(0,it.Z)()(a=function(t){(0,f.Z)(n,t);var e=ft(n);function n(t){var a,o;(0,p.Z)(this,n),o=e.call(this,t),(0,v.Z)((0,h.Z)(o),"componentDidMount",(function(){o.setState({isAutoAddProductNotStocktaking:!!localStorage.getItem("add_product_not_stocktaking")&&JSON.parse(localStorage.getItem("add_product_not_stocktaking"))})})),(0,v.Z)((0,h.Z)(o),"onDrop",(function(t){var e=t.file,n=o.props.t,a=new FileReader;a.readAsBinaryString(e),a.onload=function(t){var a,i,r=t.target.result,s=XLSX.read(r,{type:"binary"}),c=(null===(a=s.Workbook.Sheets)||void 0===a?void 0:a.filter((function(t){return 0==t.Hidden})))||[];c.length>0&&(i=c[0].name);var l=i&&s.SheetNames.find((function(t){return t==i}))||s.SheetNames[0],u=XLSX.utils.sheet_to_json(s.Sheets[l],{raw:!0});if(u.length>0){var d=[];u.map((function(t,e){var n=Object.keys(t),a=Object.values(t);n.map((function(t,n){var o=a[n].toString().trim();""!=o&&(d[e]||(d[e]={}),d[e]=gt(gt({},d[e]),{},(0,v.Z)({},t.trim(),o)))}))}));var p=n("importTranslate.MA_KHO"),h=n("importTranslate.TEN_KHO"),g=n("components.productPurchaseImportExcel.warehouseId"),f=n("importTranslate.MA_SP"),m=n("importTranslate.MA_MAU_MA"),k=Q()(d.filter((function(t){return!t[p]&&t[h]})).map((function(t){var e,n=null===(e=o.props.warehouses.find((function(e){return(0,lt.Mle)(e.name)==(0,lt.Mle)(t[h])})))||void 0===e?void 0:e.id;if(!n)return t[h];t[p]=n})).filter((function(t){return t}))).join(", ");if(k)return ct.Z.error(n("error"),"Kh\xf4ng t\xecm th\u1ea5y kho ".concat(k)),void o.setState({selectedFile:null,isUpdating:!1});var y=[],_=0;d.map((function(t,e){if(t[n("pages.shop.product.variation.index")]=e+1,t.line_number=e+2,t[g])_=e,y.push(t);else{var a=nt()(t);a[g]=d[_][g],y.push(a)}})),y=y.reverse();var b=o.checkDupplicateProduct(y);b&&b.length>0?(b=ot()(b.map((function(t){return"".concat(t[f]," / ").concat(t[m])}))),S.Z.confirm({title:n("components.stocktakingImportExcel.warningDupplicateProduct"),content:pt("div",{style:{maxHeight:300,overflow:"auto"}},b.map((function(t,e){return pt("div",{style:{color:"#f04134"}},pt("b",null,"#",e),"\xa0",t)}))),okText:n("components.stocktakingImportExcel.continueCreateStocktaking"),cancelText:n("components.stocktakingImportExcel.delete"),onOk:function(){return o.setState({stocktakingFile:y,selectedFile:e,fileName:e.name,isUpdating:!1})},onCancel:function(){return o.setState({stocktakingFile:[],selectedFile:null,fileName:null,isUpdating:!1})}})):o.setState({stocktakingFile:y,selectedFile:e,fileName:e.name,isUpdating:!1})}else ct.Z.error(n("error"),n("components.stocktakingImportExcel.fileExcelEmpty")),o.setState({selectedFile:null,isUpdating:!1})}})),(0,v.Z)((0,h.Z)(o),"checkDupplicateProduct",(function(t){var e=o.props.t;if("stocktaking"==o.state.importType){var n=[],a=e("importTranslate.MA_SP"),i=e("importTranslate.MA_MAU_MA"),r=e("importTranslate.MA_KHO");return t.reverse().map((function(e,o){if(e[a]&&e[i]){var s=t.find((function(t,n){return n!=o&&t[a]&&t[i]&&t[r]&&t[a]==e[a]&&t[i]==e[i]&&t[r]==e[r]}));s&&n.push(s)}})),n}})),(0,v.Z)((0,h.Z)(o),"submitStocktaking",(function(t){o.setState({stocktaking:t}),o.props.submit&&o.props.submit(t)})),(0,v.Z)((0,h.Z)(o),"handleQuantityChange",(function(t,e){var n=o.state.stocktaking;if(n.items[t]){var a=n.items[t].quantity+e;n.items[t].changed_quantity=a-n.items[t].variation_warehouse.actual_remain_quantity,n.items[t].quantity=a,n.items[t].pending=n.items[t].variation_warehouse.pending_transfer_quantity,a<n.items[t].variation_warehouse.pending_transfer_quantity?n.items[t].warning=!0:n.items[t].warning=!1,o.submitStocktaking(n)}})),(0,v.Z)((0,h.Z)(o),"sendRequestImportCountVariations",(function(t,e){var n=o.state,a=n.stocktakingFile,i=n.isUpdatingQuantity,r=n.selectWarehouse,s=o.props,c=s.warehouses,l=s.currentShop,u=s.t;if(o.state.visible)if(a.length<=0)ct.Z.error(u("error"),u("components.stocktakingImportExcel.fileExcelEmpty"));else{var d=e;0==t&&(d={warehouse_id:r||(c.length&&c?c[0].id:void 0),items:[],note:"",shop_id:l.id,status:0}),i||o.setState({isUpdatingQuantity:!0,quantityState:a}),t+1<=a.length&&o.handleImportCountVariations(t,d)}})),(0,v.Z)((0,h.Z)(o),"compareWithVariation",(function(t,e){return 1434896==o.props.currentShop.id?(null===t||void 0===t?void 0:t.custom_id)==e.BARCODE:null})),(0,v.Z)((0,h.Z)(o),"handleImportCountVariations",(function(t,e){t>0&&o.scrollImportCountVariations();var n=o.state,a=n.stocktakingFile,i=n.stockBarcode,r=n.variationsStocktaking,s=n.failureProduct,c=n.isAutoAddProductNotStocktaking,l=o.props,u=l.currentShop,d=l.accessToken,p=l.t,h=a[t];if(void 0===h.BARCODE){var g=o.state.updatingInfo;return g.push({id:t,message:"".concat(p("components.stocktakingImportExcel.formatFileError")),success:!1}),o.setState({updatingInfo:g}),o.sendRequestImportCountVariations(t+1,e)}h.BARCODE=h.BARCODE.toString().trim(),h.BARCODE=h.BARCODE.includes("-")?h.BARCODE.toLowerCase().split(" ").join(""):h.BARCODE;var f=o.state.updatingInfo,m={access_token:d,include_combo_info:!0};/^(BP){0,1}[0-9]+(V|\-){1}[0-9]+$/.test(h.BARCODE)?m.barcode=h.BARCODE:m.search=h.BARCODE;var k="".concat((0,lt.LpH)(),"/shops/").concat(u.id,"/variations");O()({method:"get",url:k,params:m}).then((function(n){if(f.push({id:t,message:h.BARCODE,success:n.data.data.length>0}),n.data.data.length||s.push({barcode:h.BARCODE,quantity:h.QUANTITY?parseInt(h.QUANTITY):1}),o.setState({updatingInfo:f,failureProduct:s}),n.data.data.filter((function(t){return u.use_custom_id_for_barcode?t.custom_id==h.BARCODE:null!=t.barcode?t.barcode==h.BARCODE:"".concat(t.product.display_id,"-").concat(t.display_id)==h.BARCODE||o.compareWithVariation(t,h)})).map((function(t){var n=i.find((function(t){return t==h.BARCODE}));if(!n||o.compareWithVariation(t,h)){var a=n?h.BARCODE:"".concat(t.product.display_id,"-").concat(t.display_id);i.push(a);var s=(t.variations_warehouses||[]).find((function(t){return t.warehouse_id===e.warehouse_id}))||{actual_remain_quantity:0,remain_quantity:0,pending_transfer_quantity:0},c=h.QUANTITY?parseInt(h.QUANTITY)-s.actual_remain_quantity:1-s.actual_remain_quantity;e.items.push({variation_id:t.id,changed_quantity:c,current_quantity:s?s.actual_remain_quantity:0,quantity:h.QUANTITY?parseInt(h.QUANTITY):1,variation_warehouse:s,pending:s.pending_transfer_quantity,warning:(s?s.actual_remain_quantity:0)<s.pending_transfer_quantity,brand_id:t.product.brand_id,supplier_product_ids:t.product.supplier_product_ids,category_ids:t.product.category_ids,variation:t}),o.submitStocktaking(e),r.push(t),o.setState({variationsStocktaking:r,stockBarcode:i})}else{var l=o.state.stocktaking.items.findIndex((function(e){return e.variation_id==t.id})),u=h.QUANTITY?parseInt(h.QUANTITY):1;o.handleQuantityChange(l,u)}})),o.state.updatingInfo.length==o.state.quantityState.length){var a=f.filter((function(t){return 0==t.success})).length;c?o.handleAddVariationNotAvailable(a):a>0||1434896==u.id?o.setState({confirmModalDetail:!0}):o.verifyQuantityBeforeCreate()}return o.sendRequestImportCountVariations(t+1,e)})).catch((function(){return f.push({id:t,message:"Kh\xf4ng t\xecm th\u1ea5y ".concat(h.BARCODE),success:!1}),s.push({barcode:h.BARCODE,quantity:h.QUANTITY?parseInt(h.QUANTITY):1}),o.setState({updatingInfo:f,failureProduct:s}),o.sendRequestImportCountVariations(t+1,e)}))})),(0,v.Z)((0,h.Z)(o),"handleAddVariationNotAvailable",(function(t){var e=o.props,n=e.currentShop,a=e.accessToken,i=nt()(o.state.stocktaking);o.setState({isFilling:!0});var r={page:1,page_size:30,actualQuantity:{type:"greaterOrEqual",value:1,warehouseId:i.warehouse_id||"all"},shop_id:n.id,item_ignore:i.items.map((function(t){return t.variation_id}))},s="".concat((0,lt.LpH)(),"/shops/").concat(n.id,"/products/not_stocktaking?access_token=").concat(a),c=[];(function t(e){var n=nt()(e);return O().post(s,n).then((function(n){var a=n.data.data;return o.fillDataIntoItem(a),c=c.concat(a),o.setState({currentData:c.length,totalEntriesFill:n.data.total_entries}),0==a.length||c.length>=n.data.total_entries?c:(e.page=e.page+1,t(e))}))})(r).then((function(e){t>0?o.setState({confirmModalDetail:!0}):o.verifyQuantityBeforeCreate(),o.setState({isFilling:!1})}))})),(0,v.Z)((0,h.Z)(o),"fillDataIntoItem",(function(t){var e=nt()(o.state.stocktaking);(t||[]).map((function(t){var n=o.getVariationWarehouse(t.variations_warehouses,o.state.stocktaking.warehouse_id);-1==e.items.findIndex((function(e){return e.variation_id==t.id}))&&(e.items.push({variation_id:t.id,changed_quantity:-n.actual_remain_quantity,current_quantity:n.actual_remain_quantity,quantity:0,variation_warehouse:n,pending:n.pending_transfer_quantity,warning:n.actual_remain_quantity<n.pending_transfer_quantity,brand_id:t.product.brand_id,supplier_product_ids:t.product.supplier_product_ids,category_ids:t.product.category_ids,manipulation_warehouses:t.product.manipulation_warehouses,style:{color:"#096dd9"},variation:t}),o.submitStocktaking(e))}))})),(0,v.Z)((0,h.Z)(o),"getVariationWarehouse",(function(t,e){var n={actual_remain_quantity:0,remain_quantity:0,pending_transfer_quantity:0,shelf_quantity:0};return t?0==t.length?n:t.find((function(t){return t.warehouse_id==e}))||n:n})),(0,v.Z)((0,h.Z)(o),"verifyQuantityBeforeCreate",(function(){var t=o.state,e=t.stocktakingFile,n=t.stocktaking.items,a=o.props.currentShop,i={notExist:[],deviatedQuantity:[]},r=Object.keys(tt()(e,"BARCODE")),s=Object.values(tt()(e,"BARCODE"));r.map((function(t,e){var r,c=s[e].reduce((function(t,e){return t+parseInt(e.QUANTITY||1)}),0);console.log(c,"totalQuantity");var l=null===(r=n.find((function(e){var n,i,r,s,c;return a.use_custom_id_for_barcode?(null===(n=e.variation)||void 0===n?void 0:n.custom_id)==t:null!=(null===(i=e.variation)||void 0===i?void 0:i.barcode)?(null===(r=e.variation)||void 0===r?void 0:r.barcode)==t:"".concat(null===(s=e.variation)||void 0===s?void 0:s.product.display_id,"-").concat(null===(c=e.variation)||void 0===c?void 0:c.display_id)==t||o.compareWithVariation(e.variation,{BARCODE:t})})))||void 0===r?void 0:r.quantity;console.log(l,"quantityInStocktaking"),void 0==l?i.notExist.push({quantity:c,barcode:t}):c!=l&&i.deviatedQuantity.push({quantity:c,barcode:t})})),i.notExist.length>0||i.deviatedQuantity.length>0?o.setState({listItemFailure:i,visibleListItemFailure:!0}):o.setState({modalDetailVisible:!0})})),(0,v.Z)((0,h.Z)(o),"renderVerifyModal",(function(){var t=o.state.listItemFailure,e=o.props.t;return pt("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"}},t.notExist.length>0&&pt("div",{style:{width:"".concat(t.deviatedQuantity.length>0?"50%":"100%"),marginRight:10}},pt("div",null,e("components.stocktakingImportExcel.itemNotExist"),":"),pt("div",{className:"updating-info",style:{marginTop:10,maxHeight:300,overflow:"auto"}},t.notExist.map((function(t,e){return pt("strong",{className:"fail"},"#",e+1," ",t.barcode)})))),t.deviatedQuantity.length>0&&pt("div",{style:{width:"".concat(t.notExist.length>0?"50%":"100%")}},pt("div",null,e("components.stocktakingImportExcel.itemDeviatedQuantity"),":"),pt("div",{className:"updating-info",style:{marginTop:10,maxHeight:300,overflow:"auto"}},t.deviatedQuantity.map((function(t,e){return pt("strong",{className:"fail"},"#",e+1," ",t.barcode)})))))})),(0,v.Z)((0,h.Z)(o),"handleImport",(function(){var t=o.state,e=t.stocktakingFile,n=t.visible,a=t.isUpdating,i=t.importType,r=o.props,s=r.currentShop,c=(r.accessToken,r.t);if(e.length<=0)ct.Z.error(c("error"),c("components.stocktakingImportExcel.fileExcelEmpty"));else{var l=[],p=[],h=[],g=/^\d+$/;if(e.map(function(){var t=(0,d.Z)(u().mark((function t(e,n){var a,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a="batch_shelf"==i?e[c("importTranslate.SL_LO_SAU_DIEU_CHINH")]:e[c("importTranslate.SO_LUONG_SAU_DIEU_CHINH")],o="batch_shelf"==i?e[c("importTranslate.SL_KE_SAU_DIEU_CHINH")]:e[c("importTranslate.SO_LUONG_SAU_DIEU_CHINH")],a=(0,lt.WNN)(a),o=(0,lt.WNN)(o),null!=e[c("importTranslate.MA_SP")]&&null!=e[c("importTranslate.MA_MAU_MA")]&&null!=o&&null!=a&&null!=e[c("importTranslate.MA_KHO")]&&""!==e[c("importTranslate.MA_SP")]&&""!==e[c("importTranslate.MA_MAU_MA")]&&""!==o&&""!==a&&""!==e[c("importTranslate.MA_KHO")]||l.push(n+2),null!=o&&null!=o.toString().match(g)&&null!=a&&null!=a.toString().match(g)||p.push(n+2);case 6:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()),l.length>0){var f=[],m="";return l.map((function(t){return m+=t+" "})),f.push({id:1,message:"".concat(c("components.stocktakingImportExcel.formatFileErrorAt"),": ").concat(m),success:!1}),void o.setState({warehousesState:[1],isUpdating:!0,updatingInfo:f})}if(p.length>0){var k=[],v="";return p.map((function(t){return v+=t+" "})),k.push({id:1,message:"".concat(c("components.stocktakingImportExcel.formatQuantityError"),": ").concat(v),success:!1}),void o.setState({warehousesState:[1],isUpdating:!0,updatingInfo:k})}if(h.length>0){var y=[],_="";return h.map((function(t){return _+=t+" "})),y.push({id:1,message:"".concat(c("components.stocktakingImportExcel.formatRemainQuantityError"),": ").concat(_),success:!1}),void o.setState({warehousesState:[1],isUpdating:!0,updatingInfo:y})}var S=[],b=[];if(!(e.length>0)){var w=[];return w.push({id:0,message:"".concat(c("components.stocktakingImportExcel.nothingIsUpdate")),success:!0}),void o.setState({warehousesState:[1],isUpdating:!0,updatingInfo:w})}e.map((function(t){b.push(t[c("importTranslate.MA_KHO")]);var e="batch_shelf"==i?parseInt(t[c("importTranslate.SL_LO_SAU_DIEU_CHINH")])+parseInt(t[c("importTranslate.SL_KE_SAU_DIEU_CHINH")]):t[c("importTranslate.SO_LUONG_SAU_DIEU_CHINH")];S[t[c("importTranslate.MA_KHO")]]||(S[t[c("importTranslate.MA_KHO")]]={note:t[c("components.stocktakingImportExcel.note")],warehouse_id:t[c("importTranslate.MA_KHO")],items:[],shop_id:s.id,status:0,is_batch_shelf:"batch_shelf"==i}),""==S[t[c("importTranslate.MA_KHO")]].note&&(S[t[c("importTranslate.MA_KHO")]].note=t[c("components.stocktakingImportExcel.note")]),S[t[c("importTranslate.MA_KHO")]].items.push({line_number:t.line_number,product_display_id:t[c("importTranslate.MA_SP")].toString(),variation_display_id:t[c("importTranslate.MA_MAU_MA")].toString(),product_name:t[c("importTranslate.TEN_SP")],quantity:e,warehouse_id:t[c("importTranslate.MA_KHO")],shelf_quantity:"batch_shelf"==i?t[c("importTranslate.SL_KE_SAU_DIEU_CHINH")]:void 0})})),b=ot()(b),n&&!a&&o.setState({datas:S,warehousesState:b,isUpdating:!0},(function(){return setTimeout((function(){return o.sendRequest(0)}))}))}})),(0,v.Z)((0,h.Z)(o),"sendRequest",function(){var t=(0,d.Z)(u().mark((function t(e){var n,a,i,r,s,c,l,d,p,h,g,f,m;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e>0&&o.scrollUpdatingInfo(),n=o.props,a=n.currentShop,i=n.accessToken,r=n.t,n.warehouses,s=o.state,c=s.datas,l=s.warehousesState,d=s.isAutoAddProductNotStocktaking,!(e>=l.length)){t.next=5;break}return t.abrupt("return");case 5:p=c[l[e]],h="".concat((0,lt.LpH)(),"/shops/").concat(a.id,"/stocktakings/import?access_token=").concat(i),g=function t(e){var n=X()(e).map((function(e){return $()(e)?t(e):e}));return K()(n)},t.prev=8,O().post(h,{stocktaking:p}).then((function(t){var n,a,i,s,c=null===(n=t.data)||void 0===n?void 0:n.success,u=o.state.updatingInfo;(u.push({id:e,message:c?r("components.stocktakingImportExcel.insertStocktakingSuccess"):(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.message)||r("components.stocktakingImportExcel.insertStocktakingError"),success:c}),o.setState({updatingInfo:u}),e+1<l.length)?o.sendRequest(e+1):d&&null!==(i=t.data)&&void 0!==i&&null!==(s=i.data)&&void 0!==s&&s.id&&o.handleAutoAddProductNotStocktaking(t.data.data.id)})).catch((function(t){var n=t.response?t.response.data.errors?g(t.response.data.errors):t.response.data.message?[t.response.data.message]:[]:[],a=o.state.updatingInfo;return a.push({id:e,message:n||r("components.stocktakingImportExcel.unknownError"),success:!1}),o.setState({updatingInfo:a}),o.sendRequest(e+1)})),t.next=19;break;case 12:return t.prev=12,t.t0=t.catch(8),f=t.t0.response?t.t0.response.data.errors?g(t.t0.response.data.errors):t.t0.response.data.message?[t.t0.response.data.message]:[]:[],(m=o.state.updatingInfo).push({id:e,message:f||r("components.stocktakingImportExcel.unknownError"),success:!1}),o.setState({updatingInfo:m}),t.abrupt("return",o.sendRequest(e+1));case 19:case"end":return t.stop()}}),t,null,[[8,12]])})));return function(e){return t.apply(this,arguments)}}()),(0,v.Z)((0,h.Z)(o),"handleAutoAddProductNotStocktaking",(function(t){if(t){var e=o.props,n=e.currentShop,a=e.accessToken,i="".concat((0,lt.LpH)(),"/shops/").concat(n.id,"/stocktakings/auto_fill_product?access_token=").concat(a);O().post(i,{id:t})}})),(0,v.Z)((0,h.Z)(o),"handleCancelModal",(function(){var t,e=o.state,n=e.isUpdating,a=e.isUpdatingQuantity;(n||a)&&o.props.fetch(),o.setState({visible:!1,selectedFile:null,fileName:null,isUpdating:!1,isUpdatingQuantity:!1,updatingInfo:[],warehousesState:[],quantityState:[],datas:[],confirmModalDetail:!1,stockBarcode:[],variationsStocktaking:[],failureProduct:[],listItemFailure:{notExist:[],deviatedQuantity:[]},stocktaking:{warehouse_id:(null===(t=o.props.warehouses)||void 0===t?void 0:t.length)>0?o.props.warehouses[0].id:void 0,status:0,items:[]},currentData:0,totalEntriesFill:0})})),(0,v.Z)((0,h.Z)(o),"handleExportExcel",(function(){var t=o.state.failureProduct,e=new ExcelJS.Workbook,n=e.addWorksheet("My Sheet");return n.columns=[{header:"BARCODE",key:"barcode",width:20},{header:"QUANTITY",key:"quantity",width:20}],t.map((function(t){n.addRow({barcode:t.barcode,quantity:t.quantity})})),e.xlsx.writeBuffer().then((function(t){(0,dt.saveAs)(new Blob([t],{type:"application/octet-stream"}),"Export_Product_Failure.xlsx")}))})),(0,v.Z)((0,h.Z)(o),"handleCheckAutoAddProduct",(function(t){t.stopPropagation(),o.setState({isAutoAddProductNotStocktaking:t.target.checked}),localStorage.setItem("add_product_not_stocktaking",JSON.stringify(t.target.checked))})),(0,v.Z)((0,h.Z)(o),"onChangeSelectWarehouse",(function(t){var e=o.state.stocktaking;e.warehouse_id=t,o.setState({selectWarehouse:t,stocktaking:e})}));var i=t.stocktaking;return i={warehouse_id:(null===(a=t.warehouses)||void 0===a?void 0:a.length)>0?t.warehouses[0].id:void 0,status:0,items:[]},o.state={visible:!1,stocktakingFile:[],isUpdating:!1,datas:[],warehousesState:[],updatingInfo:[],stocktakingId:null,countCurrentItem:0,countAllItems:0,modalDetailVisible:!1,stocktaking:i,isUpdatingQuantity:!1,quantityState:[],variationsStocktaking:[],confirmModalDetail:!1,failureProduct:[],stockBarcode:[],importType:"",isAutoAddProductNotStocktaking:!t.isServer&&(!(!localStorage||!localStorage.getItem("add_product_not_stocktaking"))&&JSON.parse(localStorage.getItem("add_product_not_stocktaking"))),currentData:0,totalEntriesFill:0,selectWarehouse:null},o}return(0,g.Z)(n,[{key:"getProgress",value:function(){return this.state.totalEntriesFill&&0!=this.state.totalEntriesFill?Math.round(this.state.currentData/this.state.totalEntriesFill*100):0}},{key:"scrollImportCountVariations",value:function(){var t=document.getElementById("importing-variations-quantity");t&&(t.scrollTop=t.scrollHeight)}},{key:"scrollUpdatingInfo",value:function(){var t=document.getElementById("updating-stocktaking-from-excel");t.scrollTop=t.scrollHeight}},{key:"render",value:function(){var t=this,e=this.props,n=e.t,a=e.currentShop,i=e.accessToken,r=e.warehouses,c=e.i18n,l=e.title,u=e.isButton,d=e.type,p=this.state,h=p.visible,g=p.fileName,f=p.selectedFile,m=p.isUpdating,k=p.updatingInfo,v=p.warehousesState,y=(p.countCurrentItem,p.countAllItems,p.modalDetailVisible),_=p.stocktaking,b=p.isUpdatingQuantity,w=p.quantityState,I=p.importType,x=p.confirmModalDetail,Z=p.visibleListItemFailure,O=p.isAutoAddProductNotStocktaking,D=p.isFilling,C=p.selectWarehouse,A=k.filter((function(t){return 1==t.success})).length,R=k.filter((function(t){return 0==t.success})).length;return pt("span",null,pt(q.Z,{title:l,isButton:u,icon:pt(rt.Z,null),onClick:function(){return t.setState({importType:d,visible:!0})}}),pt(S.Z,{visible:h,wrapClassName:"modal-updating",title:n("stocktaking"==I?"components.stocktakingImportExcel.titleImportExcel":"quantity"==I?"components.stocktakingImportExcel.titleImportExcelQuantity":"components.stocktakingImportExcel.createStocktakingByBatchShelf"),width:600,onCancel:function(){return t.handleCancelModal()},destroyOnClose:!0,maskClosable:!1,bodyStyle:{padding:"0 24px"},footer:pt("div",{style:m||b?{}:{display:"flex",justifyContent:"space-between",alignItems:"center"}},pt("div",null,"quantity"==I&&!m&&!b&&pt(z.default,{placeholder:n("pages.shop.advertising.selectWarehouse"),value:C,style:{marginRight:10},dropdownMatchSelectWidth:!1,allowClear:!0,onChange:this.onChangeSelectWarehouse},r.map((function(t){return pt(kt,{value:t.id,key:t.id},t.name)}))),!m&&!b&&pt(L.Z,{style:{marginLeft:10},accept:".xlsx",showUploadList:!1,multiple:!1,customRequest:this.onDrop.bind(this)},pt(o.default,{style:{width:"100%"}},g?pt("span",null,pt(st.Z,null)," ",g):pt("span",null,pt(rt.Z,null)," ",n("components.stocktakingImportExcel.chooseFile"))))),pt("div",null,("stocktaking"==I||"batch_shelf"==I)&&pt(o.default,{type:"primary",onClick:function(){return t.handleImport()},disabled:!f||m},n("start")),"quantity"==I&&pt(o.default,{type:"primary",onClick:function(){return t.sendRequestImportCountVariations(0,_)},disabled:!f||b||!C},n("start"))))},!m&&!b&&pt("div",null,pt("div",{style:"quantity"==I?{marginTop:10}:{margin:"10px 0"}},pt(F.default,{message:n("notes"),description:pt("div",{style:{fontSize:14}},("stocktaking"==I||"batch_shelf"==I)&&pt("div",null,pt("div",null,"- ",n("components.stocktakingImportExcel.noteAlert1"),"\xa0 (",pt("a",{target:"_blank",href:"batch_shelf"==I?"vi"==c.language?"/static/files/import_batch_shelf_stocktaking.xlsx":"/static/files/import_batch_shelf_stocktaking_en.xlsx":"vi"==c.language?"/static/files/import_stocktaking.xlsx":"/static/files/import_stocktaking_en.xlsx"},n("components.stocktakingImportExcel.sampleFile")),")"),pt("div",null,"- ",n("components.stocktakingImportExcel.noteAlert2")),pt("div",null,"- ",n("components.stocktakingImportExcel.ignoreDuplicateAndNoChangeQuantity"))),"quantity"==I&&pt("div",null,"- ",n("components.stocktakingImportExcel.noteAlert3"),"\xa0 (",pt("a",{target:"_blank",href:"/static/files/import_change_quantity.xlsx"},n("components.stocktakingImportExcel.sampleFile")),")")),type:"warning",showIcon:!0})),("quantity"==I||"stocktaking"==I)&&pt("div",{style:{padding:"10px 0"}},pt(s.default,{title:n("pages.shop.product.stocktaking.tipAuto"),placement:"topLeft"},pt(H.default,{onChange:this.handleCheckAutoAddProduct,checked:O},n("pages.shop.product.stocktaking.autoAddListProductNotStocktaking"))))),m&&pt("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},pt(j.default,{type:"circle",percent:Math.floor(100*k.length/v.length),style:{margin:"10px 0"}}),k.length==v.length?pt("h4",null,pt("span",{style:{color:"#00a854"}},"".concat(n("updateSuccess")," ").concat(A," ").concat(n("components.stocktakingImportExcel.stocktaking"))),pt("span",{style:{color:"#f04134"}},"".concat(R>0?", ".concat(n("components.stocktakingImportExcel.notFoundBarcode")," ").concat(R," ").concat(n("components.stocktakingImportExcel.stocktaking")):""))):pt("div",null,pt("h4",{style:{color:"#096dd9"}},pt(E.Z,null)," ","".concat(n("components.stocktakingImportExcel.updatingStocktaking"),"..."))),pt("div",{id:"updating-stocktaking-from-excel",className:"updating-info"},k.map((function(t,e){if(null!=t.success)return pt("div",{key:e},pt("span",null,pt("strong",{className:t.success?"success":"fail"},"#".concat(t.id+1))),"\xa0",pt("span",{className:t.success?"success":"fail"},((null===t||void 0===t?void 0:t.message)||"").toString().split(";").map((function(t){return pt("div",null,t)}))))})))),b&&pt("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},pt(j.default,{type:"circle",percent:Math.floor(100*k.length/w.length),style:{margin:"10px 0"}}),k.length==w.length?pt("h4",null,pt("span",{style:{color:"#00a854"}},"".concat(n("components.stocktakingImportExcel.barcodeSuccess")," ").concat(A," ").concat(n("products.title"))),pt("span",{style:{color:"#f04134"}},"".concat(R>0?", ".concat(n("pages.admin.failure")," ").concat(R," ").concat(n("products.title")):""))):pt("div",null,pt("h4",{style:{color:"#096dd9"}},pt(E.Z,null)," ","".concat(n("components.stocktakingImportExcel.searchBarcode"),"..."))),D&&pt("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:"center"}},pt("div",null,n("components.stocktakingImportExcel.loadVariationNotVailable")),pt("div",{style:{width:300}},pt(j.default,{percent:this.getProgress()}))),x&&A>0&&pt(o.default,{onClick:function(){return t.setState({modalDetailVisible:!0})}},n("components.stocktakingImportExcel.createStocktaking")),pt("div",{id:"importing-variations-quantity",className:"updating-info"},k.map((function(t,e){if(null!=t.success)return pt("div",{key:e},pt("span",null,pt("strong",{className:t.success?"success":"fail"},"#".concat(t.id+2))),"\xa0",pt("span",{className:t.success?"success":"fail"},t.message))})))),k.length==w.length&&R>0?pt("div",{style:{textAlign:"center",padding:"10px 0px 0px 0px"}},n("components.stocktakingImportExcel.productImportFailure"),pt("a",{onClick:this.handleExportExcel}," ",pt(T.Z,null)," T\u1ea3i Xu\u1ed1ng")):pt("div",null)),Z&&pt(S.Z,{wrapClassName:"modal-updating",width:700,visible:Z,title:n("components.stocktakingImportExcel.verifyStocktaking"),onCancel:function(){return t.setState({visibleListItemFailure:!1})},destroyOnClose:!0,maskClosable:!1,footer:pt(o.default,{type:"primary",onClick:function(){return t.setState({visibleListItemFailure:!1,modalDetailVisible:!0})}},n("components.stocktakingImportExcel.continueCreateStocktaking"))},this.renderVerifyModal()),b&&k.length==w.length&&y&&pt(B.Z,{visible:y,close:function(){return t.setState({modalDetailVisible:!1,confirmModalDetail:!1})},accessToken:i,shopId:a.id,stocktaking:this.state.stocktaking,variationsStocktaking:this.state.variationsStocktaking,isServer:this.props.isServer,disbaledSelectWarehouse:!0}))}}]),n}(x.Component))||a,yt=(0,N.$j)((function(t){return{currentShop:t.shop.currentShop,accessToken:t.navigation.user.accessToken,warehouses:(0,ut.op)(t)}}),{})(vt),_t=n(65644),St=n(92902),bt=n(80470),wt=n.n(bt),It=n(36934),xt=n(9051),Zt=n(48519),Ot=n(89734),Et=n.n(Ot),Tt=n(30381),Dt=n.n(Tt),Ct=x.createElement;function At(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Rt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?At(Object(n),!0).forEach((function(e){(0,v.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):At(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Nt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,k.Z)(t);if(e){var o=(0,k.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,m.Z)(this,n)}}var Pt=(0,it.Z)()(mt=function(t){(0,f.Z)(n,t);var e=Nt(n);function n(t){var a;return(0,p.Z)(this,n),a=e.call(this,t),(0,v.Z)((0,h.Z)(a),"handleFetchData",(0,d.Z)(u().mark((function t(){var e,n,o,i,r,s,c;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a.setState({isDownloading:!0,stocktakings:[]}),e=a.props,n=e.accessToken,o=e.shopId,i=e.selectedRowKeys,r=Rt(Rt({},a.props.params),{},{page:1,page_size:30,stocktaking_ids:i,preload_items:!0}),s=[],c="".concat((0,lt.LpH)(),"/shops/").concat(o,"/stocktakings?access_token=").concat(n),function t(e){return O().get(c,{params:e}).then((function(n){if(n.data.success){var a=n.data.data;return s=s.concat(a),n.data.total_entries==s.length?s:(e.page=e.page+1,t(e))}return s})).catch(lt.s0o)}(r).then((function(t){(null===t||void 0===t?void 0:t.length)>0?a.setState({stocktakings:t,isDownloading:!1},(function(){return a.handleExportExcel()})):a.setState({isDownloading:!1})}));case 7:case"end":return t.stop()}}),t)})))),(0,v.Z)((0,h.Z)(a),"handleExportExcel",(function(){var t=a.state.stocktakings,e=a.props,n=e.t,o=e.currentShop,i=new ExcelJS.Workbook,r=i.addWorksheet("My Sheet"),s=[];return t.map((function(t){(t.items||[]).map((function(t){(t.variation.fields||[]).map((function(t){s.find((function(e){return e.key==t.name}))||s.push({header:t.name,key:t.name,width:20})}))}))})),r.columns=[{header:"STT",key:"stt",width:10},{header:"ID",key:"id",width:10},{header:[n("pages.shop.product.export.creator")],key:"create",width:20},{header:[n("pages.shop.product.stocktaking.warehouse")],key:"wh",width:15},{header:[n("status")],key:"status",width:20},{header:[n("pages.shop.product.stocktaking.insertedAt")],key:"created_at",width:20},{header:[n("pages.shop.product.stocktaking.lastUpdate")],key:"updated_at",width:20},{header:[n("pages.shop.product.stocktaking.note")],key:"note",width:32},{header:[n("pages.shop.product.stocktaking.productName")],key:"product_name",width:15},{header:[n("pages.shop.product.stocktaking.productId")],key:"product_id",width:15},{header:[n("pages.shop.product.stocktaking.variationId")],key:"variation_id",width:20},{header:[n("pages.shop.product.stocktaking.variationInfo")],key:"variation_info",width:20},{header:[n("pages.shop.product.stocktaking.actual")],key:"remain_quantity",width:20},{header:[n("pages.shop.product.stocktaking.changed")],key:"changed_quantity",width:20},{header:[n("pages.shop.product.stocktaking.fixed")],key:"after_changed_quantity",width:20}].concat(s),t.map((function(t,e){Et()(t.items,"display_id").map((function(n,i){var s,c=(a.props.warehouses.find((function(e){return t.warehouse_id===e.id}))||{}).name||a.props.t("pages.shop.product.warranty.warehouseDeleted"),l={};(n.variation.fields||[]).map((function(t){l=Rt(Rt({},l),{},(0,v.Z)({},t.name,t.value))})),r.addRow(Rt({stt:i?null:e+1,id:i?null:t.display_id,create:i?null:null===(s=t.creator)||void 0===s?void 0:s.name,wh:i?null:c,status:i?null:(0,lt.Fps)()[t.status].text,created_at:i?null:(0,lt.o0x)(o.timezone,t.inserted_at,!0),updated_at:i?null:(0,lt.o0x)(o.timezone,t.updated_at,!0),note:i?null:t.note,product_name:n.variation.product.name,product_id:n.variation.product.custom_id||n.variation.product.display_id,variation_id:n.variation.custom_id||n.variation.display_id,variation_info:(n.variation.fields||[]).map((function(t){return"".concat(t.name,": ").concat(t.value)})).join(", "),remain_quantity:0===t.status?n.variation_warehouse.actual_remain_quantity:n.current_quantity,changed_quantity:n.changed_quantity,after_changed_quantity:(0===t.status?n.variation_warehouse.actual_remain_quantity:n.current_quantity)+n.changed_quantity},l))}))})),r.getRow(1).font={size:12,bold:!0},i.xlsx.writeBuffer().then((function(t){(0,dt.saveAs)(new Blob([t],{type:"application/octet-stream"}),"Stocktaking.xlsx")}))})),a.state={stocktakings:[],isDownloading:!1},a}return(0,g.Z)(n,[{key:"render",value:function(){var t=this.props,e=t.isButton,n=t.title;return Ct("div",{style:{display:"inline"}},Ct(q.Z,{title:n,icon:Ct(T.Z,null),onClick:this.handleFetchData,isButton:e}))}}]),n}(x.Component))||mt,qt=(0,N.$j)((function(t){return{currentShop:t.shop.currentShop,timezone:t.navigation.user.timezone,warehouses:(0,ut.op)(t)}}),null)(Pt),Ut=n(7859),Mt=n(7690),Bt=n(97705),jt=n(37508),Ht=function(t,e,n){var a=n.find((function(e){return e.id==t.warehouse_id}));return'<div class="printer">\n      <div class="title">\n        <strong>PHI\u1ebeU KI\u1ec2M KHO</strong>\n      </div>\n      <div class="info">\n        <div style="display: grid; grid-template-columns: 50% 50%">\n          <div>\n            M\xe3 phi\u1ebfu xu\u1ea5t: <strong>'.concat(t.display_id,"</strong>\n          </div>\n          <div>\n            Ng\u01b0\u1eddi t\u1ea1o: <strong>").concat(t.user?t.user.name:"H\u1ec7 Th\u1ed1ng","</strong>\n          </div>\n          <div>\n            Ng\xe0y t\u1ea1o: ").concat((0,lt.o0x)(e||7,t.inserted_at,!1,"DD/MM/YYYY HH:mm"),'\n          </div>\n        </div>\n        <div>\n          <div style="margin-top: 4px; font-weight: 600">\n            <i>KHO CH\u1ee8A H\xc0NG</i>\n          </div>\n          <div style="display: grid; grid-template-columns: 50% 50%">\n            <div>\n              T\xean: <strong>').concat(null===a||void 0===a?void 0:a.name,"</strong>\n            </div>\n            <div>\n              S\u1ed1 \u0111i\u1ec7n tho\u1ea1i: ").concat(null===a||void 0===a?void 0:a.phone_number,"\n            </div>\n          </div>\n          <div>\n            \u0110\u1ecba ch\u1ec9: ").concat(null===a||void 0===a?void 0:a.full_address,'\n          </div>\n        </div>\n      </div>\n      <table class="table">\n        <tbody>\n        <tr style="text-align: center">\n          <th width="6%">#</th>\n          <th width="15%;">M\xe3 SP</th>\n          <th width="15%;">M\xe3 M\u1eabu</th>\n          <th width="19%;">T\xean h\xe0ng</th>\n          <th width="10%;" style="text-align: left">T\u1ed3n kho</th>\n          <th width="10%;">Ch\xeanh l\u1ec7ch</th>\n          <th width="10%;">Sau \u0111i\u1ec1u ch\u1ec9nh</th>\n        </tr>\n        ').concat(Et()(t.items,"display_id").map((function(e,n){var a=0==t.status?e.variation_warehouse.actual_remain_quantity:e.current_quantity;return'<tr>\n              <td style="text-align: center">'.concat(n+1,"</td>\n              <td>").concat(e.variation.product.custom_id||e.variation.product.display_id,"</td>\n              <td>").concat(e.variation.custom_id||e.variation.display_id,'</td>\n              <td style="text-transform: uppercase">\n                ').concat(e.variation.product.name," ").concat(e.variation.fields.length?e.variation.fields.map((function(t){return"".concat(t.value)})).join(" - "):"",'\n              </td>\n              <td class="display-number">').concat((0,lt.oH6)(a),'</td>\n              <td class="display-number">').concat((0,lt.oH6)(e.changed_quantity),'</td>\n              <td class="display-number">').concat((0,lt.oH6)(a+e.changed_quantity),"</td>\n            </tr>")})).join(""),'\n        <tr>\n          <th colspan="1" class="display-number">T\u1ed5ng</th>\n          <th></th>\n          <th></th>\n          <th></th>\n          <th></th>\n          <th class="display-number">').concat((0,lt.oH6)(t.items.reduce((function(t,e){return t+e.changed_quantity}),0)),'</th>\n          <th class="display-number">').concat((0,lt.oH6)(t.items.reduce((function(e,n){return e+((0==t.status?n.variation_warehouse.actual_remain_quantity:n.current_quantity)+n.changed_quantity)}),0)),"</th>\n        </tr>\n        </tbody>\n      </table>\n    </div>\n  ")},Ft=n(74018),Lt=n(24781),zt=n(41850),Wt=n(45812),Qt=x.createElement;function Vt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function Kt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(n),!0).forEach((function(e){(0,v.Z)(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Yt(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,a=(0,k.Z)(t);if(e){var o=(0,k.Z)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return(0,m.Z)(this,n)}}var Xt=["30","50","100"],Jt={creator_id:void 0,last_creator_id:void 0,warehouse_id:void 0,variation_id:void 0,page:1,page_size:30,status:-2},$t="stocktaking-table",Gt="updated_status_at",te=S.Z.confirm,ee=_.default.RangePicker,ne=y.default.Group,ae=y.default.Button,oe=function(t){(0,f.Z)(n,t);var e=Yt(n);function n(t){var a;(0,p.Z)(this,n),a=e.call(this,t),(0,v.Z)((0,h.Z)(a),"columns",[{title:a.props.t("pages.shop.product.stocktaking.id"),dataIndex:"id",ellipsis:!0,width:"5%"},{title:a.props.t("pages.shop.product.stocktaking.creator"),dataIndex:"creator",ellipsis:!0},{title:a.props.t("pages.shop.product.stocktaking.note"),dataIndex:"note",ellipsis:!0},{title:a.props.t("pages.shop.product.stocktaking.warehouse"),dataIndex:"warehouse",ellipsis:!0},{title:a.props.t("pages.shop.product.stocktaking.insertedAt"),dataIndex:"inserted_at",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.stocktaking.stocktakingAt"),dataIndex:"stocktaking_at",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.stocktaking.lastUpdate"),dataIndex:Gt,align:"right",ellipsis:!0,width:"10%"},{title:a.props.t("status"),dataIndex:"status",align:"center",width:"160px",fixed:"right",render:function(t,e){var n=a.props.currentShop,o=n?(0,Zt.zE)(n.role):{};return Qt("span",{onClick:function(t){return t.stopPropagation()}},Qt(xt.Z,{accessToken:a.props.accessToken,shopId:a.props.shopId,stocktaking:e.action,t:a.props.t,disabled:!o.ql_nhaphang}))}}]),(0,v.Z)((0,h.Z)(a),"getData",(function(){return a.props.stocktakings.data.map((function(t){return{key:t.id,id:(0,lt.pyT)(t.display_id,0),creator:t.creator?Qt(M.Z,{seed:t.creator.id,avatar_url:t.creator.avatar_url,id:t.creator.fb_id,size:[20,20],style:{marginRight:5,float:"left"},name:t.creator.name,showName:!0}):Qt(c.default,{color:"#00707f"},a.props.t("pages.admin.system")),warehouse:Qt(s.default,{title:(a.props.warehouses.find((function(e){return t.warehouse_id===e.id}))||{}).name},Qt("strong",null,(a.props.warehouses.find((function(e){return t.warehouse_id===e.id}))||{}).name||a.props.t("pages.shop.product.warranty.warehouseDeleted"))),note:Qt(s.default,{title:t.note},t.note),inserted_at:(0,lt.o0x)(a.props.timezone,t.inserted_at),stocktaking_at:t.stocktaking_at&&(0,lt.o0x)(a.props.timezone,t.stocktaking_at),updated_status_at:t.updated_status_at?(0,lt.o0x)(a.props.timezone,t.updated_status_at):"",action:t}}))})),(0,v.Z)((0,h.Z)(a),"handleTableChange",(function(t){var e=a.state.params;e.page=t.current,a.setState({pageSize:t.pageSize},(function(){localStorage.setItem("stocktakingPageSize",t.pageSize),e.page_size=t.pageSize,a.fetchStocktakings(e)})),document.querySelector(".ant-table-body").scrollTop=0})),(0,v.Z)((0,h.Z)(a),"onChangeFilterDate",(function(t,e){var n=a.state,o=n.params,i=n.filterTags,r=i.findIndex((function(t){return t.key==e}));if(t&&t.length>0){var s=t[0].startOf("day").unix(),c=t[1].endOf("day").unix(),l={key:e,value:{startDate:t[0].startOf("day"),endDate:t[1].endOf("day")}};r>-1?i[r]=l:i.push(l),"inserted"==e?(o.startDate=s,o.endDate=c):(o.startUpdatedTime=s,o.endUpdatedTime=c)}else"inserted"==e?(o.startDate=void 0,o.endDate=void 0):(o.startUpdatedTime=void 0,o.endUpdatedTime=void 0),r>-1&&i.splice(r,1);(0,lt.iAs)(e,"".concat(a.props.shopId,"_filter_variation_source_count")),a.setState({params:o,filterTags:i},(function(){return a.fetchStocktakings(o)}))})),(0,v.Z)((0,h.Z)(a),"handleSearchEmployee",(function(t,e){var n=t.target?t.target.value:t;a.props.pushUsersTextSearch(n,a.props.users,e,"stocktakingFilter")})),(0,v.Z)((0,h.Z)(a),"getOptions",(function(){var t,e,n=a.props,o=n.t,s=n.accessToken,c=n.shopId,l=n.currentShop,u=n.warehouses,d=n.users,p=n.employeeList,h=(n.isServer,a.state),g=h.searchResult,f=h.searchResultProduct,m=h.params,k=p&&p.length?p.findIndex((function(t){return"creator_id"==t.which&&"stocktakingFilter"==t.type})):-1,y=-1==k?d:p[k].users,_=k>-1?p[k].text:void 0,S=y.map((function(t){var e=t.user_id;return{value:e,label:(0,lt.q$s)(e,y)}})),b=[{value:"creator_id",label:o("pages.shop.product.purchase.creator"),children:[{value:100,label:Qt("div",{onClick:function(t){return t.stopPropagation()}},Qt(r.default,{onChange:function(t){return a.handleSearchEmployee(t,"creator_id")},value:_,placeholder:o("components.orderAdvanceFilter.enterEmployee"),allowClear:!0}))},{value:"created_by_user",label:Qt("div",null,o("pages.shop.product.purchase.createdByUser"))},{value:"created_by_system",label:Qt("div",null,o("pages.shop.product.purchase.createdBySystem"))}].concat(S)},{value:"warehouse_id",label:o("pages.shop.statistic.inventory.warehouse"),children:u.map((function(t){return{value:t.id,label:t.name}}))},{value:"inserted",label:o("pages.shop.product.purchase.time"),children:[{value:"inserted",label:Qt("span",{onClick:function(t){return t.stopPropagation()}},Qt(ee,{ranges:(t={},(0,v.Z)(t,o("pages.shop.statistic.yesterday"),[Dt()().add(-1,"days").startOf("day"),Dt()().add(-1,"days").endOf("day")]),(0,v.Z)(t,o("pages.shop.statistic.today"),[Dt()().startOf("day"),Dt()().endOf("day")]),(0,v.Z)(t,o("pages.shop.statistic.lastWeek"),[Dt()().add(-7,"days").startOf("day"),Dt()().endOf("day")]),(0,v.Z)(t,o("pages.shop.statistic.lastMonth"),[Dt()().add(-30,"days").startOf("day"),Dt()().endOf("day")]),(0,v.Z)(t,o("pages.shop.statistic.thisMonth"),[Dt()().startOf("month").startOf("day"),Dt()().endOf("month").endOf("day")]),t),value:m&&m.endDate&&m.startDate?[Dt()(m.startDate,"X"),Dt()(m.endDate,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(t){return a.onChangeFilterDate(t,"inserted")}}))}]},{value:"last_updated",label:o("pages.shop.product.purchase.lastUpdated"),children:[{value:"last_updated",label:Qt("span",{onClick:function(t){return t.stopPropagation()}},Qt(ee,{ranges:(e={},(0,v.Z)(e,o("pages.shop.statistic.yesterday"),[Dt()().add(-1,"days").startOf("day"),Dt()().add(-1,"days").endOf("day")]),(0,v.Z)(e,o("pages.shop.statistic.today"),[Dt()().startOf("day"),Dt()().endOf("day")]),(0,v.Z)(e,o("pages.shop.statistic.lastWeek"),[Dt()().add(-7,"days").startOf("day"),Dt()().endOf("day")]),(0,v.Z)(e,o("pages.shop.statistic.lastMonth"),[Dt()().add(-30,"days").startOf("day"),Dt()().endOf("day")]),(0,v.Z)(e,o("pages.shop.statistic.thisMonth"),[Dt()().startOf("month").startOf("day"),Dt()().endOf("month").endOf("day")]),e),value:m&&m.startUpdatedTime&&m.endUpdatedTime?[Dt()(m.startUpdatedTime,"X"),Dt()(m.endUpdatedTime,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(t){return a.onChangeFilterDate(t,"last_updated")}}))}]},{value:"variation",label:o("pages.shop.statistic.statisticItem.product"),children:[{value:"id",label:o("pages.shop.statistic.statisticItem.variation"),children:[{value:"search-variation",label:Qt("div",{onClick:function(t){return t.stopPropagation()}},Qt(Bt.Z,{accessToken:s,searchResult:g,combo_by:"variation",searchOnly:!0,shopId:c,callback:function(t){return a.setState({searchResult:t})},is_filter:!0}))}].concat((0,i.Z)(g.map((function(t,e){return{value:"variation-".concat(e),label:Qt("div",{onClick:function(e){e.stopPropagation(),a.handleSelectItem(t.id,"variation")}},Qt(jt.Z,{width:448,t:o,key:e,currentShop:l,combo_by:"variation",item:t,warehouses:u}))}}))))},{value:"product_id",label:o("pages.shop.statistic.statisticItem.product"),children:[{value:"search-product",label:Qt("div",{onClick:function(t){return t.stopPropagation()}},Qt(Bt.Z,{accessToken:s,searchResult:f,combo_by:"product",searchOnly:!0,shopId:c,callback:function(t){return a.setState({searchResultProduct:t})},is_filter:!0}))}].concat((0,i.Z)(f.map((function(t,e){return{value:"variation-".concat(e),label:Qt("div",{onClick:function(e){e.stopPropagation(),a.handleSelectItem(t.id,"product")}},Qt(jt.Z,{width:300,t:o,key:e,currentShop:l,combo_by:"product",item:t,warehouses:u}))}}))))}]}];return(0,lt.QIx)(b,"".concat(a.props.shopId,"_filter_variation_source_count"))})),(0,v.Z)((0,h.Z)(a),"handleSelectItem",(function(t,e){if("no-result"!=t){var n,o=a.state,i=o.searchResult,r=o.searchResultProduct,s=o.params;if("variation"==e)n={key:"variation_id",value:i.find((function(e){return e.id==t}))},a.fetchStocktakings(Kt(Kt({},s),{},{variation_id:t}));else n={key:"product_id",value:r.find((function(e){return e.id==t}))},a.fetchStocktakings(Kt(Kt({},s),{},{product_id:t}));a.onSelectTag(n)}})),(0,v.Z)((0,h.Z)(a),"getInc",(function(){var t;return(null===(t=a.state.columnsWidth)||void 0===t?void 0:t.inc)||0})),(0,v.Z)((0,h.Z)(a),"onResize",(function(t,e){var n,o=a.state.columnsWidth;t==Gt&&(e=a.getInc()+e-((null===(n=document.getElementsByClassName(t)[0])||void 0===n?void 0:n.offsetWidth)||0));o[t=t==Gt?"inc":t]=e,a.setState({columnsWidth:o},(function(){var n,i;"inc"==t&&e<=0&&((null===(n=document.getElementsByClassName("ant-table-body")[0])||void 0===n?void 0:n.scrollWidth)||0)<=((null===(i=document.getElementsByClassName("ant-table-body")[0])||void 0===i?void 0:i.offsetWidth)||0)&&(o[t]=0,a.setState({columnsWidth:o})),localStorage.setItem("columnsWidthStocktaking",JSON.stringify(o))}))})),(0,v.Z)((0,h.Z)(a),"handleRowClick",(function(t){var e=t.action;-1!=e.status&&a.setState({modalDetailVisible:!0,selectedStocktakingId:e.id,isLocalStorage:!1,variationsStocktaking:[]})})),(0,v.Z)((0,h.Z)(a),"fetchStocktakings",(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kt({},Jt),e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=a.props,o=n.accessToken,i=n.shopId,r=n.getStocktakingCounter,s=n.fetchStocktakings;t=Kt(Kt({},a.state.params),t),a.setState({params:t,isLoading:e}),r(o,i,t),s(o,i,t).then((function(){return a.setState({isLoading:!1})}))})),(0,v.Z)((0,h.Z)(a),"setSelectPurchase",(function(){var t=a.props,e=t.shopId,n=t.t,o=JSON.parse(localStorage.getItem("product_stocktaking_shop_".concat(e)))||null;localStorage["product_stocktaking_shop_".concat(e)]?te({title:n("pages.shop.product.purchase.alert"),content:n("pages.shop.product.purchase.contentStocktaking"),okText:n("pages.shop.product.purchase.continous"),cancelText:n("pages.shop.product.purchase.delete"),onOk:function(){return a.setState({selectedStocktaking:o.stocktaking,modalDetailVisible:!0,selectedStocktakingId:null,variationsStocktaking:o.variationsStocktaking})},onCancel:function(){a.setState({selectedStocktaking:null,modalDetailVisible:!0,selectedStocktakingId:null,variationsStocktaking:[]}),localStorage.removeItem("product_stocktaking_shop_".concat(e))}}):a.setState({modalDetailVisible:!0,selectedStocktakingId:null,variationsStocktaking:[],selectedStocktaking:null})})),(0,v.Z)((0,h.Z)(a),"onCancelStocktakingDetail",(function(){return a.setState({modalDetailVisible:!1})})),(0,v.Z)((0,h.Z)(a),"onChangeCascader",(function(t,e){if(1!=e.length||!e[0].isRoot){var n=a.state,o=n.filterTags,i=n.params,r={key:t[0],value:t[1]};a.onSelectTag(r),a.fetchStocktakings(Kt(Kt({},i),{},(0,v.Z)({},r.key,r.value))),a.setState({filterTags:o})}})),(0,v.Z)((0,h.Z)(a),"renderVariationTag",(function(t){var e=t&&t.product.name,n={product_display_id:t&&(t.product.custom_id||(0,lt.pyT)(t.product.display_id,0)),var_display_id:t&&(t.custom_id||(0,lt.pyT)(t.display_id,0)),name:e};return Qt("div",{className:"tag-variation"},n.product_display_id?Qt(c.default,{color:"green",style:{marginRight:3}},n.product_display_id):"",n.var_display_id?Qt(c.default,{color:"pink",style:{marginRight:3}},n.var_display_id):"",Qt("b",null,n.name))})),(0,v.Z)((0,h.Z)(a),"renderDateTag",(function(t){var e=a.props,n=e.timezone,o=e.t,i=(0,lt.o0x)(n,t.startDate||"",!1,"DD/MM/YYYY"),r=(0,lt.o0x)(n,t.endDate||"",!1,"DD/MM/YYYY");return"".concat(o("pages.shop.product.purchase.from")," ").concat(i," - ").concat(o("pages.shop.product.purchase.to")," ").concat(r)})),(0,v.Z)((0,h.Z)(a),"renderTag",(function(t,e){var n,o,i=a.props,r=i.t,s=i.warehouses,l=i.users,u="",d="";switch(t.key){case"creator_id":d=r("pages.shop.product.purchase.creator"),u="created_by_system"==t.value?r("pages.shop.product.purchase.createdBySystem"):"created_by_user"==t.value?r("pages.shop.product.purchase.createdByUser"):null===(n=l.find((function(e){return e.user_id==t.value})))||void 0===n?void 0:n.user.name;break;case"variation_id":d=r("pages.shop.statistic.statisticItem.product"),u=a.renderVariationTag(t.value);break;case"product_id":d=r("pages.shop.statistic.statisticItem.product"),u=a.renderProductTag(t.value);break;case"warehouse_id":var p=s&&s.length>0&&(null===(o=s.find((function(e){return e.id==t.value}))||{})||void 0===o?void 0:o.name);d=r("pages.shop.setting.conditionWarehouse"),u=Qt("b",null,"\xa0",p);break;case"inserted":d=Qt("strong",null,r("pages.shop.product.purchase.time")),u=a.renderDateTag(t.value);break;case"last_updated":d=Qt("strong",null,"C\u1eadp nh\u1eadt cu\u1ed1i"),u=a.renderDateTag(t.value)}return Qt(c.default,{key:"".concat(e,"_").concat(u),closable:!0,onClose:function(){return a.onCloseTag(e)}},Qt("span",{className:"content-tag"},d,": ",u))})),(0,v.Z)((0,h.Z)(a),"renderProductTag",(function(t){var e=t&&t.name,n={product_display_id:t&&(t.custom_id||(0,lt.pyT)(t.display_id,0)),name:e};return Qt("div",{className:"tag-variation"},n.product_display_id?Qt(c.default,{color:"green",style:{marginRight:3}},n.product_display_id):"",Qt("b",null,n.name))})),(0,v.Z)((0,h.Z)(a),"onSelectTag",(function(t){var e=a.state.filterTags,n=e.findIndex((function(e){return e.key==t.key}));-1!=n?e[n].value=t.value:e.push(t),(0,lt.iAs)(t.key,"".concat(a.props.shopId,"_filter_variation_source_count")),a.setState({filterTags:e})})),(0,v.Z)((0,h.Z)(a),"onCloseTag",(function(t){var e=a.state,n=e.filterTags,o=e.params,i=n[t].key;n.splice(t,1),"inserted"==i&&(o.startDate=void 0,o.endDate=void 0),"last_updated"==i&&(o.startUpdatedTime=void 0,o.endUpdatedTime=void 0),a.setState({filterTags:n}),a.fetchStocktakings(Kt(Kt({},o),{},(0,v.Z)({},i,undefined)))})),(0,v.Z)((0,h.Z)(a),"handleDeleteFilter",(function(){w()(a.state.params,Jt)||a.setState({params:Kt({},Jt),filterTags:[]},(function(){a.fetchStocktakings(a.state.params)}))})),(0,v.Z)((0,h.Z)(a),"handlePrintStocktaking",(function(){var t=a.props,e=t.accessToken,n=t.shopId,o=a.state.selectedRowKeys,i={page:o.length>0?-1:1,page_size:30,stocktaking_ids:o,preload_items:!0},r="".concat((0,lt.LpH)(),"/shops/").concat(n,"/stocktakings?access_token=").concat(e);O().get(r,{params:i}).then((function(t){t.data.success&&(a.setState({printList:t.data.data}),a.handlePrint())}))})),(0,v.Z)((0,h.Z)(a),"tableHeighStyle",(function(t){return t?Qt(I.default,{id:"1525466766"},[".stocktaking-table .ant-table-body,.stocktaking-table .ant-table-body-inner{min-height:calc(100vh - 244px);}"]):Qt(I.default,{id:"1192860019"},[".stocktaking-table .ant-table-body,.stocktaking-table .ant-table-body-inner{min-height:calc(100vh - 207px);}"])})),(0,v.Z)((0,h.Z)(a),"handlePrint",(function(){return a.setState({isPrinting:!0},(function(){var t=document.getElementById(a.printDivId).innerHTML,e=document.createElement("iframe");e.name="frame1",e.style.position="absolute",e.style.top="-1000000px",document.body.appendChild(e);var n=e.contentWindow?e.contentWindow:e.contentDocument.documnet?e.contentDocument.document:e.contentDocument;n.document.open(),n.document.write("\n      <!DOCTYPE html>\n        <head>\n          <style type='text/css'>\n            @media print {\n              @page {\n                size: auto;\n                margin: 6mm;\n              }\n            }\n          </style>\n        </head>\n        <body>\n          ".concat(t,"\n        </body>\n      </html>\n    ")),n.document.close(),setTimeout((function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(e)}),500),a.setState({isPrinting:!1})}))})),(0,v.Z)((0,h.Z)(a),"renderStatus",(function(){var t=a.state,e=t.params,n=t.isLoading,o=a.props,i=o.stocktakings,r=o.t,s=i.counters,l=s&&s.length>0?s.reduce((function(t,e){return t+e.count}),0):0,u=function(t){var e=s&&s.length>0?s.find((function(e){return e.status==t})):0;return e?e.count:0},d=[{text:r("commons.all"),value:-2,count:l},{text:r("tool.creating"),value:-1,count:u(-1)},{text:r("stocktakings.stocktaking"),value:0,count:u(0)},{text:r("stocktakings.stocktook"),value:1,count:u(1)},{text:r("tool.cancelled"),value:2,count:u(2)}];return Qt("div",{className:"status-dropdown",style:{marginTop:10}},Qt(ne,{id:"status-group",onChange:function(t){return a.fetchStocktakings({status:t.target.value},!0)},value:e.status},d.map((function(t){return Qt(ae,{value:t.value,key:t.value},t.text,Qt(c.default,{key:t.value},n&&e.status==t.value?Qt(E.Z,null):t.count))}))))})),(0,v.Z)((0,h.Z)(a),"getListActionTools",(function(){var t=a.props,e=t.stocktakings.data,n=t.accessToken,o=t.shopId,i=t.t,r=t.currentShop,s=t.warehouses,c=t.isServer,l=a.state,u=l.params,d=l.selectedRowKeys,p=r?(0,Zt.zE)(r.role):{},h=[{icon:Qt(T.Z,null),title:i("pages.shop.statistic.inventory.exportExcel"),key:"export_excel",content:function(t){return Qt(qt,{trigger:"click",params:u,accessToken:n,shopId:o,selectedRowKeys:d,isButton:t,title:i("pages.shop.statistic.inventory.exportExcel")})}},{icon:Qt(D.Z,null),title:i("components.stocktakingImportExcel.createStocktakingByProductId"),key:"import_excel",content:function(t){return Qt(yt,{fetch:function(){return a.fetchStocktakings()},warehouses:s,isServer:c,isButton:t,title:i("components.stocktakingImportExcel.createStocktakingByProductId"),type:"stocktaking"})}},{icon:Qt(D.Z,null),title:i("components.stocktakingImportExcel.adjustQuantity"),key:"import_excel_by_quantity",content:function(t){return Qt(yt,{fetch:function(){return a.fetchStocktakings()},warehouses:s,isServer:c,isButton:t,title:i("components.stocktakingImportExcel.adjustQuantity"),type:"quantity"})}},{icon:Qt(D.Z,null),title:i("components.stocktakingImportExcel.createStocktakingByBatchShelf"),key:"import_excel_by_batch_shelf",content:function(t){return Qt(yt,{fetch:function(){return a.fetchStocktakings()},warehouses:s,isServer:c,isButton:t,title:i("components.stocktakingImportExcel.createStocktakingByBatchShelf"),type:"batch_shelf"})}},{icon:Qt(C.Z,null),title:i("pages.shop.product.stocktaking.printStocktaking"),key:"print_stocktaking",content:function(t){return Qt(q.Z,{icon:Qt(C.Z,null),title:i("pages.shop.product.stocktaking.printStocktaking"),onClick:a.handlePrintStocktaking,isButton:t})}}];if(!r.use_warehouse_position){var g=e.findIndex((function(t){return"import_excel_by_batch_shelf"==t.key}));g>-1&&e.splice(g,1)}if(!p.ql_nhaphang){var f=e.findIndex((function(t){return"import_excel"==t.key}));f>-1&&e.splice(f,1);var m=e.findIndex((function(t){return"import_excel_by_quantity"==t.key}));m>-1&&e.splice(m,1);var k=e.findIndex((function(t){return"import_excel_by_batch_shelf"==t.key}));k>-1&&e.splice(k,1)}return h})),(0,v.Z)((0,h.Z)(a),"onSelectRow",(function(){var t=a.props,e=t.shopId,n=t.accessToken,o=a.state.params,i="".concat((0,lt.LpH)(),"/shops/").concat(e,"/stocktakings?access_token=").concat(n);a.setState({loadingData:!0});(function t(e){return O().get(i,{params:e}).then((function(n){var o=a.state,i=o.loadingData,r=o.selectedRowKeys,s=n.data.data,c=s.map((function(t){return t.id})),l=r.filter((function(t){return!c.includes(t)})).concat(c);return i&&a.setState({selectedRowKeys:l}),(l||[]).length>=n.data.total_entries||0==s.length||!i?void 0:(e.page+=1,t(e))}))})(Kt(Kt({},o),{},{page:1})).then((function(t){return a.setState({loadingData:!1})}))}));var o=t.isServer?{}:localStorage.getItem("columnsWidthStocktaking")?JSON.parse(localStorage.getItem("columnsWidthStocktaking")):{};return a.state={isLoading:!1,params:Kt({},Jt),modalDetailVisible:!1,selectedStocktakingId:null,selectedRowKeys:[],columnsWidth:o,selectedStocktaking:null,variationsStocktaking:[],pageSize:parseInt(localStorage.getItem("stocktakingPageSize")||30),filterTags:[],searchResult:[],searchResultProduct:[],printList:[],loadingData:!1},a.printDivId=(0,lt.uuG)(),a}return(0,g.Z)(n,null,[{key:"getInitialProps",value:function(){var t=(0,d.Z)(u().mark((function t(e,n){var a,o;return u().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.store.dispatch,o=e.query.shopId,!e.isServer){t.next=4;break}return t.next=4,a((0,It.v3p)(n,o,Jt));case 4:return t.next=6,a((0,It.P3w)(n,o,!1));case 6:return t.abrupt("return",{});case 7:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),(0,g.Z)(n,[{key:"componentDidMount",value:function(){var t=this.state,e=t.params,n=t.pageSize;if((0,lt.oSE)($t),this.props.isServer){var a=localStorage.getItem("columnsWidthStocktaking");a&&this.setState({columnsWidth:JSON.parse(a)})}e.page_size=n,this.fetchStocktakings(e)}},{key:"render",value:function(){var t=this,e=this.props,n=e.stocktakings,a=n.total_entries,i=n.data,r=e.accessToken,s=e.shopId,c=e.t,l=e.currentShop,u=e.timezone,d=e.warehouses,p=this.state,h=p.isLoading,g=p.params,f=p.modalDetailVisible,m=p.selectedRowKeys,k=p.selectedStocktakingId,v=p.columnsWidth,y=p.selectedStocktaking,_=p.pageSize,S=p.filterTags,b=p.isPrinting,w=p.printList,I=p.loadingData,x=l?(0,Zt.zE)(l.role):{},Z={pageBreakInside:"avoid",minHeight:"190mm",padding:"1mm"},O=this.columns.map((function(t){return v&&v[t.dataIndex]?t.width=v[t.dataIndex]:t.width=200,t})),E=(0,lt.f2Q)(O,this.getInc());O.map((function(t){return t.dataIndex==Gt&&t.width&&delete t.width,t})),O=O.map((function(e){return Kt(Kt({},e),{},{onHeaderCell:function(e){return{id:e.dataIndex,width:e.width,tableClassName:$t,onResize:t.onResize,isInc:e.dataIndex==Gt}}})}));var T={header:{cell:Ut.Z}};return Qt(_t.Z,{className:"product-stocktaking"},Qt("div",{className:"tools-container"},x.ql_nhaphang&&Qt(P.Z,{icon:Qt(A.Z,null),color:"#096DD9",title:c("pages.shop.product.stocktaking.create"),onClick:function(){return t.setSelectPurchase()}}),Qt(q.Z,{icon:Qt(R.Z,null),disabled:h,title:c("pages.shop.orderControlInfo.sync"),onClick:function(){return t.fetchStocktakings()},isButton:!0}),Qt(Lt.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(t){return t.key})),keyView:"stocktaking"}),Qt(Wt.Z,{selectedLength:m.length,loadingData:I,total:a,onClick:function(){return t.setState({loadingData:!1,selectedRowKeys:[]})}}),Qt("div",{className:"filter"},Qt(Ft.Z,{params:g,shopId:s,accessToken:r,fetch:function(e){return t.setState({params:e},(function(){return t.fetchStocktakings(e)}))}}),Qt("div",null,S.length>0&&Qt(o.default,{danger:!0,onClick:function(){return t.handleDeleteFilter()}},c("pages.shop.statistic.customer.deleteFilter")),Qt(Mt.Z,{options:this.getOptions(),popupClassName:"cascader-filter-customer",onChange:this.onChangeCascader}))),S&&S.length>0&&Qt("div",{className:"tags-filter"},S.map(this.renderTag))),b&&Qt("div",{id:this.printDivId,className:"print-div"},w.map((function(t){return Qt("div",{key:t.id,style:Z},Qt("div",{dangerouslySetInnerHTML:{__html:Ht(t,u,d)}}),Qt("style",{dangerouslySetInnerHTML:{__html:wt()}}))}))),this.renderStatus(),Qt(zt.Z,{components:T,className:"".concat($t).concat(h?" blur-when-loading":""),size:"small",dataSource:this.getData(),columns:O,pagination:{size:"small",pageSize:_,total:a,current:g.page,pageSizeOptions:Xt,showSizeChanger:!0},scroll:{x:E,y:S&&S.length>0?"calc(100vh - 244px)":"calc(100vh - 212px)"},onChange:this.handleTableChange,onRow:function(e){return{onClick:function(n){return t.handleRowClick(e)}}},rowSelection:{selectedRowKeys:m,onChange:function(e){return t.setState({selectedRowKeys:e})},onSelectRow:function(){return t.onSelectRow()},isSelection:!0,preserveSelectedRowKeys:!0}}),Qt(B.Z,{visible:f,close:function(){return t.onCancelStocktakingDetail()},accessToken:r,shopId:s,stocktaking:k?i.find((function(t){return t.id==k})):y,variationsStocktaking:this.state.variationsStocktaking,isServer:this.props.isServer}),h&&Qt(U.Z,null),this.tableHeighStyle(S&&S.length>0))}}]),n}(x.Component);(0,v.Z)(oe,"pageInfo",{title:"pages.shop.product.stocktaking.stocktaking",sassStyle:wt()});var ie=(0,N.$j)((function(t){return{timezone:t.navigation.user.timezone,stocktakings:t.product.stocktakings,warehouses:(0,ut.op)(t),users:t.user.users,employeeList:t.user.filterEmployeeList}}),{fetchStocktakings:It.v3p,getStocktakingCounter:It.nBi,pushUsersTextSearch:It.mw6,fetchPrintBarcodes:It.P3w})((0,St.Z)(oe))},61968:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shop/product/stocktaking",function(){return n(65166)}])}},function(t){t.O(0,[5460,2902,4517,3845,9774,2888,179],(function(){return e=61968,t(t.s=e);var e}));var e=t.O();_N_E=e}]);