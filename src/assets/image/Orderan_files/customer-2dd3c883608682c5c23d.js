(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4491],{12528:function(e,t,n){"use strict";var o=n(20862),s=n(95318);t.Z=void 0;var r=s(n(67154)),a=o(n(67294)),i=s(n(14321)),l=s(n(72454)),c=function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n},u=i.default.TimePicker,d=i.default.RangePicker,p=a.forwardRef((function(e,t){return a.createElement(d,(0,r.default)({},e,{picker:"time",mode:void 0,ref:t}))})),m=a.forwardRef((function(e,t){var n=e.addon,o=e.renderExtraFooter,s=e.popupClassName,i=c(e,["addon","renderExtraFooter","popupClassName"]),d=a.useMemo((function(){return o||(n?((0,l.default)(!1,"TimePicker","`addon` is deprecated. Please use `renderExtraFooter` instead."),n):void 0)}),[n,o]);return a.createElement(u,(0,r.default)({},i,{dropdownClassName:s,mode:void 0,ref:t,renderExtraFooter:d}))}));m.displayName="TimePicker",m.RangePicker=p;var h=m;t.Z=h},21954:function(e){!function(){"use strict";e.exports=".modal-configuration-sms{margin-top:20px !important}.modal-configuration-sms .customer-send-sms-header{background-color:#fff;padding:10px;border-radius:2px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);-webkit-box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);min-height:118px;margin-bottom:10px}.modal-configuration-sms .ant-modal-body{padding-top:0px}.phones-mult .ant-popover-content .ant-popover-inner{overflow:auto;max-height:250px}.phones-mult .ant-popover-content .ant-popover-inner::-webkit-scrollbar{width:4px}.phone{cursor:pointer;color:#108ee9}.dateTime-send-sms{margin-left:19px;width:450px}.dateTime-send-sms .date-send-sms{margin-right:2%;width:50%}.dateTime-send-sms .time-send-sms{width:48%}.tooltip-message-tag{max-width:300px !important}.tooltip-message-tag .ant-tooltip-inner{background-color:#fff !important;color:rgba(0,0,0,.65) !important}.tooltip-message-tag .ant-tooltip-inner h4{border-radius:2px;border:1px solid #5e72e4;color:#5e72e4;width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;padding:0 5px}.tooltip-message-tag .ant-tooltip-arrow{border-left-color:#fff !important;border-right-color:#fff !important}.notisetting-wrapper{height:100%}.notisetting-wrapper .setting-card{margin-bottom:20px;border-radius:2px;overflow:overlay;background-color:#fff}.notisetting-wrapper .setting-box{border:1px solid #d9d9d9;border-radius:2px}.notisetting-wrapper .setting-title{background-color:#f5f5f5;padding:10px;color:#000;font-size:15px;font-weight:500;border-top-left-radius:2px;border-top-right-radius:2px}.notisetting-wrapper .notisetting-table{overflow-x:auto;min-width:500px}.notisetting-wrapper .notisetting-table strong{margin-left:20px}.notisetting-wrapper .notisetting-table .notisetting-thead{display:flex;padding-bottom:10px;font-weight:600;font-size:14px}.notisetting-wrapper .notisetting-table ul li{display:flex;border-bottom:1px solid #f0f0f0;padding:15px 0}.notisetting-wrapper .notisetting-table ul li:first-child{border-top:1px solid #d9d9d9}.notisetting-wrapper .notisetting-table .col-first,.notisetting-wrapper .notisetting-table .col-second,.notisetting-wrapper .notisetting-table .col-action{display:flex;justify-content:center}.notisetting-wrapper .notisetting-table .col-first{width:10%;align-items:center}.notisetting-wrapper .notisetting-table .col-second{width:20%;align-items:center;font-size:14px;font-weight:600}.notisetting-wrapper .notisetting-table .col-third{display:flex;width:55%;justify-content:left;align-items:center}.notisetting-wrapper .notisetting-table .first{width:5% !important}.notisetting-wrapper .notisetting-table .second{width:15% !important}.notisetting-wrapper .notisetting-table .third{width:40% !important}.notisetting-wrapper .notisetting-table .fourth{width:20% !important}.notisetting-wrapper .notisetting-table .last{width:10% !important}.notisetting-wrapper .notisetting-table .col-action{width:15%;align-items:center}.notisetting-wrapper .notisetting-table .col-action .action-delete:hover{border:1px solid #f46e65}.notisetting-wrapper .notisetting-table .col-action .action-delete:hover .anticon-delete{color:#f46e65}.notisetting-wrapper .notisetting-table .auto-send-event{padding-bottom:15px}"}()},81138:function(e){!function(){"use strict";e.exports='.box-auto-complete{margin-bottom:5px}.box-auto-complete .ant-select-search__field__wrap input.ant-input{padding-right:32px;border-radius:2px !important}.box-auto-complete .ant-select-search__field__wrap input.ant-input .ant-input-suffix{right:14px}.box-auto-complete-custom .ant-select-search__field__wrap input.ant-input{border-radius:20px !important}.box-auto-complete-custom .ant-select-search__field__wrap .ant-input-affix-wrapper{border-radius:20px}.dropdown-box-customer-select.ant-select-dropdown{min-width:550px}.dropdown-box-customer-select.ant-select-dropdown ul .li-customer-info{flex-direction:column !important}.dropdown-box-customer-select.ant-select-dropdown ul .li-customer-info .form-customer-identical{display:flex;align-items:center;margin-bottom:4px}.dropdown-box-customer-select.ant-select-dropdown ul li{border-bottom:1px dashed #e9e9e9}.dropdown-box-customer-select.ant-select-dropdown ul li:last-child{border-bottom:none}.dropdown-box-customer-select.ant-select-dropdown ul li .item-name{display:inline-block;margin-bottom:-5px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-box-customer-select.ant-select-dropdown ul li .item-info-address{display:inline-block;margin-bottom:-5px;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.dropdown-box-customer-select.ant-select-dropdown ul li .item-phone-number{display:inline-block;width:100%}.dropdown-box-customer-select.ant-select-dropdown ul li .item-remain-warehouse-quantity{display:inline-block;width:40%;margin-left:15px}.dropdown-box-customer-select.ant-select-dropdown ul li .item-remain-price{display:inline-block;width:40%;margin-left:15px}.dropdown-box-customer-select.ant-select-dropdown ul li .item-remain-price .dollar-sign:before{content:"$"}.dropdown-box-customer-select-custom.ant-select-dropdown{min-width:250px !important}'}()},57897:function(e){!function(){"use strict";e.exports=".tags-modal .ant-modal-body{background:#f5f5f5}.tags-modal .ant-modal-body .flex-between{display:flex;justify-content:space-between;align-items:center}.tags-modal .ant-modal-body .tag-items{background:#fff;border:1px solid #d9d9d9;overflow:auto;max-height:66vh}.tags-modal .ant-modal-body .tag-items .tag-item{padding:8px 12px;border-bottom:1px solid #d9d9d9;cursor:pointer}.tags-modal .ant-modal-body .tag-items .tag-item .actions{display:none}.tags-modal .ant-modal-body .tag-items .tag-item:hover{background:#f0f5ff}.tags-modal .ant-modal-body .tag-items .tag-item:hover .actions{display:block}.tags-modal .ant-modal-body .tag-items .tag-item:last-child{border-bottom:none}"}()},7026:function(e){!function(){"use strict";e.exports=".cc-custom .ant-select-selector{display:flex;align-items:center;border-bottom:none !important}.cc-custom .ant-select-selection-item{height:100%}.bd-dp{width:100%;box-shadow:none;border:none;padding:5px}.update-multi-assigned_user .ant-modal-close{display:none}.customer-creator-modal .ant-modal-body{padding:0 16px}.customer-creator-modal .info-item{display:flex;align-items:center;justify-content:center;padding:5px 0;border-top:1px solid #d9d9d9}.customer-creator-modal .info-item .anticon{margin-right:5px;font-size:14px}.customer-creator-modal .info-item .ant-input,.customer-creator-modal .info-item .ant-select-selection{border:none;height:38px}.customer-creator-modal .info-item .ant-input .ant-select-selection__rendered,.customer-creator-modal .info-item .ant-select-selection .ant-select-selection__rendered{padding-top:5px}.customer-creator-modal .info-item .ant-input:focus,.customer-creator-modal .info-item .ant-select-selection:focus{box-shadow:none;border:none}.customer-creator-modal .info-item .ant-calendar-picker-icon{display:none}.popover-filter-by-time .ant-popover-inner-content{padding:0px 16px 10px 16px;background-color:#ededed}.popover-filter-by-time .ant-popover-inner-content .filter-time{background-color:#fff;border-radius:2px;padding:10px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15)}.popover-filter-by-time .ant-popover-inner-content .filter-time .filter-type{margin-bottom:10px}.popover-filter-by-time .ant-popover-inner-content .filter-time .filter-birthday{display:flex;flex-direction:column;margin:0 auto}.popover-filter-by-time .ant-popover-inner-content .filter-time .filter-birthday .btn-save .ant-btn{border-radius:2px}.popover-filter-by-time .ant-popover-inner-content .filter-time .ant-select .ant-select-selection{border-radius:2px !important}.popover-filter-by-time .ant-popover-inner-content .filter-time .filter-incurred-order{text-align:center}.popover-filter-by-time .ant-popover-inner-content .filter-time .filter-incurred-order .ant-picker-range{width:100%}.popover-filter-by-time .ant-popover-title{border-bottom:unset;background-color:#ededed}.popover-filter-by-time .ant-popover-title .ant-tabs-bar .ant-tabs-tab-active{background-color:#ededed}.customer-export-modal .ant-modal-body{background-color:#ededed}.customer-export-modal .ant-modal-body .modal-content{background-color:#fff;padding:10px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);border-radius:2px !important}.customer-export-modal .ant-radio-group{margin-left:16px}.customer-export-modal .ant-checkbox-group{margin-left:16px;margin-bottom:16px;display:flex}.customer-export-modal .ant-checkbox-group .ant-checkbox-group-item{flex:1;margin-right:0px}.customer-export-modal .header{margin-bottom:10px;margin-top:10px;font-weight:500}.container-layout .sale-form{margin-right:10px}.container-layout .content-body{margin-top:10px}.container-layout .content-body .ant-table-header{padding-right:0 !important}.container-layout .content-body .ant-table-body .ant-table-row{cursor:pointer}.ant-cascader-menu{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;overflow:auto}"}()},22701:function(e,t,n){var o=n(55639),s=n(79833),r=/^\s+/,a=o.parseInt;e.exports=function(e,t,n){return n||null==t?t=0:t&&(t=+t),a(s(e).replace(r,""),t||0)}},26021:function(e,t,n){"use strict";var o,s=n(17669),r=n(51024),a=n(28140),i=n(74047),l=n(52700),c=n(4706),u=n(33814),d=n(44102),p=n(20775),m=n(26265),h=n(23279),f=n.n(h),g=n(67294),v=n(14494),y=n(59271),_=n(7085),b=n(76570),C=n(87217),w=n(81138),S=n.n(w),k=n(9669),x=n.n(k),Z=n(95213),T=n(20920),I=n(50916),O=g.createElement;function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,p.Z)(e);if(t){var s=(0,p.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,d.Z)(this,n)}}var M=(0,C.Z)()(o=function(e){(0,u.Z)(n,e);var t=E(n);function n(e){var o;return(0,i.Z)(this,n),o=t.call(this,e),(0,m.Z)((0,c.Z)(o),"renderAutoCompleteDataSource",(function(){var e=o.props,t=e.searchResult,n=e.t;return(0,a.Z)(t).map((function(e){var t=e.fb_id,s=e.id,r=e.name,a=e.prefix,i=(e.disabled,e.shop_customer),l=null;return i&&i.shop_customer_addresses&&i.shop_customer_addresses.length>0&&i.shop_customer_addresses.map((function(e,t){null==l&&e.full_address&&(l=t)})),{label:O("div",{style:{width:"100%"}},a||null,O("div",{className:"item-name"},!a&&O(I.Z,{avatar_url:(0,T.E$)(e,o.props.accessToken),id:t,name:r,size:[20,20],seed:s}),O("strong",{style:{marginLeft:5}},r)),i&&O("div",null,O("span",{className:"item-info-address"},O(y.Z,null),"\xa0",O("span",{style:{color:"#096dd9"}},l?i.shop_customer_addresses[l].full_address:n("components.customerSearchBar.noInfoAddress"))),O("span",{className:"item-phone-number"},i&&O("div",{style:{borderLeft:"2px solid #ff3860",paddingLeft:5}},n("containers.customerInfo.purchased"),": ",i.order_count," ",n("containers.customerInfo.count"),O("br",null),i.phone_numbers[0]?"".concat(n("phoneNumber"),": ").concat(i.phone_numbers[0]):"")))),value:i?i.id:s}}))})),(0,m.Z)((0,c.Z)(o),"sendSearchCustomerRequest",(function(e){if(""===e||void 0!==e.target)return o.setState({loading:!1});e=e.replace(/\n/g,"");var t=o.props,n=t.accessToken,s=t.shopId,r=t.t,i="".concat((0,Z.LpH)(),"/shops/").concat(s,"/customers?autocomplete=true&include_pages=true&access_token=").concat(n,"&search=").concat(e);x().get(i).then((function(e){if(e.data&&!0===e.data.success){var t=(0,a.Z)(e.data.data);return 0===t.length&&t.push({id:"no-result",name:r("components.customerSearchBar.noResultWereFound"),prefix:"! ",disabled:!0,shop_customer:null,fb_id:null,global_id:null}),o.props.callback(t),o.setState({loading:!1})}}))})),(0,m.Z)((0,c.Z)(o),"handleInputSearchChange",(function(e){var t=e&&e.target?e.target.value:e;o.setState({searchTerm:t})})),(0,m.Z)((0,c.Z)(o),"onSearch",(function(e){var t=e&&e.target?e.target.value:e;o.setState({loading:!0}),o.sendSearchCustomerRequest(t)})),o.state={searchTerm:"",loading:!1},o.sendSearchCustomerRequest=f()(o.sendSearchCustomerRequest.bind((0,c.Z)(o)),400),o}return(0,l.Z)(n,[{key:"handleOnSelect",value:function(e){this.setState({searchTerm:""}),this.props.callback([]),this.props.onSelect(e)}},{key:"render",value:function(){var e=this.state,t=e.searchTerm,n=e.loading,o=this.props,a=o.t,i=o.customStyle;return O("div",{className:"box-auto-complete ".concat(void 0!=i&&i?"box-auto-complete-custom":"")},O(s.Z,{className:"global-search",value:t,style:{width:"100%"},onChange:this.handleInputSearchChange.bind(this),onSearch:this.onSearch,placeholder:a("components.customerSearchBar.enterCustomerNameOrPhoneNumber"),options:this.renderAutoCompleteDataSource(),onSelect:this.handleOnSelect.bind(this),dropdownClassName:"dropdown-box-customer-select ".concat(void 0!=i&&i?"dropdown-box-customer-select-custom":"")},O(r.default,{suffix:O("span",null,O(n?_.Z:b.Z,null))})),O("style",{dangerouslySetInnerHTML:{__html:S()}}))}}]),n}(g.Component))||o;t.Z=(0,v.$j)((function(e){return{currentShop:e.shop.currentShop}}))(M)},43831:function(e,t,n){"use strict";var o,s=n(56697),r=n(28140),a=n(51024),i=n(65400),l=n(74047),c=n(52700),u=n(4706),d=n(33814),p=n(44102),m=n(20775),h=n(26265),f=n(67294),g=n(49101),v=n(92104),y=n(91816),_=n(63258),b=n(8212),C=n(73171),w=n(95642),S=n(87217),k=n(31731),x=n(57897),Z=n.n(x),T=n(14104),I=f.createElement;function O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?O(Object(n),!0).forEach((function(t){(0,h.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,m.Z)(e);if(t){var s=(0,m.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,p.Z)(this,n)}}var D=(0,S.Z)()(o=function(e){(0,d.Z)(n,e);var t=M(n);function n(e){var o;return(0,l.Z)(this,n),o=t.call(this,e),(0,h.Z)((0,u.Z)(o),"renderModalContent",(function(){var e=o.props,t=e.tags,n=e.t,s=o.state.action;return I("div",null,I("div",{className:"flex-between",style:{marginBottom:16,fontWeight:500}},I("div",null,n("pages.shop.actionTools.totalTags"),": ",t.length),I(i.default,{icon:I(g.Z,null),type:"primary",onClick:function(){return o.handleAction("create")},disabled:"create"==s},n("components.productCategory.create"))),"create"==s&&o.renderUpdateItem(),(null===t||void 0===t?void 0:t.length)>0&&I("div",{className:"tag-items"},t.map(o.renderTagItem)))})),(0,h.Z)((0,u.Z)(o),"onNameChange",(function(e){var t=o.state.selectTag;t.name=e.target.value,o.setState({selectTag:t})})),(0,h.Z)((0,u.Z)(o),"handleAction",(function(e,t){var n={name:""};"create"!=e&&(n.id=t.id,n.name=t.name,n.description=t.description),"delete"==e&&(n.is_removed=!0),"delete"!=e&&setTimeout((function(){var e;return null===(e=o.input)||void 0===e?void 0:e.focus()})),o.setState({selectTag:n,action:e})})),(0,h.Z)((0,u.Z)(o),"handleSave",(function(){var e=o.props,t=e.t,n=e.deleteData,s=e.createData,r=e.updateData,a=o.state,i=a.selectTag,l=a.isLoading,c=a.action;if(!i.name)return message.warning(t("components.productCategory.nameTagNotEmpty"));l||(o.setState({isLoading:!0}),"create"!=c?"update"!=c?"delete"!=c||n&&n(i).then((function(e){o.setState({selectTag:{},isLoading:!1,action:""})})):r&&r(i).then((function(e){o.setState({selectTag:{},isLoading:!1,action:""})})):s&&s(i).then((function(e){o.setState({selectTag:{},isLoading:!1,action:""})})))})),(0,h.Z)((0,u.Z)(o),"renderUpdateItem",(function(){var e=o.state,t=e.selectTag,n=e.isLoading,s=e.action,r=o.props,l=r.t,c=r.showDescription;if(!t)return"";return I("div",null,I("div",{className:c?"":"flex-between",style:E({padding:"8px 12px",background:"#F0F5FF"},"create"==s?{border:"1px solid #ADC6FF",marginBottom:16,borderRadius:2}:{borderBottom:"1px solid #d9d9d9"})},I(a.default,{value:t.name,onChange:o.onNameChange,placeholder:"Nh\u1eadp t\xean th\u1ebb",style:{width:"100%",marginRight:12},ref:function(e){return o.input=e}}),c&&I("div",{style:{marginTop:10}},I("div",{style:{fontWeight:500}},l("crm.description")),I(T.default,{style:{marginTop:5},onChange:function(e){t.description=e.target.value,o.setState({selectTag:t})},value:null===t||void 0===t?void 0:t.description,rows:2,placeholder:l("crm.addDescription")})),I("div",{style:c?{display:"flex",justifyContent:"end",marginTop:10}:{display:"flex"}},I(i.default,{onClick:function(e){e.stopPropagation(),o.setState({selectTag:{},action:""})},style:{marginRight:12},disabled:n},l("cancel")),I(i.default,{loading:n,icon:I(v.Z,null),onClick:o.handleSave,type:"primary"},l("pages.shop.setting.application.save")))))})),(0,h.Z)((0,u.Z)(o),"handleClickItem",(function(e,t){t=t.includes(e.id)?t.filter((function(t){return t!=e.id})):[].concat((0,r.Z)(t),[e.id]),o.setState({openingDescriptionIds:t})})),(0,h.Z)((0,u.Z)(o),"handleEdit",(function(e,t,n){e.stopPropagation(),o.handleAction(t,n)})),(0,h.Z)((0,u.Z)(o),"renderTagItem",(function(e,t){var n=o.state,s=n.action,r=n.selectTag,a=n.isLoading,l=n.openingDescriptionIds,c=o.props,u=c.t,d=c.showDescription,p=e.id==r.id;if("update"==s&&p)return o.renderUpdateItem();var m={};"delete"==s&&p&&(m={background:"#FFF1F0"});var h=d&&l.includes(e.id);return I("div",{className:"tag-item",key:t,style:m},I("div",{onClick:function(){return d&&o.handleClickItem(e,l)}},I("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},I("div",null,d&&I("span",null,I(h?y.Z:_.Z,{style:{fontSize:14,marginRight:5}})),e.name),!s&&I("div",{className:"actions"},I(b.Z,{style:{marginRight:10},onClick:function(t){return o.handleEdit(t,"update",e)}}),I(C.Z,{onClick:function(){return o.handleAction("delete",e)}}))),h&&I("div",null,I("span",{style:{fontWeight:500}},u("crm.description"),": "),e.description||u("pages.shop.customer.notYet"))),"delete"==s&&p&&I("div",{className:"flex-between",style:{borderTop:"1px solid #FFA39E",paddingTop:8,marginTop:8}},I("div",null,I("div",null,"B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n x\xf3a ?")),I("div",null,I(i.default,{onClick:function(e){e.stopPropagation(),o.setState({selectTag:{},action:""})},style:{marginRight:12}},u("cancel")),I(i.default,{onClick:o.handleSave,icon:I(C.Z,null),type:"danger",loading:a},u("delete")))))})),o.state={visible:!1,action:"",selectTag:{},isLoading:!1,openingDescriptionIds:[]},o}return(0,c.Z)(n,[{key:"render",value:function(){var e=this,t=this.state.visible,n=this.props,o=n.title,r=n.isButton;return I("div",null,I(k.Z,{icon:I(w.Z,null),title:o,onClick:function(){return e.setState({visible:!0})},isButton:r}),I(s.Z,{visible:t,title:o,onCancel:function(){e.setState({visible:!1,action:"",selectTag:{}})},width:900,footer:!1,className:"tags-modal"},this.renderModalContent()),I("style",{dangerouslySetInnerHTML:{__html:Z()}}))}}]),n}(f.Component))||o;t.Z=D},74229:function(e,t,n){"use strict";var o=n(89552),s=n(67294),r=n(7085),a=s.createElement;t.Z=function(){return a("div",{className:"spinner"},a(o.default,{indicator:a(r.Z,{style:{fontSize:40}})}))}},71349:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return An}});var o,s=n(56697),r=n(65400),a=n(51024),i=n(28140),l=n(82891),c=n(12386),u=n(11187),d=n(59361),p=n(32292),m=n(94055),h=n(809),f=n.n(h),g=n(92447),v=n(74047),y=n(4706),_=n(52700),b=n(33814),C=n(44102),w=n(20775),S=n(26265),k=n(64713),x=n(64749),Z=n(18446),T=n.n(Z),I=n(89734),O=n.n(I),E=n(22701),M=n.n(E),D=n(50361),R=n.n(D),P=n(13311),N=n.n(P),L=n(23279),B=n.n(L),j=n(65988),F=n(67294),A=n(17887),z=n(2877),U=n(48176),V=n(50161),H=n(90631),K=n(27053),Y=n(95642),q=n(73171),W=n(64302),G=n(3157),Q=n(24616),J=n(89366),$=n(56931),X=n(57254),ee=n(25592),te=n(76570),ne=n(7026),oe=n.n(ne),se=n(50916),re=n(40987),ae=n(74806),ie=n(31059),le=n(54061),ce=n.n(le),ue=n(78598),de=n(7085),pe=n(79508),me=n(54549),he=n(31731),fe=n(95213),ge=n(22318),ve=n(87217),ye=n(9669),_e=n.n(ye),be=n(30381),Ce=n.n(be),we=F.createElement;function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var Ze,Te=(0,ve.Z)()(o=function(e){(0,b.Z)(n,e);var t=xe(n);function n(e){var o;(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"customerOptions",[{label:o.props.t("components.customerExportExcel.facebook"),value:"online"},{label:o.props.t("components.customerExportExcel.offline"),value:"offline"}]),(0,S.Z)((0,y.Z)(o),"content",(function(){var e=o.state.checkedFieldList,t=o.props,n=t.t,s=t.currentShop;return we(ie.default.Group,{value:e,onChange:function(e){return o.setState({checkedFieldList:e},(function(){return localStorage.setItem("customerExportExcel",JSON.stringify(e))}))}},we("div",{style:{display:"grid",flex:1}},we(ie.default,{value:"id"},"FB ID"),we(ie.default,{value:"purchased_amount"},n("containers.customerInfo.spent")),we(ie.default,{value:"assigned_user"},n("containers.formBoxModal.processedBy")),we(ie.default,{value:"name"},n("components.customerExportExcel.name")),we(ie.default,{value:"notes"},n("notes")),we(ie.default,{value:"tags_customer"},n("containers.customerInfo.tagCustomer")),we(ie.default,{value:"reward_point"},n("systemLogs.shops.reward_point_settings")),s.show_email_order&&we(ie.default,{value:"email"},"Email")),we("div",{style:{display:"grid",flex:1}},we(ie.default,{value:"phone_numbers"},n("phoneNumber")),we(ie.default,{value:"purchased"},n("components.numberOfPurchases")),we(ie.default,{value:"last_order_at"},n("pages.shop.customer.lastOrderAt")),we(ie.default,{value:"birthday"},n("pages.shop.customer.birthday")),we(ie.default,{value:"customer_level"},n("components.customerLevel")),we(ie.default,{value:"inserted_at"},n("pages.shop.customer.insertedAt")),we(ie.default,{value:"succeed_order_count"},"S\u1ed1 \u0111\u01a1n \u0111\xe3 nh\u1eadn")))})),(0,S.Z)((0,y.Z)(o),"handleDownload",(0,g.Z)(f().mark((function e(){var t,n,s,r,a,i,l,c,u,d,p,m,h,g,v,y,_,b,C,w,S,k,x,Z,T,I,O,E,M;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.props,n=t.selectedRowKeys,s=t.shopId,r=t.t,a=t.params,i=t.timezone,l=t.users,c=t.selectedCustomers,u=t.accessToken,d=o.state,p=d.checkedCustomerList,m=d.exportType,h=d.optSwitch,g=o.state.checkedFieldList.filter((function(e){return"purchased"!=e})),v=[],y=0,o.setState({isLoading:!0,isDownloading:!0}),_=R()(a),b="".concat((0,fe.LpH)(),"/shops/").concat(s,"/customers/get_customers?access_token=").concat(u),C=["start_time_inserted_at","end_time_inserted_at","start_time_incurred_order","end_time_incurred_order"],_&&C.map((function(e){_[e]&&(_[e]=Ce()(_[e]).unix())})),w=ke(ke({},_),{},{page:-1,page_size:500,typeCustomer:1==p.length?p[0]:void 0}),S=function e(t){return _e().post(b,t).then((function(n){var s=n.data.data;return y+=s.length,v=s.concat(v),o.setState({length:y,total:n.data.total_entries}),0==s.length?v:n.data.scroll_id?(t.scroll_id=n.data.scroll_id,e(t)):void 0})).catch((function(e){ge.Z.error(r("components.customerExportExcel.failure"),r("components.customerExportExcel.errorExportFile")),o.setState({isLoading:!1,isDownloading:!1})}))},!n.length){e.next=17;break}v=c,o.setState({length:c.length,total:c.length}),e.next=19;break;case 17:return e.next=19,S(w).then((function(e){v=e}));case 19:k=v.map((function(e){var t,n={};if(g.includes("id")&&e.id&&(n.FBID=e.psid?e.psid.split("_").reverse()[0]:""),g.includes("name")&&e.name&&(n[r("components.customerExportExcel.fullName")]=e.name),g.includes("phone_numbers")&&e.shop_customer.phone_numbers&&(n[r("phoneNumber")]=e.shop_customer.phone_numbers.join(", ").toString()),g.includes("birthday")&&e.shop_customer.date_of_birth&&(n[r("pages.shop.customer.birthday")]=(0,fe.o0x)(i||7,e.shop_customer.date_of_birth,!1,"DD/MM/YYYY")),g.includes("order_count")&&e.shop_customer.order_count&&(n[r("components.numberOfPurchases")]=e.shop_customer.order_count),g.includes("purchased_amount")&&e.shop_customer.purchased_amount&&(n[r("containers.customerInfo.spent")]=e.shop_customer.purchased_amount),g.includes("notes")&&(n["Ghi ch\xfa"]=e.psid?e.page_notes&&e.page_notes.length?e.page_notes.map((function(e){return e.message})).join(" ;"):"Kh\xf4ng c\xf3 ghi ch\xfa":e.shop_customer.notes&&e.shop_customer.notes.length?e.shop_customer.notes.map((function(e){return e.message})).join("; "):"Kh\xf4ng c\xf3 ghi ch\xfa"),g.includes("purchased")&&(n["S\u1ed1 l\u1ea7n mua h\xe0ng"]=e.shop_customer.order_count),g.includes("customer_level")&&e.shop_customer.level&&(n["C\u1ea5p \u0111\u1ed9 kh\xe1ch h\xe0ng"]=e.shop_customer.level.name),g.includes("tags_customer")&&e.shop_customer.tags&&0!==e.shop_customer.tags.length&&(n[r("containers.customerInfo.tagCustomer")]=e.shop_customer.tags.join(", ").toString()),g.includes("assigned_user")&&e.shop_customer.assigned_user_id){var o,s=l.find((function(t){return t.user_id==e.shop_customer.assigned_user_id}))||{};s&&(n[r("containers.formBoxModal.processedBy")]=null===(o=s.user)||void 0===o?void 0:o.name)}return g.includes("reward_point")&&(n[r("systemLogs.shops.reward_point_settings")]=parseInt(e.shop_customer.reward_point||0)),g.includes("succeed_order_count")&&(n["S\u1ed1 \u0111\u01a1n \u0111\xe3 nh\u1eadn"]=e.shop_customer.succeed_order_count||0),g.includes("email")&&e.shop_customer.emails&&null!==(t=e.shop_customer.emails)&&void 0!==t&&t.length&&(n.Email=e.shop_customer.emails.join(", ").toString()),g.includes("last_order_at")&&e.shop_customer.last_order_at&&(n[r("pages.shop.customer.lastOrderAt")]=(0,fe.o0x)(i||7,e.shop_customer.last_order_at,!1,"DD/MM/YYYY")),g.includes("inserted_at")&&e.shop_customer.inserted_at&&(n[r("pages.shop.customer.insertedAt")]=(0,fe.o0x)(i||7,e.shop_customer.inserted_at,!1,"DD/MM/YYYY")),n})),x=[],h?v.forEach((function(e,t){var n=!0;if(0!==e.shop_customer.shop_customer_addresses.length&&e.shop_customer.shop_customer_addresses.forEach((function(e){e.full_address&&(n=!1)})),n)x.push(ke(ke({},k[t]),{},{"\u0110\u1ecba ch\u1ec9 kh\xe1ch h\xe0ng":"Kh\xf4ng c\xf3 \u0111\u1ecba ch\u1ec9","Ph\u01b0\u1eddng/x\xe3":"","Huy\u1ec7n":"","T\u1ec9nh/th\xe0nh":"Kh\xf4ng c\xf3 t\u1ec9nh/th\xe0nh"}));else{var o=0;e.shop_customer.shop_customer_addresses.forEach((function(e){if(e.full_address){var n=(e.address?e.full_address.replace("".concat(e.address,", "),""):e.full_address).split(",");n.length>3&&n.shift();var s={"\u0110\u1ecba ch\u1ec9 kh\xe1ch h\xe0ng":e.address||"Kh\xf4ng c\xf3 \u0111\u1ecba ch\u1ec9","Ph\u01b0\u1eddng/x\xe3":n[0],"Huy\u1ec7n":n[1],"T\u1ec9nh/th\xe0nh":n[2]};1==(o+=1)?x.push(ke(ke({},k[t]),s)):x.push(ke({},s))}}))}})):x=k,Z={},T=0,x.forEach((function(e){Object.keys(e).length>T&&(T=Object.keys(e).length,Z=e)})),"excel"==m?(I={SheetNames:[],Sheets:{}},(O=XLSX.utils.json_to_sheet(x))["!cols"]=Object.keys(Object.assign(x[0]||{},Z)).map((function(e){return"FBID"==e||"T\u1ec9nh/th\xe0nh"==e||"\u0110\u1ecba ch\u1ec9 kh\xe1ch h\xe0ng"==e?{wch:50}:{wch:30}})),"DataSheet 1",XLSX.utils.book_append_sheet(I,O,"DataSheet 1"),E=XLSX.write(I,{bookType:"xlsx",bookSST:!1,type:"binary"}),setTimeout((function(){o.setState({isLoading:!1,isDownloading:!1,length:0}),(0,ue.saveAs)(new Blob([(0,fe.$iI)(E)],{type:"application/octet-stream"}),"customers-".concat(s,".xlsx"))}),1e3)):(k=x.map((function(e){return ce()(e,(function(e,t,n){return e+"".concat(n,": ").concat(t,";")}),"")+"\n"})),M=new Blob(k,{type:"text/plain;charset=utf-8"}),setTimeout((function(){o.setState({isLoading:!1,isDownloading:!1,length:0}),(0,ue.saveAs)(M,"customers.txt")}),1e3));case 26:case"end":return e.stop()}}),e)})))),(0,S.Z)((0,y.Z)(o),"onChangeSwitch",(function(e){o.setState({optSwitch:e})})),(0,S.Z)((0,y.Z)(o),"renderModalTitle",(function(){var e=o.state.exportType;return we("div",{style:{display:"flex",padding:"8px 0px"}},we("div",null,"T\u1ea3i xu\u1ed1ng"),we(k.default.Group,{value:e,onChange:function(e){return o.setState({exportType:e.target.value})}},we(k.default,{value:"excel"},"Excel"),we(k.default,{value:"text"},"TXT")))}));var s=!e.isServer&&localStorage.getItem("customerExportExcel")?JSON.parse(localStorage.getItem("customerExportExcel")):["id","name","phone_numbers","date_of_birth","order_count","purchased_amount","notes","purchased","customer_level","tags_customer"];return o.state={modalVisible:!1,exportType:"excel",checkedFieldList:s,checkedCustomerList:["online","offline"],isLoading:!1,isDownloading:!1,length:0,timer:null,optSwitch:!1,total:0},o}return(0,_.Z)(n,[{key:"componentDidMount",value:function(){var e;(e=localStorage.getItem("customerExportExcel"))&&(e=JSON.parse(e),this.setState({checkedFieldList:e}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.modalVisible,o=t.checkedFieldList,a=t.checkedCustomerList,i=t.isLoading,l=t.isDownloading,c=t.length,u=t.total,d=this.props,p=d.t,m=d.isButton,h=d.title;return we("div",{style:{display:"inline"}},we(he.Z,{icon:we(H.Z,null),title:h,onClick:function(){return e.setState({modalVisible:!0})},isButton:m,tooltip:we("div",null,we("div",null,p("components.customerExportExcel.exportInfoCustomer")),we("div",{style:{color:"#f56a00"}},p("components.customerExportExcel.noteSelectInfoToExport")))}),n&&we(s.Z,{width:700,wrapClassName:"customer-export-modal",visible:n,onCancel:function(){return e.setState({modalVisible:!1})},maskClosable:!i,title:this.renderModalTitle(),footer:we("div",null,we(r.default,{className:"order-action-button",disabled:0==o.length||0==a.length||i||l,type:"primary",onClick:function(){return e.handleDownload()}},l?we(ae.default,{status:"active",style:{width:100},percent:Math.floor(100*c/u)}):we("span",null,we(l?de.Z:H.Z,null)," ",p("components.customerExportExcel.download"))))},we("div",{className:"modal-content"},we("div",{className:"header"},p("components.customerExportExcel.chooseInfoDownload")),this.content(),we("div",{className:"header"},p("components.customerExportExcel.filterByCustomer")),we(ie.default.Group,{options:this.customerOptions,value:a,onChange:function(t){return e.setState({checkedCustomerList:t})}}),we("div",{className:"header",style:{display:"flex",alignItems:"center"}},p("components.customerExportExcel.customerAddressInformation"),we("span",{style:{marginLeft:"10px",display:"flex"}},we(re.Z,{onChange:this.onChangeSwitch,checkedChildren:we(pe.Z,null),unCheckedChildren:we(me.Z,null)}))))))}}]),n}(F.Component))||o,Ie=n(88547),Oe=n(65644),Ee=n(74229),Me=n(14321),De=n(49101),Re=n(29985),Pe=n(14494),Ne=n(83049),Le=n(36934),Be=F.createElement;function je(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var Fe,Ae=x.default.Option,ze=k.default.Group,Ue=(0,ve.Z)()(Ze=function(e){(0,b.Z)(n,e);var t=je(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"createCustomer",(function(){o.setState({modalVisible:!1,name:"",phoneNumber:"",dateOfBirth:void 0});var e=o.props,t=e.accessToken,n=e.shopId,s=e.createCustomer,r=e.fetch,a=o.state;s(t,n,{name:a.name,phoneNumber:a.phoneNumber,createType:a.createType,dateOfBirth:a.dateOfBirth}).then((function(e){e&&r()}))})),(0,S.Z)((0,y.Z)(o),"onSelectBirthday",(function(e,t){var n=e?e.format("YYYY-MM-DD"):null;o.setState({dateOfBirth:n})})),o.state={modalVisible:!1,name:"",phoneNumber:"",dateOfBirth:void 0,createType:"update",assigned_user_id:void 0},o}return(0,_.Z)(n,[{key:"render",value:function(){var e=this,t=this.state,n=t.modalVisible,o=t.name,r=t.phoneNumber,i=t.createType,l=t.assigned_user_id,c=this.props,u=c.t,d=c.users,p={display:"block",height:"30px",lineHeight:"30px"};return Be("div",{style:{display:"inline"}},Be(Ne.Z,{title:u("components.customerCreator.createNewCustomer"),icon:Be(De.Z,null),color:"#096DD9",onClick:function(){return e.setState({modalVisible:!0})}}),n&&Be(s.Z,{visible:n,onCancel:function(){return e.setState({modalVisible:!1,name:"",phoneNumber:""})},title:u("components.customerCreator.addCustomer"),okText:u("components.customerCreator.create"),cancelText:u("components.customerCreator.cancel"),onOk:this.createCustomer,wrapClassName:"customer-creator-modal"},Be(ze,{onChange:function(t){return e.setState({createType:t.target.value})},value:i,style:{width:"100%",padding:"10px 0"}},Be(k.default,{style:p,value:"ignore"},u("components.customerCreator.ignore")),Be(k.default,{style:p,value:"update"},u("components.customerCreator.update")),Be(k.default,{style:p,value:"force"},u("components.customerCreator.force"))),Be("span",{className:"info-item"},Be(J.Z,null),Be(a.default,{placeholder:u("components.customerCreator.nameCustomer"),value:o,onChange:function(t){return e.setState({name:t.target.value})}})),Be("span",{className:"info-item"},Be(Re.Z,null),Be(a.default,{placeholder:u("phoneNumber"),value:r,onChange:function(t){return e.setState({phoneNumber:t.target.value})}})),Be("span",{className:"info-item",style:{display:"flex",justifyContent:"flex-start"}},Be($.Z,null),Be(Me.default,{className:"bd-dp",placeholder:u("pages.shop.customer.birthday"),style:{marginLeft:5},format:"DD/MM/YYYY",onChange:function(t,n){return e.onSelectBirthday(t,n)},disabledDate:function(e){return e&&e>Ce()().endOf("day")},defaultPickerValue:Ce()().add(-25,"years")})),Be("span",{className:"info-item",style:{display:"flex",justifyContent:"flex-start"}},Be(K.Z,null),Be(x.default,{className:"crm-select cc-custom",value:l,onChange:function(t){return e.setState({assigned_user_id:t})},placeholder:u("containers.formBoxModal.processedBy"),style:{width:"100%"}},d.map((function(e){return Be(Ae,{key:e.user_id,value:e.user_id},(0,fe.q$s)(e.user_id,d))}))))))}}]),n}(F.Component))||Ze,Ve=(0,Pe.$j)((function(e){return{users:e.user.users}}),{createCustomer:Le.wKm})(Ue),He=n(28465),Ke=n(4863),Ye=n(45578),qe=n.n(Ye),We=n(35161),Ge=n.n(We),Qe=n(8212),Je=n(74634),$e=n(24557),Xe=n(54977),et=n(22263),tt=F.createElement;function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function st(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var rt,at=x.default.Option,it=k.default.Group,lt={modalVisible:!1,isImporting:!1,customers:[],nameField:void 0,phoneField:void 0,emailsField:void 0,fileName:"",createType:"update",creatingInfo:[],purchaseFiled:void 0,fullAddressFiled:void 0,typeChangePurchased:"add",birthdayFiled:void 0,rewardPoint:void 0,typeChangeRewardPoint:"add",typeChangeEmail:"add",note:void 0,orderCount:void 0,typeChangeOrderCount:"add",tagsCustomer:void 0},ct=["tinh","tinh/thanh","tinh thanh"],ut=["quan","huyen","quan huyen","quan/huyen","huyen/quan"],dt=["xa","phuong","phuong/xa","xa/phuong"],pt=(0,ve.Z)()(Fe=function(e){(0,b.Z)(n,e);var t=st(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"sendRequest",function(){var e=(0,g.Z)(f().mark((function e(t){var n,s,r,a,l,c,u,d,p,m,h,g,v,y,_,b,C,w,S,k,x,Z,T,I,O,E,M,D,R,P,N,L,B,j,F,A,z,U,V,H,K,Y;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0==t&&o.setState({isImporting:!0}),t!=o.state.customers.length){e.next=3;break}return e.abrupt("return");case 3:return l=o.props,c=l.accessToken,u=l.shopId,d=l.t,p=l.shop,m=o.state,h=m.createType,g=m.customers,v=m.phoneField,y=m.nameField,_=m.creatingInfo,b=m.purchaseFiled,C=m.fullAddressFiled,w=m.tagsCustomer,S=m.typeChangePurchased,k=m.birthdayFiled,x=m.rewardPoint,Z=m.typeChangeRewardPoint,T=m.orderCount,I=m.typeChangeOrderCount,O=m.note,E=m.emailsField,M=m.typeChangeEmail,D=g[t][y],R=(0,fe.SRG)(g[t][v],!1,p.country_code),P=g[t][b],N=g[t][C],L=null,B=null,j=null,Object.keys(g[t]).map((function(e){var n=null===e||void 0===e?void 0:e.toString().split(" ").join("");ct.includes((0,fe.Mle)(n))&&(L=g[t][e]),ut.includes((0,fe.Mle)(n))&&(B=g[t][e]),dt.includes((0,fe.Mle)(n))&&(j=g[t][e])})),F=g[t][O],A=g[t][x],z=g[t][T],U=(null===g||void 0===g?void 0:g.length)>0&&(null===(n=g[t][w])||void 0===n||null===(s=n.toString())||void 0===s?void 0:s.split(";").map((function(e){return e.trim()})))||[],V=[g||[]].length>0&&(null===(r=g[t][E])||void 0===r||null===(a=r.toString())||void 0===a?void 0:a.split(";").map((function(e){return e.trim()})))||[],H=(0,fe._MS)(g[t][k],p.timezone),K={customer:{name:D,phoneNumber:R}},Y="".concat((0,fe.LpH)(),"/shops/").concat(u,"/customers?access_token=").concat(c),"import",e.next=22,_e().post(Y,{name:D,phoneNumber:R,createType:h,purchaseAmount:P,fullAddress:N,typeChangePurchased:S,dateOfBirth:H,province:L,district:B,commune:j,point:A,type:"import",typeChangeRewardPoint:Z,countOrder:z,typeChangeOrderCount:I,note:F,timezone:p.timezone,tags:U,emails:V,typeChangeEmail:M}).then((function(e){e.data.success&&(K.success=!0,K.message=d("success"))})).catch((function(e){K.success=!1,K.message=d("action.unknownError"),e.response&&e.response.data&&(K.message=e.response.data.message)}));case 22:(_=(0,i.Z)(_)).push(K),o.setState({creatingInfo:_},(function(){return o.sendRequest(t+1)}));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,S.Z)((0,y.Z)(o),"onDrop",(function(e){var t=e.file;o.setState({fileName:t.name});var n=o.props.t,s=new FileReader;s.readAsBinaryString(t),s.onload=function(e){var t=e.target.result,s=XLSX.read(t,{type:"binary",cellDates:!0}),r=s.SheetNames[0],a=XLSX.utils.sheet_to_json(s.Sheets[r],{raw:!0});if(0!=a.length){var i=void 0,l=void 0,c=void 0,u=void 0,d=void 0;Ge()(a[0],(function(e,t){(0,fe.xT2)(e)&&(l=t),(0,fe.X07)(e)&&(i=t),(0,fe.JhM)(e)&&(c=t),(0,fe.ik3)(e)&&(u=t),(0,fe.J_U)(e)&&(d=t)})),o.setState({customers:a,nameField:i,phoneField:l,emailsField:c,purchaseFiled:u,birthdayFiled:d})}else o.setState({fileName:""}),ge.Z.error(n("components.customerImportExecl.errorImportFile"),n("components.customerImportExecl.sheetEmpty"))}})),(0,S.Z)((0,y.Z)(o),"renderResult",(function(){return o.state.creatingInfo.map((function(e,t){if(null!=e.success)return tt("div",{key:t},tt("span",null,tt("strong",{className:e.success?"success":"fail"},"#".concat(e.customer.name,"-").concat(e.customer.phoneNumber,": "))),"\xa0",tt("span",{className:e.success?"success":"fail"},e.message))}))})),(0,S.Z)((0,y.Z)(o),"getModalContent",(function(){var e=o.state,t=e.isImporting,n=e.nameField,s=e.phoneField,a=e.customers,i=e.fileName,l=e.createType,c=e.creatingInfo,u=e.purchaseFiled,d=e.tagsCustomer,p=e.fullAddressFiled,m=e.birthdayFiled,h=e.rewardPoint,f=e.orderCount,g=e.note,v=e.typeChangeEmail,y=e.emailsField,_=o.props,b=_.t,C=_.shop,w=[];(a||[]).map((function(e){return Object.keys(e).map((function(e){return w.push(e)}))})),w=qe()(w);var S={display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:10,paddingTop:10,borderTop:"1px solid #d9d9d9",fontSize:14},Z={display:"block",height:"30px",lineHeight:"30px"},T=c.filter((function(e){return e.success})).length,I=a.length-T;return t?tt("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},tt(ae.default,{type:"circle",percent:Math.floor(100*c.length/a.length),style:{marginBottom:10}}),c.length==a.length?tt("h4",null,tt("span",{style:{color:"#00a854"}},"".concat(b("components.customerImportExecl.created")," ").concat(T," ").concat(b("customers.title").toLowerCase())),tt("span",{style:{color:"#f04134"}},"".concat(I>0?", ".concat(b("components.customerImportExecl.failure")," ").concat(I," ").concat(b("customers.title").toLowerCase()):""))):tt("div",null,tt("h4",{style:{color:"#096dd9"}},b("components.customerImportExecl.importingCustomerFromExcelFile"))),tt("div",{id:"updating-info",className:"updating-info"},o.renderResult())):tt("div",null,tt(Ke.default,{message:b("notes"),description:tt("div",{style:{fontSize:14}},tt("p",null," ",b("components.customerImportExecl.selectFileExcel")),tt("p",null," ",b("components.customerImportExecl.fileExcelHaveNotTitle")),tt("p",null," ",b("components.customerImportExecl.systemAutoDectecColumn"))),type:"warning",showIcon:!0}),tt(it,{onChange:function(e){return o.setState({createType:e.target.value})},value:l,style:{borderTop:"1px solid #d9d9d9",width:"100%",marginTop:10,paddingTop:10}},tt(k.default,{style:Z,value:"ignore"},b("components.customerImportExecl.ignore")),tt(k.default,{style:Z,value:"update"},b("components.customerImportExecl.update")),tt(k.default,{style:Z,value:"force"},b("components.customerImportExecl.force"))),tt("div",{style:S},tt("p",null,tt(J.Z,{style:{marginRight:10}}),b("components.customerImportExecl.nameCustomer")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({nameField:e})},value:n,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),tt("div",{style:S},tt("p",null,tt(Re.Z,{style:{marginRight:10}}),b("phoneNumber")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({phoneField:e})},value:s,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),tt("div",{style:S},tt("p",null,tt(W.Z,{style:{marginRight:10}}),"Email"),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({emailsField:e})},value:y,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),"update"==l&&y&&tt("div",{style:S},tt("p",null,tt(Qe.Z,{style:{marginRight:10}}),b("pages.shop.setting.change")," email"),tt(x.default,{style:{width:150},onChange:function(e){return o.setState({typeChangeEmail:e})},value:v},tt(at,{key:"replace",value:"replace"},b("components.customerImportExecl.replacePurchasedAmount")),tt(at,{key:"add",value:"add"},b("components.customerImportExecl.addFromExcel")))),tt("div",{style:S},tt("p",null,tt(Je.Z,{style:{marginRight:10}}),b("components.customerExportExcel.purchaseAmount")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({purchaseFiled:e})},value:u,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),u&&tt("div",{style:S},tt("p",null,tt(Qe.Z,{style:{marginRight:10}}),b("components.customerImportExecl.changePurchasedAmount")),tt(x.default,{style:{width:150},onChange:function(e){return o.setState({typeChangePurchased:e})},value:o.state.typeChangePurchased},tt(at,{key:"replace",value:"replace"},b("components.customerImportExecl.replacePurchasedAmount")),tt(at,{key:"add",value:"add"},b("components.customerImportExecl.addPurchasedAmount")))),tt("div",{style:S},tt("p",null,tt($e.Z,{style:{marginRight:10}}),b("address")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({fullAddressFiled:e})},value:p,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),tt("div",{style:S},tt("p",null,tt($.Z,{style:{marginRight:10}}),b("components.customerImportExecl.birthday")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({birthdayFiled:e})},value:m,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),tt("div",{style:S},tt("p",null,tt(Xe.Z,{style:{marginRight:10}}),b("components.customerImportExecl.note")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({note:e})},value:g,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),tt("div",{style:S},tt("p",null,tt(Xe.Z,{style:{marginRight:10}}),b("components.customerImportExecl.tagCustomer")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({tagsCustomer:e})},value:d,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),C.reward_point_settings&&"true"==C.reward_point_settings.enabled&&tt("div",{style:S},tt("p",null,tt(et.Z,{style:{marginRight:10}}),b("containers.formBox.rewardPoints")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({rewardPoint:e})},value:h,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),h&&tt("div",{style:S},tt("p",null,tt(Qe.Z,{style:{marginRight:10}}),"Thay \u0111\u1ed5i \u0111i\u1ec3m th\u01b0\u1edfng"),tt(x.default,{style:{width:150},onChange:function(e){return o.setState({typeChangeRewardPoint:e})},value:o.state.typeChangeRewardPoint},tt(at,{key:"replace",value:"replace"},b("components.customerImportExecl.replacePurchasedAmount")),tt(at,{key:"add",value:"add"},b("components.customerImportExecl.addPurchasedAmount")))),tt("div",{style:S},tt("p",null,tt(et.Z,{style:{marginRight:10}}),b("components.customerImportExecl.timesOfPurchase")),tt(x.default,{placeholder:b("components.customerImportExecl.titleCol"),style:{width:150},onChange:function(e){return o.setState({orderCount:e})},value:f,allowClear:!0},w.map((function(e,t){return tt(at,{key:t,value:e},e)})))),f&&tt("div",{style:S},tt("p",null,tt(Qe.Z,{style:{marginRight:10}}),"Thay \u0111\u1ed5i s\u1ed1 l\u1ea7n mua h\xe0ng"),tt(x.default,{style:{width:150},onChange:function(e){return o.setState({typeChangeOrderCount:e})},value:o.state.typeChangeOrderCount},tt(at,{key:"replace",value:"replace"},b("components.customerImportExecl.replacePurchasedAmount")),tt(at,{key:"add",value:"add"},b("components.customerImportExecl.addPurchasedAmount")))),tt("div",{style:S},tt(He.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:o.onDrop},tt(r.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},i?tt("span",null,tt(pe.Z,null)," ",i):tt("span",null,tt(U.Z,null)," ",b("components.customerImportExecl.selectFile")))),tt(r.default,{disabled:!i||!n||!s,type:"primary",onClick:function(){return o.sendRequest(0)}},b("start"))))})),o.state=ot({},lt),o}return(0,_.Z)(n,[{key:"render",value:function(){var e=this,t=this.state.modalVisible,n=this.props,o=n.t,r=n.title,a=n.isButton;return tt("div",{style:{display:"inline"}},tt(he.Z,{title:r,icon:tt(U.Z,null),color:"#00d1b2",onClick:function(){return e.setState({modalVisible:!0})},isButton:a}),t&&tt(s.Z,{visible:t,onCancel:function(){e.setState(ot({},lt)),e.state.creatingInfo.length>0&&e.props.fetch()},title:o("components.customerImportExecl.importCustomerFromExcelFile"),footer:null,wrapClassName:"modal-updating"},this.getModalContent()))}}]),n}(F.Component))||Fe,mt=n(92902),ht=n(31432),ft=n(20920),gt=n(65779),vt=n(48519),yt=F.createElement;function _t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var bt,Ct=s.Z.confirm,wt=(0,ve.Z)()(rt=function(e){(0,b.Z)(n,e);var t=_t(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"handleDelete",(function(){var e=o.props,t=e.accessToken,n=e.clearSelectedCustomers,s=e.shopId,r=e.selectedCustomerIds,a=e.fetchListOfCustomers,i=e.t,l="".concat((0,fe.LpH)(),"/shops/").concat(s,"/customers/delete_multi?access_token=").concat(t);_e()({method:"post",url:l,data:(0,fe.D$T)({customer_ids:r},null,null)}).then((function(e){if(200===e.status&&e.data){var t=e.data.data.reduce((function(e,t){return t.success&&e.push(t.id),e}),[]);a(),n(),ge.Z.success(i("success"),"".concat(i("components.productDeleteMutil.deleteSuccess")," ").concat(t.length," ").concat(i("customers.title")))}200!==e.status||e.data.success||ge.Z.error(i("error"),i("messageCode.".concat(e.data.message_code))||e.data.message)})).catch((function(e){console.log(e),ge.Z.error(i("error")),fe.s0o}))})),(0,S.Z)((0,y.Z)(o),"showDeleteConfirm",(function(){var e=o.props,t=e.selectedCustomerIds,n=e.t,s=t.length;Ct({title:"".concat(n("components.productDeleteMutil.wantToDeleteProduct")," ").concat(s," ").concat(n("components.productDeleteMutil.selectedCustomer"),"?"),okText:n("components.productDeleteMutil.agree"),okType:"danger",cancelText:n("components.productDeleteMutil.disagree"),onOk:function(){return o.handleDelete()}})})),o}return(0,_.Z)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.selectedCustomerIds,o=t.t,s=t.title,r=t.isButton,a=n.length;return yt("div",{style:{display:"inline"}},yt(he.Z,{title:s,icon:yt(q.Z,null),onClick:function(){return a>0&&e.showDeleteConfirm()},isButton:r,tooltip:a>0?"".concat(o("delete")," ").concat(a," ").concat(o("components.productDeleteMutil.selectedCustomer")):o("selectCustomerToDelete")}))}}]),n}(F.Component))||rt,St=(0,Pe.$j)((function(e){return{currentShop:(0,ht.tf)(e)}}))(wt),kt=n(50613),xt=n(2307),Zt=n(12528),Tt=n(62443),It=n(20838),Ot=n(22353),Et=n(21954),Mt=n.n(Et),Dt=n(26021),Rt=F.createElement;function Pt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Nt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pt(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Lt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var Bt,jt=x.default.Option,Ft=It.default.TabPane,At=a.default.TextArea,zt={page:1,page_size:20,search:null},Ut=(0,ve.Z)()(bt=function(e){(0,b.Z)(n,e);var t=Lt(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"fetchEventMessages",(0,g.Z)(f().mark((function e(){var t,n,s,r,a=arguments;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:zt,n=o.props,s=n.shopId,r=n.accessToken,o.setState({loadingEventMessage:!0}),t=Nt({},t),e.next=6,o.props.fetchEventMessages(s,r,t);case 6:o.setState({loadingEventMessage:!1});case 7:case"end":return e.stop()}}),e)})))),(0,S.Z)((0,y.Z)(o),"handleConfigurationSendSMS",(function(){var e=o.props,t=e.shopId,n=e.accessToken,s=e.t,r=e.currentShop,a=o.state,i=a.customers,l=a.datesSendEventMessage,c=a.eventMessages,d=a.sendNow,p=r.event_messages_sms.find((function(e,t){return t==c}));if(i&&i.length>0&&l&&p){var m={customers:i.map((function(e){return e.id})),message:p,send_date:l.toDate().toISOString(),send_now:d},h="".concat((0,fe.LpH)(),"/shops/").concat(t,"/customer_event_messages?access_token=").concat(n);return _e().post(h,{params:m}).then((function(e){200==e.status&&e.data.success&&(o.setState({modalVisible:!1,eventMessages:void 0,datesSendEventMessage:Ce()().utcOffset(parseInt(o.props.timezone)||7).add("30","minutes"),customers:[]}),o.props.clearSelectedCustomers(),u.default.success("C\u1ea5u h\xecnh g\u1eedi h\xe0ng lo\u1ea1t th\xe0nh c\xf4ng"))})).catch(fe.s0o)}null!==i&&void 0!==i&&i.length||u.default.error(Rt("span",null,0==i.length?s("components.configurationSendSMS.notHaveCustomer"):message?s("components.configurationSendSMS.notSelectedDate"):s("components.configurationSendSMS.notSelectedEventMessage")))})),(0,S.Z)((0,y.Z)(o),"handleFetchCustomer",(function(){var e=o.props,t=e.selectedCustomerIds,n=e.selectedCustomers;if(t&&t.length>0){var s=o.fetchPhoneNumer(n);o.setState({customers:s})}o.setState({modalVisible:!0})})),(0,S.Z)((0,y.Z)(o),"removeCustomer",(function(e){var t=o.state.customers,n=(0,i.Z)(t),s=n.findIndex((function(t){return t.id==e}));n.splice(s,1),o.setState({customers:n})})),(0,S.Z)((0,y.Z)(o),"renderPhoneNumnber",(function(e){return Rt("div",null,e.map((function(e){return Rt("div",null,Rt("p",null,e))})))})),(0,S.Z)((0,y.Z)(o),"fetchPhoneNumer",(function(e){var t=[];return e.map((function(e){(!e.shop_customer||!e.shop_customer.phone_numbers||e.shop_customer.phone_numbers.length>0)&&t.push(e)})),t})),(0,S.Z)((0,y.Z)(o),"renderListCustomer",(function(e){var t=e.shop_customer.phone_numbers,n=t.length-1;return Rt("div",{key:e.id,className:"item-order",style:{borderLeft:"1px solid",borderLeftColor:"#d9d9d9"}},Rt("div",{className:"close-div"},Rt(me.Z,{onClick:function(){return o.removeCustomer(e.id)}})),Rt("div",{className:"order-content"},Rt("span",null,e.name),t.length>1?Rt(Tt.default,{content:o.renderPhoneNumnber(t),trigger:"hover",placement:"top",overlayClassName:"phones-mult"},Rt("span",{className:"phone"},t[n])):Rt("span",{className:"phone"},t)))})),(0,S.Z)((0,y.Z)(o),"handleFetchAllCustomers",(function(){var e=o.props,t=e.shopId,n=e.accessToken;o.setState({isLoading:!0});var s=(0,i.Z)(o.state.fetchCustomers),r=R()(o.props.params);r&&["start_time_inserted_at","end_time_inserted_at","start_time_incurred_order","end_time_incurred_order"].map((function(e){r[e]&&(r[e]=Ce()(r[e]).unix())})),r=Nt(Nt({},zt),r);var a="".concat((0,fe.LpH)(),"/shops/").concat(t,"/customers?access_token=").concat(n),l=[];return function e(t){return _e()({method:"get",url:a,params:t}).then((function(n){if(n.data.success){var r=n.data.data;if((null===r||void 0===r?void 0:r.length)>0){var a=o.fetchPhoneNumer(r);return(null===a||void 0===a?void 0:a.length)>0&&(l=l.concat(a)),s=s.concat(r),o.setState({total_entries:n.data.total_entries,fetchCustomers:s}),n.data.page_number<n.data.total_pages?(t.page=t.page+1,e(t)):o.setState({customers:l,isLoading:!1})}return o.setState({customers:l,isLoading:!1})}return o.setState({customers:l,isLoading:!1})}))}(r)})),(0,S.Z)((0,y.Z)(o),"handleOnSelect",(function(e){var t=o.state,n=t.searchResultCustomer,s=t.customers,r=o.props.t,a=(0,i.Z)(s),l=n.find((function(t){return t.shop_customer.id==e}));l&&l.shop_customer&&l.shop_customer.phone_numbers&&l.shop_customer.phone_numbers.length>0?(l&&a.findIndex((function(e){return e.id==l.id})))<0?(a.push(l),o.setState({customers:a})):u.default.error(Rt("span",null,r("components.configurationSendSMS.hasCustomer"))):u.default.error(Rt("span",null,r("components.configurationSendSMS.selectedCustomerFailure")))})),(0,S.Z)((0,y.Z)(o),"handleSaveEventMessages",(function(){var e=o.props,t=e.t,n=e.currentShop,s=e.accessToken,r=e.shopId,a=o.state,i=a.contentEventMessage,l=a.titleEventMessage,c=a.methodSendMessage,d=a.zaloTemplate,p=a.smsType,m={active:!0,title:l,content:i,method_send_message:n.sms_account&&["sms","infotxt"].includes(n.sms_account.type)&&(n.zalo_account||n.sms_account.oaid)?c:n.sms_account&&["sms","infotxt"].includes(n.sms_account.type)&&!n.zalo_account?"1":"2",zalo_template:d,sms_type:p};if(!i&&"2"!=c||!l)return u.default.error(Rt("span",null,t(l?"pages.shop.setting.notification.noContentEventMessage":"pages.shop.setting.notification.noTitleEventMessage")));var h={event_messages_sms:(n.event_messages_sms||[]).concat(m)};o.props.updateSettingMessages(s,r,h,"event_messages_sms").then((function(){o.setState({contentEventMessage:"",titleEventMessage:"",addEventMessages:!1,methodSendMessage:"1",zaloTemplate:void 0,smsType:2})}))})),(0,S.Z)((0,y.Z)(o),"handleEditEventMessage",(function(e){var t=o.props,n=t.t,s=t.currentShop,r=t.accessToken,a=t.shopId,i=o.state,l=i.contentEventMessage,c=i.titleEventMessage,d=i.methodSendMessage,p=i.zaloTemplate,m=i.smsType,h=s.sms_account&&["sms","infotxt"].includes(s.sms_account.type)&&(s.zalo_account||s.sms_account.oaid)?d:s.sms_account&&["sms","infotxt"].includes(s.sms_account.type)&&!s.zalo_account?"1":"2",f=s.event_messages_sms||[];if(!f[e])return u.default.error("Kh\xf4ng t\xecm th\u1ea5y s\u1ef1 ki\u1ec7n");if(f[e]=Nt(Nt({},f[e]),{},{content:l,title:c,method_send_message:h,zalo_template:p,sms_type:m}),!l&&"2"!=d||!c)return u.default.error(Rt("span",null,n(c?"pages.shop.setting.notification.noContentEventMessage":"pages.shop.setting.notification.noTitleEventMessage")));var g={event_messages_sms:f};o.props.updateSettingMessages(r,a,g,"event_messages_sms").then((function(){o.setState({contentEventMessage:"",titleEventMessage:"",modalEventVisibale:!1,methodSendMessage:"1",zaloTemplate:void 0,modalEventIdx:null,smsType:2})}))})),(0,S.Z)((0,y.Z)(o),"renderDatePicker",(function(e){var t=o.props.t,n=o.state,s=n.datesSendEventMessage,r=n.sendNow;return Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}},!e&&Rt("span",{style:{marginTop:5,marginRight:10}},t("sendAppointment"),": "),Rt("div",{className:"dateTime-send-sms"},Rt(Me.default,{format:"DD-MM-YYYY",disabledDate:function(e){return e&&e.valueOf()<Ce()()},onChange:function(e){return o.setState({datesSendEventMessage:e})},value:s,className:"date-send-sms",disabled:r}),Rt(Zt.Z,{disabled:r,format:"HH:mm",className:"time-send-sms",value:s,disabledHours:function(){var e=[];if((null===s||void 0===s?void 0:s.year())==Ce()().year()&&(null===s||void 0===s?void 0:s.month())==Ce()().month()&&(null===s||void 0===s?void 0:s.day())==Ce()().days())for(var t=0;t<Ce()().hour();t++)e.push(t);return e},disabledMinutes:function(e){for(var t=[],n=0;n<60;n++)t.push(n);return e==Ce()().hour()?t.splice(0,Ce()().minute()):[]},onChange:function(e){return o.setState({datesSendEventMessage:e})}})))})),(0,S.Z)((0,y.Z)(o),"renderContentSendSMS",(function(){var e,t=o.props,n=t.t,s=t.currentShop,r=t.zaloTemplates,a=o.state,i=a.eventMessages,l=a.sendNow;return Rt("div",{className:"customer-send-sms-header"},i&&1==(null===(e=s.event_messages_sms[i])||void 0===e?void 0:e.sms_type)&&Rt("div",{style:{marginBottom:10}},Rt(Ke.default,{message:"G\u1eedi tin nh\u1eafn Qu\u1ea3ng c\xe1o c\u1ea7n t\xedch ch\u1ecdn g\u1eedi ngay v\xe0 c\u1ea7n t\u1ed1i thi\u1ec3u 30 kh\xe1ch h\xe0ng",type:"warning",showIcon:!0})),Rt("div",{style:Nt(Nt({},{display:"flex",flexDirection:"row",marginTop:10}),{},{marginTop:5})},Rt(ie.default,{checked:l,onChange:function(e){return o.setState({sendNow:e.target.checked})}},"G\u1eedi tin nh\u1eafn ngay sau khi t\u1ea1o")),o.renderDatePicker(),Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}},Rt("span",{style:{marginTop:5,marginRight:10}},n("components.configurationSendSMS.message"),":"),Rt(x.default,{style:{width:450,marginLeft:68},placeholder:n("components.configurationSendSMS.selectedEvent"),value:i,onChange:function(e){var t;1==(null===(t=s.event_messages_sms[e])||void 0===t?void 0:t.sms_type)?o.setState({eventMessages:e,sendNow:!0}):o.setState({eventMessages:e})}},s.event_messages_sms.map((function(e,t){var n=(r||[]).find((function(t){return e.zalo_template&&(t.templateId==e.zalo_template||t.TempId==e.zalo_template)}));return Rt(jt,{key:t,value:t,disabled:!e.active},Rt(m.default,{title:n?n.templateName||n.TempName||"":e.content,placement:"right",overlayClassName:"tooltip-message-tag"},Rt("p",null,e.title)))})))))})),(0,S.Z)((0,y.Z)(o),"getProgress",(function(){var e=o.state,t=e.total_entries,n=e.fetchCustomers;return t>0?Math.round(n.length/t*100):0})),(0,S.Z)((0,y.Z)(o),"renderSelectedCustomer",(function(){var e=o.props,t=e.t,n=e.shopId,s=e.accessToken,a=e.selectedCustomerIds,i=o.state,l=i.customers,c=i.isLoading,u=i.searchResultCustomer,d=i.getWidthCart;return Rt("div",{className:"scan-orders"},c?(null===a||void 0===a?void 0:a.length)>0?Rt("div",{style:{textAlign:"center"}},Rt("span",null,Rt(de.Z,null)," ",t("components.configurationSendSMS.loadingCustomer"))):Rt("div",{className:"customer-send-messages-content",style:{textAlign:"center"}},Rt(ae.default,{percent:o.getProgress(),style:{width:300,fontSize:16}})):Rt("div",null,Rt("div",{className:"title title-customer"},Rt("span",{style:{lineHeight:2.5}},Rt(pe.Z,null)," ",l?l.length:0," ",t("components.configurationSendSMS.customerFound")),Rt("span",{style:{width:"40%"}},Rt(Dt.Z,{accessToken:s,shopId:n,onSelect:o.handleOnSelect,searchResult:u,callback:function(e){return o.setState({searchResultCustomer:e})},customStyle:!0}))),Rt("div",{id:"virtualize-list-sms"},l&&l.length>0&&(0,ft.ng)(d,(l.length>9?420:42*l.length)>.5*window.innerHeight?.4*window.innerHeight:l.length>9?420:42*l.length,l.length,42,o.renderListCustomer,l)),!(null!==l&&void 0!==l&&l.length)&&!c&&Rt("div",{className:"title",style:{width:"100%",textAlign:"center",marginTop:10,display:"flex",alignItem:"center"}},Rt(r.default,{onClick:o.handleFetchAllCustomers,icon:Rt(Ot.Z,null)},t("components.configurationSendSMS.selcetAllCusotmer")))))})),(0,S.Z)((0,y.Z)(o),"renderConfigSendMessages",(function(){var e,t=o.props,n=t.t,s=t.currentShop;return Rt("div",{className:"notisetting-wrapper"},Rt("div",{className:"setting-card",style:{marginBottom:0}},Rt("div",{className:"setting-box"},Rt("div",{className:"setting-title",style:{justifyContent:"space-between"}},Rt("span",null,n("pages.shop.setting.notification.eventMessage")),Rt(m.default,{title:n("addNoti")},Rt(r.default,{icon:Rt(De.Z,null),type:"primary",onClick:function(){return o.setState({addEventMessages:!0,contentEventMessage:"",titleEventMessage:""})}},n("components.settingTag.add")))),(null===(e=s.event_messages_sms)||void 0===e?void 0:e.length)>0?Rt("div",{className:"notisetting-table",style:{padding:15}},Rt("div",{className:"notisetting-thead"},Rt("div",{className:"col-first"},n("pages.shop.setting.notification.toggle").toUpperCase()),Rt("div",{className:"col-second"},n("pages.shop.setting.notification.title").toUpperCase()),Rt("div",{className:"col-third"},n("pages.shop.setting.notification.content").toUpperCase()),Rt("div",{className:"col-action"},n("pages.shop.setting.notification.action").toUpperCase())),Rt("ul",null,o.renderInboxEventSettings())):Rt("div",{className:"notisetting-not-connect",style:{marginLeft:20,marginTop:10,marginBottom:10}},Rt("strong",null,n("pages.shop.setting.notification.NoEventMessageConfigure"))))))})),(0,S.Z)((0,y.Z)(o),"handleTableChange",(function(e){var t;(t=Nt({},zt)).page=e.current,o.fetchEventMessages(t)})),(0,S.Z)((0,y.Z)(o),"getMethodSendMessage",(function(e){switch(e){case"1":return"SMS";case"2":return"Zalo ZNS";case"3":return"SMS v\xe0 Zalo ZNS";case"4":return"Multi Channel"}})),(0,S.Z)((0,y.Z)(o),"getDataEventMessages",(function(){var e=o.props,t=e.eventMessagesData,n=e.timezone;return(t.data||[]).map((function(e,t){var s,r,a;return{key:e.id,title:e.title,message_type:o.getMethodSendMessage(e.method_send_message),name:(null===(s=e.shop_customer)||void 0===s?void 0:s.name)||(null===(r=e.customer)||void 0===r?void 0:r.name),phone_number:null===(a=e.shop_customer)||void 0===a?void 0:a.phone_numbers[0],time_to_send:e.time_to_send?(0,fe.o0x)(n,e.time_to_send):"",time_has_sent:e.time_has_sent?(0,fe.o0x)(n,e.time_has_sent):""}}))})),(0,S.Z)((0,y.Z)(o),"onSelectChange",(function(e){o.setState({selectedRowKeys:e})})),(0,S.Z)((0,y.Z)(o),"renderMessagesHistories",(function(){var e=o.props.eventMessagesData,t={selectedRowKeys:o.state.selectedRowKeys,onChange:o.onSelectChange,getCheckboxProps:function(e){return{disabled:!!e.time_has_sent}}};return Rt(xt.Z,{className:"table-bill-handover",dataSource:o.getDataEventMessages(),columns:[{title:"Ti\xeau \u0111\u1ec1",dataIndex:"title",ellipsis:!0,align:"left"},{title:"Lo\u1ea1i tin nh\u1eafn",dataIndex:"message_type",ellipsis:!0,align:"center",width:"15%"},{title:"Kh\xe1ch h\xe0ng",dataIndex:"name",ellipsis:!0,align:"left",width:"15%"},{title:"S\u0110T",dataIndex:"phone_number",ellipsis:!0,align:"center",width:"15%"},{title:"Th\u1eddi gian h\u1eb9n g\u1eedi",dataIndex:"time_to_send",ellipsis:!0,align:"center",width:"15%"},{title:"\u0110\xe3 g\u1eedi l\xfac",dataIndex:"time_has_sent",ellipsis:!0,align:"center",width:"15%"}],pagination:{size:"small",pageSize:20,total:e.total_entries},onChange:o.handleTableChange,rowSelection:t,loading:o.state.loadingEventMessage,bordered:!0,rowClassName:function(){return"row-variation"},style:{borderCollapse:"collapse",maxHeight:"calc(100vh - 350px)",overflowY:"hidden"},scroll:{y:"calc(100vh - 450px)"},locale:{emptyText:"Ch\u01b0a c\xf3 tin nh\u1eafn"}})})),(0,S.Z)((0,y.Z)(o),"handleDeleteMessagesSms",(function(){var e=o.props,t=e.shopId,n=e.accessToken,s=o.state.selectedRowKeys;s.length>0&&o.props.handleDeleteMessagesSms(t,n,s).then((function(e){null!==e&&void 0!==e&&e.success&&(o.fetchEventMessages(),o.setState({selectedRowKeys:[]}))}))})),(0,S.Z)((0,y.Z)(o),"renderTabBarExtraContent",(function(){var e=o.props.t,t=o.state,n=t.selectedRowKeys;return"3"==t.tab&&Rt("div",{style:{marginTop:10}},n.length>0&&Rt(r.default,{onClick:function(){return o.setState({selectedRowKeys:[]})},type:"dashed"},Rt("b",null,n.length),"\xa0",e("pages.shop.order.selectedOrder"),"  ",Rt(me.Z,null)),Rt(Ne.Z,{icon:Rt(V.Z,null),color:"#096dd9",title:"C\u1eadp nh\u1eadt nhanh",onClick:function(){return o.setState({visibleEditMessages:!0})},style:{marginLeft:10}}),Rt(Ne.Z,{icon:Rt(q.Z,null),color:"rgb(150, 19, 19)",title:"".concat(e("delete")," ").concat(n.length," ").concat(e("pages.shop.order.selectedOrder")," "),onClick:o.handleDeleteMessagesSms,style:{marginLeft:10}}))})),(0,S.Z)((0,y.Z)(o),"handleSaveMessagesSms",(function(){var e=o.props,t=e.shopId,n=e.accessToken,s=o.state,r=s.selectedRowKeys,a={selectedRowKeys:r,sendDate:s.datesSendEventMessage.toDate().toISOString()};r.length>0&&o.props.handleUpdateMessagesSms(t,n,a).then((function(e){null!==e&&void 0!==e&&e.success&&(o.fetchEventMessages(),o.setState({selectedRowKeys:[],visibleEditMessages:!1}))}))})),(0,S.Z)((0,y.Z)(o),"renderDataEditMessages",(function(){return Rt("div",null,Rt("div",{style:{marginLeft:10,fontWeight:500}},o.props.t("sendAppointment")),o.renderDatePicker(!0))})),(0,S.Z)((0,y.Z)(o),"handleActiveEventMessage",function(){var e=(0,g.Z)(f().mark((function e(t,n){var s,r,a,i,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=o.props,r=s.currentShop,a=s.accessToken,i=s.shopId,(l=r.event_messages_sms||[])[n].active=t,o.props.updateSettingMessages(a,i,{event_messages_sms:l},"event_messages_sms");case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,S.Z)((0,y.Z)(o),"handleDeleteEventMessage",(function(e){var t=o.props,n=t.t,r=t.currentShop,a=t.accessToken,i=t.shopId;s.Z.confirm({title:n("pages.shop.setting.notification.confirmDelete"),onText:n("delete"),cancelText:n("cancel"),onOk:function(){var t=r.event_messages_sms||[];t.splice(e,1),o.props.updateSettingMessages(a,i,{event_messages_sms:t},"event_messages_sms")}})})),(0,S.Z)((0,y.Z)(o),"renderInboxEventSettings",(function(){var e=o.props,t=e.t,n=e.currentShop,a=e.zaloTemplates,i=o.state,l=i.modalEventVisibale,c=i.modalEventIdx,u=i.titleEventMessage;return(n.event_messages_sms||[]).map((function(e,n){var i=a.find((function(t){return t.templateId==e.zalo_template||t.TempId==e.zalo_template}));return Rt("li",{key:e.title},Rt("div",{className:"col-first"},Rt(re.Z,{checked:e.active,onChange:function(e){return o.handleActiveEventMessage(e,n)},size:"small"})),Rt("div",{className:"col-second"},e.title),Rt("div",{className:"col-third"},["2"].includes(e.method_send_message)?(null===i||void 0===i?void 0:i.templateName)||(null===i||void 0===i?void 0:i.TempName)||"":e.content),Rt("div",{className:"col-action"},Rt(r.default.Group,null,Rt(r.default,{onClick:function(){return o.setState({modalEventVisibale:!0,modalEventIdx:n,contentEventMessage:e.content,titleEventMessage:e.title,methodSendMessage:e.method_send_message?e.method_send_message:"1",zaloTemplate:e.zalo_template,smsType:e.sms_type?e.sms_type:2})},icon:Rt(Qe.Z,null),className:"action-edit"}),Rt(r.default,{icon:Rt(q.Z,null),onClick:function(){return o.handleDeleteEventMessage(n)},className:"action-delete"}))),l&&c==n&&Rt(s.Z,{visible:l,width:600,wrapClassName:"notisetting-modal",title:"".concat(t("pages.shop.setting.notification.EditEventMessage")," #").concat(u),okText:t("save"),onCancel:function(){return o.onCancel()},onOk:function(){return o.handleEditEventMessage(n)}},o.renderContentEventMessage()))}))})),(0,S.Z)((0,y.Z)(o),"onCancel",(function(){o.setState({modalEventVisibale:!1,modalEventIdx:null,contentEventMessage:"",methodSendMessage:"1",zaloTemplate:void 0})})),(0,S.Z)((0,y.Z)(o),"handleChangeContentMessage",(function(e,t){var n=o.state.caretPosition,s=R()(o.state[t]);-1==n&&s&&(n=s.length),s||(n=0),s=[s.slice(0,n),"LEVEL_DISCOUNT"==e?"(#{".concat(e,"})"):"#{".concat(e,"}"),s.slice(n)].join(""),o.setState((0,S.Z)({},t,s))})),(0,S.Z)((0,y.Z)(o),"renderContentEventMessage",(function(){var e=o.props,t=e.t,n=e.currentShop,s=o.state,r=s.titleEventMessage,i=s.contentEventMessage,l=[{key:"FULL_NAME",des:o.props.t("pages.shop.setting.notification.fullName")},{key:"PHONE_NUMBER",des:o.props.t("pages.shop.setting.notification.phoneNumber")},{key:"DATE",des:o.props.t("pages.shop.setting.notification.statusTransitionDate")},{key:"MONTH",des:o.props.t("pages.shop.setting.notification.statusTransitionMonth")},{key:"YEAR",des:o.props.t("pages.shop.setting.notification.statusTransitionYear")},{key:"SHOP_NAME",des:o.props.t("pages.shop.setting.notification.insertShopName")}],c=[{key:"REWARD_POINT",des:o.props.t("rewardPoints")},{key:"POINT_TO_MONEY",des:o.props.t("pages.shop.setting.notification.pointToMoney")},{key:"MONEY_TO_POINT",des:o.props.t("pages.shop.setting.notification.moneyToPoint")}],u=n.reward_point_settings&&Object.keys(n.reward_point_settings).length>0&&n.reward_point_settings.enabled?l.concat(c):l;return Rt("div",null,o.renderMethodSendMessage(),Rt("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},Rt("span",{style:{marginTop:5}},t("pages.shop.setting.notification.title"),": "),Rt(a.default,{style:{width:425},placeholder:t("pages.shop.setting.notification.enterTitle"),onChange:function(e){return o.setState({titleEventMessage:e.target.value})},value:r})),Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}}),Rt("span",{style:{marginTop:5}},t("pages.shop.setting.notification.content"),": "),Rt(At,{onChange:function(e){return o.setState({contentEventMessage:e.target.value})},value:i,style:{marginTop:10,marginLeft:5,width:540},rows:5}),Rt("div",{className:"notisetting-labels",style:{marginTop:25,marginLeft:20}},u.map((function(e,n){return Rt("div",{className:"notitag",key:n,style:{display:"flex",marginTop:10}},Rt(m.default,{placement:"left",title:t("components.orderExportExcel.clickToInsertTag")},Rt("span",{style:{flex:1}},Rt(d.default,{color:"#2db7f5",onClick:function(){return o.handleChangeContentMessage(e.key,"contentEventMessage")}},e.key))),Rt("span",{style:{flex:1}},e.des))}))))})),(0,S.Z)((0,y.Z)(o),"renderMethodSendMessage",(function(){var e=o.props,t=e.t,n=e.currentShop,s=e.zaloTemplates,r=o.state,a=r.methodSendMessage,i=r.zaloTemplate,l=r.smsType,c=n.sms_account,u=c.oaid||"1sms"==c.type;return Rt(F.Fragment,null,c&&["sms","infotxt"].includes(c.type)&&u&&Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}},Rt("span",{style:{flex:3,marginTop:5}},"H\xecnh th\u1ee9c g\u1eedi",": "),Rt(x.default,{style:{width:425},placeholder:t("selectShippingStatus"),value:a,onChange:function(e){return o.setState({methodSendMessage:e})}},Rt(jt,{value:"1",key:"1"},"Ch\u1ec9 g\u1eedi SMS"),Rt(jt,{value:"2",key:"2"},"Ch\u1ec9 g\u1eedi Zalo ZNS"),Rt(jt,{value:"3",key:"3"},"G\u1eedi c\u1ea3 Zalo ZNS v\xe0 SMS"),Rt(jt,{value:"4",key:"4"},"\u01afu ti\xean Zalo ZNS. N\u1ebfu th\u1ea5t b\u1ea1i g\u1eedi SMS (Multi-Channel)"))),["1","3","4"].includes(a)&&"sms"==c.type&&Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}},Rt("span",{style:{flex:3,marginTop:5}},"Ki\u1ec3u SMS",": "),Rt(x.default,{style:{width:425},placeholder:"Ch\u1ecdn ki\u1ec3u SMS",value:l,onChange:function(e){return o.setState({smsType:e})}},Rt(jt,{value:1,key:1},"Qu\u1ea3ng c\xe1o"),Rt(jt,{value:2,key:2},"CSKH"))),["2","3","4"].includes(a)&&u&&Rt("div",{style:{display:"flex",flexDirection:"row",marginTop:10}},Rt("span",{style:{flex:3,marginTop:5}},"Zalo templates",": "),Rt(x.default,{style:{width:425},placeholder:"Ch\u1ecdn template",value:(i||"").toString()||void 0,onChange:function(e){return o.setState({zaloTemplate:e})}},s.map((function(e){return Rt(jt,{value:(e.templateId||e.TempId||"").toString(),key:(e.templateId||e.TempId||"").toString()},e.TempContent?Rt(m.default,{title:Rt("span",{dangerouslySetInnerHTML:{__html:e.TempContent}}),placement:"right",overlayClassName:"tooltip-message-tag"},Rt("p",null,e.templateName||e.TempName)):Rt("p",null,e.templateName||e.TempName))})))))})),(0,S.Z)((0,y.Z)(o),"renderFooter",(function(){var e=o.props.t;return"1"==o.state.tab?Rt("div",null,Rt(r.default,{onClick:o.handleCancelConfigurationSMS},e("cancel")),Rt(r.default,{onClick:o.handleConfigurationSendSMS,type:"primary"},e("save"))):null})),(0,S.Z)((0,y.Z)(o),"handleCancelConfigurationSMS",(function(){o.props.clearSelectedCustomers(),o.setState({modalVisible:!1,eventMessages:void 0,datesSendEventMessage:Ce()().utcOffset(parseInt(o.props.timezone)||7).add("5","minutes"),customers:[],total_entries:0,fetchCustomers:[]})})),(0,S.Z)((0,y.Z)(o),"handleChangeTab",(function(e){o.setState({tab:e}),"3"==e&&o.fetchEventMessages()})),o.state={modalVisible:!1,datesSendEventMessage:Ce()().utcOffset(parseInt(o.props.timezone)||7).add("30","minutes"),eventMessages:void 0,customers:[],isLoading:!1,searchResultCustomer:[],isLoadingSearch:!1,getWidthCart:740,tab:"1",contentEventMessage:"",titleEventMessage:"",methodSendMessage:"1",caretPosition:-1,smsType:2,total_entries:0,fetchCustomers:[],selectedRowKeys:[]},o}return(0,_.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.shopId,o=t.accessToken,s=t.fetchZaloZnsTemplate,r=document.getElementById("virtualize-list-sms");r&&this.setState({getWidthCart:r.offsetWidth-1.5}),window.addEventListener("resize",(function(){document.getElementById("virtualize-list-sms")&&e.setState({getWidthCart:document.getElementById("virtualize-list-sms").offsetWidth-2})})),s(n,o)}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,o=t.isButton,r=t.title,a=this.state,i=a.modalVisible,l=a.addEventMessages,c=a.tab,u=a.visibleEditMessages;return Rt("div",{style:{display:"inline"}},Rt(he.Z,{icon:Rt(W.Z,null),color:"#98cc60",onClick:function(){return e.handleFetchCustomer()},isButton:o,title:r}),Rt(s.Z,{visible:i,title:n("components.configurationSendSMS.title"),wrapClassName:"update-order-tool modal-configuration-sms",width:"3"==c?1e3:800,footer:this.renderFooter(),onCancel:this.handleCancelConfigurationSMS},Rt(It.default,{defaultActiveKey:"1",onChange:function(t){return e.handleChangeTab(t)},tabBarExtraContent:this.renderTabBarExtraContent()},Rt(Ft,{tab:"G\u1eedi tin",key:"1"},this.renderContentSendSMS(),this.renderSelectedCustomer()),Rt(Ft,{tab:"C\u1ea5u h\xecnh",key:"2"},this.renderConfigSendMessages()),Rt(Ft,{tab:"L\u1ecbch s\u1eed",key:"3"},this.renderMessagesHistories()))),Rt(s.Z,{visible:l,title:n("pages.shop.setting.notification.addEventMessage"),width:600,onCancel:function(){return e.setState({addEventMessages:!1,contentEventMessage:"",titleEventMessage:"",methodSendMessage:"1",zaloTemplate:void 0})},onOk:this.handleSaveEventMessages},this.renderContentEventMessage()),u&&Rt(s.Z,{visible:u,title:"C\u1eadp nh\u1eadt tin nh\u1eafn",onCancel:function(){return e.setState({visibleEditMessages:!1})},onOk:this.handleSaveMessagesSms},this.renderDataEditMessages()),Rt("style",{dangerouslySetInnerHTML:{__html:Mt()}}))}}]),n}(F.Component))||bt,Vt=(0,Pe.$j)((function(e){return{currentShop:(0,ht.tf)(e),customer:(0,ht.p6)(e),timezone:e.navigation.user.timezone,zaloTemplates:e.settings.zaloTemplate,eventMessagesData:e.settings.eventMessages}}),{fetchListOfCustomers:Le.ezi,fetchZaloZnsTemplate:Le.HLP,updateSettingMessages:Le.RJj,fetchEventMessages:Le.oL6,handleDeleteMessagesSms:Le.vgf,handleUpdateMessagesSms:Le.fnu})(Ut),Ht=n(49485),Kt=n(30775),Yt=n(42258),qt=F.createElement;function Wt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wt(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var Jt,$t=x.default.Option,Xt={display:"block",height:"30px",lineHeight:"30px"},en=(0,ve.Z)()(Bt=function(e){(0,b.Z)(n,e);var t=Qt(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"handleUpdateCustomers",(function(e){var t=o.props,n=t.accessToken,s=t.shopId,r=t.t,a=t.fetch,i=o.state,l=i.updatingInfo,c=i.typeQuickUpdate,u=i.tags,d=i.typeUpdate,p=i.customers,m=i.typeLevel,h=i.level,f=p[e],g="".concat((0,fe.LpH)(),"/shops/").concat(s,"/customers/").concat(f.id,"?access_token=").concat(n);l.push({success:null,message:null});var v=function(t){l[e].success=t.success,o.setState({updatingInfo:l}),e+1<p.length?o.handleUpdateCustomers(e+1):a()},y=[];switch(d){case"update":y=u;break;case"add":y=(f.shop_customer.tags||[]).concat(u);break;case"remove":y=(f.shop_customer.tags||[]).filter((function(e){return!u.includes(e)}))}var _={};switch(c){case"block":_={id:f.id,shop_customer:{is_block:!0}};break;case"unBlock":_={id:f.id,shop_customer:{is_block:!1}};break;case"tag":_={id:f.id,shop_customer:{tags:y.length>0?y:-1}};break;case"level":_={id:f.id,shop_customer:{level_id:"update"==m?h:void 0}}}_e().put(g,(0,fe.D$T)({customer:_})).then((function(t){var n=t.data;l[e].message=r("success"),(0,Yt.VE)(n.data),v(n)})).catch((function(t){var n=t.response.data,o=n.errors&&n.errors,s="";if(o)for(var r in o)if(o.hasOwnProperty(r))if(o[r].constructor==Array)s+=o[r].join(", ");else for(var a in o[r])s+=o[r][a];l[e].message=n.message?n.message:n.errors?s:"",v(n)}))})),(0,S.Z)((0,y.Z)(o),"renderResult",(function(){var e=o.state,t=e.updatingInfo,n=e.customers,s=o.props.t,r=function(e,t,o){return qt("div",{key:n[t].id},qt("span",null,qt("strong",{className:o},"#".concat(n[t].name))),"\xa0",qt("span",{className:o},e.message&&""!=e.message?e.message:s("action.unknownError")))};return qt("div",null,t.map((function(e,t){if(e.success)return qt("div",{key:t},r(e,t,"success"))})),t.map((function(e,t){if(!e.success)return qt("div",{key:t},r(e,t,"fail"))})))})),(0,S.Z)((0,y.Z)(o),"handleConfirm",(function(){var e=o.props,t=e.accessToken,n=e.shopId,s=e.selectedRowKeys,r="".concat((0,fe.LpH)(),"/shops/").concat(n,"/get_customers?access_token=").concat(t),a=s.join(",").toString(),i=[];o.setState({isLoading:!0});var l={page:1,page_size:30};s.length&&(l=Gt(Gt({},l),{},{customer_ids:a}));(function e(t){return _e().post(r,t).then((function(n){if(n.data.success){var o=n.data.data;return i=i.concat(o),0==o.length||i.length>=n.data.total_entries?(i.length,n.data.total_entries,i):(t.page+=1,e(t))}})).catch(fe.s0o)})(l).then((function(e){e&&o.setState({customers:e,isLoading:!1,isUpdating:!0},(function(){return o.handleUpdateCustomers(0)}))}))})),(0,S.Z)((0,y.Z)(o),"renderTypeUpdate",(function(){var e=o.props.t;return qt("div",{style:{marginTop:10}},qt(k.default.Group,{value:o.state.typeUpdate,onChange:function(e){return o.setState({typeUpdate:e.target.value})},defaultValue:"update"},qt(k.default,{style:Xt,value:"update"},e("components.productUpdateCategory.updateTag")),qt(k.default,{style:Xt,value:"add"},e("components.productUpdateCategory.addToOldTags")),qt(k.default,{style:Xt,value:"remove"},e("components.productUpdateCategory.cancelTags"))))})),(0,S.Z)((0,y.Z)(o),"getCustomerLevels",(function(){var e=o.props,t=e.accessToken,n=e.shopId,s="".concat((0,fe.LpH)(),"/shops/").concat(n,"/customer_levels?access_token=").concat(t);_e().get(s).then((function(e){e.data.success&&o.setState({customerLevels:e.data.data})}))})),(0,S.Z)((0,y.Z)(o),"renderQuickUpdateLevel",(function(){var e=o.state,t=e.customerLevels,n=e.level,s=e.typeLevel,r=o.props.t;return qt("div",null,qt("div",{style:{marginTop:10}},qt(k.default.Group,{value:s,onChange:function(e){return o.setState({typeLevel:e.target.value})}},qt(k.default,{style:Xt,value:"update"},r("components.orderReturnedActions.update")),qt(k.default,{style:Xt,value:"remove"},r("components.printLabelCard.delete")))),"update"==s&&qt("div",null,qt("div",{style:{fontWeight:500,marginTop:8}},r("components.selectCustomerLevel")),qt(x.default,{placeholder:r("components.selectCustomerLevel"),allowClear:!0,value:n,style:{width:"100%"},onChange:function(e){return o.setState({level:e})},showSearch:!0,filterOption:function(e,t){return(0,fe.st5)(e,t.children)}},t.map((function(e){return qt($t,{key:e.id,value:e.id},qt(gt.Z,{color:e.color_customer_level,name:e.name}))})))))})),o.state={modalVisible:!1,isLoading:!1,isUpdating:!1,updatingInfo:[],typeUpdate:"update",tags:[],customers:[],customerLevels:[],typeLevel:"update"},o}return(0,_.Z)(n,[{key:"componentDidMount",value:function(){this.getCustomerLevels()}},{key:"render",value:function(){var e=this,t=this.state,n=t.modalVisible,o=t.isUpdating,a=t.updatingInfo,i=t.typeQuickUpdate,l=t.tags,c=t.customers,u=t.isLoading,d=this.props,p=d.selectedRowKeys,m=d.t,h=d.title,f=d.isButton,g=d.currentShop,v=a.filter((function(e){return e.success})).length,y=c.length-v,_={fontWeight:500,marginBottom:5};return qt("div",{style:{display:"inline"}},qt(he.Z,{icon:qt(V.Z,null),tooltip:0==p.length?m("components.quickUpdateCustomer.selectCustomerToQuickUpdate"):"".concat(m("components.productUpdateCategory.quickUpdate")," ").concat(p.length," ").concat(m("components.quickUpdateCustomer.selectedCustomer")),onClick:function(){return e.setState({modalVisible:!0})},title:h,isButton:f}),n&&qt(s.Z,{onCancel:function(){return e.setState({modalVisible:!1,isLoading:!1,isUpdating:!1,updatingInfo:[],typeQuickUpdate:void 0})},visible:n,footer:qt("div",null,o?qt(r.default,{onClick:function(){var t;return e.setState((t={updatingInfo:[],modalVisible:!1,isUpdating:!1},(0,S.Z)(t,"updatingInfo",[]),(0,S.Z)(t,"typeQuickUpdate",void 0),t))}},m("components.productUpdateCategory.exit")):qt(r.default,{type:"primary",disabled:"category"==i&&"tag"==i,onClick:this.handleConfirm},m("pages.dashboard.update"))),wrapClassName:"modal-updating",title:p.length?"".concat(m("components.productUpdateCategory.quickUpdate")," ").concat(p.length," ").concat(m("components.quickUpdateCustomer.selectedCustomer")):"".concat(m("pages.shop.actionTools.quickUpdate")," ").concat(m("customers.title"))},u?qt("span",null,qt(de.Z,null)," ",m("components.quickUpdateCustomer.loadingSelectedCustomer")):o?qt("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center"}},qt(ae.default,{type:"circle",percent:Math.floor(100*a.length/c.length),style:{marginBottom:10}}),a.length==c.length?qt("h4",null,qt("span",{style:{color:"#00a854"}},"".concat(m("components.productUpdateCategory.updateSucceed")," ").concat(v," ").concat(m("customers.title"))),qt("span",{style:{color:"#f04134"}},"".concat(y>0?", ".concat(m("pages.admin.failure")," ").concat(y," ").concat(m("customers.title")):""))):qt("div",null,qt("h4",{style:{color:"#096dd9"}},m("components.productUpdateCategory.updatingCategory"))),qt("div",{id:"updating-info",className:"updating-info"},this.renderResult())):qt("div",{style:{width:"100%"}},qt("div",null,qt("div",{style:_},qt(V.Z,null),qt("span",{style:{marginLeft:3}},m("components.productUpdateCategory.typeUpdate"),":")),qt(x.default,{placeholder:m("components.productUpdateCategory.selectTypeUpdate"),value:i,allowClear:!0,style:{width:"100%"},onChange:function(t){return e.setState({typeQuickUpdate:t})}},qt($t,{key:"tag",value:"tag"},m("containers.customerInfo.tagCustomer")),qt($t,{key:"block",value:"block"},m("components.quickUpdateCustomer.blockCustomer")),qt($t,{key:"unBlock",value:"unBlock"},m("components.quickUpdateCustomer.unblockCustomer")),qt($t,{key:"level",value:"level"},m("components.customerLevel")))),"tag"==i&&qt("div",null,this.renderTypeUpdate(),qt("div",{style:_},qt(Y.Z,null),qt("span",{style:{marginLeft:3}},m("containers.customerInfo.selectTagCustomer"))),qt(x.default,{placeholder:m("components.productPromotionDetail.selectTags"),mode:"multiple",allowClear:!0,value:l,style:{width:"100%"},onChange:function(t){return e.setState({tags:t})},showSearch:!0,filterOption:function(e,t){return(0,fe.st5)(e,t.children)}},g.tags.map((function(e,t){return qt($t,{key:t,value:e},e)})))),"level"==i&&this.renderQuickUpdateLevel())))}}]),n}(F.Component))||Bt,tn=(0,Pe.$j)(null,{updateCustomer:Le.uGj,fetchListOfCustomers:Le.ezi,updateCustomerAction:Yt.VE})(en),nn=n(88460),on=n(79728),sn=n(12044),rn=n(33786),an=n(17918),ln=F.createElement;function cn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function un(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cn(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function dn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var pn,mn=x.default.Option,hn=(k.default.Group,k.default.Button,(0,ve.Z)()(Jt=function(e){(0,b.Z)(n,e);var t=dn(n);function n(e){var o;return(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"botcakeContent",(function(){var e,t,n,s=o.props,a=s.currentShop,i=s.t,l=s.pancakeTags,c=o.state,u=c.botcakePageId,d=c.botcakeTags;return ln("div",null,ln(Ke.default,{message:"Ghi ch\xfa",description:"H\u1ec7 th\u1ed1ng s\u1ebd t\u1ef1 \u0111\u1ed9ng t\u1ea1o t\u1ec7p kh\xe1ch h\xe0ng tr\xean Botcake theo b\u1ed9 l\u1ecdc kh\xe1ch h\xe0ng hi\u1ec7n t\u1ea1i, n\u1ebfu kh\xf4ng c\xf3 b\u1ed9 l\u1ecdc s\u1ebd t\u1ef1 \u0111\u1ed9ng l\u1ea5y t\u1ea5t c\u1ea3 kh\xe1ch h\xe0ng",type:"warning",showIcon:!0}),ln("div",{style:{display:"flex",flexDirection:"row",marginTop:20,justifyContent:"space-between"}},ln("div",{style:{paddingTop:3}},ln(on.Z,null),ln("span",{style:{marginLeft:5}},i("pages.shop.setting.notification.selectedPage"))),ln(x.default,{style:{width:300},onChange:function(e){return o.setState({botcakePageId:e,botcakeTags:[]})},value:u||(null===(e=l[0])||void 0===e?void 0:e.page_id),placeholder:i("pages.shop.setting.notification.selectedPage")},l.map((function(e){var t;return e.page_id&&ln(mn,{key:e.page_id,value:e.page_id},ln("div",{className:"avatar",style:{display:"flex",alignItems:"center"}},ln(rn.Z,{ids:[e.page_id],width:20,height:20}),"\xa0",ln("div",null,null===(t=a.pages.find((function(t){return t.id==e.page_id})))||void 0===t?void 0:t.name)))})))),ln("div",{style:{display:"flex",flexDirection:"row",marginTop:10,justifyContent:"space-between"}},ln("div",{style:{paddingTop:3}},ln(sn.Z,null),ln("span",{style:{marginLeft:5}},i("pages.shop.setting.notification.botcakeTags")),ln(an.Z,{tip:i("pages.shop.setting.notification.tipBotcakeTags")})),ln(x.default,{mode:"multiple",showArrow:!0,placeholder:i("pages.shop.setting.notification.addBotcakeTags"),value:d&&d.length?d.map((function(e){return parseInt(e)})):[],onChange:function(e){return o.setState({botcakeTags:e})},style:{width:300}},null===(t=l.find((function(e){return e.page_id==u}))||l[0])||void 0===t||null===(n=t.tags)||void 0===n?void 0:n.map((function(e){return ln(mn,{key:e.id,value:e.id},e.name)})))),ln("div",{style:{marginTop:20,justifyContent:"flex-end",display:"flex"}},ln(r.default,{type:"danger",onClick:function(){return o.setState({botcakeVisible:!1,shopCustomerParams:{}})}},"H\u1ee7y"),"\xa0",ln(r.default,{type:"primary",disabled:0==d.length,onClick:o.handleSaveBotcake},"T\u1ea1o")))})),(0,S.Z)((0,y.Z)(o),"handleSaveBotcake",(function(){var e,t=o.state,n=t.botcakePageId,s=t.botcakeTags,r=o.props,a=r.accessToken,i=r.shopId,l=r.pancakeTags,c=r.customerParams,u=r.selectedRowKeys,d="".concat((0,fe.LpH)(),"/shops/").concat(i,"/audience_botcake?access_token=").concat(a),p={pageId:n||(null===(e=l[0])||void 0===e?void 0:e.page_id),botcakeTags:s,customerParams:un(un({},c),{},{customer_ids:u&&u.length>0?u.join(","):void 0})};return _e().post(d,{params:p}).then((function(e){e.data.success?ge.Z.success("Th\xe0nh c\xf4ng"):ge.Z.error("C\xf3 l\u1ed7i x\u1ea3y ra, vui l\xf2ng th\u1eed l\u1ea1i sau"),o.setState({visible:!1,botcakePageId:"",botcakeTags:[]})}))})),o.state={isLoading:!1,botcakeTags:[],botcakePageId:"",visible:!1},o}return(0,_.Z)(n,[{key:"componentDidUpdate",value:function(e,t){var n=this.props,o=n.accessToken,s=n.shopId,r=n.currentShop,a=n.fetchPancakeTags,i=this.state.visible,l=r&&r.pages.map((function(e){return e.id}))||[];i&&t.visible!=i&&l.length>0&&a(s,o,l)}},{key:"render",value:function(){var e=this,t=this.state.visible,n=this.props,o=n.icon,r=n.title,a=n.isButton;return ln(F.Fragment,null,o&&ln(m.default,{title:"T\u1ea1o t\u1ec7p kh\xe1ch h\xe0ng b\xean Botcake"},ln(G.Z,{style:{fontSize:16},onClick:function(t){e.setState({visible:!0})}})),!o&&ln("div",{style:{display:"inline"}},ln(he.Z,{icon:ln(G.Z,null),onClick:function(t){e.setState({visible:!0})},title:r,isButton:a})),t&&ln(s.Z,{width:600,title:"Botcake Audience",visible:t,footer:!1,onCancel:function(){return e.setState({visible:!1})}},this.botcakeContent()))}}]),n}(F.Component))||Jt),fn=(0,Pe.$j)((function(e){return{currentShop:e.shop.currentShop,pancakeTags:e.settings.pancakeTags}}),{fetchPancakeTags:Le.rIi})(hn),gn=n(24781),vn=n(41850),yn=n(45812),_n=n(43831),bn=n(28969),Cn=n(32745),wn=F.createElement;function Sn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var kn={id:null,type:"discount_by_coupon_id",promo_code_info:{discount:0,is_percent:!1,max_discount_by_percent:0,disable:!1},start_time:Ce()(),end_time:Ce()().add(30,"days"),is_activated:!0,warehouse_ids:[]},xn=(0,ve.Z)()(pn=function(e){(0,b.Z)(n,e);var t=Sn(n);function n(e){var o;return(0,v.Z)(this,n),(o=t.call(this,e)).state={visiable:!1,voucher:null},o}return(0,_.Z)(n,[{key:"render",value:function(){var e=this,t=this.state.visiable,n=this.props,o=n.t,s=n.shopId,r=n.accessToken,a=n.currentShop,i=n.isButton,l=n.selectedRowKeys,c=n.params;return wn(F.Fragment,null,wn(he.Z,{icon:wn($.Z,null),title:o("pages.shop.customer.createVoucher"),onClick:function(){return e.setState({visiable:!0})},isButton:i}),t&&wn(Cn.Z,{shopId:s,handleCancel:function(){return e.setState({visiable:!1})},modalVisibile:t,currentShop:a,accessToken:r,promotion:kn,isFormCustomer:!0,customerIds:l,params:c}))}}]),n}(F.Component))||pn,Zn=(0,Pe.$j)(null,{})(xn),Tn=F.createElement;function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function On(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){(0,S.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function En(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,w.Z)(e);if(t){var s=(0,w.Z)(this).constructor;n=Reflect.construct(o,arguments,s)}else n=o.apply(this,arguments);return(0,C.Z)(this,n)}}var Mn=x.default.Option,Dn=k.default.Group,Rn=k.default.Button,Pn=["30","50","100","500","1000"],Nn={page:1,page_size:30,search:void 0,sale_form:"all",end_time_inserted_at:void 0,start_time_inserted_at:void 0,start_time_incurred_order:void 0,end_time_incurred_order:void 0},Ln=["blockCheck","level","assigned_user","birthday","orderCount","succeedOrderCount","purchasedAmount","lastOrderAt","creator","rewardPoints","usedRewardPoints","phoneNumbers","email","returnedOrderCount","address","tags","totalRewardPoints","insertedAt","referralCode"],Bn=["blockCheck","level","assigned_user","birthday","orderCount","succeedOrderCount","purchasedAmount","lastOrderAt","creator","returnedOrderCount","insertedAt"],jn=[],Fn=function(e){(0,b.Z)(n,e);var t=En(n);function n(e){var o;(0,v.Z)(this,n),o=t.call(this,e),(0,S.Z)((0,y.Z)(o),"getProvince",(function(){var e=o.props.accessToken,t="".concat((0,fe.LpH)(),"/geo/provinces/get_provinces_all_countries?access_token=").concat(e);_e().post(t).then((function(e){localStorage.setItem("provinces",JSON.stringify(e.data.data))}))})),(0,S.Z)((0,y.Z)(o),"fetchCustomers",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e?On(On({},o.state.params),e):On(On({},Nn),{},{page_size:o.state.pageSize});o.setState({isRefeshDisabled:!0});var n=o.props,s=n.accessToken,r=n.shopId,a=n.fetchListOfCustomers;a(s,r,t).then((function(){o.setState({params:t,isRefeshDisabled:!1,total_entries:o.props.customers.total_entries})}))})),(0,S.Z)((0,y.Z)(o),"onClickRefresh",(function(e){var t=o.state,n=t.params,s=t.pageSize;n.page_size=s;var r=n;e?o.onClearFilterClick():o.fetchCustomers(r)})),(0,S.Z)((0,y.Z)(o),"handleSearchInputChange",(function(e){return o.handleFilterWithValue("search",e)})),(0,S.Z)((0,y.Z)(o),"handleFilterWithValue",(function(e,t){var n=o.state.filters,s=n.findIndex((function(t){return t.key==e}));-1!=s?n[s].value=t:n.push({key:e,value:t}),o.setState({filters:n});var r=R()(o.state.params);r[e]=""==t?null:t,o.fetchCustomers(r)})),(0,S.Z)((0,y.Z)(o),"onClearFilterClick",(function(){o.setState({searchTerm:"",filters:[]}),o.fetchCustomers(!1)})),(0,S.Z)((0,y.Z)(o),"handleTableChange",(function(e,t,n){var s=o.state.params;if(s.page=e.current,s.page_size=e.pageSize,0!=Object.keys(n).length&&n.order){var r={asc_desc:"ascend"==n.order?"asc":"desc"};switch(n.field){case"level":r.sort_by="order";break;case"orderCount":r.sort_by="order_count";break;case"purchasedAmount":r.sort_by="purchased_amount";break;case"returnedOrderCount":r.sort_by="returned_order_count";break;case"succeedOrderCount":r.sort_by="succeed_order_count";break;case"lastOrderAt":r.sort_by="last_order_at";break;case"insertedAt":r.sort_by="inserted_at";break;case"rewardPoints":r.sort_by="reward_point";break;case"usedRewardPoints":r.sort_by="used_reward_point";break;case"totalRewardPoints":r.sort_by="total_reward_point"}s.data_sort=r,o.fetchCustomers(s)}else o.fetchCustomers(On(On({},s),{},{data_sort:void 0}));o.setState({params:s,pageSize:e.pageSize}),document.querySelector(".ant-table-body").scrollTop=0,localStorage.setItem("customerPageSize",e.pageSize)})),(0,S.Z)((0,y.Z)(o),"handleClickCustomer",(function(e){o.getSelectedCustomer(e.key)})),(0,S.Z)((0,y.Z)(o),"getSelectedCustomer",function(){var e=(0,g.Z)(f().mark((function e(t){var n,s,r,a,i,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.props,s=n.accessToken,r=n.shopId,o.props.customers){e.next=3;break}return e.abrupt("return");case 3:return a=N()(o.props.customers.data,(function(e){return e.id===t})),i=a.fb_id,l="".concat((0,fe.LpH)(),"/shops/").concat(r,"/customers/").concat(a.id,"/load_customer_notes?access_token=").concat(s,"&psid=").concat(i,"&check_page_id=").concat(a.page_id),e.next=8,_e()({method:"get",url:l}).then((function(e){200==e.status&&o.setState({customerNotes:e.data.customer_notes})}));case 8:o.setState({modalVisible:!0,selectedCustomer:a});case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,S.Z)((0,y.Z)(o),"renderCall",(function(e){var t=o.props,n=t.call,s=t.sipChange,r=t.t,a=(0,fe.xAZ)(e);return Tn(m.default,{title:"".concat(r("crm.callTo"),": ").concat(a)},Tn(A.Z,{onClick:function(t){t.stopPropagation(),n(e,null,null),s({isPopup:!0})},style:{fontSize:"11px",lineHeight:.5,paddingLeft:5}}))})),(0,S.Z)((0,y.Z)(o),"lengthData",(function(e){return(e||"").toString().length||0})),(0,S.Z)((0,y.Z)(o),"renderDateOfBirth",(function(e,t,n){var s,r,a,i,l=o.props.groupByBirthday,c=o.sortDate(l),u=c.findIndex((function(t){return t.date==e})),d=c.reduce((function(e,t,n){var o;return n<u?e+=(null===(o=t.data)||void 0===o?void 0:o.length)||0:e}),0),p={children:Tn("div",null,Tn("span",{style:{fontWeight:500}},e),"\xa0\xa0",Tn(m.default,{title:"Chat v\u1edbi kh\xe1ch h\xe0ng"},Tn(z.Z,{style:{fontSize:16},onClick:function(t){return o.handleClickGroupBirthday(t,e)}}))),props:{style:{background:"#FFFFFF",borderRight:"1px solid #d9d9d9"}}};n==d&&(p.props.rowSpan=null===(a=c[u])||void 0===a||null===(i=a.data)||void 0===i?void 0:i.length);return n>d&&n<d+(null===(s=c[u])||void 0===s||null===(r=s.data)||void 0===r?void 0:r.length)&&(p.props.rowSpan=0),p})),(0,S.Z)((0,y.Z)(o),"handleClickGroupBirthday",(function(e,t){e.stopPropagation();var n=o.props,s=n.currentShop,r=n.shopId,a=s.pages.map((function(e){return e.id})),i={shopId:r,birthday:t};1==a.length?window.open("".concat((0,fe.Thw)(),"/").concat(a[0],"?pos_params=").concat(JSON.stringify(i))):window.open("".concat((0,fe.Thw)(),"/multi_pages?page_ids=").concat(a,"&pos_params=").concat(JSON.stringify(i)))})),(0,S.Z)((0,y.Z)(o),"onFilterButtonClick",(function(e,t,n){var s=o.state,r=s.params,a=s.filters,i=o.props,l=i.accessToken,c=i.shopId,u=i.fetchCustomerByBirthday,d="7"==e?"date_of_birth_custom":"date_of_birth",p=a.findIndex((function(e){return["date_of_birth","date_of_birth_custom"].includes(e.key)}));-1!=p&&a.splice(p,1),a.push({key:d,value:On(On({},t),{},{numberMonth:n})}),"8"==e?(o.setState({isRefeshDisabled:!0}),u(l,c,{filterDate:Ce()().format("MM-DD")}).then((function(e){if(e.success){var t=o.sortDate(e.data).reduce((function(e,t){var n=t.data.map((function(e){return e.customer.id}));return e.concat(n)}),[]);o.setState({isRefeshDisabled:!1,groupByBirthdayView:!0,selectedRowKeys:t,filters:a})}}))):(r.date_of_birth=t,o.fetchCustomers(r),o.setState({groupByBirthdayView:!1,selectedRowKeys:[],filters:a}))})),(0,S.Z)((0,y.Z)(o),"sortDate",(function(e){return O()(e,(function(e){var t=e.date.split("-");return[t[1],t[0]]}))})),(0,S.Z)((0,y.Z)(o),"onChangeFilterByTime",(function(e){e.timeRange;var t=e.range,n=e.optionValue,s=o.state,r=s.params,a=s.filters,i=(0,p.Z)(t,2),l=i[0],c=i[1];l=l?l.startOf("day"):l,c=c?c.endOf("day"):c;var u="start_time_".concat(n),d="end_time_".concat(n);r[u]=l,r[d]=c;var m=a.findIndex((function(e){return e.key==n}));-1!=m&&a.splice(m,1),a.push({key:n,value:[l,c]}),o.setState({timeRange:[l,c],filters:a}),o.fetchCustomers(r)})),(0,S.Z)((0,y.Z)(o),"setLoadingMultiDel",(function(e){o.setState({isLoading:e})})),(0,S.Z)((0,y.Z)(o),"handleAdvanceFilter",(function(e){var t=R()(o.state.params);Object.keys(Nn).map((function(e){n=On(On({},n),{},(0,S.Z)({},e,t[e]))})),t=n;var n={},s=["orderCount","succeedOrderCount","returnedOrderCount","purchasedAmount","rewardPoint"];e.length&&(e.map((function(e){n[e.key]?n[e.key].push(e.value):n[e.key]="null"==[e.value]||s.includes(e.key)?e.value:[e.value]})),t=On(On({},t),n)),t.inserted_at&&delete t.inserted_at,t.incurred_order&&delete t.incurred_order,o.setState({filters:e,params:t},(function(){return o.fetchCustomers(t)}))})),(0,S.Z)((0,y.Z)(o),"renderFilterQuantityTag",(function(e,t){var n=o.props.currentShop;return Tn("strong",null,"between"!=e.type&&Tn("span",null,function(e){switch(e){case"greaterOrEqual":return">=";case"smallerOrEqual":return"<=";default:return""}}(e.type)," ",t?(0,fe.ufS)(e.value,n.currency):(0,fe.oH6)(e.value)),"between"==e.type&&Tn("span",null,t?(0,fe.ufS)(e.minValue,n.currency):(0,fe.oH6)(e.minValue)," ~ ",t?(0,fe.ufS)(e.maxValue,n.currency):(0,fe.oH6)(e.maxValue)))})),(0,S.Z)((0,y.Z)(o),"renderFilter",(function(e,t){var n,s,r,a,i,l,c,u,p,m,h;if(!["search"].includes(e.key)){var f,g=o.state.filters,v=o.props,y=v.t,_=v.currentShop,b=v.warehouses,C=v.order_sources_custom,w=null===(n=g.find((function(t){return t.key==e.key&&t.value==e.value})))||void 0===n?void 0:n.info;switch(e.key){case"selectedLevel":f=Tn("div",null,Tn("span",null,y("pages.shop.setting.notification.levelName"),":"),"\xa0",Tn("strong",null,null===w||void 0===w?void 0:w.name));break;case"tags":f="include"==e.value[0]?Tn("div",null,Tn("span",null,"".concat(y("pages.shop.customer.filterByTag"),":")),"\xa0",Tn("strong",{style:{color:"#096dd9"}},e.value[1])):Tn("div",null,Tn("span",null,"L\u1ecdc lo\u1ea1i tr\u1eeb".concat(":")),"\xa0",Tn("strong",{style:{color:"#F04134"}},e.value[1]));break;case"purchasedAmount":f=Tn("div",null,Tn("span",null,"".concat(y("pages.shop.customer.purchasedAmount"),":")),"\xa0",o.renderFilterQuantityTag(e.value,!0));break;case"orderCount":f=Tn("div",null,Tn("span",null,"".concat(y("pages.shop.customer.filterByOrderCount"),":")),"\xa0",o.renderFilterQuantityTag(e.value));break;case"succeedOrderCount":f=Tn("div",null,Tn("span",null,"".concat(y("pages.shop.customer.filterByDeliveredOrderCount"),":")),"\xa0",o.renderFilterQuantityTag(e.value));break;case"returnedOrderCount":f=Tn("div",null,Tn("span",null,y("containers.customerInfo.returnOrder"),":"),"\xa0",o.renderFilterQuantityTag(e.value));break;case"rewardPoint":f=Tn("div",null,Tn("span",null,y("containers.formBox.rewardPoints"),":"),"\xa0",o.renderFilterQuantityTag(e.value));break;case"typeCustomer":f=Tn("div",null,Tn("span",null,"".concat(y("customers.title"),":")),"\xa0",Tn("strong",null,e.value));break;case"creator_id":f=Tn("div",{style:{display:"flex"}},Tn("span",null,"".concat(y("pages.shop.customer.creator"),":")),"\xa0",Tn("strong",null,Tn("span",{style:{display:"flex",justifyItems:"center"}},Tn(se.Z,{id:null===w||void 0===w||null===(s=w.user)||void 0===s?void 0:s.fb_id,size:[20,20],seed:null===w||void 0===w||null===(r=w.user)||void 0===r?void 0:r.id,name:null===w||void 0===w||null===(a=w.user)||void 0===a?void 0:a.name}),"\xa0",Tn("span",null,null===w||void 0===w||null===(i=w.user)||void 0===i?void 0:i.name))));break;case"assigned_user_id":f=w?Tn("div",{style:{display:"flex"}},Tn("span",null,"".concat(y("pages.shop.customer.assignedTo"),":")),"\xa0",Tn("strong",null,Tn("span",{style:{display:"flex",justifyItems:"center"}},Tn(se.Z,{id:null===w||void 0===w||null===(l=w.user)||void 0===l?void 0:l.fb_id,size:[20,20],seed:null===w||void 0===w||null===(c=w.user)||void 0===c?void 0:c.id,name:null===w||void 0===w||null===(u=w.user)||void 0===u?void 0:u.name}),"\xa0",Tn("span",null,null===w||void 0===w||null===(p=w.user)||void 0===p?void 0:p.name)))):Tn("b",null,y("components.orderAdvanceFilter.notAssigned"));break;case"get_field_address":var S=[];(null===(m=_.country_code)||void 0===m?void 0:m.length)>1?w.map((function(e){S.push(e.label)})):w.map((function(e){e.isRoot||S.push(e.label)})),f=Tn("div",null,Tn("span",null,y("defaultPrint.address"),":"),"\xa0",Tn("strong",null,S.join(" / ")));break;case"variation_id":f=Tn("span",{style:{display:"flex",alignItems:"center"}},Tn("strong",null,y("products.title"),":\xa0"),Tn("div",{style:{display:"flex",alignItems:"center"}},e.product_display_id?Tn(d.default,{color:"green",style:{marginRight:3,height:22,marginTop:0}},e.product_display_id):variationData?Tn(d.default,{color:"green",style:{marginRight:3,height:22,marginTop:0}},variationData.product.custom_id||variationData.product.display_id):"",e.var_display_id?Tn(d.default,{color:"pink",style:{marginRight:3,height:22,marginTop:0}},e.var_display_id):variationData?Tn(d.default,{color:"pink",style:{marginRight:3,height:22,marginTop:0}},variationData.custom_id||variationData.display_id):"",e.name||variationData.product.name));break;case"warehouse_id":f=Tn("div",null,Tn("span",null,y("pages.shop.setting.conditionWarehouse"),":"),"\xa0",Tn("strong",null,b.find((function(t){return t.id===e.value})).name));break;case"blocked":f=Tn("div",null,Tn("strong",null,y("pages.shop.customer.filterBlocked")));break;case"using_coupon":f=Tn("div",null,Tn("strong",null,y("pages.shop.customer.filterCoupon")));break;case"order_sources":var k=[],x="",Z="";if(e.value&&"no_source"!=e.value.order_sources){var T,I=(0,fe.K5C)(C,_);(0,fe.caL)(_).map((function(e){I.find((function(t){return t.id==e.id}))||k.push(e)}));var O=I.concat(k),E=O.findIndex((function(t){return t.id==e.value.order_sources||t.id&&t.id.toString()==e.value.order_sources}));x=E>-1?O[E].name:"",e.value.account&&(Z=(((null===(T=O[E])||void 0===T?void 0:T.nodes)||[]).find((function(t){return t.custom_id==e.value.account||t.id==e.value.account}))||{}).name)}f=Tn("div",{style:{display:"flex"}},Tn("strong",null,y("components.orderAdvanceFilter.".concat("no_source"==e.value.order_sources?"noSource":"orderSource")),":"),"\xa0",Tn("div",null,Z?x+"/"+Z:"-1"==e.value.order_sources&&e.value.account?x+"/"+e.value.account:x));break;case"incurred_order":case"inserted_at":var M=e.value||[];if(!M[0]&&!M[1])return;var D=M.includes(void 0);f=Tn("div",null,Tn("span",null,"inserted_at"==e.key?y("pages.shop.customer.insertedAt"):y("pages.shop.customer.timeIncurredOrder"),": "),"\xa0",Tn("strong",null,M[0]?"".concat(y("tool.from")," ").concat((0,fe.o0x)(o.props.timezone||7,M[0],!1,"DD/MM/YYYY")):"",D?"":" - ",M[1]?"".concat(y("tool.to")," ").concat((0,fe.o0x)(o.props.timezone||7,M[1],!1,"DD/MM/YYYY")):""));break;case"date_of_birth":f=Tn("div",null,Tn("strong",null,y("components.orderExportExcel.birthday"),": ",o.renderBirthdayTag(e.value)),"\xa0");break;case"date_of_birth_custom":f=Tn("div",null,Tn("strong",null,y("pages.shop.customer.numberMonth"),": ",null===(h=e.value)||void 0===h?void 0:h.numberMonth),"\xa0")}return f?Tn(d.default,{key:t,closable:!0,onClose:function(){return o.handleCloseTag(t,e.key)}},f):void 0}})),(0,S.Z)((0,y.Z)(o),"renderBirthdayTag",(function(e){var t=o.props.t,n="",s="";switch(e.type){case 1:n=t("pages.shop.customer.noDayOfBirth");break;case 2:n=t("month"),s=e.month;break;case 3:n=t("date"),s="".concat(e.date," - ").concat(e.month);break;case 4:n=t("year"),s=e.year;break;case 5:n=t("pages.shop.customer.haveThisMonth");case 6:n=t("pages.shop.customer.haveNextMonth");break;case 7:n=t("pages.shop.customer.recentBirthday")}return"".concat(n," ").concat(s)})),(0,S.Z)((0,y.Z)(o),"handleCloseTag",(function(e,t){var n=R()(o.state.params);["incurred_order","inserted_at"].includes(t)&&o.setState({timeRange:[]});var s=R()(o.state.filters);s.splice(e,1),["incurred_order","inserted_at"].includes(t)?("incurred_order"==t&&(delete n.start_time_incurred_order,delete n.end_time_incurred_order),"inserted_at"==t&&(delete n.end_time_inserted_at,delete n.start_time_inserted_at),o.setState({params:n},(function(){return o.handleAdvanceFilter(s)}))):o.handleAdvanceFilter(s)})),(0,S.Z)((0,y.Z)(o),"handleDeleteFilter",(function(){o.setState({groupByBirthdayView:!1,selectedRowKeys:[],filters:[],searchTerm:"",saleForm:"all",timeRange:[]}),o.fetchCustomers(!1)})),(0,S.Z)((0,y.Z)(o),"onOk",(function(){var e=o.props,t=e.t,n=e.accessToken,s=e.shopId,r=e.updateCustomerAction,a=e.customers,i=e.users,l=o.state,c=l.selectedUserId,d=l.selectedRowKeys;if(c){var p="".concat((0,fe.LpH)(),"/shops/").concat(s,"/customers/update_multi_assign_user?access_token=").concat(n);_e().post(p,{assigned_user_id:c,customer_ids:d}).then((function(e){var n;if(null!==e&&void 0!==e&&e.data&&e.data.success){var s=i.find((function(e){return e.user_id==c}));s={id:(s=s.user).id,fb_id:s.fb_id,avatar_url:s.avatar_url,name:s.name},d.forEach((function(e){var t=a.data.find((function(t){return t.id==e}));t.shop_customer.assigned_user_id=c,t.shop_customer.assigned_user=s,r(t)})),o.setState({visibleUpdateAssignedUser:!1,selectedUserId:void 0})}else u.default.error((null===e||void 0===e?void 0:e.data)&&((null===(n=e.data)||void 0===n?void 0:n.message)||t("action.unknownError")))}))}})),(0,S.Z)((0,y.Z)(o),"onChangeColumns",(function(e){o.columnWidth={},o.setState({checkedListCustomer:e}),localStorage.setItem("columnsCustomer",JSON.stringify({checkedListCustomer:e}))})),(0,S.Z)((0,y.Z)(o),"renderSettingColumn",(function(e){var t=o.props.t,n=o.state.checkedListCustomer,s={name:t("pages.shop.customer.nameCustomer"),blockCheck:t("pages.shop.customer.blockStatus"),level:t("components.customerLevel"),assigned_user:t("containers.formBoxModal.processedBy"),birthday:t("pages.shop.customer.birthday"),orderCount:t("pages.shop.customer.orderCount"),succeedOrderCount:t("containers.customerInfo.succeedOrderCount"),purchasedAmount:t("pages.shop.customer.purchasedAmount"),lastOrderAt:t("pages.shop.customer.lastOrderAt"),creator:t("pages.shop.customer.creator"),rewardPoints:t("containers.formBox.rewardPoints"),usedRewardPoints:t("containers.customerInfo.usedRewardPoint"),totalRewardPoints:t("containers.customerInfo.totalRewardPoints"),phoneNumbers:t("phoneNumber"),email:"Email",returnedOrderCount:t("containers.customerInfo.returnOrder"),address:t("pages.shop.customer.address"),tags:t("containers.customerInfo.tagCustomer"),insertedAt:t("pages.shop.customer.insertedAt"),referralCode:t("pages.shop.customer.referralCode")};return Tn(Ht.Z,{defaultCheckedList:jn,onChange:o.onChangeColumns,translate:s,t:t,isIcon:!1,displayColumns:n,addOptionColumns:Ln.filter((function(e){return!n.includes(e)})),isButton:e,title:t("pages.shop.setting.crmProfile.columnsSetting"),isTools:!0})})),(0,S.Z)((0,y.Z)(o),"handleCustomerTags",(function(e,t){var n=o.props,s=n.accessToken,r=n.shopId,a=n.updateShop,i=n.currentShop,l=n.t,c=R()(i.tags);"create"==t&&(c=c.concat([e.name]));var u=c.findIndex((function(t){return t==e.id}));return"update"==t&&u>-1&&c.splice(u,1,e.name),"delete"==t&&u>-1&&c.splice(u,1),a(s,{id:r,tags:c}).then((function(e){ge.Z.success(l("containers.customerInfo.updatedListTag"))}))})),(0,S.Z)((0,y.Z)(o),"linkToPancake",(function(){var e=o.state.params,t=o.props,n=t.currentShop,s=t.shopId,r=n.pages.map((function(e){return e.id})),a=On({shopId:s},e);1==r.length?window.open("".concat((0,fe.Thw)(),"/").concat(r[0],"?pos_params=").concat(JSON.stringify(a))):window.open("".concat((0,fe.Thw)(),"/multi_pages?page_ids=").concat(r,"&pos_params=").concat(JSON.stringify(a)))})),(0,S.Z)((0,y.Z)(o),"handleChangeFilterSaleForm",(function(e){var t=o.state.params,n=e.target.value;o.setState({saleForm:n}),t=On(On({},t),{},{sale_form:n}),o.fetchCustomers(t)})),(0,S.Z)((0,y.Z)(o),"getListActionTools",(function(){var e=o.props,t=e.accessToken,n=e.shopId,s=e.currentShop,r=e.users,a=e.isServer,i=e.timezone,l=e.t,c=o.state,u=c.selectedRowKeys,d=c.params,p=c.selectedCustomers,m=s?(0,vt.zE)(s.role):{},h=[{icon:Tn(U.Z,null),title:l("pages.shop.actionTools.importExcel"),key:"customer_import_excel",content:function(e){return Tn(pt,{accessToken:t,shopId:n,fetch:function(){return o.onClickRefresh(!0)},shop:s,isButton:e,title:l("pages.shop.actionTools.importExcel")})}},{icon:Tn(V.Z,null),title:l("pages.shop.actionTools.quickUpdate"),key:"quick_update",content:function(e){return Tn(tn,{currentShop:s,accessToken:t,shopId:n,selectedRowKeys:u,params:d,fetch:function(){return o.onClickRefresh()},isButton:e,title:l("pages.shop.actionTools.quickUpdate")})}},{icon:Tn(H.Z,null),title:l("pages.shop.statistic.inventory.exportExcel"),key:"customer_export_excel",content:function(e){return Tn(Te,{params:d,timezone:i,currentShop:s,accessToken:t,shopId:n,selectedRowKeys:u,selectedCustomers:p,users:r,isServer:a,isButton:e,title:l("pages.shop.statistic.inventory.exportExcel")})}},{icon:Tn(K.Z,null),title:l("pages.shop.actionTools.assignCustomer"),key:"assigned_customer",content:function(e){return Tn(he.Z,{icon:Tn(K.Z,null),onClick:function(){return u.length&&o.setState({visibleUpdateAssignedUser:!0})},title:l("pages.shop.actionTools.assignCustomer"),isButton:e})}},{icon:Tn(Y.Z,null),title:l("pages.shop.actionTools.customerTags"),key:"tag_customer",content:function(e){return Tn(_n.Z,{tags:(s.tags||[]).map((function(e){return{name:e,id:e}})),isButton:e,title:l("pages.shop.actionTools.customerTags"),deleteData:function(e){return o.handleCustomerTags(e,"delete")},updateData:function(e){return o.handleCustomerTags(e,"update")},createData:function(e){return o.handleCustomerTags(e,"create")}})}},{icon:Tn(q.Z,null),title:l("pages.shop.actionTools.multiDelete"),key:"multi_delete",content:function(e){return Tn(St,{setLoading:o.setLoadingMultiDel,accessToken:t,shopId:n,clearSelectedCustomers:function(){return o.setState({selectedCustomerIds:[],selectedRowKeys:[],selectedCustomers:[]})},selectedCustomerIds:u,fetchListOfCustomers:function(){return o.onClickRefresh(!0)},isButton:e,title:l("pages.shop.actionTools.multiDelete")})}},{icon:Tn(W.Z,null),title:l("pages.shop.actionTools.SMSConfig"),key:"SMS_config",content:function(e){return Tn(Vt,{accessToken:t,shopId:n,clearSelectedCustomers:function(){return o.setState({selectedCustomerIds:[],selectedRowKeys:[],selectedCustomers:[]})},selectedCustomerIds:u,selectedCustomers:p,fetchListCustomers:function(){return o.onClickRefresh(!0)},params:d,isButton:e,title:l("pages.shop.actionTools.SMSConfig")})}},{icon:Tn(G.Z,null),title:"Botcake audience",key:"botcake_audience",content:function(e){return Tn(fn,{accessToken:t,shopId:n,customerParams:d,selectedRowKeys:u,isButton:e,title:"Botcake audience"})}},{icon:Tn(Q.Z,null),title:l("pages.shop.setting.crmProfile.columnsSetting"),key:"setting_column",content:o.renderSettingColumn},{icon:Tn(J.Z,null),title:l("pages.shop.actionTools.crmContact"),key:"crm_contact",content:function(e){return Tn(he.Z,{icon:Tn(J.Z,null),title:l("pages.shop.actionTools.crmContact"),onClick:function(){window.open("".concat((0,fe.Thw)(!0),"/shop/").concat(n,"/table/Contact"))},isButton:e})}},{icon:Tn($.Z,null),title:l("pages.shop.customer.createVoucher"),key:"create_vouchers",content:function(e){return Tn(Zn,{isButton:e,accessToken:t,shopId:n,currentShop:s,params:d,selectedRowKeys:u})}}];if(!m.can_export_order){var f=h.findIndex((function(e){return"customer_export_excel"==e.key}));f>-1&&h.splice(f,1)}if(!s.is_linked_sms||!s.sms_account){var g=h.findIndex((function(e){return"SMS_config"==e.key}));g>-1&&h.splice(g,1)}if(!m.ql_khachhang){var v=h.findIndex((function(e){return"multi_delete"==e.key}));v>-1&&h.splice(v,1)}return h})),(0,S.Z)((0,y.Z)(o),"customerTableHeighStyle",(function(e){return e?Tn(j.default,{id:"1777224725"},[".customer-table .ant-table-body,.customer-table .ant-table-body-inner{min-height:calc(100vh - 230px);}"]):Tn(j.default,{id:"3370513830"},[".customer-table .ant-table-body,.customer-table .ant-table-body-inner{min-height:calc(100vh - 192px);}"])})),(0,S.Z)((0,y.Z)(o),"onSelectRow",(function(){var e=o.props,t=e.shopId,n=e.accessToken,s=R()(o.state.params),r="".concat((0,fe.LpH)(),"/shops/").concat(t,"/customers?access_token=").concat(n);s&&["start_time_inserted_at","end_time_inserted_at","start_time_incurred_order","end_time_incurred_order"].map((function(e){s[e]&&(s[e]=Ce()(s[e]).unix())}));var a=On(On({},s),{},{page:-1,page_size:500});o.setState({loadingData:!0});(function e(t){return _e().get(r,{params:t}).then((function(n){var s=o.state,r=s.loadingData,a=s.selectedRowKeys,i=n.data.data,l=i.map((function(e){return e.id})),c=a.filter((function(e){return!l.includes(e)})).concat(l);if(r&&o.onChangeSelectRowKey(c,i),r)return n.data.scroll_id?(t.scroll_id=n.data.scroll_id,e(t)):void 0}))})(a).then((function(e){return o.setState({loadingData:!1})}))})),(0,S.Z)((0,y.Z)(o),"onChangeSelectRowKey",(function(e,t){var n=o.props.customers,s=t&&t.length>0?t:n.data,r=o.state,a=r.selectedRowKeys,i=r.selectedCustomers.concat(e.filter((function(e){return!a.includes(e)})).map((function(e){return s.find((function(t){return t.id==e}))}))).filter((function(t){return e.includes(t.id)}));o.setState({selectedRowKeys:e,selectedCustomers:i})}));var s=e.isServer?Bn:localStorage.getItem("columnsCustomer")?JSON.parse(localStorage.getItem("columnsCustomer")).checkedListCustomer.filter((function(e){return"name"!=e&&"boom_quantity"!=e})):Bn;return o.columnWidth={},o.state={params:On({},Nn),filters:[],total_entries:0,isRefeshDisabled:!1,selectedCustomer:null,selectedRowKeys:[],searchTerm:"",customerNotes:[],purchasedAmount:void 0,provincesFilter:void 0,isLoading:!e.isServer,visibleUpdateAssignedUser:!1,selectedUserId:void 0,pageSize:M()(localStorage.getItem("customerPageSize")||30),paramsPointLogs:{page:1,page_size:30},pointLogs:[],pointLogsEntries:1,checkedListCustomer:s,groupByBirthdayView:!1,saleForm:"all",windowWidth:window.innerWidth,loadingData:!1,selectedCustomers:[],timeRange:[]},o.handleSearchInputChange=B()(o.handleSearchInputChange.bind((0,y.Z)(o)),400),o}return(0,_.Z)(n,null,[{key:"getInitialProps",value:function(){var e=(0,g.Z)(f().mark((function e(t,n){var o,s,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.isServer,s=t.store,r=t.query,!o){e.next=6;break}return e.next=4,s.dispatch((0,Le.N_V)(r.shopId,n));case 4:e.next=7;break;case 6:s.dispatch((0,Le.N_V)(r.shopId,n));case 7:return e.abrupt("return",{isServer:o,filterCustomer:r.filterCustomer});case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),(0,_.Z)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.isServer;e.customers.success||this.setState({isRefeshDisabled:!0});var n=this.state,o=n.params,s=n.pageSize;if(t){var r=localStorage.getItem("columnsCustomer");r&&this.setState({checkedListCustomer:JSON.parse(r).checkedListCustomer.filter((function(e){return"name"!=e&&"boom_quantity"!=e}))})}var a=window.location.href,i=new URL(a),l=null;if(i.search&&(l=JSON.parse(i.searchParams.get("params")))){var c=this.removeParamsUrl();window.history.pushState({},document.title,c)}o.page_size=s;var u=l||!1;if(u){var d=On(On({},o),u);this.fetchCustomers(d)}else this.fetchCustomers(o);this.getProvince()}},{key:"removeParamsUrl",value:function(){var e=window.location.href;return e.substring(e.lastIndexOf("/")+1).split("?")[0]}},{key:"componentDidUpdate",value:function(e,t){var n=this.state.selectedCustomer;if(n){var o=this.props.customers.data.find((function(e){return e.id==n.id}));T()(o,n)||this.setState({selectedCustomer:o})}}},{key:"renderCustomerInfoModal",value:function(){var e=this,t=this.props,n=t.accessToken,o=t.shopId,s=t.currentShop,r=t.updateShop,a=t.updateCustomer,i=t.timezone,l=this.state.modalVisible;return Tn(Ie.Z,{showCreateOrder:!0,customerInfo:this.state.selectedCustomer,accessToken:n,shopId:o,shop:s,updateShop:r,updateCustomer:a,customerNotes:this.state.customerNotes,timezone:i,modalVisible:l,callBackState:function(t){return e.setState(t)}})}},{key:"getData",value:function(){var e=this,t=this.lengthData,n=this.props,o=n.t,s=n.timezone,r=n.users,a=n.currentShop,i=n.groupByBirthday,u=this.state.groupByBirthdayView;if(!this.props.customers)return[];var p=[],h=this.sortDate(i).reduce((function(e,t){var n=t.data.map((function(e){return On(On({},e.customer),{},{date:t.date,shop_customer:e})}));return e.concat(n)}),[]);return[(u?h:this.props.customers.data).map((function(n){var i,u,h,f,g=n.shop_customer,v=g.date_of_birth,y=g.phone_numbers,_=g.shop_customer_addresses,b=g.referral_code,C=(0,fe.oH6)(n.shop_customer.succeed_order_count,a.currency),w=(0,fe.oH6)(n.shop_customer.returned_order_count,a.currency),S=(0,fe.oH6)(n.shop_customer.order_count,a.currency),k=(0,fe.ufS)(n.shop_customer.purchased_amount,n.shop_customer.currency||a.currency),x=n.shop_customer.last_order_at?(0,fe.o0x)(e.props.timezone||7,n.shop_customer.last_order_at):o("pages.shop.customer.noPurchaseHistory"),Z=null!==(i=n.shop_customer)&&void 0!==i&&i.creator_id?r.find((function(e){return e.user.id==n.shop_customer.creator_id})):null,T=Z?Tn("span",{style:{display:"flex",justifyItems:"center"}},Tn(se.Z,{id:null===Z||void 0===Z?void 0:Z.user.fb_id,size:[20,20],seed:null===Z||void 0===Z?void 0:Z.user.id,name:null===Z||void 0===Z?void 0:Z.user.name}),"\xa0",Tn("span",null,null===Z||void 0===Z?void 0:Z.user.name)):"",I=(0,fe.xAZ)(y[0]),O=Tn(c.default,null,y.map((function(t,n){var o=(0,fe.xAZ)(t);return Tn(c.default.Item,{key:n},o,e.renderCall(t))}))),E=(0,fe.o0x)(e.props.timezone||7,n.shop_customer.inserted_at),M=(0,fe.oH6)(Math.floor(n.shop_customer.reward_point)),D=(0,fe.oH6)(Math.floor(n.shop_customer.used_reward_point)),R=(0,fe.oH6)(Math.floor(n.shop_customer.reward_point)+Math.floor(n.shop_customer.used_reward_point)),P=n.shop_customer.tags&&n.shop_customer.tags.length>0?n.shop_customer.tags.filter((function(e){return(a.tags_exclusion_customer_level||[]).includes(e)})):[],N=(null===_||void 0===_?void 0:_.length)>0?_[0].full_address:"",L={dateOfBirth:n.date,key:n.id,name:(0,ft.LR)(n,e.props.accessToken),level:n&&n.shop_customer&&n.shop_customer.level&&n.shop_customer.level&&0==P.length?Tn(gt.Z,{color:n.shop_customer.level.color_customer_level,name:n.shop_customer.level.name}):"",birthday:v?v.toString().split("-").reverse().join("/"):Tn("span",{style:{color:"#ff3860",fontWeight:500}},o("pages.shop.customer.notYet")),address:Tn(m.default,{title:N},N),succeedOrderCount:C,returnedOrderCount:w,orderCount:S,purchasedAmount:k,lastOrderAt:x,creator:T,rewardPoints:M,usedRewardPoints:D,totalRewardPoints:R,insertedAt:E,blockCheck:n.shop_customer.is_block&&Tn(gt.Z,{color:"#FF0044",name:o("pages.shop.customer.blocked")}),assigned_user:n&&n.shop_customer&&n.shop_customer.assigned_user_id?Tn("span",{className:"column-user"},(0,fe.q$s)(n.shop_customer.assigned_user_id,r)):"",phoneNumbers:Tn("span",{className:"hightlight"},y.length>1?Tn(l.default,{overlay:O},Tn("span",{style:{color:"#096dd9",fontWeight:500}},I,e.renderCall(y[0]),Tn(X.Z,{style:{paddingLeft:5}}))):Tn("span",null,I,e.renderCall(y[0]))),email:Tn("div",null,((null===n||void 0===n||null===(u=n.shop_customer)||void 0===u?void 0:u.emails)||[]).map((function(e){return Tn("div",{key:e},e)}))),tags:((null===n||void 0===n||null===(h=n.shop_customer)||void 0===h?void 0:h.tags)||[]).map((function(e){return Tn(d.default,null,e)})),referralCode:Tn("span",null,Tn(nn.default,{recordSrc:b},Tn("a",null,b)))};return p.push({dateOfBirth:5,key:t(n.id),name:t(n.name)+3,level:t(n&&n.shop_customer&&n.shop_customer.level&&n.shop_customer.level.name)+2,birthday:t(v?(0,fe.o0x)(s||7,v,!1,"DD/MM/YYYY"):o("pages.shop.customer.notYet")),succeedOrderCount:t(C),returnedOrderCount:t(w),orderCount:t(S),purchasedAmount:t(k),lastOrderAt:t(x),creator:t(T),rewardPoints:t(M),usedRewardPoints:t(D),totalRewardPoints:t(R),blockCheck:t(n.shop_customer.is_block&&o("pages.shop.customer.blocked")),assigned_user:t(n&&n.shop_customer&&n.shop_customer.assigned_user&&n.shop_customer.assigned_user.name)+3,phoneNumbers:15,email:10,address:t(N),tags:t(((null===n||void 0===n||null===(f=n.shop_customer)||void 0===f?void 0:f.tags)||[]).map((function(e){return e}))),insertedAt:t(E),referralCode:t(b)}),L})),p]}},{key:"displayRender",value:function(e){return e[e.length-1]}},{key:"render",value:function(){var e=this,t=this.state,n=t.isRefeshDisabled,o=t.searchTerm,l=t.modalVisible,c=t.selectedRowKeys,u=t.filters,d=t.params,m=t.total_entries,h=t.visibleUpdateAssignedUser,f=t.selectedUserId,g=t.pageSize,v=t.checkedListCustomer,y=t.groupByBirthdayView,_=t.saleForm,b=t.loadingData,C=t.timeRange,w=this.props,S=w.accessToken,k=w.shopId,Z=w.currentShop,T=w.t,I=w.users,O=Z.reward_point_settings&&"true"==Z.reward_point_settings.enabled&&{title:T("containers.formBox.rewardPoints"),width:"10%",dataIndex:"rewardPoints",align:"right",ellipsis:!0,sorter:!0},E=Z.reward_point_settings&&"true"==Z.reward_point_settings.enabled&&{title:T("containers.customerInfo.usedRewardPoint"),width:"10%",dataIndex:"usedRewardPoints",align:"right",ellipsis:!0,sorter:!0},M=Z.reward_point_settings&&"true"==Z.reward_point_settings.enabled&&{title:T("containers.customerInfo.totalRewardPoints"),width:"10%",dataIndex:"totalRewardPoints",align:"right",ellipsis:!0,sorter:!0},D=[{title:T("pages.shop.customer.blockStatus"),width:"10%",dataIndex:"blockCheck"},{title:T("components.customerLevel"),width:"15%",dataIndex:"level",ellipsis:!0,sorter:!0},{title:T("containers.formBoxModal.processedBy"),width:"10%",dataIndex:"assigned_user",ellipsis:!0},{title:T("pages.shop.customer.birthday"),width:"10%",dataIndex:"birthday",ellipsis:!0},O,E,M,{title:T("pages.shop.customer.orderCount"),width:"10%",dataIndex:"orderCount",align:"right",ellipsis:!0,sorter:!0},{title:T("containers.customerInfo.succeedOrderCount"),width:"10%",dataIndex:"succeedOrderCount",align:"right",ellipsis:!0,sorter:!0},{title:T("containers.customerInfo.returnOrder"),width:"10%",dataIndex:"returnedOrderCount",align:"right",ellipsis:!0,sorter:!0},{title:T("pages.shop.customer.purchasedAmount"),width:"10%",dataIndex:"purchasedAmount",align:"right",ellipsis:!0,sorter:!0},{title:T("pages.shop.customer.lastOrderAt"),width:"10%",dataIndex:"lastOrderAt",align:"right",ellipsis:!0,sorter:!0},{title:T("pages.shop.customer.creator"),width:"10%",dataIndex:"creator",ellipsis:!0},{title:T("phoneNumber"),width:"10%",dataIndex:"phoneNumbers",align:"left",ellipsis:!0},{title:"Email",width:"8%",dataIndex:"email",align:"right",ellipsis:!0},{title:T("pages.shop.customer.address"),width:"10%",dataIndex:"address",ellipsis:!0},{title:T("containers.customerInfo.tagCustomer"),width:"10%",dataIndex:"tags",ellipsis:!0},{title:T("pages.shop.customer.insertedAt"),width:"10%",dataIndex:"insertedAt",align:"right",ellipsis:!0,sorter:!0},{title:T("pages.shop.customer.referralCode"),width:"10%",dataIndex:"referralCode",align:"left",ellipsis:!0}];D=D.filter((function(e){return e}));var R={selectedRowKeys:c,onChange:function(t){return e.onChangeSelectRowKey(t)},preserveSelectedRowKeys:!0,isSelection:!0,onSelectRow:this.onSelectRow},P=this.getData(),N=(0,p.Z)(P,2),L=N[0],B=N[1],j=(0,fe.Owf)(B,D.filter((function(e){return e.dataIndex})));D=D.map((function(e){return e.dataIndex?e.width=j[e.dataIndex]:e.width=0,e}));var F=(0,fe.f2Q)(D);if(!Z.reward_point_settings||"true"!=Z.reward_point_settings.enabled){var A=v.findIndex((function(e){return"rewardPoints"==e}));A>-1&&v.splice(A,1);var U=v.findIndex((function(e){return"usedRewardPoints"==e}));U>-1&&v.splice(U,1);var V=v.findIndex((function(e){return"totalRewardPoints"==e}));V>-1&&v.splice(V,1)}var H=v.map((function(e,t){return D.find((function(t){return t.dataIndex==e}))}));y&&(H=[{title:"Ng\xe0y sinh",dataIndex:"dateOfBirth",render:this.renderDateOfBirth,width:"80px",fixed:"left"}].concat(H));var K=(0,fe.A8U)(this.props.customers.data,T("pages.shop.customer.nameCustomer"),{windowWidth:this.state.windowWidth},"name"),Y=[{title:T("pages.shop.customer.nameCustomer"),dataIndex:"name",ellipsis:!0,fixed:"left",width:K}];H=[].concat(Y,(0,i.Z)(H));var q=!!Z&&(Z.active_module.includes(3)&&Z.wholesale&&Z.wholesale.tags_customer_to_wholesale&&Z.wholesale.tags_customer_to_wholesale.on),W=["search"],G=(u||[]).filter((function(e){return e.key&&!W.includes(e.key)}));return Tn(Oe.Z,{className:"container-layout",style:{overflow:"visible"}},Tn("div",{className:"tools-container"},Tn(Ve,{accessToken:S,shopId:k,fetch:function(){return e.onClickRefresh()}}),Tn(he.Z,{icon:Tn(ee.Z,null),onClick:function(){return e.onClickRefresh()},disabled:n,title:T("pages.shop.orderControlInfo.sync"),isButton:!0}),Tn(gn.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(e){return e.key})),keyView:"customer",subWidth:c.length>0||b||G.length>0?335:100}),G.length>0&&Tn(he.Z,{icon:Tn(z.Z,null),onClick:this.linkToPancake,title:T("pages.shop.customer.chatPancake"),isButton:!0}),!y&&Tn(yn.Z,{selectedLength:c.length,loadingData:b,total:m,onClick:function(){return e.setState({loadingData:!1,selectedRowKeys:[],selectedCustomers:[]})}}),Tn("div",{className:"filter"},Tn(a.default,{placeholder:T("pages.shop.customer.filterByCustomer"),value:o,prefix:Tn(te.Z,null),onChange:function(t){e.setState({searchTerm:t.target.value}),e.handleSearchInputChange(t.target.value)}}),Tn(Dn,{onChange:this.handleChangeFilterSaleForm,value:_,className:"sale-form",style:q?{display:"block"}:{display:"none"}},Tn(Rn,{value:"all"},T("commons.all")),Tn(Rn,{value:"wholesale"},Tn("span",{style:{marginLeft:5}},T("pages.shop.customer.wholesale"))),Tn(Rn,{value:"retail"},Tn("span",{style:{marginLeft:5}},T("pages.shop.customer.retail")))),Tn(bn.Z,{allowClear:!0,returnValue:!0,range:C,callback:this.onChangeFilterByTime,filterByBirthday:this.onFilterButtonClick,options:[{label:T("pages.shop.customer.insertedAt"),value:"inserted_at"},{label:T("pages.shop.customer.filterBirthday"),value:"date_of_birth"},{label:T("pages.shop.customer.timeIncurredOrder"),value:"incurred_order"}],view:"customer"}),G.length>0&&Tn(r.default,{className:"delete",danger:!0,onClick:function(){return e.handleDeleteFilter()}},T("crm.deleteFilter")),Tn(kt.Z,{accessToken:S,shopId:k,fetch:function(t){return e.handleAdvanceFilter(t)},filters:u})),Tn("div",{className:"tags-filter"},u.map((function(t,n){return e.renderFilter(t,n)})))),Tn("div",{className:"content-body",style:{marginTop:5}},Tn(vn.Z,{className:"customer-table ".concat(n?"blur-when-loading":""),size:"small",pagination:{size:"small",current:y?1:d.page,pageSize:y?L.length:g,total:y?1:m,pageSizeOptions:Pn,showSizeChanger:!y},onRow:function(t){return{onClick:function(n){return e.handleClickCustomer(t)}}},onChange:this.handleTableChange,columns:H,rowSelection:y?void 0:R,locale:{emptyText:T("pages.shop.customer.noCustomer")},dataSource:L,scroll:{x:F,y:u&&u.length>0?"calc(100vh - 230px)":"calc(100vh - 192px)"}})),l&&this.renderCustomerInfoModal(),Tn(s.Z,{onOk:this.onOk,onCancel:function(){return e.setState({visibleUpdateAssignedUser:!1,selectedUserId:void 0})},closeIcon:!0,className:"update-multi-assigned_user",visible:h},Tn("div",{className:"fw600",style:{marginBottom:5}},T("pages.shop.customer.assignedTo")),Tn(x.default,{value:f,onChange:function(t){return e.setState({selectedUserId:t})},placeholder:T("containers.formBoxModal.selectUser"),style:{width:"100%"},filterOption:function(e,t){return(0,fe.st5)(e,t.children.props.name)},showSearch:!0},I.map((function(e){return Tn(Mn,{key:e.user_id,value:e.user_id},(0,fe.q$s)(e.user_id,I))})))),n&&Tn(Ee.Z,null),this.customerTableHeighStyle(u&&u.length>0))}}]),n}(F.Component);(0,S.Z)(Fn,"pageInfo",{title:"customers.title",sassStyle:oe()});var An=(0,Pe.$j)((function(e){return On(On({timezone:e.navigation.user.timezone},(0,ht.H5)(e)),{},{users:e.user.users,groupByBirthday:e.customer.groupByBirthday,warehouses:e.warehouse.warehouses,order_sources_custom:(0,ht.ME)(e)})}),{fetchListOfCustomers:Le.ezi,updateShop:Le.tUB,updateCustomer:Le.uGj,updateCustomerAction:Le.VEp,call:Kt.Z.call,sipChange:Kt.Z.sipChange,fetchCustomerByBirthday:Le.NJO,fetchCustomerLevels:Le.N_V})((0,mt.Z)(Fn))},71453:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shop/customer",function(){return n(71349)}])}},function(e){e.O(0,[5460,2902,4517,1759,9774,2888,179],(function(){return t=71453,e(e.s=t);var t}));var t=e.O();_N_E=t}]);