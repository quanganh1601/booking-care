(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[532],{95831:function(e){!function(){"use strict";e.exports=".select-layout{display:grid;background-color:#fff;font-size:14px}.select-layout:first-child{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.select-layout span{font-weight:500;white-space:nowrap}.select-layout .item-info{width:100%;display:grid;align-items:center;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.select-layout .item-info .ant-select{width:100% !important;border:unset}.select-layout .item-info .ant-select .ant-select-selection{border:unset}.select-layout .item-info .box-input-number-wrapper{border-radius:2px !important}.select-layout .item-info .box-input-number-wrapper .ant-input-number-focused{border-radius:2px !important}.select-layout .item-info .box-input-number-wrapper .ant-input-suffix{top:0px}.select-layout .item-info .ant-input{border-radius:2px !important}.purchase-detail .ant-modal-footer .custom-footer{display:flex;justify-content:flex-end}.purchase-detail .ant-table-body{overflow-x:hidden}.purchase-detail .ant-table-body .ant-table-tbody .ant-table-row{height:50px}.purchase-table-container .purchase-table-row-light{background-color:#ebf8f2 !important}.purchase-table-container .ant-table-footer{padding-bottom:8px !important}.popover-suggestion{width:75%}tr.drop-over-downward td{border-bottom:2px dashed #096dd9}tr.drop-over-upward td{border-top:2px dashed #096dd9}.purchase-image .ant-upload-list-picture-card{display:unset !important}.sync-div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-align:left}.sync-div .sync-btn{width:24px !important;height:24px !important;padding:0px 0 3px !important}.sync-div .sync-btn>*{font-size:14px}.sync-div .unsync-btn{color:#595959;background-color:#fff;border:.5px solid #bfbfbf}"}()},69705:function(e){!function(){"use strict";e.exports=".upload-image .ant-upload-list .ant-upload-list-item{padding:2px}.upload-image .ant-upload-list .ant-upload-list-picture-card-container,.upload-image .ant-upload-list .ant-upload-select-picture-card{height:75px;width:75px}.upload-image .ant-upload-list .ant-upload-list-picture-card-container .ant-upload-text,.upload-image .ant-upload-list .ant-upload-select-picture-card .ant-upload-text{margin-top:8px;font-size:12px;color:#666}.upload-image .ant-upload-list .ant-upload-animate-inline-appear,.upload-image .ant-upload-list .ant-upload-animate-inline-enter,.upload-image .ant-upload-list .ant-upload-animate-inline-leave{-webkit-animation-duration:.1s;animation-duration:.1s}.create-shop-upload-avatar .ant-upload-select-picture-card{height:104px !important;width:104px !important}"}()},71502:function(e){!function(){"use strict";e.exports=".supplier-products-modal .ant-modal-header{padding:0px;border-bottom:none !important}.supplier-products-modal .ant-modal-header .tab-supplier-creator .ant-tabs-nav{margin-bottom:0px !important}.supplier-products-modal .ant-modal-body{background-color:#ededed}.supplier-products-modal .ant-modal-body .supplier-debt-must-pay .debt-info{width:100%;margin-bottom:10px;display:flex;justify-content:space-between}.supplier-products-modal .ant-modal-body .supplier-debt-must-pay .debt-info .second .ant-btn{border-radius:2px}.supplier-products-modal .ant-modal-body .supplier-info .ant-input{border-radius:2px !important}.supplier-products-modal .ant-modal-body .supplier-info .ant-select-selection{border-radius:2px !important}.supplier-products-modal .ant-modal-body .supplier-info .containers{display:grid;width:100%;background-color:#fff;border-radius:2px;font-size:14px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);padding:16px}.supplier-products-modal .ant-modal-body .supplier-info .containers .info{width:100%;display:grid;align-items:center;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;margin-bottom:16px}.supplier-products-modal .ant-modal-body .supplier-info .containers .info span{font-weight:500;white-space:nowrap;margin-bottom:4px}.supplier-products-modal .ant-modal-body .supplier-info .containers .info:last-child{margin-bottom:0px}.supplier-products-modal .ant-modal-body .supplier-info .containers .address{display:flex;flex-direction:row;justify-content:space-between;margin-top:16px;margin-bottom:16px}.supplier-products-modal .ant-modal-body .supplier-info .containers .address .ant-select{width:30%;margin-left:8px}.supplier-products-modal .ant-modal-body .supplier-info .containers .address .ant-select:first-child{margin-left:0px}"}()},4758:function(e,t,n){"use strict";var a,i=n(17669),r=n(51024),s=n(11187),o=n(59361),c=n(28140),u=n(74047),l=n(52700),d=n(4706),p=n(33814),h=n(44102),m=n(20775),f=n(26265),g=n(23279),v=n.n(g),y=n(67294),_=n(9669),b=n.n(_),S=n(14494),x=n(95213),I=n(87217),Z=n(68628),w=n(7085),C=n(76570),P=y.createElement;function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,m.Z)(e);if(t){var i=(0,m.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,h.Z)(this,n)}}var k=(0,I.Z)()(a=function(e){(0,p.Z)(n,e);var t=D(n);function n(e){var a;return(0,u.Z)(this,n),a=t.call(this,e),(0,f.Z)((0,d.Z)(a),"onSearch",(function(e){var t=e.target&&e.target?e.target.value:e;a.setState({loading:!0}),a.sendSearchProductRequest(t)})),a.state={loading:!1,searchTerm:"",open:!1},a.sendSearchProductRequest=v()(a.sendSearchProductRequest.bind((0,d.Z)(a)),400),a}return(0,l.Z)(n,[{key:"renderAutoCompleteDataSource",value:function(){var e=this.props,t=e.searchResult;e.t;return(0,c.Z)(t).map((function(e){var t,n=e.id,a=e.name,i=e.prefix,r=e.accessories,s=e.custom_id,c=e.display_id,u=e.fields;u&&u.length>0&&(t=u.filter((function(e){return"undefined"!=e.value})).map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", "));return{label:P(y.Fragment,null,P("div",{style:{width:"100%",display:"flex"}},c?P(o.default,{color:"pink"},s||(0,x.pyT)(c,0)):null,i||null," ",P("div",{className:"item-name"},P("strong",null,r?r.name:a))),!i&&t&&P("div",null,P("span",{className:"item-property"},P(Z.Z,null),P("span",{style:{color:"#096dd9"}}," ",t)))),value:n}}))}},{key:"sendSearchProductRequest",value:function(e){var t=this;if(""===e||void 0!==e.target)return this.setState({loading:!1});e=e.replace(/\n/g,"");var n=this.props,a=n.accessToken,i=n.shopId,r=n.t,s={access_token:a};s.search=e,this.props.warehouse_id&&(s.warehouse_id=this.props.warehouse_id);var o="".concat((0,x.LpH)(),"/shops/").concat(i,"/accessories_variations");b()({method:"get",url:o,params:s}).then((function(e){if(200===e.status&&e.data&&!0===e.data.success){var n=(0,c.Z)(e.data.data);return 0===n.length&&n.push({id:"no-result",name:r("components.accessoriesSearchBar.noResultWereFound"),prefix:"! ",disabled:!0}),t.props.callback(n),t.setState({loading:!1})}return t.props.callback([{id:"no-result",name:r("components.accessoriesSearchBar.noResultWereFound"),prefix:"! ",disabled:!0}]),t.setState({loading:!1})}))}},{key:"handleInputSearchChange",value:function(e){var t=e.target&&e.target?e.target.value:e;this.setState({searchTerm:t})}},{key:"handleOnSelect",value:function(e){this.setState({searchTerm:""}),"no-result"!=e&&(this.props.onSelect(e),s.default.success("Th\xeam th\xe0nh c\xf4ng nguy\xean ph\u1ee5 li\u1ec7u"))}},{key:"render",value:function(){var e=this,t=this.state,n=t.searchTerm,a=t.loading,s=t.open,o=this.props,c=o.t,u=o.filterProduct,l=o.style;return P("div",{className:"box-auto-complete",style:l||{}},P(i.Z,{open:s,onFocus:function(){return e.setState({open:!0})},onBlur:function(){return e.setState({open:!1})},className:"global-search",value:n,style:{width:"100%"},onChange:this.handleInputSearchChange.bind(this),onSearch:this.onSearch,placeholder:c(u?"components.accessoriesSearchBar.filterAccessories":"components.accessoriesSearchBar.enterNameOfAccessories"),onSelect:this.handleOnSelect.bind(this),options:this.renderAutoCompleteDataSource(),dropdownClassName:"dropdown-box-accessories-select"},P(r.default,{suffix:P("span",null,P(a?w.Z:C.Z,null))})),P("style",{dangerouslySetInnerHTML:{__html:l}}))}}]),n}(y.Component))||a;t.Z=(0,S.$j)((function(e){return{currentShop:e.shop.currentShop}}))(k)},99791:function(e,t,n){"use strict";var a,i=n(56697),r=n(62443),s=n(14321),o=n(64713),c=n(31059),u=n(94055),l=n(2307),d=n(65400),p=n(809),h=n.n(p),m=n(28140),f=n(92447),g=n(74047),v=n(52700),y=n(4706),_=n(33814),b=n(44102),S=n(20775),x=n(26265),I=n(64749),Z=n(51024),w=n(23279),C=n.n(w),P=n(89734),D=n.n(P),k=n(44908),N=n.n(k),T=n(18446),q=n.n(T),O=n(50361),R=n.n(O),M=n(41609),A=n.n(M),L=n(67294),z=n(14494),j=n(17405),B=n(7085),H=n(92104),E=n(25592),F=n(73218),V=n(14283),W=n(30381),Q=n.n(W),U=n(9669),$=n.n(U),K=n(95213),Y=n(20920),J=n(36934),G=n(31432),X=n(97705),ee=n(4758),te=n(44122),ne=n(87217),ae=n(22318),ie=n(74298),re=n(7463),se=n(19925),oe=n(48519),ce=n(95831),ue=n.n(ce),le=n(41850),de=n(7859),pe=n(83049),he=n(17567),me=n(73427),fe=n(17918),ge=n(60517),ve=n(88460),ye=n(60243),_e=L.createElement;function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){(0,x.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,S.Z)(e);if(t){var i=(0,S.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,b.Z)(this,n)}}var Ie=Z.default.TextArea,Ze=Z.default.Search,we=I.default.Option,Ce={items:[],accessories_items:[],note:"",warehouse:{},status:0,not_create_transaction:!1,auto_create_debts:!0,is_batch_shelf:!1},Pe="table-container",De=(0,ne.Z)()(a=function(e){(0,_.Z)(n,e);var t=xe(n);function n(e){var a,i;(0,g.Z)(this,n),i=t.call(this,e),(0,x.Z)((0,y.Z)(i),"listenKeyWhenPastePhoto",(function(){document.addEventListener("paste",i.showQuickUploadPhoto)})),(0,x.Z)((0,y.Z)(i),"showQuickUploadPhoto",(function(e){i.retrieveImageFromClipboard(e,(function(e){i.handelUploadFiles(e,0)}))})),(0,x.Z)((0,y.Z)(i),"handelUploadFiles",function(){var e=(0,f.Z)(h().mark((function e(t,n){var a,r,s,o,c,u,l,d;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.state,r=a.fileList,s=a.purchase,o=t[n],c=i.props.accessToken,u=new FormData,e.next=6,new Promise((function(e){var t=new FileReader;t.onload=function(){var n=new Image;n.onload=function(){u.append("width",n.width),u.append("height",n.height),e(o)},n.src=t.result},t.readAsDataURL(o)}));case 6:l=e.sent,u.append("file",l),d="".concat((0,K.LpH)(!0),"/contents?access_token=").concat(c),$().post(d,u).then((function(e){var a=[{uid:r.length+1,response:{content_url:e.data.content_url},status:"done",url:e.data.content_url}],o=(r=[].concat((0,m.Z)(r),a)).map((function(e){return e.response?e.response.content_url:e}));s.images=o,i.setState({fileList:r,purchase:s}),n+1<t.length&&i.handelUploadFiles(t,n+1)})).catch((function(e){return console.log(e)}));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,x.Z)((0,y.Z)(i),"handleInputNumberChange",(function(e,t,n,a){var r=Se({},i.state.purchase);if("product"==e)if("separateQuantity"==t)r.items[n].quantity=r.items[n].quantity+(r.items[n].separateQuantity||0)-a,r.items[n].remain_quantity=r.items[n].remain_quantity+(r.items[n].separateQuantity||0)-a,r.items[n].separateQuantity=a;else{1==r.status&&r.id?r.items[n].remain_quantity+=a-r.items[n].quantity:r.items[n].remain_quantity=a,r.items[n][t]=a;var s=r.items[n].number_of_batch||0,o=r.items[n].quantity_per_batch||0;r.items[n].maxNumber=Math.floor(a/(o||1)),a>=s*o?r.items[n].maxQty=Math.floor(a/(s||1)):r.items[n].number_of_batch=0}else r.accessories_items[n][t]=a;i.setState({purchase:r})})),(0,x.Z)((0,y.Z)(i),"handleChangeBatch",(function(e,t,n){var a=Se({},i.state.purchase),r=a.items[t].quantity,s=a.items[t].number_of_batch||0,o=a.items[t].quantity_per_batch||0;"quantity_per_batch"==e?(a.items[t].maxNumber=Math.floor(r/(n||1)),a.items[t].maxQty=Math.floor(r/(s||1)),r<s*n&&(a.items[t].number_of_batch=0)):(a.items[t].maxQty=Math.floor(r/(n||1)),a.items[t].maxNumber=Math.floor(r/(o||1)),r<o*n&&(a.items[t].quantity_per_batch=0)),a.items[t][e]=n,i.setState({purchase:a})})),(0,x.Z)((0,y.Z)(i),"handleInputFormatMoney",(function(e,t,n,a){var r=Se({},i.state.purchase);switch(e){case"product":r.items[n][t]=a;break;case"transport":r[t]=a;break;default:r.accessories_items[n][t]=a}i.setState({purchase:r})})),(0,x.Z)((0,y.Z)(i),"getData",(function(){var e=i.props,t=e.t,n=e.currentShop,a=i.state,r=a.purchase,s=a.isAccessories,o=[];s?r.accessories_items.map((function(e,n){var a,r,s,c,u,l,d,p,h,m,f=e.accessories_variation&&e.accessories_variation.accessories?e.accessories_variation.accessories.is_removed?t("components.productPurchaseDetail.accessoriesWasDelete"):e.accessories_variation.accessories.name:t("components.productPurchaseDetail.accessoriesWasDelete");o.push({key:n,accId:(null===(a=e.accessories_variation)||void 0===a||null===(r=a.accessories)||void 0===r?void 0:r.custom_id)||(null===(s=e.accessories_variation)||void 0===s||null===(c=s.accessories)||void 0===c?void 0:c.display_id),images:(0,Y.ip)((null===e||void 0===e||null===(u=e.accessories_variation)||void 0===u?void 0:u.images)||[]),accVariationId:(null===(l=e.accessories_variation)||void 0===l?void 0:l.custom_id)||(null===(d=e.accessories_variation)||void 0===d?void 0:d.display_id),accName:f,note:{value:(null===e||void 0===e?void 0:e.note)||"",index:n},unit:(null===(p=e.accessories_variation)||void 0===p||null===(h=p.accessories)||void 0===h?void 0:h.unit)||"",fields:(null===(m=e.accessories_variation)||void 0===m?void 0:m.fields)||[],price:{value:e.imported_price,index:n},quantity:{value:e.quantity,index:n},remain:(0,K.oH6)(e.remain_quantity),totalPrice:(0,K.ufS)(e.quantity*((null===e||void 0===e?void 0:e.imported_price)||0),i.props.currentShop.currency),deleteAccessories:n})})):(i.state.purchase.items||[]).map((function(e,a){var r,s,c,u,l,d,p,h,m,f,g;o.push({key:a,selectedId:e.variation_id,note:{value:e.note_purchase,index:a},productName:(null===(r=e.variation)||void 0===r||null===(s=r.product)||void 0===s?void 0:s.name)||t("components.productPurchaseDetail.productWasDelete"),productId:(null===(c=e.variation)||void 0===c||null===(u=c.product)||void 0===u?void 0:u.custom_id)||(0,K.pyT)(null===(l=e.variation)||void 0===l||null===(d=l.product)||void 0===d?void 0:d.display_id,0),variationId:e.variation.is_removed?t("components.productPurchaseDetail.variationWasDelete"):e.variation.custom_id||(0,K.pyT)(e.variation.display_id,0),fields:e.variation.fields||[],images:(0,Y.ip)((null===(p=e.variation)||void 0===p?void 0:p.images)||[]),price:{value:e.imported_price,index:a},quantity:{value:e.quantity,index:a},separateQuantity:{value:e.separateQuantity||0,index:a,max:e.quantity+(e.separateQuantity||0)},remain:(0,K.oH6)(e.remain_quantity<0?0:e.remain_quantity,n.currency),totalPrice:(0,K.ufS)(e.quantity*((null===e||void 0===e?void 0:e.imported_price)||0),n.currency),custom_id:(null===(h=e.variation)||void 0===h?void 0:h.custom_id)||"".concat(null===(m=e.variation)||void 0===m||null===(f=m.product)||void 0===f?void 0:f.display_id,"-").concat(null===(g=e.variation)||void 0===g?void 0:g.display_id),quantityPerBatch:{value:e.quantity_per_batch||0,index:a,max:e.maxQty},numberOfBatch:{value:e.number_of_batch||0,index:a,max:e.maxNumber},sellingStatus:i.renderStatus(e),delete:a,originItem:e})}));return i.state.isAccessories?o:o.filter((function(e){return i.conditionFilterProductItem(e.originItem)}))})),(0,x.Z)((0,y.Z)(i),"conditionFilterProductItem",(function(e){var t=i.state.searchProduct,n=e.variation.fields.map((function(e){return e.value})),a=function(e,t){return(0,K.Mle)(e).includes((0,K.Mle)(t))};return a(e.variation.product.name,t)||a(e.variation.product.custom_id,t)||a(e.variation.product.display_id,t)||a(e.variation.display_id,t)||a(e.variation.custom_id,t)||n.find((function(e){return a(e,t)}))})),(0,x.Z)((0,y.Z)(i),"renderStatus",(function(e){var t,n,a=i.state.purchase;a.warehouse_id?t=(null===(n=e.variation.variations_warehouses)||void 0===n?void 0:n.filter((function(e){return e.warehouse_id==a.warehouse_id})))||[]:t=e.variation.variations_warehouses||[];return(0,Y.SZ)(e.id?[e]:t,!1,!1)})),(0,x.Z)((0,y.Z)(i),"handleSeparatePurchase",(function(){i.setState({isLoading:!0});var e=i.state,t=e.purchase,n=e.oldStatus,a=i.props,r=a.updateSeparatePurchase,s=a.accessToken,o=a.shopId,c=a.fetchPurchase,u=a.close,l=R()(t),d=R()(t),p=t.items?t.items.map((function(e,t){return Se(Se({},e),{},{index:t})})):void 0,h=p.filter((function(e){return e.separateQuantity})).map((function(e){return Se(Se({},e),{},{quantity:e.separateQuantity})}));p.length>0&&(p=p.filter((function(e){return 0!=e.quantity}))),d.items=p,d.status=n,l.items=h,l.note="",delete l.transaction_id,delete l.inserted_at,delete l.warehouse,delete l.user,delete l.user_id,delete l.updated_at,delete l.display_id,r(s,o,l,d).then((function(e){e&&(i.setState({isSeparate:!1,isLoading:!1}),c(),u())})).catch((function(e){i.setState({isSeparate:!1,isLoading:!1})}))})),(0,x.Z)((0,y.Z)(i),"handleSave",(function(){var e;i.setState({isLoading:!0});var t=i.props,n=t.updatePurchase,a=t.createPurchase,r=t.accessToken,s=t.shopId,o=t.close,c=t.createPurchaseAccessories,u=t.updatePurchaseAccessories,l=t.countersPurchase,d=t.params,p=i.state,h=p.purchase,m=p.isCreating,f=p.typePrint,g=p.isAccessories,v=p.sorterVariationId,y=!1;if((h.items&&h.items.length>0||h.accessories_items&&h.accessories_items.length>0)&&(h.accessories_items&&h.accessories_items.length>0?h.accessories_items.map((function(e){e.quantity<0&&(y=!0)})):h.items.map((function(e){e.quantity<0&&(y=!0)}))),y)return i.setState({isLoading:!1}),ae.Z.error(ie.ZP.t("pages.admin.failure"),ie.ZP.t("components.productPurchaseDetail.notNegativeNumber"));var _=h.items?h.items:void 0;_&&(v&&(_=_.sort((function(e,t){var n,a,i,r,s,o,c,u,l=(null===(n=e.variation)||void 0===n?void 0:n.custom_id)||"".concat(null===(a=e.variation)||void 0===a||null===(i=a.product)||void 0===i?void 0:i.display_id,"-").concat(null===(r=e.variation)||void 0===r?void 0:r.display_id),d=(null===(s=t.variation)||void 0===s?void 0:s.custom_id)||"".concat(null===(o=t.variation)||void 0===o||null===(c=o.product)||void 0===c?void 0:c.display_id,"-").concat(null===(u=t.variation)||void 0===u?void 0:u.display_id);return l<d?-1:l>d?1:0})),_="descend"==v?_.reverse():_),_=_.map((function(e,t){return Se(Se({},e),{},{index:t,display_id:t})})));var b=R()(h);(b.items=_,b.images=null!==(e=b.images)&&void 0!==e&&e.length?b.images:"-1",m)?(b.shop_id=s,delete b.warehouse,g?(l(r,s,Se(Se({},d),{},{type:"accessories"})),c(r,s,b).then((function(e){i.setState({isLoading:!1}),o(e)}))):a(r,s,b).then((function(e){f&&!g&&i.child.handlePrint(),o(),l(r,s,Se(Se({},d),{},{type:"purchase"})),i.setState({isLoading:!1,purchase:Se({},Ce)})})).catch(i.handleSetDraft())):h.accessories_items?(u(r,s,b),i.setState({isLoading:!1}),o()):(b.supplier_products_id=b.supplier_products_id||"-1",n(r,s,b).then((function(e){f&&!g&&i.child.handlePrint(),o(e),i.setState({isLoading:!1})})));i.setState({searchProduct:""})})),(0,x.Z)((0,y.Z)(i),"handlePurchaseChange",(function(e,t){var n=e.target?e.target.value:e,a=Se({},i.state.purchase);a[t]=n,i.setState({purchase:a})})),(0,x.Z)((0,y.Z)(i),"onChangeWarehouse",(function(e){var t=i.state.isAccessories,n=Se({},i.state.purchase);n.warehouse_id=e,i.setState({purchase:n}),localStorage.setItem("".concat(t?"purchase_accessories":"purchase","_warehouse_in_shop_").concat(i.props.shopId),e),i.handleFetchSuggestion(e)})),(0,x.Z)((0,y.Z)(i),"handleFetchSuggestion",(function(e){var t=i.props,n=t.shopId,a=t.accessToken,r=i.state.paramsSuggestion;r.warehouse_id=e;var s="".concat((0,K.LpH)(),"/shops/").concat(n,"/purchases/purchase_suggestion?access_token=").concat(a);i.setState({isLoadingSuggestion:!0}),$()({method:"get",url:s,params:r}).then((function(e){var t;null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.success&&i.setState({listSuggestions:e.data.data||[],paramsSuggestion:Se(Se({},r),{},{total_entries:e.data.total_entries})}),i.setState({isLoadingSuggestion:!1})}))})),(0,x.Z)((0,y.Z)(i),"handleOnChangeTableSuggestion",(function(e){var t=i.state.paramsSuggestion;t.page=e.current,i.setState({paramsSuggestion:t},(function(){i.state.purchase.warehouse_id&&i.handleFetchSuggestion(i.state.purchase.warehouse_id)}))})),(0,x.Z)((0,y.Z)(i),"onChangeSupplierProducts",(function(e){var t=Se({},i.state.purchase);t.supplier_products_id=e||null,e?localStorage.setItem("supplier_product_in_shop_".concat(i.props.shopId),e):localStorage.removeItem("supplier_product_in_shop_".concat(i.props.shopId)),i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"handleChangeTags",(function(e){e=e.length?e:"-1";var t=Se({},i.state.purchase);t.tags=e,i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"onChangeAutoCreateDebts",(function(e){var t=Se({},i.state.purchase);t.auto_create_debts=e,i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"handleSelectItem",(function(e){if("no-result"!=e){var t=i.state,n=t.search_by,a=t.onScreenBarcode,r=t.searchResult;if(i.setState({isSelectItem:!0,selectedId:e}),"product"!=n||a){var s=r.find((function(t){return t.id==e}));i.handleSelectItemSearchByVariation(s)}else{var o=r.find((function(t){return t.id==e}));i.handleSelectItemSearchByProduct(o)}}})),(0,x.Z)((0,y.Z)(i),"handleScrollTo",C()((function(e){i.setState({scrollIndex:e},(function(){i.setState({isSelectItem:!1})}))}),200)),(0,x.Z)((0,y.Z)(i),"handleSelectItemSearchByVariation",(function(e){var t=Se({},i.state.purchase),n=t.items.findIndex((function(t){return t.variation_id==e.id}));-1==n?(t.items.push(i.objectVariation(e)),i.handleScrollTo(t.items.length-1)):(t.items[n]=Se(Se({},t.items[n]),{},{quantity:t.items[n].quantity+1,remain_quantity:t.items[n].remain_quantity+1}),i.handleScrollTo(n)),i.state.onScreenBarcode&&ae.Z.success("".concat(i.props.t("pages.shop.addProductSuccess")," ").concat(e.product.name)),i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"handleSelectItemSearchByProduct",(function(e){var t=i.state.purchase;e.variations.map((function(n){var a=t.items.findIndex((function(e){return e.variation_id==n.id}));n.product={name:e.name,custom_id:e.custom_id,display_id:e.display_id,manipulation_warehouses:e.manipulation_warehouses||[]},-1==a?(t.items.push(i.objectVariation(n)),i.handleScrollTo(t.items.length-1)):(t.items[a]=Se(Se({},t.items[a]),{},{quantity:t.items[a].quantity+1,remain_quantity:t.items[a].remain_quantity+1}),i.handleScrollTo(a)),i.state.onScreenBarcode&&ae.Z.success("".concat(i.props.t("pages.shop.addProductSuccess")," ").concat(n.product.name))})),i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"objectVariation",(function(e){return{variation:e,imported_price:e.last_imported_price,product_name:e.product.name,quantity:i.state.onScreenBarcode?1:0,remain_quantity:i.state.onScreenBarcode?1:0,variation_id:e.id}})),(0,x.Z)((0,y.Z)(i),"handleSelectItemAccessories",(function(e){var t=i.state,n=t.search_by,a=t.searchResultAccessories,r=t.searchResult,s=("bill-of-materials"==n?r:a).find((function(t){return t.id==e})),o=R()(i.state.purchase),c=[];"bill-of-materials"==n?c=s.bill_of_material_items.map((function(e){return Se(Se({},e.accessories_variation),{},{qty_import:e.quantity})})):c.push(s),c.map((function(e){var t=o.accessories_items.findIndex((function(t){return t.id==e.id}));-1==t?o.accessories_items.push(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{accessories_variation:e,id:e.id,accessories_variation_id:e.id,inserted_at:e.inserted_at,updated_at:e.updated_at,imported_price:e.last_imported_price,quantity:t,note:e.accessories.note}}(e,e.qty_import)):o.accessories_items[t].quantity+=e.qty_import||1})),i.setState({purchase:o})})),(0,x.Z)((0,y.Z)(i),"handleSetPrintBarcode",(function(e){var t=i.props,n=t.shopId,a=t.accessToken,r=t.currentShop,s=i.state.purchase,o=[];return s.items&&s.items.length&&s.items.forEach((function(e){var t=o.findIndex((function(t){return e.variation.id==t.id}));t>-1?o[t]=Se(Se({},o[t]),{},{printQuantity:o[t].printQuantity+e.quantity}):o.push(Se(Se({},e.variation),{},{printQuantity:e.quantity}))})),_e("span",{style:{marginRight:12}},_e(te.Z,{accessToken:a,shopId:n,currentShop:r,variations:o,createAndPrint:!0,onRef:function(e){i.child=e},isType:e,noTitle:!0,width:40}))})),(0,x.Z)((0,y.Z)(i),"getSelectedSupplier",(function(e){var t=i.props.supplier_products;if(t&&t.length>0)return t.filter((function(t){return t.id==e})).length>0?t.filter((function(t){return t.id==e}))[0]:void 0})),(0,x.Z)((0,y.Z)(i),"handleScrollTable",(function(e){var t=document.getElementById("row-footer");t&&(t.scrollLeft=e.target.scrollLeft)})),(0,x.Z)((0,y.Z)(i),"handleSearchFilter",(function(e){return i.setState({search_by:e,searchResult:[]})})),(0,x.Z)((0,y.Z)(i),"onChangeInsertedAt",(function(e){if(e){var t=Q()(e.startOf("day")).unix();i.setState({purchase:Se(Se({},i.state.purchase),{},{inserted_at:t,change_inserted_at:!0})})}})),(0,x.Z)((0,y.Z)(i),"onChangeReceivedAt",(function(e){if(e){var t=Q()(e.startOf("day")).unix();i.setState({purchase:Se(Se({},i.state.purchase),{},{received_at:t,change_received_at:!0})})}})),(0,x.Z)((0,y.Z)(i),"handleAddItem",(function(e){var t=R()(i.state.purchase),n=t.items.findIndex((function(t){return t.variation_id==e.id}));-1==n?t.items.push(i.objectVariation(e)):t.items[n]=Se(Se({},t.items[n]),{},{quantity:t.items[n].quantity+1,remain_quantity:t.items[n].remain_quantity+1}),i.setState({purchase:t})})),(0,x.Z)((0,y.Z)(i),"columnsSuggestion",[{title:i.props.t("products.title"),dataIndex:"name",width:"15%",ellipsis:!0},{title:i.props.t("components.productComboDetail.productId"),dataIndex:"product_id",width:"15%",ellipsis:!0},{title:i.props.t("components.productComboDetail.variationId"),dataIndex:"variation_id",width:"15%",ellipsis:!0},{title:i.props.t("components.productComboDetail.attributes"),dataIndex:"variation_fields",ellipsis:!0},{title:i.props.t("components.productComboDetail.importedPrice"),dataIndex:"last_imported_price",width:"15%",ellipsis:!0,align:"right"},{title:i.props.t("components.productPurchaseDetail.remain"),dataIndex:"remain_quantity",width:"10%",ellipsis:!0,align:"right"},{title:"",dataIndex:"action",width:150,ellipsis:!0,align:"right",render:function(e){return _e(d.default,{size:"small",type:"primary",onClick:function(){return i.handleAddItem(e)}},i.props.t("components.productComboDetail.addToVote"))}}]),(0,x.Z)((0,y.Z)(i),"handleFilterSaperate",(function(){var e=i.props,t=e.close,n=e.onfilterPurchase,a=i.state.purchase;n(["separate_by",N()([a.display_id].concat(a.separate_by_display_ids||[]))]),t()})),(0,x.Z)((0,y.Z)(i),"renderContentSuggestion",(function(){var e=i.props.t,t=i.state,n=t.paramsSuggestion,a=t.isLoadingSuggestion;return _e("div",null,_e("div",{style:{marginBottom:10}},_e("b",null,e("components.productComboDetail.listProductOutOfStock"))),_e(l.Z,{columns:i.columnsSuggestion,dataSource:i.getDataSuggestion(),loading:a,scroll:{y:300},size:"small",pagination:{size:"small",pageSize:n.page_size,total:n.total_entries||0,current:n.page},onChange:i.handleOnChangeTableSuggestion}))})),(0,x.Z)((0,y.Z)(i),"getDataSuggestion",(function(){var e=i.state.listSuggestions,t=i.props.currentShop;return e.map((function(e,n){var a=e.fields.map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", ");return{key:n,name:_e(u.default,{title:e.product.name,placement:"topLeft"},_e("span",null,e.product.name)),product_id:_e(u.default,{title:e.product.custom_id||e.product.display_id},_e("span",null,e.product.custom_id||e.product.display_id)),variation_id:_e(u.default,{title:e.custom_id||e.display_id},_e("span",null,e.custom_id||e.display_id)),variation_fields:_e(u.default,{title:a,placement:"topLeft"},_e("span",null,a)),last_imported_price:_e(u.default,{title:(0,K.ufS)(e.last_imported_price,t.currency),placement:"topLeft"},_e("span",null,(0,K.ufS)(e.last_imported_price,t.currency))),remain_quantity:_e(u.default,{title:(0,K.oH6)(e.remain_quantity,t.currency),placement:"topLeft"},_e("span",null,(0,K.oH6)(e.remain_quantity,t.currency))),action:e}}))})),(0,x.Z)((0,y.Z)(i),"handleUploadImages",(function(e,t){var n=R()(i.state.purchase);n[t]=e,i.setState({purchase:n})})),(0,x.Z)((0,y.Z)(i),"handleChangePrint",(function(e){return function(t){t.target.checked?i.setState({typePrint:e},(function(){return localStorage.setItem("printPurchase",e)})):i.setState({typePrint:null},(function(){return localStorage.removeItem("printPurchase")}))}})),(0,x.Z)((0,y.Z)(i),"renderPRint",(function(e){var t=i.props.t,n=i.state,a=n.typePrint;if(!n.isAccessories)return _e("span",{style:{marginRight:12}},_e(c.default,{onChange:i.handleChangePrint(e),checked:a==e},t("components.productPurchaseDetail.".concat("barcode"==e?"printBarcode":"printQRCode"))))})),(0,x.Z)((0,y.Z)(i),"renderFooter",(function(){var e,t,n=i.props,a=n.shopId,r=n.t,s=n.accessToken,l=n.currentShop,p=n.warehousesPermission,h=n.params,m=i.state,f=m.isLoading,g=m.purchase,v=m.isCreating,y=m.isAccessories,_=m.isSeparate,b=m.typePrint,S=l?(0,oe.zE)(l.role):{},x=(null===(e=p.find((function(e){return e.warehouse_id==g.warehouse_id})))||void 0===e?void 0:e.list_permissions)||[],I=S.ql_nhaphang&&x.find((function(e){return"nhap_hang"==e}))&&S.for_control_orders;return _e("div",{className:"modal-footer-content"},_e(c.default,{style:{marginRight:12},onChange:function(e){return i.handlePurchaseChange(e.target.checked,"not_create_transaction")},checked:null===g||void 0===g?void 0:g.not_create_transaction,disabled:!v&&(1==(null===(t=i.props.purchase)||void 0===t?void 0:t.status)||g.is_lock)},r("components.productComboDetail.notCreateTransaction")),_e(c.default,{style:{marginRight:12},checked:g.is_lock,onChange:function(e){return i.handlePurchaseChange(e.target.checked,"is_lock")},disabled:!I},r("pages.shop.product.purchase.lock")),_e("span",null,i.renderPRint("barcode"),i.renderPRint("qrcode"),!y&&b&&i.handleSetPrintBarcode(b),!v&&!y&&_e(o.default.Group,{style:{marginRight:12}},_e(u.default,{title:r("pages.shop.product.purchase.filterSeparated")},_e(o.default.Button,{onClick:function(){return i.handleFilterSaperate()}},_e(j.Z,{style:{fontSize:16}}))),_e(o.default.Button,{onClick:function(){return i.setState({isSeparate:!_})},disabled:g.is_lock&&g.id},_?r("components.productPurchaseDetail.cancel"):"T\xe1ch phi\u1ebfu")),_e(se.Z,{onChange:i.onStatusChange,size:"large",purchase:g,accessToken:s,shopId:a,t:r,params:h}),_e(d.default,{type:"primary",style:{marginLeft:12},icon:_e(f?B.Z:H.Z,null),disabled:f||g&&(A()(g.warehouse_id)||!(g.items||[]).length&&!(g.accessories_items||[]).length),onClick:_?i.handleSeparatePurchase:i.handleSave},r(v?"components.productComboDetail.create":"save"))))})),(0,x.Z)((0,y.Z)(i),"onResize",(function(e,t){var n=i.state.widthColumns;n[e]=t||50,i.setState({widthColumns:n},(function(){localStorage.setItem("columns_width_purchase_detail_table",JSON.stringify(n))}))})),(0,x.Z)((0,y.Z)(i),"handleChangeSortTable",(function(e,t,n){"variationId"==n.field&&i.setState({sorterVariationId:n.order}),document.querySelector(".ant-table-body").scrollTop=0})),(0,x.Z)((0,y.Z)(i),"getColumns",(function(){var e=i.state,t=e.isCreating,n=e.purchase,a=e.isSyncingPrice,r=e.isSyncingQty,s=e.widthColumns,o=i.props,c=o.currentShop,u=o.t,l=c?(0,oe.zE)(c.role):{},d=n.id&&n.is_lock,p=[{title:function(){return _e("div",null,u("components.productComboDetail.variationId")," / ",u("components.productCreatorFirstStep.properties"))},dataIndex:"variation",ellipsis:!0,sorter:function(e,t){return e.custom_id<t.custom_id?-1:e.custom_id>t.custom_id?1:0},render:function(e,t){return _e("div",{className:"variation-info"},_e("div",{className:"copy-text",style:{color:"#434343",fontWeight:500}},_e(ve.default,{recordSrc:t.variationId},t.variationId)),_e("div",null,(0,Y.Br)(t.fields)))}},{title:function(){return _e("div",null,u("products.title")," / ",u("components.productComboDetail.productId"))},dataIndex:"product",ellipsis:!0,render:function(e,t){return _e("div",{className:"product-info"},_e("div",{style:{color:"#434343",fontWeight:500}},t.productName),_e("div",{className:"copy-text"},_e(ve.default,{recordSrc:t.productId},t.productId)))}},{title:u("components.orderExportExcel.image"),dataIndex:"images",align:"center",width:70,ellipsis:!0},{title:i.props.t("pages.shop.product.management.sellingSpeed"),dataIndex:"sellingStatus",ellipsis:!0,width:.1*i.tableWidth},{title:i.props.t("pages.shop.product.transfer.note"),dataIndex:"note",ellipsis:!0,width:.1*i.tableWidth,render:function(e){var t=e.value,n=e.index;return _e(Z.default,{value:t,placeholder:u("pages.shop.setting.enterNote"),onChange:function(e){return i.handleInputFormatMoney("product","note_purchase",n,e.target.value)},disabled:d})}},{title:_e("div",{className:"sync-div"},_e(pe.Z,{className:"sync-btn ".concat(!a&&"unsync-btn"),icon:_e(E.Z,null),title:u("components.productPurchaseDetail.syncingImportPrice"),style:{marginRight:6},onClick:function(){return i.setState({isSyncingPrice:!a})}}),u("components.productPurchaseDetail.price")),dataIndex:"price",align:"right",width:.12*i.tableWidth,ellipsis:!0,render:function(e){var a=e.value,r=e.index;return t||2!=n.status?"text"==r?_e("strong",null,(0,K.ufS)(a,c.currency)):_e(re.default,{value:a,size:"small",currency:i.props.currentShop.currency,isMoney:!0,callBack:function(e){i.state.isSyncingPrice&&n&&n.items&&n.items.length>0?n.items.forEach((function(t,n){return i.handleInputFormatMoney("product","imported_price",n,e)})):i.handleInputFormatMoney("product","imported_price",r,e)},suffix:(0,K.jKf)(c.currency),disabled:d}):"text"==r?_e("strong",null,(0,K.ufS)(a,c.currency)):(0,K.ufS)(a,c.currency)}},{title:_e("div",{className:"sync-div"},_e(pe.Z,{className:"sync-btn ".concat(!r&&"unsync-btn"),icon:_e(E.Z,null),title:u("components.productPurchaseDetail.syncingQuantity"),style:{marginRight:6},onClick:function(){return i.setState({isSyncingQty:!r})}}),u("components.orderExportExcel.quantity")),dataIndex:"quantity",align:"right",width:.12*i.tableWidth,ellipsis:!0,render:function(e){var a=e.value,r=e.index;return t||2!=n.status?"text"==r?_e("strong",null,(0,K.oH6)(a,c.currency)):_e(re.default,{value:a,size:"small",currency:c.currency,isMoney:!1,min:0,callBack:function(e){i.state.isSyncingQty&&n&&n.items&&n.items.length>0?n.items.forEach((function(t,n){return i.handleInputNumberChange("product","quantity",n,e)})):i.handleInputNumberChange("product","quantity",r,e)},disabled:d}):"text"==r?_e("strong",null,(0,K.oH6)(a,c.currency)):(0,K.oH6)(a,c.currency)}},{title:"SL t\xe1ch",dataIndex:"separateQuantity",align:"right",width:.08*i.tableWidth,ellipsis:!0,render:function(e){var t=e.value,n=e.index,a=e.max;return _e(re.default,{value:t,size:"small",currency:c.currency,isMoney:!1,min:0,max:a,callBack:function(e){return i.handleInputNumberChange("product","separateQuantity",n,e)},disabled:d})}},{title:"SL/l\xf4",dataIndex:"quantityPerBatch",align:"right",width:.08*i.tableWidth,ellipsis:!0,render:function(e){var t=e.value,a=e.index,r=e.max;return _e(re.default,{value:t,size:"small",currency:c.currency,isMoney:!1,min:0,max:r||Math.floor(n.items[a].quantity/(n.items[a].number_of_batch||1)),callBack:function(e){return i.handleChangeBatch("quantity_per_batch",a,e)},disabled:d})}},{title:"S\u1ed1 l\xf4",dataIndex:"numberOfBatch",align:"right",width:.08*i.tableWidth,ellipsis:!0,render:function(e){var t=e.value,a=e.index,r=e.max;return _e(re.default,{value:t,size:"small",currency:c.currency,isMoney:!1,min:0,max:r||Math.floor(n.items[a].quantity/(n.items[a].quantity_per_batch||1)),callBack:function(e){return i.handleChangeBatch("number_of_batch",a,e)},disabled:d})}},{title:u("components.productPurchaseDetail.rest"),dataIndex:"remain",align:"right",ellipsis:!0,width:.1*i.tableWidth},{title:u("orders.totalPrice"),dataIndex:"totalPrice",align:"right",ellipsis:!0,width:.1*i.tableWidth},{title:"",dataIndex:"delete",width:.04*i.tableWidth,render:function(e){return"text"==e||d?"":_e(F.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){n.items&&n.items.splice(e,1),i.setState({purchase:n})}})}}];if(t||1!=n.status){var h=p.findIndex((function(e){return"remain"==e.dataIndex}));h>-1&&p.splice(h,1)}if(!l.view_imported_price){var m=p.findIndex((function(e){return"price"==e.dataIndex}));m>-1&&p.splice(m,1);var f=p.findIndex((function(e){return"totalPrice"==e.dataIndex}));f>-1&&p.splice(f,1)}if(i.props.purchase&&2==i.props.purchase.status&&i.props.purchase.id){var g=p.findIndex((function(e){return"delete"==e.dataIndex}));-1!=g&&p.splice(g,1)}if(!i.state.isSeparate){var v=p.findIndex((function(e){return"separateQuantity"==e.dataIndex}));-1!=v&&p.splice(v,1)}if(!n.is_batch_shelf){var y=p.findIndex((function(e){return"quantityPerBatch"==e.dataIndex}));-1!=y&&p.splice(y,1);var _=p.findIndex((function(e){return"numberOfBatch"==e.dataIndex}));-1!=_&&p.splice(_,1)}p=p.map((function(e,t){return Se(Se({},e),{},{onHeaderCell:function(e){return{id:e.dataIndex,width:e.width,tableClassName:Pe,columnNotResize:p.length-1==t&&e.dataIndex,onResize:i.onResize}}})}));var b=Object.keys(s);return p=p.map((function(e){return b.includes(e.dataIndex)?Se(Se({},e),{},{width:s[e.dataIndex]}):e}))})),(0,x.Z)((0,y.Z)(i),"getAccessoriesColum",(function(){var e=i.state,t=e.isCreating,n=e.purchase,a=e.isSyncingPrice,r=e.isSyncingQty,s=i.props,o=s.currentShop,c=s.t,u=o?(0,oe.zE)(o.role):{},l=[{title:function(){return _e("div",null,c("components.productComboDetail.variationId")," / ",c("components.productCreatorFirstStep.properties"))},dataIndex:"variation",ellipsis:!0,render:function(e,t){return _e("div",{className:"variation-info"},_e("div",{className:"copy-text",style:{color:"#434343",fontWeight:500}},_e(ve.default,{recordSrc:t.variationId},t.accVariationId)),_e("div",null,(0,Y.Br)(t.fields)))}},{title:function(){return _e("div",null,c("components.productPurchaseDetail.accessories")," / ",c("components.productPurchaseDetail.accessoriesId"))},dataIndex:"accessories",width:.2*i.tableWidth,ellipsis:!0,render:function(e,t){return _e("div",{className:"product-info"},_e("div",{style:{color:"#434343",fontWeight:500}},t.accName),_e("div",{className:"copy-text"},_e(ve.default,{recordSrc:t.accId},t.accId)))}},{title:"H\xecnh \u1ea3nh",dataIndex:"images",align:"center",width:60,ellipsis:!0},{title:c("components.productPurchaseDetail.unit"),dataIndex:"unit",ellipsis:!0,width:.1*i.tableWidth},{title:c("note"),dataIndex:"note",width:.1*i.tableWidth,ellipsis:!0,render:function(e){var t=e.value,n=e.index;return"text"==n?t||"":_e(Z.default,{value:t,placeholder:c("pages.shop.setting.enterNote"),onChange:function(e){return i.handleInputNumberChange("accessories","note",n,e.target.value)}})}},{title:_e("div",{className:"sync-div"},_e(pe.Z,{className:"sync-btn ".concat(!a&&"unsync-btn"),icon:_e(E.Z,null),title:c("components.productPurchaseDetail.syncingImportPrice"),style:{marginRight:6},onClick:function(){return i.setState({isSyncingPrice:!a})}}),c("components.productPurchaseDetail.price")),dataIndex:"price",width:.1*i.tableWidth,align:"right",ellipsis:!0,render:function(e){var t=e.value,a=e.index;return i.state.isCreating?"text"==a?(0,K.ufS)(t,o.currency):_e(re.default,{value:t,size:"small",currency:o.currency,isMoney:!0,callBack:function(e){i.state.isSyncingPrice&&n&&n.accessories_items&&n.accessories_items.length>0?n.accessories_items.forEach((function(t,n){return i.handleInputFormatMoney("accessories","imported_price",n,e)})):i.handleInputFormatMoney("accessories","imported_price",a,e)},suffix:(0,K.jKf)(o.currency)}):(0,K.ufS)(t,o.currency)}},{title:_e("div",{className:"sync-div"},_e(pe.Z,{className:"sync-btn ".concat(!r&&"unsync-btn"),icon:_e(E.Z,null),title:c("components.productPurchaseDetail.syncingQuantity"),style:{marginRight:6},onClick:function(){return i.setState({isSyncingQty:!r})}}),c("components.orderExportExcel.quantity")),dataIndex:"quantity",width:.1*i.tableWidth,align:"right",ellipsis:!0,render:function(e){var a=e.value,r=e.index;return t||-1==n.status?"text"==r?_e("strong",null,(0,K.oH6)(a,o.currency)):_e(re.default,{value:a,size:"small",currency:o.currency,isMoney:!1,isPercent:!0,decimal:!0,callBack:function(e){i.state.isSyncingQty&&n&&n.accessories_items&&n.accessories_items.length>0?n.accessories_items.forEach((function(t,n){return i.handleInputNumberChange("accessories","quantity",n,e)})):i.handleInputNumberChange("accessories","quantity",r,e)}}):(0,K.oH6)(a,o.currency)}},{title:c("components.productPurchaseDetail.rest"),dataIndex:"remain",align:"right",ellipsis:!0,width:.1*i.tableWidth},{title:c("orders.totalPrice"),dataIndex:"totalPrice",width:.15*i.tableWidth,align:"right",ellipsis:!0},{title:"",dataIndex:"deleteAccessories",width:50,render:function(e){return"text"!=e?_e(F.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){var t=i.state.purchase;t.accessories_items&&t.accessories_items.splice(e,1),i.setState({purchase:t})}}):""}}];if(t||1!=n.status){var d=l.findIndex((function(e){return"remain"==e.dataIndex}));d>-1&&l.splice(d,1)}if(!u.view_imported_price){var p=l.findIndex((function(e){return"totalPrice"==e.dataIndex}));p>-1&&l.splice(p,1);var h=l.findIndex((function(e){return"price"==e.dataIndex}));h>-1&&l.splice(h,1)}if(n&&[1,2].includes(n.status)&&n.id){var m=l.findIndex((function(e){return"deleteAccessories"==e.dataIndex}));-1!=m&&l.splice(m,1)}return l.map((function(e){if(e.width)e.width=Math.floor(e.width);else{var t=i.tableWidth-l.reduce((function(e,t){return e+(t.width?t.width:0)}),0);e.width=Math.floor(t)}return e}))})),(0,x.Z)((0,y.Z)(i),"renderTableSummary",(function(e){var t=i.state,n=t.isAccessories,a=t.purchase,r=i.props,s=r.currentShop,o=r.t,c=((n?a.accessories_items:a.items)||[]).filter((function(e){return n||i.conditionFilterProductItem(e)})).reduce((function(e,t){var n=t.remain_quantity<0?0:t.remain_quantity;return e.price+=t.imported_price||0,e.quantity+=t.quantity,e.remain+=n,e.totalPrice+=t.quantity*((null===t||void 0===t?void 0:t.imported_price)||0),e}),{price:0,quantity:0,remain:0,totalPrice:0});return _e(l.Z.Summary,{fixed:!0},_e(l.Z.Summary.Row,null,e.map((function(e,t){var n,a=0==t;return a&&(n=o("crm.sum")),(c[e.dataIndex]||0==c[e.dataIndex])&&(n=["totalPrice","price"].includes(e.dataIndex)?(0,K.ufS)(c[e.dataIndex],s.currency):(0,K.oH6)(c[e.dataIndex])),_e(l.Z.Summary.Cell,{index:t,align:a?"right":e.align},_e("span",{style:{fontWeight:600}},n))}))))})),(0,x.Z)((0,y.Z)(i),"renderTableFooter",(function(){var e=i.props,t=e.t,n=e.currentShop,a=i.state,r=a.purchase,s=a.isCreating,o=a.isAccessories,c=n?(0,oe.zE)(n.role):{},l=0,d=0,p=0,h=0,m=o?r.accessories_items:r.items;return(m||[]).filter((function(e){return o||i.conditionFilterProductItem(e)})).map((function(e){var t=e.remain_quantity<0?0:e.remain_quantity;l+=((null===e||void 0===e?void 0:e.imported_price)||0)*Math.abs(e.quantity),d+=e.quantity,p+=t,h+=((null===e||void 0===e?void 0:e.imported_price)||0)*Math.abs(e.remain_quantity)})),o&&(l=parseInt(l),d=parseInt(1e3*d)/1e3,p=parseInt(1e3*p)/1e3,h=parseInt(h)),_e("div",{style:{textAlign:"right"}},_e("span",{className:"total-info"},_e(u.default,{title:"T\u1ed5ng s\u1ed1 SP".concat(": ",(0,K.oH6)((null===m||void 0===m?void 0:m.length)||0))},t("pages.shop.statistic.statisticItem.total_product"),":",_e("strong",null," ",(0,K.oH6)((null===m||void 0===m?void 0:m.length)||0)))),c.view_imported_price&&_e("span",{className:"total-info"},_e(u.default,{title:"".concat(t("components.productPurchaseDetail.sumPrice"),": ").concat(l)},t("components.productPurchaseDetail.sumPrice"),":",_e("strong",null," ",(0,K.ufS)(l,n.currency)))),_e("span",{className:"total-info"},_e(u.default,{title:"".concat(t("components.productPurchaseDetail.sumQuantity"),": ").concat(d)},t("components.productPurchaseDetail.sumQuantity"),":",_e("strong",null," ",(0,K.oH6)(d)))),!s&&_e("span",{className:"total-info"},_e(u.default,{title:"".concat(t("components.productPurchaseDetail.sumRemain"),": ").concat(p)},t("components.productPurchaseDetail.sumRemain"),":",_e("strong",null," ",(0,K.oH6)(p)))),!s&&c.view_imported_price&&_e("span",{className:"total-info"},_e(u.default,{title:"".concat(t("components.productPurchaseDetail.sumPriceRemain"),": ").concat(h)},t("components.productPurchaseDetail.sumPriceRemain"),":",_e("strong",null," ",(0,K.ufS)(h,n.currency)))))})),(0,x.Z)((0,y.Z)(i),"renderUploadFile",(function(e,t){var n=i.props.accessToken,a=i.state.purchase,r=(-1==a[e]?[]:a[e]||[]).map((function(e,t){return{uid:t,response:{content_url:e,success:!0},status:"done",url:e}}));return _e("div",null,_e("div",{className:"header"},t),_e(ye.Z,{className:"purchase-image",accessToken:n,editFileList:r,handleUploadImages:function(t){return i.handleUploadImages(t,e)}}))})),(0,x.Z)((0,y.Z)(i),"renderContent",(function(){var e,t,n,a,r=i.props,o=r.warehouses,u=r.accessToken,l=r.shopId,d=r.t,p=r.currentShop,h=r.purchase_tags,m=r.supplier_products,f=i.state,g=f.purchase,v=f.isCreating,y=f.searchResult,_=(f.isTurnOnAccessories,f.searchResultAccessories),b=f.isAccessories,S=f.search_by,x=f.modalVisible,Z=f.isSelectItem,w=f.scrollIndex,C=f.isLoadingItem,P={header:{cell:de.Z}},D=o.map((function(e){var t=e.name,n=e.id;return _e(we,{key:n,value:n},t)})),k=[];k=(m||[]).filter((function(e){return 0!=e.is_activated})).filter((function(e){return!(!g.supplier_products_id||g.supplier_products_id!=e.id)||(b?1==e.type:1!=e.type)}));var N=g&&g.items?g.items.map((function(e){return e.variation_id})):[],T=b?i.getAccessoriesColum():i.getColumns(),q=i.getSelectedSupplier(g.supplier_products_id),O=g.id&&g.is_lock,R=p?(0,oe.zE)(p.role):{};return _e("div",{className:"content"},_e("div",{className:"content-info"},_e("div",{className:"info-item"},_e("div",{className:"header"},d("components.productPurchaseDetail.store")),_e(I.default,{disabled:!v,value:g.warehouse_id?g.warehouse_id:void 0,placeholder:d("components.orderImportExcel.selectWarehouse"),onChange:i.onChangeWarehouse,dropdownClassName:"select-warehouse-dropdown",style:{width:"100%"}},D)),R.ql_ncc&&_e("div",{className:"info-item"},_e("div",{className:"header"},d("components.productSupplierImportExcel.productSupplier")),_e(I.default,{style:{width:"100%"},placeholder:d("components.productPurchaseDetail.selectSupplier"),size:"default",value:g.supplier_products_id&&k.find((function(e){return e.id==g.supplier_products_id}))?g.supplier_products_id:void 0,onChange:i.onChangeSupplierProducts,showSearch:!0,filterOption:function(e,t){return(0,K.Mle)(t.children).indexOf((0,K.Mle)(e))>=0},allowClear:!0,disabled:O},k.map((function(e){return _e(we,{key:e.id,value:e.id},e.name)}))),g.supplier_products_id&&k.find((function(e){return e.id==g.supplier_products_id}))&&_e("div",{className:"warehouse-info"},_e("div",{className:"data"},_e("div",{className:"key"},d("components.customerExportExcel.name"),":"),_e("div",{className:"value",style:{cursor:"pointer",color:"#096dd9"},onClick:function(){return i.setState({modalVisible:!0})}},null===q||void 0===q?void 0:q.name)),_e("div",{className:"data"},_e("div",{className:"key"},d("components.orderAdvanceFilter.phoneNumber"),":"),_e("div",{className:"value"},null!==q&&void 0!==q&&q.phone_number?null===q||void 0===q?void 0:q.phone_number:"Ch\u01b0a c\xf3"))),g.supplier_products_id&&(null===(e=p.settings)||void 0===e||null===(t=e.auto_create_debt)||void 0===t?void 0:t.supplier)&&_e("div",{style:{borderTop:"1px dashed #d9d9d9",marginTop:8,paddingTop:8}},_e(c.default,{disabled:!(!g.id||[-1,0].includes(parseInt(g.status)))||1453955==p.id,checked:g.auto_create_debts,onChange:function(e){return i.onChangeAutoCreateDebts(e.target.checked)}},_e("span",null,d("automaticallyCreateLiabilitiesBySuppliers")),_e(fe.Z,{tip:_e("div",null,d("pages.shop.product.purchase.systemAutoCreateDebt"),"\xa0",g.auto_create_debts?_e("b",null,d("pages.shop.product.purchase.unPaid")):_e("b",null,d("pages.shop.product.purchase.paid")),"\xa0",d("pages.shop.product.purchase.forSupplier")," ",null===q||void 0===q?void 0:q.name)}))),g.supplier_products_id&&g.auto_create_debts&&(null===(n=p.settings)||void 0===n||null===(a=n.auto_create_debt)||void 0===a?void 0:a.supplier)&&_e("div",{className:"info",style:{paddingTop:4}},_e("div",{className:"header"},d("pages.shop.product.purchase.prepaidDebt")),_e(re.default,{value:g.prepaid_debt,size:"small",isMoney:!0,currency:p.currency,callBack:function(e){return i.handleInputFormatMoney("transport","prepaid_debt",0,e)},suffix:(0,K.jKf)(p.currency),disabled:![-1,0].includes(parseInt(g.status))||O}))),_e("div",{className:"info-item"},_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.transaction.addTags")),_e(I.default,{style:{width:"100%"},onChange:i.handleChangeTags,mode:"multiple",value:"-1"==g.tags?[]:g.tags||[],placeholder:d("components.productPromotionDetail.selectTags"),disabled:O},(h||[]).map((function(e){return _e(we,{value:e.id,key:e.id},e.name)})))),_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.product.purchase.transportFee")),_e("div",null,_e(re.default,{value:g.transport_fee,size:"small",currency:p.currency,isMoney:!0,callBack:function(e){return i.handleInputFormatMoney("transport","transport_fee",0,e)},suffix:(0,K.jKf)(p.currency),disabled:O}))),g.export_accessories_id&&_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.product.purchase.costsIncurred")),_e("div",null,_e(re.default,{value:g.costs_incurred,size:"small",currency:p.currency,isMoney:!0,callBack:function(e){return i.handleInputFormatMoney("transport","costs_incurred",0,e)},suffix:(0,K.jKf)(p.currency),disabled:O}))),_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.product.promotionAdvance.discount")),_e("div",null,_e(re.default,{value:g.discount,size:"small",currency:p.currency,isMoney:!0,callBack:function(e){return i.handleInputFormatMoney("transport","discount",0,e)},suffix:(0,K.jKf)(p.currency),disabled:O}))),_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.product.purchase.createdAt")),_e("div",null,_e(s.default,{format:"DD-MM-YYYY",value:g.inserted_at?Q()("".concat((0,K.p6d)(g.inserted_at)),"DD/MM/YYYY"):Q()(),style:{width:"100%",marginRight:10,borderRadius:"unset"},getCalendarContainer:function(e){return e.parentNode},onChange:i.onChangeInsertedAt,disabled:O}))),_e("div",{className:"info"},_e("div",{className:"header"},d("pages.shop.product.purchase.receivedAt")),_e("div",null,_e(s.default,{format:"DD-MM-YYYY",value:g.received_at?Q()("".concat((0,K.p6d)(g.received_at)),"DD/MM/YYYY"):void 0,style:{width:"100%",marginRight:10,borderRadius:"unset"},getCalendarContainer:function(e){return e.parentNode},onChange:i.onChangeReceivedAt,disabled:O})))),_e("div",{className:"info-item"},_e("div",{className:"header"},d("note")),_e(Ie,{placeholder:d("note"),style:{fontSize:14,marginBottom:10},value:g.note,onChange:function(e){return i.handlePurchaseChange(e,"note")}}),R.view_imported_price&&i.renderUploadFile("bill_images",d("pages.shop.product.purchase.billImage")),i.renderUploadFile("images",d("pages.shop.product.variation.image")))),_e("div",{className:"table-info"},(v||2!=g.status)&&!O&&!b&&_e("div",{style:{display:"flex"}},_e("div",{className:"select-layout"},_e("div",{className:"item-info"},_e(I.default,{className:"ant-select-filter-type-combo",value:S,onChange:i.handleSearchFilter},_e(I.default.Option,{value:"variation",className:"ant-select"},d("components.productComboDetail.variation")),_e(I.default.Option,{value:"product",className:"ant-select"},d("products.title"))))),_e("div",{style:{width:"100%",marginLeft:12,display:"flex",justifyContent:"space-between"}},_e(X.Z,{accessToken:u,searchResult:y,shopId:l,combo_by:S,onSelect:i.handleSelectItem,callback:function(e){return i.setState({searchResult:e})},selectedVariationIds:N,onScreenBarcode:function(e){return i.setState({onScreenBarcode:e,searchResult:[]})},selected_warehouse_id:[g.warehouse_id],warehouse_id:g.warehouse_id,style:{display:"flex",flex:1},localClassName:"stocktaking-search",isBlocked:!0,customDTS:"purchase"}),v&&p.use_warehouse_position&&!1)),(v||-1==g.status)&&b&&_e("div",{style:{display:"flex"}},_e("div",{className:"select-layout"},_e("div",{className:"item-info"},_e(I.default,{className:"ant-select-filter-type-accessories",value:S,onChange:i.handleSearchFilter},_e(I.default.Option,{value:"accessories",className:"ant-select"},d("components.productPurchaseDetail.accessories")),_e(I.default.Option,{value:"bill-of-materials",className:"ant-select"},d("materials.billOfMaterials"))))),_e("div",{style:{width:"100%",marginLeft:12,display:"flex",justifyContent:"space-between"}},"bill-of-materials"==S?_e(X.Z,{accessToken:u,shopId:l,combo_by:S,searchResult:y,onSelect:i.handleSelectItemAccessories,callback:function(e){return i.setState({searchResult:e})},style:{display:"flex",flex:1},localClassName:"stocktaking-search"}):_e(ee.Z,{accessToken:u,shopId:l,style:{display:"flex",flex:1},searchResult:_,onSelect:i.handleSelectItemAccessories,callback:function(e){return i.setState({searchResultAccessories:e})}}))),_e(le.Z,{className:Pe,columns:T,dataSource:i.getData(),components:P,title:i.renderSearchProduct,summary:function(){return i.renderTableSummary(T)},footer:i.renderTableFooter,size:"small",scroll:{y:400},pagination:!1,onChange:i.handleChangeSortTable,isSelectItem:Z,scrollIndex:w,rowClassName:i.setClassName,loading:C})),x&&_e(he.Z,{currentShop:p,accessToken:u,shopId:l,visible:x,setVisible:function(e){return i.setState({modalVisible:e})},selectedSupplier:q,viewModal:!0}))})),(0,x.Z)((0,y.Z)(i),"setClassName",(function(e){var t=i.state.selectedId;return t&&e.selectedId==t?"purchase-table-row-light":""})),(0,x.Z)((0,y.Z)(i),"renderSearchProduct",(function(){var e=i.props,t=e.t,n=e.accessToken,a=e.shopId,s=e.currentShop,o=i.state,c=o.listSuggestions,u=o.isLoadingSuggestion,l=o.purchase,p=o.isCreating,h=o.modalDetailVisible,m=o.isAccessories,f=s?(0,oe.zE)(s.role):{};return _e("div",{className:"text-align-left",style:{display:"flex",justifyContent:"space-between"}},_e("div",{style:{display:"flex",alignItems:"center"}},c.length>0&&l.warehouse_id&&p&&!m&&_e(r.default,{overlayClassName:"popover-suggestion",trigger:"click",content:i.renderContentSuggestion()},_e(d.default,{icon:_e(V.Z,null),loading:u},t("components.productPurchaseDetail.purchaseSuggestion")))),_e("div",null,_e(Ze,{placeholder:t("components.productPurchaseDetail.textSearch"),allowClear:!0,style:{width:300,marginRight:12},onChange:function(e){return i.setState({searchProduct:e.target.value})}}),!m&&(!l.id||!l.is_lock)&&_e(ge.Z,{accessToken:n,shopId:a,visible:h,setVisible:function(e){return i.setState({modalDetailVisible:e})},params:{},permission:f.create_product,content:t("components.productPurchaseDetail.createProduct"),handleCallback:function(e){return i.handleSelectItemSearchByProduct(e)}})))})),(0,x.Z)((0,y.Z)(i),"onStatusChange",(function(e){var t=i.state.purchase;t.id||localStorage.setItem("default_purchase_status",e),i.setState({purchase:Se(Se({},t),{},{status:e})})})),(0,x.Z)((0,y.Z)(i),"handleSetDraft",(function(){var e=i.props.shopId,t=i.state.purchase;if(t){var n=t.note,a=t.accessories_items,r=t.transport_fee,s=t.id,o=t.items;localStorage["product_purchase_shop_".concat(e)]&&!s&&localStorage.removeItem("product_purchase_shop_".concat(e));var c=(0,K.kzT)(t);!((null===o||void 0===o?void 0:o.length)>0||n||(null===a||void 0===a?void 0:a.length)>0||r)||s||c||localStorage.setItem("product_purchase_shop_".concat(e),JSON.stringify(t))}i.setState({searchProduct:""})})),(0,x.Z)((0,y.Z)(i),"renderTitle",(function(){var e=i.props,t=e.t,n=e.showHistories,a=e.accessToken,r=e.shopId,s=i.state,o=s.purchase,c=s.isCreating;return _e("div",null,_e("span",null,"".concat(t("components.productPurchaseDetail.detailedInfo")," ").concat(c?"":o.display_id?"#".concat(o.display_id):"")),!c&&n&&_e(me.Z,{accessToken:a,shopId:r,data:o,tableName:"purchases"}))}));var p=e.isServer?{}:localStorage&&localStorage.getItem("columns_width_purchase_detail_table")?JSON.parse(localStorage.getItem("columns_width_purchase_detail_table")):{},v=.8*(.95*((null===(a=window)||void 0===a?void 0:a.innerWidth)||1200)-48);return i.state={purchase:R()(e.purchase)||Ce,isLoading:!1,isCreating:!e.purchase||!e.purchase.id,searchResult:[],isTurnOnAccessories:!1,isAccessories:e.isAccessories||!1,searchResultAccessories:[],onScreenBarcode:!1,search_by:"variation",paramsSuggestion:{page:1,page_size:30},listSuggestions:[],isLoadingSuggestion:!1,searchProduct:"",widthColumns:p,isSeparate:!1,sorterVariationId:void 0,modalVisible:!1,isSyncingPrice:!1,isSyncingQty:!1,scrollIndex:0,isSelectItem:!1,selectedId:null,typePrint:null,modalDetailVisible:!1,isLoadingItem:!1},i.tableWidth=Math.floor(v),i}return(0,v.Z)(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props,n=t.isServer,a=t.isAccessories;if(n){var i=localStorage&&localStorage.getItem("columns_width_purchase_detail_table");i&&(i=JSON.parse(i),this.setState({widthColumns:i}))}if("undefined"!==typeof Storage&&localStorage.printPurchase){var r=localStorage.getItem("printPurchase");this.setState({typePrint:r})}window.addEventListener("beforeunload",(function(t){var n=e.props.shopId,a=e.state.purchase;if(a){var i=a.note,r=a.accessories_items,s=a.warehouse_id,o=a.transport_fee,c=a.id,u=a.items;t.preventDefault(),"undefined"!==typeof Storage&&(localStorage["product_purchase_shop_".concat(n)]&&localStorage.removeItem("product_purchase_shop_".concat(n)),(u&&u.length>0||i||r&&r.length>0||s||o)&&!c&&localStorage.setItem("product_purchase_shop_".concat(n),JSON.stringify(a)))}})),this.setState({purchase:R()(this.props.purchase)||Ce,isTurnOnAccessories:(0,K.rqq)(1,this.props.currentShop),search_by:a?"accessories":"variation"}),this.listenKeyWhenPastePhoto()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("paste",this.showQuickUploadPhoto,!1)}},{key:"componentDidUpdate",value:function(e){var t,n,a=this,i=this.props,r=i.shopId,s=i.warehousesPermission,o=i.purchase,c=i.visible,u=i.isAccessories,l=document.getElementsByClassName("ant-table-body")[1];if(l&&l.addEventListener("scroll",this.handleScrollTable,!1),u||(0,K.oSE)(Pe),!e.visible&&c){var d=null,p=null;localStorage.getItem("".concat(u?"purchase_accessories":"purchase","_warehouse_in_shop_").concat(r))&&(p=localStorage.getItem("".concat(u?"purchase_accessories":"purchase","_warehouse_in_shop_").concat(r))),localStorage.getItem("supplier_product_in_shop_".concat(r))&&(d=parseInt(localStorage.getItem("supplier_product_in_shop_".concat(r))));var h=((null===o||void 0===o?void 0:o.images)||[]).map((function(e,t){return{uid:t,response:{content_url:e},status:"done",url:e}})),m=s.find((function(e){return e.warehouse_id==p})),f=p&&!m||((null===m||void 0===m?void 0:m.list_permissions)||[]).includes("nhap_hang");this.setState({purchase:o?R()(Se(Se({},o),{},{items:D()((null===o||void 0===o?void 0:o.items)||[],"display_id")})):Se(Se({},Ce),{},{status:f?localStorage.getItem("default_purchase_status")||1:0,warehouse_id:p,supplier_products_id:d,items:[],accessories_items:[]}),oldStatus:o?o.status:-1,isCreating:localStorage["product_purchase_shop_".concat(e.shopId)]?!!o&&!o.id:!o,isTurnOnAccessories:(0,K.rqq)(1,e.currentShop),isAccessories:u,fileList:h,search_by:u?"accessories":"variation"})}if((null===(t=this.state.purchase.items)||void 0===t||!t.length)&&this.state.purchase.id&&c&&!this.state.isLoadingItem&&!u){var g=this.props,v=g.accessToken,y=g.shopId,_=g.showPurchase;this.setState({isLoadingItem:!0}),_(v,y,this.state.purchase.id).then((function(e){e.items=D()(e.items||[],"display_id"),a.setState({purchase:e,isLoadingItem:!1})}))}!q()(null===(n=e.purchase)||void 0===n?void 0:n.warehouse_id,null===o||void 0===o?void 0:o.warehouse_id)&&null!==o&&void 0!==o&&o.warehouse_id&&this.handleFetchSuggestion(o.warehouse_id)}},{key:"retrieveImageFromClipboard",value:function(e,t){var n;0==e.clipboardData&&"function"==typeof t&&t(void 0);var a=null===(n=e.clipboardData)||void 0===n?void 0:n.items;void 0!=a&&0!=a.length||"function"==typeof t&&t(void 0);for(var i=[],r=0;r<a.length;r++){if(-1!=a[r].type.indexOf("rtf")){t(void 0);break}if(-1!=a[r].type.indexOf("image")){var s=a[r].getAsFile();i.push(s)}}i.length&&t(i)}},{key:"render",value:function(){var e=this,t=this.props,n=t.visible,a=t.close,r=this.state,s=r.isLoading,o=r.onScreenBarcode;return _e("div",null,n&&_e(i.Z,{className:"modal-detail",visible:n,width:"95%",onCancel:function(){e.handleSetDraft(),e.setState({isSeparate:!1,fileList:[],isSyncingPrice:!1,isSyncingQty:!1,scrollIndex:0,isSelectItem:!1}),o||a()},maskClosable:!s,closable:!s,title:this.renderTitle(),footer:this.renderFooter()},this.renderContent()),_e("style",{dangerouslySetInnerHTML:{__html:ue()}}))}}]),n}(L.Component))||a;t.Z=(0,z.$j)((function(e){return{warehouses:(0,G.op)(e),currentShop:(0,G.tf)(e),warehousesPermission:e.user.currentUserWarehousesPermissions,purchase_tags:e.product.purchase_tags,supplier_products:e.product.supplier_products.data}}),{updatePurchase:J.CDO,createPurchase:J.QUS,createPurchaseAccessories:J.SIC,updatePurchaseAccessories:J.MXI,countersPurchase:J.u5D,updateSeparatePurchase:J.fqM,showPurchase:J.E6})(De)},19925:function(e,t,n){"use strict";var a=n(56697),i=n(11187),r=n(62443),s=n(65400),o=n(12386),c=n(74047),u=n(52700),l=n(4706),d=n(33814),p=n(44102),h=n(20775),m=n(26265),f=n(51024),g=n(67294),v=n(14494),y=n(7085),_=n(57254),b=n(2603),S=n(95213),x=n(36934),I=n(48519),Z=g.createElement;function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,m.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,h.Z)(e);if(t){var i=(0,h.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,p.Z)(this,n)}}var D=f.default.TextArea,k=function(e){(0,d.Z)(n,e);var t=P(n);function n(){var e;(0,c.Z)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return e=t.call.apply(t,[this].concat(i)),(0,m.Z)((0,l.Z)(e),"state",{isLoading:!1,noteModalVisible:!1,note:""}),(0,m.Z)((0,l.Z)(e),"canCancel",(function(t){return t.status<1||(t.accessories_items?!t.is_transfer&&-1==t.accessories_items.findIndex((function(e){return e.remain_quantity!=e.quantity}))&&1==t.status&&t.warehouse&&!t.warehouse.is_hide&&!e.state.check_enable_type:!t.is_transfer&&1==t.status&&t.warehouse&&!t.warehouse.is_hide&&!e.state.check_enable_type)})),(0,m.Z)((0,l.Z)(e),"onActionClick",(function(t){var n=t.key,a=e.props,i=a.onChange;a.currentShop.cancel_product_condition&&2==n?e.setState({noteModalVisible:!0}):i?i(n):(e.setState({isLoading:!0}),e.doUpdate(n).then((function(){return e.setState({isLoading:!1})})))})),(0,m.Z)((0,l.Z)(e),"doUpdate",(function(t){var n=e.props,a=(n.cancelPurchase,n.accessToken),i=n.shopId,r=n.cancelPurchaseAccessories,s=n.user,o=n.updatePurchase,c=n.currentShop,u=n.t,l=n.purchase,d=n.updatePurchaseAccessories,p=e.state.note;if(c.cancel_product_condition&&2==t){if(!p)return e.setState({noteModalVisible:!0});e.setState({noteModalVisible:!1,modalDetailVisible:!1,note:""});var h=p+"\n- "+s.name;l.note?l.note="".concat(l.note,"\n---\n").concat(u("components.productDeleteMutil.reason"),": ").concat(h):l.note=h}return l.accessories_items?2==t?r(a,i,l.id,l.note):d(a,i,C(C({},l),{},{status:t})):o(a,i,C(C({},l),{},{status:t}))})),e}return(0,u.Z)(n,[{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.countersPurchase,a=t.params,i=t.shopId,r=t.accessToken,s=t.purchase;e.purchase.status!=s.status&&n(r,i,C(C({},a),{},{type:s.accessories_items?"accessories":"product"}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.noteModalVisible,c=t.note,u=this.props,l=u.purchase,d=u.t,p=u.size,h=u.currentShop,m=(0,S.VCw)(),f=m[l.status],g=h?(0,I.zE)(h.role):{},v=[];if(l.id)switch(l.status){case-1:v.push(0,1);break;case 0:v.push(1)}else v.push(-1,0,1);return this.canCancel(l)&&l.id&&v.push(2),v=v.filter((function(e){return e!=l.status})),g.ql_nhaphang||(v=v.filter((function(e){return 1!=e}))),l.is_lock&&(v=v.filter((function(e){return 2!=e}))),Z("span",{onClick:function(e){return e.stopPropagation()}},Z(r.default,{content:Z(o.default,{className:"dropdown-container",onClick:this.onActionClick},v.map((function(t){var n=m[t];return Z(o.default.Item,{disabled:e.state.isLoading,key:t},n.text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},Z(s.default,{type:"primary",size:"small",style:{fontSize:"large"==p?14:12,width:"large"==p?150:120,height:"large"==p?40:22,background:f.bgColor,borderColor:f.bgColor,position:"relative",overflow:"hidden",padding:"0 5px"}},f.text,this.state.isLoading&&Z(y.Z,{style:{position:"absolute",left:1,top:"calc((100% / 2) - 6px)"}}),(v.length>0||l.is_lock)&&!this.props.onChange&&(l.is_lock?Z(b.Z,{style:{position:"absolute",right:5,top:"calc((100% / 2) - 5px)"}}):Z(_.Z,{style:{position:"absolute",right:5,top:"calc((100% / 2) - 5px)"}})))),Z(a.Z,{visible:n,okText:d("components.productDeleteMutil.agree"),okType:"danger",onOk:function(t){return c?e.doUpdate(2):i.default.warning(d("components.orderActionButton.enterReason"))},cancelText:d("components.productDeleteMutil.disagree"),onCancel:function(){return e.setState({note:"",noteModalVisible:!1,modalDetailVisible:!1})}},Z("div",{style:{paddingBottom:10,fontWeight:600,fontSize:16}},d("components.productDeleteMutil.reason")),Z(D,{placeholder:d("components.productDeleteMutil.enterReason"),value:c,onChange:function(t){return e.setState({note:t.target.value})}})))}}]),n}(g.Component);t.Z=(0,v.$j)((function(e){return{currentShop:e.shop.currentShop,user:e.navigation.user}}),{cancelPurchase:x.KL3,cancelPurchaseAccessories:x.GH$,updatePurchase:x.CDO,updatePurchaseAccessories:x.MXI,countersPurchase:x.u5D})(k)},60243:function(e,t,n){"use strict";var a=n(56697),i=n(28465),r=n(67294),s=n(49101),o=n(22318),c=n(95213),u=n(69705),l=n.n(u),d=r.createElement;t.Z=function(e){var t=e.accessToken,n=e.handleUploadImages,u=e.editFileList,p=e.className,h=(0,r.useState)(u||[]),m=h[0],f=h[1],g=(0,r.useState)(!1),v=g[0],y=g[1],_=(0,r.useState)("0"),b=_[0],S=_[1];(0,r.useEffect)((function(){f(u||[])}),[u]);return d("div",{style:{display:"flex"}},d(i.Z,{action:"".concat((0,c.LpH)(),"/contents?access_token=").concat(t),listType:"picture-card",accept:"image/*",multiple:!0,className:"upload-image".concat(p?" ".concat(p):""),beforeUpload:function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){var a=new Image;a.onload=function(){e.width=a.width,e.height=a.height,t(e)},a.src=n.result},n.readAsDataURL(e)}))},data:function(e){return{file:e,width:e.width,height:e.height}},showUploadList:!("showUploadList"in e)||e.showUploadList,fileList:m,onPreview:function(e){var t;S((null===(t=e.response)||void 0===t?void 0:t.content_url)||(null===e||void 0===e?void 0:e.thumbUrl)),y(!0)},onChange:function(e){"error"!=e.file.status?function(e){f(e);var t=[];e.length&&e.map((function(e){e.response&&e.response.success&&e.response.content_url&&t.push(e.response.content_url)})),t.length==e.length&&(t=t.length?t:-1,n(t))}(e.fileList):e.file.size>3e4?o.Z.error("Th\u1ea5t b\u1ea1i","Dung l\u01b0\u1ee3ng \u1ea3nh qu\xe1 l\u1edbn"):o.Z.error("Th\u1ea5t b\u1ea1i","L\u1ed7i kh\xf4ng x\xe1c \u0111\u1ecbnh")}},e.children||d("div",null,d(s.Z,null),d("div",{className:"ant-upload-text"},"Upload"))),d(a.Z,{visible:v,footer:null,onCancel:function(){return y(!1)},wrapClassName:"image-preview"},d("img",{style:{width:"100%"},src:b})),d("style",{dangerouslySetInnerHTML:{__html:l()}}))}},17567:function(e,t,n){"use strict";var a,i=n(40987),r=n(56697),s=n(2307),o=n(65400),c=n(94055),u=n(809),l=n.n(u),d=n(92447),p=n(74047),h=n(52700),m=n(4706),f=n(33814),g=n(44102),v=n(20775),y=n(26265),_=n(20838),b=n(64749),S=n(51024),x=n(18446),I=n.n(x),Z=n(50361),w=n.n(Z),C=n(67294),P=n(14494),D=n(9669),k=n.n(D),N=n(87217),T=n(7085),q=n(73171),O=n(49101),R=n(7145),M=n.n(R),A=n(45514),L=n(83049),z=n(50916),j=n(36934),B=n(95213),H=n(20920),E=n(71502),F=n.n(E),V=n(21326),W=n(99791),Q=n(22318),U=n(30381),$=n.n(U),K=n(48519),Y=C.createElement;function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){(0,y.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,a=(0,v.Z)(e);if(t){var i=(0,v.Z)(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return(0,g.Z)(this,n)}}var ee=S.default.TextArea,te=b.default.Option,ne=_.default.TabPane,ae={supplier_products_id:null,page:1,page_size:20},ie={supplier_products_id:null,page:1,page_size:20},re={key:"1",isCreate:!1,supplierProductDebt:[],totalEntriesSupplierDebt:null,supplierProductDebtHistories:[],totalEntriesSupplierDebtHistories:null,debtMustPay:{}},se=(0,N.Z)()(a=function(e){(0,f.Z)(n,e);var t=X(n);function n(e){var a;return(0,p.Z)(this,n),a=t.call(this,e),(0,y.Z)((0,m.Z)(a),"handleGetAddress",(function(){var e=a.props.currentShop,t=a.state.currentSupplier,n=a.getCountryCodeBySupplier()?a.getCountryCodeBySupplier():e.country_code&&e.country_code.length?e.country_code[0]:"84";a.getProvincesFromCountryCode(t.country_code||n),a.handlechangeProvince(t.province_id),a.handlechangeDistrict(t.district_id),a.handlechangeCommune(t.commune_id)})),(0,y.Z)((0,m.Z)(a),"handleChangeCountryCode",(function(e){a.setState({provinces:[],districts:[],communes:[],currentSupplier:M()(a.state.currentSupplier,{province_id:{$set:""},district_id:{$set:""},commune_id:{$set:""},country_code:{$set:e}})},(function(){return a.getProvincesFromCountryCode(e.toString())}))})),(0,y.Z)((0,m.Z)(a),"handlechangeProvince",(function(e){var t=e||"";a.setState({districts:[],communes:[],currentSupplier:M()(a.state.currentSupplier,{district_id:{$set:""},commune_id:{$set:""},province_id:{$set:t}})});var n=localStorage.getItem("province_".concat(t));if(n)a.setState({districts:JSON.parse(n)});else{var i="".concat((0,B.LpH)(),"/geo/districts?province_id=").concat(t);k().get(i).then((function(e){e.data&&!0===e.data.success&&(localStorage.setItem("province_".concat(t),JSON.stringify(e.data.data)),a.setState({districts:e.data.data}))}))}})),(0,y.Z)((0,m.Z)(a),"handlechangeDistrict",(function(e){var t=e||"";a.setState({communes:[],currentSupplier:M()(a.state.currentSupplier,{commune_id:{$set:""},district_id:{$set:t}})});var n=localStorage.getItem("district_".concat(t));if(n)a.setState({communes:JSON.parse(n)});else{var i="".concat((0,B.LpH)(),"/geo/communes?district_id=").concat(t);k().get(i).then((function(e){e.data&&!0===e.data.success&&(localStorage.setItem("district_".concat(t),JSON.stringify(e.data.data)),a.setState({communes:e.data.data}))}))}})),(0,y.Z)((0,m.Z)(a),"handlechangeCommune",(function(e){var t=e||"";a.setState({currentSupplier:M()(a.state.currentSupplier,{commune_id:{$set:t}})})})),(0,y.Z)((0,m.Z)(a),"getProvincesFromCountryCode",(function(e){var t=localStorage.getItem("provinces_".concat(e)),n="".concat((0,B.LpH)(),"/geo/provinces?country_code=").concat(e);if(!t)return k()({method:"get",url:n}).then((function(t){t.data&&!0===t.data.success&&(localStorage.setItem("provinces_".concat(e),JSON.stringify(t.data.data)),a.setState({provinces:t.data.data}))}));a.setState({provinces:JSON.parse(t)})})),(0,y.Z)((0,m.Z)(a),"openModal",(function(){a.setState({isCreate:!0}),a.props.setVisible(!0)})),(0,y.Z)((0,m.Z)(a),"closeModal",(function(){a.props.setVisible(!1),a.props.viewModal||a.props.setSelectedSupplier({id:0,name:"",phone_number:"",address:"",description:"",country_code:"",province_id:"",district_id:"",commune_id:"",custom_id:""}),a.setState(G(G({},re),{},{activeKey:"1"}))})),(0,y.Z)((0,m.Z)(a),"handleSaveSupplier",(function(){var e=a.props,t=e.shopId,n=e.accessToken,i=e.updateSupplierProduct,r=e.createSupplierProduct,s=a.state.currentSupplier,o={supplier_products:s};s.id?i(n,t,o):r(n,t,o),a.closeModal()})),(0,y.Z)((0,m.Z)(a),"handleOnChangeTab",(function(e){switch(e){case"2":a.fetchSupplierDebt();break;case"3":a.fetchSupplierDebtHistories(),a.calTotalDebt()}a.setState({activeKey:e})})),(0,y.Z)((0,m.Z)(a),"fetchSupplierDebt",(0,d.Z)(l().mark((function e(){var t,n,i,r,s,o,c,u=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:ae,a.setState({loadingSupplierDebt:!0}),n=a.props,i=n.accessToken,r=n.shopId,s=n.fetchListOfDebt,o=a.state.currentSupplier,t=G(G({},t),{},{supplier_products_id:o.id}),e.next=7,s(i,r,t);case 7:c=e.sent,a.setState({supplierProductDebt:c.data,totalEntriesSupplierDebt:c.total_entries,loadingSupplierDebt:!1});case 9:case"end":return e.stop()}}),e)})))),(0,y.Z)((0,m.Z)(a),"calTotalDebt",(0,d.Z)(l().mark((function e(){var t,n,i,r,s,o,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.props,i=n.shopId,r=n.accessToken,s=n.calTotalDebt,o=a.state.currentSupplier,c={supplier_products_id:o.id},e.next=5,s(r,i,c);case 5:u=e.sent,a.setState({debtMustPay:null===u||void 0===u||null===(t=u.data)||void 0===t?void 0:t.debt_must_pay});case 7:case"end":return e.stop()}}),e)})))),(0,y.Z)((0,m.Z)(a),"fetchSupplierDebtHistories",(0,d.Z)(l().mark((function e(){var t,n,i,r,s,o=arguments;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=o.length>0&&void 0!==o[0]?o[0]:ie,a.setState({loadingSupplierDebtHistories:!0}),n=a.props,i=n.accessToken,r=n.shopId,s=a.state.currentSupplier,t=G(G({},t),{},{supplier_products_id:s.id}),(0,j.V2h)(i,r,t).then((function(e){a.setState({supplierProductDebtHistories:null===e||void 0===e?void 0:e.data,totalEntriesSupplierDebtHistories:null===e||void 0===e?void 0:e.total_entries,loadingSupplierDebtHistories:!1})}));case 6:case"end":return e.stop()}}),e)})))),(0,y.Z)((0,m.Z)(a),"handleChangeSupplier",(function(e,t){var n;e="tags"==t?(null===(n=e)||void 0===n?void 0:n.length)>0?e:"-1":e,a.setState({currentSupplier:M()(a.state.currentSupplier,(0,y.Z)({},t,{$set:e}))})})),(0,y.Z)((0,m.Z)(a),"renderSupplierInfo",(function(){var e=a.props,t=e.currentShop,n=e.t,i=e.supplier_tags,r=a.state,s=r.currentSupplier,o=r.provinces,c=r.districts,u=r.communes,l=a.getCountryCodeBySupplier()?a.getCountryCodeBySupplier():t.country_code&&t.country_code.length?t.country_code[0]:"84";return Y("div",{className:"supplier-info"},Y("div",{className:"containers"},Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.custom")),Y(S.default,{placeholder:n("pages.shop.product.supplier.custom"),size:"default",style:{flex:4,marginRight:10},value:s.custom_id,onChange:function(e){return a.handleChangeSupplier(e.target.value,"custom_id")}})),Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.name")),Y(S.default,{placeholder:n("pages.shop.product.supplier.name"),size:"default",style:{flex:4,marginRight:10},value:s.name,onChange:function(e){return a.handleChangeSupplier(e.target.value,"name")}})),Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.phoneNumber")),Y(S.default,{placeholder:n("pages.shop.product.supplier.phone"),size:"default",style:{flex:5,marginRight:10},value:s.phone_number,onChange:function(e){return a.handleChangeSupplier(e.target.value,"phone_number")}})),Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.type")),Y(b.default,{value:s.type,onChange:function(e){return a.handleChangeSupplier(e,"type")}},Y(te,{key:"0",value:0},n("pages.shop.product.supplier.supplierByProduct")),Y(te,{key:"1",value:1},n("pages.shop.product.supplier.supplierByAccessories")))),Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.tag")),Y(b.default,{style:{width:"100%"},onChange:function(e){return a.handleChangeSupplier(e,"tags")},mode:"multiple",value:"-1"==s.tags?[]:s.tags||[],placeholder:n("components.productPromotionDetail.selectTags"),showSearch:!0,filterOption:function(e,t){return(0,B.st5)(e,t.label)}},(i||[]).map((function(e){return Y(te,{value:e.id,key:e.id,label:e.name},e.name)}))))),Y("div",{className:"containers",style:{marginTop:16}},Y("div",null,Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.address")),Y(S.default,{placeholder:n("pages.shop.product.supplier.address"),size:"default",style:{flex:2},value:s.address,onChange:function(e){return a.setState({currentSupplier:M()(a.state.currentSupplier,{address:{$set:e.target.value}})})}})),t.country_code&&t.country_code.length>1&&Y("div",{className:"info"},Y("span",null,n("containers.customerInfo.country")),Y(b.default,{placeholder:n("containers.customerInfo.country"),value:a.state.currentSupplier.country_code?a.state.currentSupplier.country_code.toString():l,onChange:a.handleChangeCountryCode.bind((0,m.Z)(a))},a.props.currentShop.country_code.map((function(e){return Y(te,{key:e,value:e},(0,B.bbV)(e))}))))),Y("div",{className:"address"},Y(A.Z,{value:s.province_id&&o.length?s.province_id:void 0,dataSource:o,placeholder:o.length||!s.province_id?n("containers.customerInfo.province"):Y("span",null,Y(T.Z,null)," ",n("containers.customerInfo.loading")),onChange:a.handlechangeProvince}),Y(A.Z,{value:s.district_id&&c.length?s.district_id:void 0,dataSource:c,placeholder:c.length||!s.district_id?n("containers.customerInfo.district"):Y("span",null,Y(T.Z,null)," ",n("containers.customerInfo.loading")),onChange:a.handlechangeDistrict.bind((0,m.Z)(a))}),Y(A.Z,{value:s.commune_id&&u.length?s.commune_id:void 0,dataSource:u,placeholder:u.length||!s.commune_id?n("containers.customerInfo.commune"):Y("span",null,Y(T.Z,null)," ",n("containers.customerInfo.loading")),onChange:a.handlechangeCommune.bind((0,m.Z)(a))})),Y("div",{className:"info"},Y("span",null,n("pages.shop.product.supplier.description")),Y(ee,{placeholder:n("pages.shop.product.supplier.supplierDescription"),style:{fontSize:14},rows:4,value:s.description,onChange:function(e){return a.setState({currentSupplier:M()(a.state.currentSupplier,{description:{$set:e.target.value}})})}}))))})),(0,y.Z)((0,m.Z)(a),"columnsSupplierDebt",[{title:"ID",dataIndex:"display_id",ellipsis:!0,width:"6%"},{title:a.props.t("pages.shop.debt.nameDebt"),dataIndex:"name",ellipsis:!0,width:"17%"},{title:a.props.t("pages.shop.debt.description"),dataIndex:"description",ellipsis:!0},{title:a.props.t("pages.shop.debt.debtRemain"),dataIndex:"remain",align:"right",ellipsis:!0,width:"15%"},{title:a.props.t("containers.customerInfo.debtsHistoriesCreator"),dataIndex:"creator",align:"left",width:"20%"},{title:a.props.t("containers.customerInfo.debtsHistoriesInsertedAt"),dataIndex:"inserted_at",align:"right",ellipsis:!0,width:"15%"},{title:a.props.t("pages.shop.debt.debtStatus"),dataIndex:"status",ellipsis:!0,width:120}]),(0,y.Z)((0,m.Z)(a),"getDataSourceSupplierDebt",(function(){var e=a.props,t=e.currentShop,n=e.timezone;return a.state.supplierProductDebt.map((function(e){var a=(0,H.rQ)()[e.status];return{display_id:e.display_id,name:Y(c.default,{title:e.name_debt},e.name_debt),description:Y(c.default,{title:e.description},e.description),remain:Y("span",{style:{color:0==e.type?"#f04134":"#096dd9"}},(0,B.ufS)(e.money_must_pay_or_collect-e.money_payed_or_collected,t.currency)),creator:e.user?Y("span",{style:{display:"flex",alignItems:"center",float:"left"}},Y(z.Z,{id:e.user.fb_id,size:[20,20],name:e.user.fb_id}),"\xa0",Y("span",null,e.user.name)):"",inserted_at:Y(c.default,{title:(0,B.o0x)(n||7,e.inserted_at)},(0,B.o0x)(n||7,e.inserted_at)),status:Y(o.default,{type:"primary",style:{fontSize:12,width:100,height:20,background:a.bgColor,borderColor:a.bgColor,textAlign:"center",padding:0}},a.text),action:e}}))})),(0,y.Z)((0,m.Z)(a),"renderSupplierDebt",(function(){var e=a.state,t=e.totalEntriesSupplierDebt,n=e.loadingSupplierDebt,i=a.props.t;return Y("div",null,Y(s.Z,{columns:a.columnsSupplierDebt,dataSource:a.getDataSourceSupplierDebt(),onChange:a.handleTableChange("supplier_debt"),pagination:{size:"small",pageSize:20,total:t},loading:n,locale:{emptyText:i("pages.shop.debt.noCustomerDebtInfo")}}))})),(0,y.Z)((0,m.Z)(a),"handleTableChange",(function(e){return function(t){var n;switch(e){case"supplier_debt":return(n=G({},ae)).page=t.current,void a.fetchSupplierDebt(n);case"supplier_debt_histories":return(n=G({},ie)).page=t.current,void a.fetchSupplierDebtHistories(n)}}})),(0,y.Z)((0,m.Z)(a),"columnsSupplierDebtHistories",[{title:"STT",dataIndex:"index",align:"center",width:"4%"},{title:a.props.t("containers.customerInfo.debtsHistoriesNote"),dataIndex:"note",ellipsis:!0,width:"25%"},{title:a.props.t("containers.customerInfo.debtsHistoriesChangedAmount"),dataIndex:"changed_amount",align:"right",ellipsis:!0},{title:a.props.t("containers.customerInfo.debtsAfterAction"),dataIndex:"current_debts",align:"right",ellipsis:!0,width:"15%"},{title:a.props.t("containers.customerInfo.debtsHistoriesCreator"),dataIndex:"creator",align:"left",width:"12%"},{title:a.props.t("containers.customerInfo.debtsHistoriesInsertedAt"),dataIndex:"inserted_at",align:"right",ellipsis:!0,width:"12%"},{title:a.props.t("containers.customerInfo.incurredDate"),dataIndex:"incurred_date",align:"right",ellipsis:!0,width:"12%"},{title:a.props.t("delete"),dataIndex:"delete",align:"center",ellipsis:!0,width:"5%"}]),(0,y.Z)((0,m.Z)(a),"getDataSourceDebtsHistories",(function(){var e=a.props,t=e.timezone,n=e.currentShop;return(a.state.supplierProductDebtHistories||[]).map((function(e,i){return{index:i+1,note:Y(c.default,{title:e.note},e.note),changed_amount:Y("span",{style:{color:e.changed_amount>0?"#f04134":"#096dd9"}},(0,B.ufS)(e.changed_amount,n.currency)),current_debts:null!=e.current_debts?Y("span",{style:{color:"#096dd9"}},(0,B.ufS)(e.current_debts,n.currency)):"",creator:e.user?Y("span",{style:{display:"flex",alignItems:"center",float:"left"}},Y(z.Z,{avatar_url:e.user.avatar_url,id:e.user.fb_id,size:[20,20],name:e.user.fb_id}),"\xa0",Y("span",null,e.user.name)):"",inserted_at:Y(c.default,{title:(0,B.o0x)(t||7,e.inserted_at)},(0,B.o0x)(t||7,e.inserted_at)),incurred_date:e.incurred_date?Y(c.default,{title:(0,B.o0x)(t||7,e.incurred_date)},(0,B.o0x)(t||7,e.incurred_date)):"",delete:[0,1].includes(e.type)?Y("span",{onClick:function(e){return e.stopPropagation()}},Y(o.default,{size:"small",danger:!0,onClick:function(){return a.confirmDelete(e)}},Y(q.Z,null))):null,action:e}}))})),(0,y.Z)((0,m.Z)(a),"confirmDelete",(function(e){var t=a.props.t;r.Z.confirm({title:t("containers.formBox.warningConfirm"),content:"B\u1ea1n c\xf3 ch\u1eafc ch\u1eafn mu\u1ed1n xo\xe1 l\u1ecbch s\u1eed c\xf4ng n\u1ee3 n\xe0y",okText:t("containers.formBox.confirmOK"),cancelText:t("cancel"),onOk:function(){return a.handleDeleteDebtsHistories(e)},onCancel:function(){}})})),(0,y.Z)((0,m.Z)(a),"handleDeleteDebtsHistories",(function(e){var t=a.state.currentSupplier,n=a.props,i=n.currentShop,r=n.accessToken,s=n.t,o={debtPaying:{id:e.id,is_debt_must_pay:!0,value:1==e.type?e.current_debts:Math.abs(e.changed_amount),inserted_at:e.inserted_at?$()(e.inserted_at).unix():null,type:e.type,note:e.note,payment_methods:e.payment_methods||0},customer:null,supplier_products_id:t},c="".concat((0,B.LpH)(),"/shops/").concat(i.id,"/debt/delete_debts_histories?access_token=").concat(r);k().post(c,(0,B.D$T)({params:o})).then((function(e){e.data.success?Q.Z.success(s("containers.customerInfo.updatedDebtSuccess")):Q.Z.error(s("containers.customerInfo.updatedDebtError")),a.fetchSupplierDebtHistories(),a.calTotalDebt()}))})),(0,y.Z)((0,m.Z)(a),"renderSupplierDebtHistories",(function(){var e=a.props,t=e.t,n=e.currentShop,i=(e.accessToken,a.state),r=i.loadingSupplierDebtHistories,c=i.totalEntriesSupplierDebtHistories,u=i.debtMustPay,l=n?(0,K.zE)(n.role):{};return Y("div",{className:"supplier-debt-must-pay"},Y("div",{className:"debt-info"},Y("div",{className:"first",style:{minWidth:140}},Y("div",{style:{display:"flex",justifyContent:"space-between"}},Y("span",null,"T\u1ed5ng c\xf4ng n\u1ee3 ph\u1ea3i tr\u1ea3:"),"\xa0",Y("span",{style:{color:"#f04134"}},(0,B.ufS)(null===u||void 0===u?void 0:u.sum_must_pay,n.currency))),Y("div",{style:{marginTop:5,display:"flex",justifyContent:"space-between"}},Y("span",null,"T\u1ed5ng c\xf4ng n\u1ee3 \u0111\xe3 tr\u1ea3:"),"\xa0",Y("span",{style:{color:"#f04134"}},(0,B.ufS)(null===u||void 0===u?void 0:u.sum_payed,n.currency)))),l.for_control_orders&&Y("div",{className:"second"},Y("div",null,(null===u||void 0===u?void 0:u.sum_must_pay)>0&&Y(o.default,{type:"primary",onClick:function(){return a.setState({visibleDebtPaying:!0,typePaying:0,isCreatingDebtAdjustment:!0})}},"Thanh to\xe1n"),"\xa0",Y(o.default,{type:"primary",onClick:function(){return a.setState({visibleDebtPaying:!0,typePaying:1,isCreatingDebtAdjustment:!0})}},"\u0110i\u1ec1u ch\u1ec9nh")))),Y(s.Z,{columns:a.columnsSupplierDebtHistories,dataSource:a.getDataSourceDebtsHistories(),pagination:{size:"small",pageSize:20,total:c},loading:r,onChange:a.handleTableChange("supplier_debt_histories"),locale:{emptyText:t("pages.shop.debt.noDebtHistories")},onRow:function(e){return{onClick:function(){e.action.purchase?a.setState({modalPurchaseVisible:!0,selectedPurchase:e.action.purchase}):a.onRowClickDebtHistories(e)}}}}))})),(0,y.Z)((0,m.Z)(a),"onRowClickDebtHistories",(function(e){var t=a.props.timezone;1!=e.action.type&&0!=e.action.type||null==e.action.current_debts||a.setState({visibleDebtPaying:!0,typePaying:e.action.type,isCreatingDebtAdjustment:!1,debtPaying:{id:e.action.id,is_debt_must_pay:!0,value:1==e.action.type?e.action.current_debts:Math.abs(e.action.changed_amount),inserted_at:e.action.inserted_at?$()(e.action.inserted_at).add("hours",t):null,type:e.action.type,note:e.action.note,payment_methods:e.action.payment_methods||0}})})),(0,y.Z)((0,m.Z)(a),"handleChangeSupplierProduct",(function(e,t){var n=w()(a.state.currentSupplier);n[t]=e,a.setState({currentSupplier:n})})),a.state=G(G({currentSupplier:e.selectedSupplier||{id:0,name:"",phone_number:"",address:"",description:"",province_id:"",district_id:"",commune_id:"",country_code:"",custom_id:"",type:0,is_activated:null,tags:[]},provinces:[],districts:[],communes:[]},re),{},{visibleDebtPaying:!1,modalPurchaseVisible:!1,selectedPurchase:null,typePaying:null,activeKey:e.activeKey||"1",isCreatingDebtAdjustment:!0}),a}return(0,h.Z)(n,[{key:"componentDidMount",value:function(){this.handleGetAddress(),"3"==this.props.activeKey&&(this.fetchSupplierDebtHistories(),this.calTotalDebt())}},{key:"getCountryCodeBySupplier",value:function(){var e=this.state.currentSupplier;(0,B.tVb)(e,"")}},{key:"componentDidUpdate",value:function(e){var t=this;I()(this.props.selectedSupplier,e.selectedSupplier)||this.setState({currentSupplier:this.props.selectedSupplier},(function(){t.handleGetAddress()}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.visible,a=t.t,s=t.currentShop,c=t.removeButtonPlus,u=t.accessToken,l=t.viewModal,d=t.shopId,p=this.state,h=p.activeKey,m=p.isCreate,f=p.visibleDebtPaying,g=p.debtMustPay,v=p.currentSupplier,y=p.typePaying,b=p.debtPaying,S=p.isCreatingDebtAdjustment,x=s?(0,K.zE)(s.role):{},I=x.ql_congno&&x.ql_congno_ncc;return Y("div",{style:{display:"inline-block"}},Y(r.Z,{wrapClassName:"supplier-products-modal",closable:!1,visible:n,width:"".concat(1==h||m?"600px":"95%"),title:Y("div",null,Y(_.default,{className:"tab-supplier-creator",activeKey:h,onChange:function(t){return e.handleOnChangeTab(t)}},Y(ne,{tab:a("pages.shop.product.supplier.supplierInformation"),key:"1"}),!m&&(0,B.rqq)(2,s)&&I&&[Y(ne,{tab:a("pages.shop.product.supplier.supplierDebts"),key:"2"}),Y(ne,{tab:a("pages.shop.product.supplier.debtHistory"),key:"3"})])),footer:"1"==h&&Y("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},Y("div",{style:{display:"flex",alignItems:"center"}},Y(i.Z,{size:"small",checked:0!=v.is_activated,onChange:function(t){return e.handleChangeSupplierProduct(t,"is_activated")}}),"\xa0",Y("span",{style:{display:"flex",justifyContent:"space-around",alignItems:"center"}},Y("span",{style:{fontWeight:500}},a("systemLogs.status"),":"),"\xa0",Y("span",{style:{color:0!=v.is_activated?"#52c41a":"#ff4d4f",borderColor:0!=v.is_activated?"#52c41a":"#ff4d4f",backgroundColor:0!=v.is_activated?"#52c41a":"#ff4d4f",borderRadius:"50%",width:10,height:10,marginLeft:4}}),"\xa0",Y("span",null,0!=v.is_activated?a("pages.shop.product.management.active"):a("pages.shop.product.management.deactive")))),Y(o.default,{type:"primary",onClick:function(){return e.handleSaveSupplier()}},m?"T\u1ea1o":"L\u01b0u")),onCancel:function(){return e.closeModal()}},"1"==h?this.renderSupplierInfo():!m&&("2"==h?this.renderSupplierDebt():"3"==h?this.renderSupplierDebtHistories():"")),!c&&!l&&Y(L.Z,{icon:Y(O.Z,null),title:a("pages.shop.product.supplier.addNewSupplier"),onClick:this.openModal}),Y(V.Z,{visible:f,close:function(){return e.setState({visibleDebtPaying:!1,typePaying:null,debtPaying:null})},type:y,isDebtMustPay:!0,debtMustPay:null===g||void 0===g?void 0:g.sum_must_pay,debtPaying:b,supplierInfo:v,accessToken:u,isCreating:S,fetchData:function(){e.fetchSupplierDebtHistories(),e.calTotalDebt()}}),Y(W.Z,{visible:this.state.modalPurchaseVisible,close:function(){return e.setState({modalPurchaseVisible:!1})},purchase:this.state.selectedPurchase,accessToken:u,shopId:d,showHistories:!0}),Y("style",{dangerouslySetInnerHTML:{__html:F()}}))}}]),n}(C.Component))||a;t.Z=(0,P.$j)((function(e){return{timezone:e.navigation.user.timezone,user:e.navigation.user,supplier_tags:e.product.supplier_tags}}),{updateSupplierProduct:j.hfe,createSupplierProduct:j.qkV,fetchListOfDebt:j._xZ,calTotalDebt:j.FvM})(se)}}]);