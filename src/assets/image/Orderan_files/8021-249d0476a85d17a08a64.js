(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8021],{78021:function(e,t,r){"use strict";var n,o=r(74806),a=r(71535),d=r(28465),i=r(65400),c=r(14321),s=r(4863),l=r(84996),p=r(31059),u=r(94055),m=r(809),h=r.n(m),f=r(92447),g=r(74047),_=r(52700),v=r(4706),I=r(33814),x=r(44102),y=r(20775),C=r(26265),k=r(51024),S=r(20838),O=r(64749),P=r(45578),E=r.n(P),F=r(50361),Z=r.n(F),T=r(89734),b=r.n(T),N=r(35161),w=r.n(N),M=r(67294),D=r(11163),B=r(47219),R=r(25449),H=r(99165),L=r(53318),U=r(4334),A=r(29985),j=r(23665),z=r(42768),W=r(59271),Y=r(1977),J=r(89317),V=r(90631),X=r(7085),K=r(20574),G=r(43347),q=r(88637),Q=r(22263),$=r(79508),ee=r(48176),te=r(9669),re=r.n(te),ne=r(30381),oe=r.n(ne),ae=r(14494),de=r(22318),ie=r(95213),ce=r(20920),se=r(36934),le=r(96129),pe=r(87217),ue=r(11763),me=r(48519),he=r(78598),fe=r(60243),ge=M.createElement;function _e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(r),!0).forEach((function(t){(0,C.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ie(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,y.Z)(e);if(t){var o=(0,y.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,x.Z)(this,r)}}var xe=O.default.Option,ye=S.default.TabPane,Ce=k.default.TextArea,ke=["-2","-3","-4","-9"],Se=(0,pe.Z)()(n=function(e){(0,I.Z)(r,e);var t=Ie(r);function r(e){var n;return(0,g.Z)(this,r),n=t.call(this,e),(0,C.Z)((0,v.Z)(n),"onDrop",(function(e){var t=e.file;n.setState({fileName:t.name});var r=n.props.t,o=new FileReader;o.readAsBinaryString(t),o.onload=function(e){var t=e.target.result,o=XLSX.read(t,{type:"binary",cellDates:!0}),a=o.Workbook.Sheets.filter((function(e){return 0==e.Hidden}))[0],d=0,i=null;do{i=XLSX.utils.sheet_to_json(o.Sheets[a.name],{raw:!0,range:d++})}while("__EMPTY"in i[0]&&"__EMPTY1"in i[0]);if(0!=(i=i.map((function(e){return w()(e,(function(t,r){return-1!=r.indexOf("__EMPTY")&&delete e[r]})),e}))).length){var c=void 0,s=void 0,l=void 0,p=void 0,u=void 0,m=void 0;w()(i[0],(function(e,t){["mae1","mvd","ma van don","order/adjustment id"].includes((0,ie.Mle)(t))&&(c=t),(0,ie.J_U)(e)&&(p=t),(0,ie.J_U)(e)&&(u=t),(0,ie.xT2)(e)&&(s=t),(0,ie.UJv)(e)&&(l=t),["settlement amount"].includes((0,ie.Mle)(t))&&(m=t)}));var h=w()(i[0],(function(e,t){return t})),f=JSON.parse(localStorage.getItem("import_partner_".concat(n.props.importType,"_").concat(n.state.partnerId))),g=(null===f||void 0===f?void 0:f.totalFeeControl)&&JSON.parse(f.totalFeeControl)||[],_=g.every((function(e){return h.includes(e)}));f&&(null===f||void 0===f||delete f.totalFeeControl),w()(f,(function(e,t){h.includes(e)||delete f[t]})),n.setState(ve(ve({orderPartners:i,idField:c,codField:m,phoneField:s,addField:l,dateField:p,expectedDate:u},f),{},{totalFeeControl:_?g:[],isAddOldFree:JSON.parse(localStorage.getItem("isAddOldFree")),isAddOldCOD:JSON.parse(localStorage.getItem("isAddOldCOD")),isCheckHadFilter:JSON.parse(localStorage.getItem("isCheckHadFilter"))}))}else n.setState({fileName:""}),de.Z.error(r("components.orderImportExcel.errorImportFile"),r("components.orderImportExcel.empty"))}})),(0,C.Z)((0,v.Z)(n),"handlePartner",(function(e){var t=n.props.currentShop,r=(0,ie.XWu)(e,t.custom_partners);(r||0==r)&&n.setState({partner:r})})),(0,C.Z)((0,v.Z)(n),"formatPhoneNumber",(function(e,t){var r=function(e,t){return"+"==e.slice(0,1)?"0".concat(e.slice(t+1,e.length)):"0"!=e.slice(0,1)?"0".concat(e.slice(t,e.length)):e};return r(e,2)==r(t,2)||r(e,3)==r(t,3)||e=="0".concat(t)||"0".concat(e)==t})),(0,C.Z)((0,v.Z)(n),"parseCurrency",(function(e,t){var r=ie.cvg.includes(n.props.currentShop.currency)?1:100;return e?t?Math.round((parseFloat(e)||0)/r):Math.round((parseFloat(e)||0)*r):0})),(0,C.Z)((0,v.Z)(n),"parseTrackingNumber",(function(e,t,r){var n,o,a,d,i=r?null===(n=e.partner)||void 0===n?void 0:n.extend_code:e;(1==t&&(i=(i=(i||"").split("."))[i.length-1]),5==t&&(i=(i=(i||"").split("_"))[0]),r&&3==t&&null!==(o=e.partner)&&void 0!==o&&o.order_number_vtp&&(i=e.partner.order_number_vtp),3==t&&i&&(i.startsWith("CH")&&(i=i.slice(2)),i.startsWith("GLK")&&(i=i.slice(3)),i.startsWith("XMG")&&(i=i.slice(3)),i.endsWith("1P1")&&(i=i.slice(0,-3))),r&&null!==(a=(e.shipments||[])[0])&&void 0!==a&&a.tracking_id)&&(i=null===(d=(e.shipments||[])[0])||void 0===d?void 0:d.tracking_id);return ke.includes(t)&&e.custom_id&&(i=e.custom_id),i||""})),(0,C.Z)((0,v.Z)(n),"getOrderFromResponse",(function(e,t,r,o){var a=o?t.term:t.id;return a=(a||"").toString().trim(),e.find((function(e){var t,o,d,i=n.parseTrackingNumber(a,r),c=n.parseTrackingNumber(e,r,!0),s=((null===(t=e.partner)||void 0===t?void 0:t.extend_code)||"").toString().trim(),l=e.marketplace_id||e.order_sources;return c.toUpperCase()==i.toUpperCase()||s.toUpperCase()==i.toUpperCase()||((null===(o=e.partner)||void 0===o?void 0:o.order_number_vtp)||"").toUpperCase().includes(i.toUpperCase())||(null===(d=e.partner)||void 0===d?void 0:d.custom_partner_id)&&(e.custom_id||e.display_id)==i||ke.includes(l)&&e.custom_id==i}))})),(0,C.Z)((0,v.Z)(n),"handleImportControlAgain",function(){var e=(0,f.Z)(h().mark((function e(t,r){var o,a,d,i,c,s,l,p,u,m,g,_,v,I,x,y,C,k,S;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.props,a=o.t,d=o.shopId,i=o.accessToken,c=o.updateOrder,s=n.state,l=s.listOrderSucceed,p=s.listOrderDeflected,u=s.listOrderFailed,m=s.controlInfo,g="".concat((0,ie.LpH)(),"/shops/").concat(d,"/orders?access_token=").concat(i),_=Z()(t),v=Math.ceil(_.length/30),I={page_size:50,page:1,get_by_display_id:!0},x=[],y=[],C=m.partner_id,n.setState({loadingControlAgain:!0}),k=h().mark((function e(t){var o;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=_.splice(0,30),I.search=o.map((function(e){return n.parseTrackingNumber(e.id,C)})).join(" "),e.next=4,re().get(g,{params:I}).then(function(){var e=(0,f.Z)(h().mark((function e(t){var s;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=o.map((function(e){var o=n.getOrderFromResponse(t.data.data,e,C,!1);if(o){var s=n.parseOrderControl(o,e.id,0,e,m,!0);return new Promise((function(t){Promise.resolve(c(i,d,s,!0).then((function(t){if(t&&t.id){e.data=[o],e.success=t.id;var n=Array.isArray(t.tags)?t.tags:[];n.includes(6)?(e.message=a("components.orderPartnerImportExcel.controlIsDeflected"),"deflected"!=r&&y.push(e)):"succeed"!=r&&(n.includes(5)||n.includes(26)||n.includes(27))&&x.push(e)}}))).then(t)}))}return new Promise((function(e){return Promise.resolve().then(e)}))})),e.next=3,Promise.all(s);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)})),S=1;case 11:if(!(S<=v)){e.next=16;break}return e.delegateYield(k(S),"t0",13);case 13:S++,e.next=11;break;case 16:x.length&&(l=x.concat(l),l=E()(l,"id"),"deflected"==r?p=p.filter((function(e){return!x.map((function(e){return e.id.toUpperCase()})).includes(e.id.toUpperCase())})):"failed"==r&&(u=u.filter((function(e){return!x.map((function(e){return e.id.toUpperCase()})).includes(e.id.toUpperCase())})))),y.length&&(p=y.concat(p),p=E()(p,"id"),"succeed"==r?p=p.filter((function(e){return!y.map((function(e){return e.id.toUpperCase()})).includes(e.id.toUpperCase())})):"failed"==r&&(u=u.filter((function(e){return!y.map((function(e){return e.id.toUpperCase()})).includes(e.id.toUpperCase())})))),n.setState({listOrderSucceed:l,listOrderDeflected:p,listOrderFailed:u,loadingControlAgain:!1}),n.updateHistoryOrderControl(l,p,u,m);case 20:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),(0,C.Z)((0,v.Z)(n),"fetchOrdersMatchExtendCode",function(){var e=(0,f.Z)(h().mark((function e(t){var r,o,a,d,i,c,s,l,p,u,m,g,_;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.state,o=r.extendCodeList,a=r.orderIdField,d=r.orderPartners,i=r.updatingInfo,c=r.isCheckHadFilter,s=n.props,l=s.accessToken,p=s.shopId,u=o.map((function(e){return e.term})).filter((function(e){return""!=e&&void 0!=e})),m="".concat((0,ie.LpH)(),"/shops/").concat(p,"/orders?access_token=").concat(l),g=c?n.props.paramsFilter:{},_=ve(ve({},g),{},{page_size:100,page:-1}),20017951!=p&&(_.is_partner=!0),c&&(_.is_order_filter=!0),_.search&&c&&(u=u.filter((function(e){return!_.search.includes(e)}))),a?(_.order_ids=u.join(","),_.get_by_display_id=!0):_.search=u.join(" "),e.next=12,re().get(m,{params:_}).then(function(){var e=(0,f.Z)(h().mark((function e(t){var r,d;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!=t.status||!t.data.data){e.next=5;break}return r=t.data.data,d=o.map((function(e){if(e.term){var t=!1,o=[];1==(o=a?r.filter((function(t){return t.display_id==e.term||"S".concat(p,"O").concat(t.display_id)==e.term||t.custom_id==e.term||"S".concat(p,"O").concat(t.custom_id)==e.term})):r.filter((function(t){var r;return n.formatPhoneNumber(e.term.toString(),t.bill_phone_number)||n.formatPhoneNumber(e.term.toString(),(null===(r=t.shipping_address)||void 0===r?void 0:r.phone_number)||"")}))).length&&(t=!0);var d=e.index||0==e.index?e.index:-1,c=e.isCustomPartner?e.partnerId:void 0;return-1!=d&&o.length>0?(i.push({id:e.id,updating:t,data:o,customPartner:c}),new Promise((function(r){t?Promise.resolve(n.handleMatchExtendCode(o[0],e.id,d,0,i,i.length-1,c)()).then(r):Promise.resolve().then(r)}))):(i.push({id:e.id,data:[]}),new Promise((function(e){return n.setState({updatingInfo:i},e)})))}return i.push({id:"",data:[]}),new Promise((function(e){return n.setState({updatingInfo:i},e)}))})),e.next=5,Promise.all(d);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 12:t==d.length-1&&n.setState({isImportSucceed:!0}),n.setState({extendCodeList:[]}),n.handleImportExtendCode(t+1);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,C.Z)((0,v.Z)(n),"fetchOrdersImportControl",function(){var e=(0,f.Z)(h().mark((function e(t){var r,o,a,d,i,c,s,l,p,u,m,g,_,v;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state,o=r.extendCodeList,a=r.updatingInfo,d=r.orderPartners,i=r.codField,c=r.totalFeeControl,s=n.props,l=s.accessToken,p=s.shopId,u="".concat((0,ie.LpH)(),"/shops/").concat(p,"/orders?access_token=").concat(l),m={page_size:50,page:1,get_by_display_id:!0},g=n.state.partnerId||localStorage.getItem("last_choice_".concat(p)),_=o.map((function(e){return n.parseTrackingNumber(e.term,g)})).filter((function(e){return e})),v=o.length-1,m.search=_.join(" "),!(_.length>0)){e.next=11;break}return e.next=11,re().get(u,{params:m}).then(function(){var e=(0,f.Z)(h().mark((function e(t){var r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(200!=t.status||!t.data.data){e.next=4;break}return r=o.map((function(e,r){var o=(e.term||"").toString().trim(),s=n.getOrderFromResponse(t.data.data,e,g,!0),l=n.parseCurrency(d[e.index][i]),p=0;return c.map((function(t){p+=n.parseCurrency(d[e.index][t])})),a.push({id:o,data:s?[s]:[],codExcel:l,feeExcel:p,updating:!!s}),new Promise(s||v==r?function(t){Promise.resolve(n.handleUpdateControl(s,o,e.index,a,v,r)()).then(t)}:function(e){return n.setState({updatingInfo:a},e)})})),e.next=4,Promise.all(r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 11:t==d.length-1&&(n.setState({isImportSucceed:!0}),n.createHistoryOrderControl()),n.setState({extendCodeList:[]}),n.handleImportControl(t+1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,C.Z)((0,v.Z)(n),"handleImportExtendCode",(function(e){var t=n.state,r=t.orderPartners,o=t.idField,a=t.phoneField,d=t.orderIdField,i=t.partnerField,c=t.partnerId,s=t.updatingInfo,l=t.extendCodeList,p=n.props.currentShop.country_code;if(!(e>=r.length)){var u=d?(r[e][d]||"").toString().trim():(0,ie.SRG)((r[e][a]||"").toString().trim(),!1,p),m=(r[e][o]||"").toString().trim(),h=(r[e][i]||"").toString().trim(),f=Z()(l);f.push({id:m,term:u,index:e,isCustomPartner:"-1"==c,partnerId:"-1"==c&&(0,ie.XWu)(h,n.props.currentShop.custom_partners)}),u?n.setState({extendCodeList:f},(function(){(e+1)%30==0||e==r.length-1?n.fetchOrdersMatchExtendCode(e):n.handleImportExtendCode(e+1)})):(s.push({id:m,data:[]}),n.setState({updatingInfo:s,extendCodeList:f},(function(){(e+1)%30==0||e==r.length-1?n.fetchOrdersMatchExtendCode(e):n.handleImportExtendCode(e+1)})))}})),(0,C.Z)((0,v.Z)(n),"handleImportControl",(function(e){var t=n.state,r=t.orderPartners,o=t.idField,a=t.extendCodeList,d=t.updatingInfo;if(!(e>=r.length)){var i=(r[e][o]||"").toString().trim();i?a.push({term:i,index:e}):d.push({id:i,data:[]}),(e+1)%30==0||e==r.length-1?n.setState({extendCodeList:a,updatingInfo:d},(function(){n.fetchOrdersImportControl(e)})):n.handleImportControl(e+1)}})),(0,C.Z)((0,v.Z)(n),"handleSendRequest",(function(){0==n.props.importType?n.handleImportExtendCode(0):n.handleImportControl(0)})),(0,C.Z)((0,v.Z)(n),"checkedExtendCode",(function(e,t){var r=n.state.idField,o=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),a=(t[r]||"").toString().trim(),d=a.split("."),i=(e.id||"").toString().split(".")||[];return(1==o&&(null===d||void 0===d?void 0:d.length)>0?d[d.length-1]:a)==(1==o&&(null===i||void 0===i?void 0:i.length)>0?i[i.length-1]:e.id)})),(0,C.Z)((0,v.Z)(n),"formatOrderControl",(function(e,t){var r=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId));return e.length?e.map((function(e){var n;return{id:e.id,order_id:(null===(n=e.data[0])||void 0===n?void 0:n.id)||null,cod:e.codExcel,fee:3==r?e.feeExcel:Math.abs(e.feeExcel),message:t&&e.message||null,message_code:t&&e.message_code||null}})):-1})),(0,C.Z)((0,v.Z)(n),"calcCodReturned",(function(e){var t,r;return!([4,5].includes(null===e||void 0===e?void 0:e.status)||15==(null===e||void 0===e?void 0:e.status)&&((null===e||void 0===e?void 0:e.items)||[]).every((function(e){return e.quantity==e.returned_count})))||(null===e||void 0===e||null===(t=e.order_returned_ids)||void 0===t?void 0:t.length)>0&&0!=(null===e||void 0===e?void 0:e.has_exchanged_order_ids)?(null===e||void 0===e?void 0:e.cod)||0:n.props.currentShop.collect_shipping_fee_order_refunded||null!==e&&void 0!==e&&e.return_fee?(null===e||void 0===e?void 0:e.shipping_fee)||0:-((null===e||void 0===e||null===(r=e.advanced_platform_fee)||void 0===r?void 0:r.returned_fee)||0)})),(0,C.Z)((0,v.Z)(n),"createHistoryOrderControl",(function(){var e=n.props,t=e.accessToken,r=e.shopId,o=e.user,a=e.t,d=e.timezone,i=n.state,c=i.updatingInfo,s=i.codField,l=i.totalFeeControl,p=i.isAddOldCOD,u=i.isAddOldFree,m=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),h=c.filter((function(e){return!e.updating&&e.id})),f=h.filter((function(e){return 1==e.data.length&&e.success})),g=f.filter((function(e){return e.message!=a("components.orderPartnerImportExcel.controlIsDeflected")})),_=f.filter((function(e){return e.message==a("components.orderPartnerImportExcel.controlIsDeflected")})),v=h.filter((function(e){return!e.success})),I=h.reduce((function(e,t){return e+n.calcCodReturned(t.data[0])}),0),x=h.reduce((function(e,t){return e+(t.codExcel||0)}),0),y=h.reduce((function(e,t){return e+(3==m?t.feeExcel:Math.abs(t.feeExcel))||0}),0),C=oe().utc(n.state.paidAt).utcOffset(d),k="";k=!s&&l.length?"control_fee":s&&!l.length?"control_cod":"all";var S={orders_succeed:n.formatOrderControl(g),orders_mismatch:n.formatOrderControl(_),orders_failed:n.formatOrderControl(v,!0),accumulate_cod:p,accumulate_fee:u,creator_id:o.uid,paid_at:oe()(C).unix(),partner_id:m,excel_cod:x,excel_fee:y,pos_cod:I,type:k};n.props.createListOrderControl(t,r,S).then((function(e){n.setState({controlInfo:e,listOrderSucceed:g,listOrderDeflected:_,listOrderFailed:v})}))})),(0,C.Z)((0,v.Z)(n),"calcTotalOrderControl",(function(e){var t=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId));return{pos_cod:e.reduce((function(e,t){return e+n.calcCodReturned(t.data[0])}),0),excel_cod:e.reduce((function(e,t){return e+(t.codExcel||0)}),0),excel_fee:e.reduce((function(e,r){return e+(3==t?r.feeExcel:Math.abs(r.feeExcel))||0}),0)}})),(0,C.Z)((0,v.Z)(n),"updateHistoryOrderControl",(function(e,t,r,o){var a=n.props,d=a.accessToken,i=a.shopId,c=n.calcTotalOrderControl(e.concat(t).concat(r)),s={id:null===o||void 0===o?void 0:o.id,orders_succeed:n.formatOrderControl(e),orders_mismatch:n.formatOrderControl(t),orders_failed:n.formatOrderControl(r),excel_cod:c.excel_cod,excel_fee:c.excel_fee,pos_cod:c.pos_cod};n.props.updateOldOrderControl(d,i,s)})),(0,C.Z)((0,v.Z)(n),"onConfirm",(function(){var e=n.props.importType,t=n.state,r=t.idField,o=t.orderIdField,a=t.addField,d=t.codField,i=t.totalFeeField,c=t.phoneField,s=t.dateField,l=t.partnerId,p=t.partnerField,u=t.totalFeeControl,m=t.expectedDate;2==e?localStorage.setItem("import_partner_2_".concat(l),JSON.stringify({idField:r,codField:d,totalFeeControl:JSON.stringify(u)})):1==e?localStorage.setItem("import_partner_1_".concat(l),JSON.stringify({idField:r,codField:d,totalFeeControl:JSON.stringify(u)})):localStorage.setItem("partner_import_0_".concat(l),JSON.stringify("-1"!=l?{idField:r,orderIdField:o,addField:a,phoneField:c,dateField:s,totalFeeField:i,expectedDate:m}:{idField:r,orderIdField:o,addField:a,phoneField:c,dateField:s,totalFeeField:i,partnerField:p,expectedDate:m})),n.setState({isImporting:!0},(function(){return n.handleSendRequest()}))})),(0,C.Z)((0,v.Z)(n),"handleCheckBoxAndSaveToLocal",(function(e,t){n.setState((0,C.Z)({},t,e)),localStorage.setItem(t,e)})),(0,C.Z)((0,v.Z)(n),"parseOrderControl",(function(e,t,r,o,a,d){var i,c,s,l,p=n.state,u=p.orderPartners,m=p.codField,h=p.totalFeeControl,f=p.paidAt,g=p.isAddOldFree,_=p.updateOrderStatus,v=p.isAddOldCOD,I=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),x="all"==(null===a||void 0===a?void 0:a.type)||!(null!==a&&void 0!==a&&a.type),y=a?x||"control_cod"==(null===a||void 0===a?void 0:a.type):m,C=a?x||"control_fee"==(null===a||void 0===a?void 0:a.type):h.length,k=o?o.codExcel:n.parseCurrency(u[r][m]),S=o?o.feeExcel:0;y&&v&&(k+=(null===(i=e.partner)||void 0===i?void 0:i.cod)||0),y&&(null===(c=e.partner)||void 0===c?void 0:c.cod)>0&&(0==k&&5!=e.status||d&&null!==a&&void 0!==a&&a.accumulate_cod)&&(k=e.partner.cod),2==_&&15!=e.status&&(e.status=3),3==_&&(e.status=5);var O=e.order_returned&&4!=e.order_returned.status&&e.order_returned.order_to_returned||(null===(s=e.order_returned_ids)||void 0===s?void 0:s.length)>0,P="VND"==n.props.currentShop.currency&&k<5e4,E=15==e.status&&e.items.every((function(e){return e.quantity==e.returned_count})),F=([4,5].includes(e.status)||E)&&P&&!O,Z=O&&5==e.status,T=2==e.status&&0==k&&!_||3==e.status&&0==k&&e.cod>0&&5==I,b=(0,ie.Caf)(e.status,4,-1)||15==e.status&&!E||(O||(null===(l=e.tags)||void 0===l?void 0:l.includes(25))&&!P)&&4==e.status||!!e.advanced_platform_fee.returned_fee||"VND"!=n.props.currentShop.currency,N=(0,le.Dg)(e.tags,5);o||h.map((function(e){return S+=n.parseCurrency(u[r][e])})),3!=I&&(S=Math.abs(S));var w=5!=e.status||O?e.cod:-(e.advanced_platform_fee.returned_fee||0);if(y&&w==k)C||e.tags.find((function(e){return 27==e||6==e}))?e.tags=N:e.tags.find((function(e){return 5==e}))||(e.tags=(0,le.Dg)(e.tags,26));else if(y)e.tags=Z?(0,le.Dg)(e.tags,5):T?(0,le.Dg)(e.tags,27):b?(0,le.Dg)(e.tags,6):(0,le.Dg)(e.tags,5);else{var M,D;e.tags.find((function(e){return 26==e}))||null!==(M=e.partner)&&void 0!==M&&M.cod&&w==(null===(D=e.partner)||void 0===D?void 0:D.cod)&&2!=e.status?e.tags=N:e.tags.find((function(e){return 6==e}))&&b?e.tags=(0,le.Dg)(e.tags,6):e.tags.find((function(e){return 5==e}))||(e.tags=(0,le.Dg)(e.tags,27))}if(e.partner_fee=C&&!d?g?S+(e.partner.total_fee||0):S:d&&!e.partner_fee?S:e.partner_fee,F&&0!=k&&(e.return_fee=!0,e.shipping_fee=k),e.partner&&!(0,ie.Caf)(e.status,4,-1)&&(e.partner.is_returned=!0),e.partner)e.partner.cod=y?k:e.partner.cod,e.partner.total_fee=C&&!d?g?e.partner_fee:S:d&&!e.partner.total_fee?S:e.partner.total_fee;else if(!ke.includes(I)){var B;e.partner={partner_id:I,extend_code:null!==(B=e.partner)&&void 0!==B&&B.extend_code?e.partner.extend_code:t,cod:y?k:0,total_fee:C?S:0}}return f&&e.partner&&(e.partner.paid_at=f),e})),(0,C.Z)((0,v.Z)(n),"handleMatchExtendCode",(function(e,t,r,o,a,d,i,c){return function(){var s,l=n.props,p=l.accessToken,u=l.shopId,m=l.updateOrder,h=l.t,f=n.state,g=f.partnerId,_=f.statusMatchExtendCode,v=f.totalFeeField,I=f.orderPartners,x=null===(s=e.partner)||void 0===s?void 0:s.extend_code,y=_&&(0,ie.Caf)(e.status,_,-1);if(!I[r])return a.push({id:t,data:[]}),n.setState({updatingInfo:a});var C=n.parseCurrency(I[r][v])||e.partner_fee;if(e.partner={partner_id:i||g,extend_code:t,total_fee:C},e.partner_fee=C,e.status=y?_:e.status,x&&x!=t||-1==g&&!i){var k=a[d],S=h(x?"components.orderPartnerImportExcel.extendCodeNotMatch":"components.orderPartnerImportExcel.cannotFindPartner");return delete k.updating,k.success=!1,k.message=S,x&&de.Z.error(h("error"),S),n.setState({updatingInfo:a})}return m(p,u,e,!0,!1,!c).then((function(e){var r=e&&e.id,i=a[d];delete i.updating,i.success=r,i.data&&i.data.length&&(i.data[o].checked=!0),c&&r&&(e.checked=!0,a.push({id:t,success:r,data:[e]}),de.Z.success(h("success"),h("components.orderPartnerImportExcel.matchExtendCodeSuccess"))),n.setState({updatingInfo:a})}))}})),(0,C.Z)((0,v.Z)(n),"handleUpdateControl",(function(e,t,r,o,a,d){return function(){var i=n.props,c=i.accessToken,s=i.shopId,l=i.updateMultipleOrders,p=i.t;if(!n.state.orderPartners[r])return o.push({id:t,data:[]}),n.setState({updatingInfo:o});if(e){var u={order:e=n.parseOrderControl(e,t,r),index:r,offset:d,extendCode:t,updatingInfoIndex:o.length-1};n.listOrdersUpdate.push(u)}if(d==a){var m=n.listOrdersUpdate.map((function(e){return e.order}));return m.length>0?l(c,s,m).then((function(e){n.listOrdersUpdate.map((function(t,r){var a=e[r],d=a&&a.id,i=a&&Array.isArray(a.tags)?a.tags:[],c=o[t.updatingInfoIndex];i.includes(6)&&(c.message=p("components.orderPartnerImportExcel.controlIsDeflected")),null!==a&&void 0!==a&&a.message&&(c.message=a.message),null!==a&&void 0!==a&&a.message_code&&(c.message_code=a.message_code),delete c.updating,c.success=d,d&&(c.data=[a]),c.data&&c.data.length&&(c.data[0].checked=!0),n.setState({updatingInfo:o})})),n.listOrdersUpdate=[]})):n.setState({updatingInfo:o})}}})),(0,C.Z)((0,v.Z)(n),"renderOrderStatus",(function(e,t){(t.order_returned_ids||[]).length&&(4==e?e=18:5==e&&(e=19));var r=(0,ie.SX_)()[e].bgColor||(0,ie.SX_)()[e].color;return ge("span",{style:{background:r,borderRadius:10,padding:"2px 10px",color:"#fff",fontSize:13}},(0,ie.SX_)()[e].text)})),(0,C.Z)((0,v.Z)(n),"renderListOrderFailed",(function(e){var t=n.props,r=t.t,o=t.currentShop,a=t.importType,d=3==(n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)))?e.feeExcel:Math.abs(e.feeExcel),i=ge("span",{style:{color:"rgba(0, 0, 0, .4)"}},r("components.orderPartnerImportExcel.noInfo")),c=e.message_code&&"undefined"!=e.message_code&&r("messageCode.".concat(e.message_code))||e.message;return 1==e.data.length&&0==a&&e.success?null:!e.success&&e.data.length>0?ge("div",{className:"order-info"},ge("div",{className:"order-info-item"},ge("span",{style:{marginLeft:15},className:"partner-item"},e.id),ge("span",{style:{marginLeft:"25%"}},c&&"undefined"!=c?c:[6,7].includes(e.data[0].status)?r("components.orderPartnerImportExcel.updateStatusOrderFailed"):r("components.orderPartnerImportExcel.updateOrderFailed")))):ge("div",{className:"order-info"},e.data.length>0?ge("div",{className:"order-info-item"},ge("span",{style:{marginLeft:15},className:"partner-item"},ge(u.default,{title:e.id||i},e.id||i)),ge("span",{className:"partner-item"},(0,ie.pyT)(e.data[0].display_id,0)),ge("span",{className:"partner-item"},(0,ie.ufS)(n.calcCodReturned(e.data[0]),o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)(e.codExcel||0,o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)(d||0,o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)((e.codExcel||0)-d||0,o.currency)),ge("span",{className:"partner-item"},e.data[0].bill_phone_number),ge("span",{className:"partner-item"},n.renderOrderStatus(e.data[0].status,e.data[0])),ge("span",null,ge(u.default,{placement:"top",title:r("components.orderPartnerImportExcel.viewOrder")},ge(B.Z,{onClick:function(t){t.stopPropagation(),n.openOrderForm(e.data[0])}})))):ge("div",{className:"order-info-item"},ge("span",{style:{marginLeft:15},className:"partner-item"},ge(u.default,{title:e.id},e.id)),ge("span",{style:{marginLeft:"25%"}},r("components.orderPartnerImportExcel.noOrderMatched"))))})),(0,C.Z)((0,v.Z)(n),"checkedIdField",(function(e){var t=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),r=(e||"").toString().split(".");return 1==t&&r&&r.length?r[r.length-1]:e})),(0,C.Z)((0,v.Z)(n),"checkedChangeExtendCode",(function(e,t){var r=n.state,o=r.orderPartners,a=r.idField,d=r.codField,i=r.totalFeeControl,c=ie.cvg.includes(n.props.currentShop.currency)?1:100,s=o.find((function(t){return n.checkedIdField((t[a]||"").toString().trim())==n.checkedIdField(e)})),l=s&&s[d]||0,p=Math.round(parseFloat(l)*c),u=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),m=0;return i.map((function(e){var t=s&&s[e]||0;m+=Math.round(parseFloat(t)*c)})),t?3==u?m:Math.abs(m):p})),(0,C.Z)((0,v.Z)(n),"renderListOrderSucceed",(function(e){var t=n.props,r=t.t,o=t.currentShop,a=3==(n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)))?e.feeExcel:Math.abs(e.feeExcel);return ge("div",{className:"order-info"},ge("div",{className:"order-info-item"},ge("span",{style:{marginLeft:15},className:"partner-item"},ge(u.default,{title:e.id},e.id)),ge("span",{className:"partner-item"},(0,ie.pyT)(e.data[0].display_id,0)),ge("span",{className:"partner-item"},(0,ie.ufS)(n.calcCodReturned(e.data[0]),o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)(e.codExcel||0,o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)(a||0,o.currency)),ge("span",{className:"partner-item"},(0,ie.ufS)((e.codExcel||0)-a||0,o.currency)),ge("span",{className:"partner-item"},e.data[0].bill_phone_number),ge("span",{className:"partner-item"},n.renderOrderStatus(e.data[0].status,e.data[0])),ge("span",null,ge(u.default,{placement:"top",title:r("components.orderPartnerImportExcel.viewOrder")},ge(B.Z,{onClick:function(t){t.stopPropagation(),n.openOrderForm(e.data[0])}})))))})),(0,C.Z)((0,v.Z)(n),"handleExportExcel",(function(e,t,r){var o=n.props.t,a=n.state,d=a.orderPartners,i=a.idField,c=a.totalFeeControl,s=a.orderIdField,l=a.phoneField,p=a.addField,u=a.dateField,m=a.expectedDate,h=a.totalFeeField,f=new ExcelJS.Workbook,g=f.addWorksheet("My Sheet"),_=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),v=function(e){var t=0,r=d.findIndex((function(t){return(t[i]||"").toString().trim()==e.id}));return-1!=r&&c.map((function(e){t+=n.parseCurrency(d[r][e])})),3==_?t:Math.abs(t)};return g.columns=r?[{header:"STT",key:"stt",width:10},{header:o("extendCode"),key:"extendCode",width:20},{header:o("orders.title"),key:"orderId",width:20},{header:"COD-POS",key:"codPos",width:20},{header:"COD-Excel",key:"codExcel",width:20},{header:"".concat(o("pages.shop.order.freight"),"-Excel"),key:"partnerFeeExcel",width:20},{header:o("components.orderPartnerImportExcel.phoneNumber"),key:"phoneNumber",width:20},{header:o("status"),key:"status",width:20},{header:o("components.orderPartnerImportExcel.notes"),key:"note",width:30}]:[{header:"STT",key:"stt",width:10},{header:o("extendCode"),key:"extendCode",width:20},{header:o("components.orderPartnerImportExcel.orderId"),key:"orderId",width:20},{header:o("phoneNumber"),key:"phoneNumber",width:20},{header:o("components.orderPartnerImportExcel.fee"),key:"fee",width:20},{header:o("address"),key:"address",width:20},{header:o("components.orderPartnerImportExcel.dateTime"),key:"dateTime",width:20},{header:o("components.orderPartnerImportExcel.dayReceiveIncoming"),key:"dayReceiveIncoming",width:20}],e.map((function(e,t){if(r){var a,c,f;g.addRow({stt:t+1,extendCode:e.id,orderId:(null===(a=e.data[0])||void 0===a?void 0:a.display_id)||"",codPos:n.parseCurrency(n.calcCodReturned(e.data[0]),!0),codExcel:n.parseCurrency(e.codExcel||0,!0),partnerFeeExcel:n.parseCurrency(v(e)||e.feeExcel||0,!0),phoneNumber:(null===(c=e.data[0])||void 0===c?void 0:c.bill_phone_number)||"",status:null!==(f=e.data[0])&&void 0!==f&&f.status?(0,ie.SX_)()[e.data[0].status].text:"",note:0==e.updating?o("components.orderPartnerImportExcel.noOrderMatched"):e.message})}else{var _=d.findIndex((function(t){return(t[i]||"").toString().trim()==e.id}));g.addRow({stt:t+1,extendCode:e.id,orderId:d[_][s],phoneNumber:d[_][l],fee:d[_][h],address:d[_][p],dateTime:d[_][u],dayReceiveIncoming:d[_][m]})}})),g.getRow(1).font={size:12,bold:!0},f.xlsx.writeBuffer().then((function(e){(0,he.saveAs)(new Blob([e],{type:"application/octet-stream"}),"".concat("failed"==t?"OrdersFailed.xlsx":"succeed"==t?"OrdersSucceed.xlsx":"OrdersDeflected.xlsx"))}))})),(0,C.Z)((0,v.Z)(n),"handleSelectOrderMatchOrder",(function(e,t,r,o,a,d,i){n.handleMatchExtendCode(e,t.id,r,o,a,d,i,!0)()})),(0,C.Z)((0,v.Z)(n),"renderOrderMatchExtendCode",(function(e){var t=n.state,r=t.orderPartners,o=t.idField,a=t.orderIdField,d=t.dateField,i=t.expectedDate,c=t.phoneField,s=t.addField,l=t.updatingInfo,m=n.props,h=m.t,f=m.currentShop,g=r.findIndex((function(t){return(t[o]||"").toString().trim()==e.id}));if(-1==g)return null;var _=r[g],v=e.data,I=ge("span",{style:{color:"rgba(0, 0, 0, .4)"}},h("components.orderPartnerImportExcel.noInfo")),x=e.message==h("components.orderPartnerImportExcel.cannotFindPartner");return ge("div",{className:"import-item",key:g},ge("div",{className:"partner-info"},ge("span",{className:"partner-item"},ge(R.Z,null)," ",ge(u.default,{placement:"top",title:_[o]||I},_[o]||I)),ge("span",{key:"0",className:"partner-item"},ge(H.Z,null)," ",ge(u.default,{placement:"top",title:(0,ie.pyT)(_[a],0)||I},(0,ie.pyT)(_[a],0)||I)),ge("span",{key:"1",className:"partner-item"},ge(u.default,{title:h("components.orderPartnerImportExcel.dateTime")},ge(L.Z,null)," ",d&&oe()(_[d]).format("DD/MM/YYYY")||I)),ge("span",{key:"5",className:"partner-item"},ge(u.default,{title:h("components.orderPartnerImportExcel.dayReceiveIncoming")},ge(U.Z,null)," ",i&&oe()(_[i]).format("DD/MM/YYYY")||I)),ge("span",{key:"2",className:"partner-item"},ge(A.Z,null)," ",_[c]||I),ge("span",{key:"3",className:"partner-item"},ge(j.Z,null)," COD"),ge("span",{key:"4",className:"partner-item"},ge(z.Z,null)," ",h("products.title")),ge("span",{style:{marginRight:15},key:"6",className:"partner-item date-item"},ge(W.Z,null)," ",ge(u.default,{placement:"top",title:_[s]||I},_[s]||I))),ge("div",{className:"order-info"},v.length>0&&!x?v.map((function(t,r){var o=t.items&&t.items.length?t.items.map((function(e){return"".concat(e.variation_info.name," x ").concat(e.quantity)})).join(", "):h("components.orderPartnerImportExcel.noProduct"),a=l.findIndex((function(t){return t.id==e.id}));return ge("div",{className:"order-info-item",key:r,onClick:function(){return n.handleSelectOrderMatchOrder(t,e,g,r,l,a,e.customPartner)},style:{cursor:"pointer"}},ge("span",{className:"partner-item"}),ge("span",{className:"partner-item"},ge(p.default,{checked:t.checked},ge(u.default,{placement:"top",title:"".concat(h("orders.title")," ").concat(t.custom_id||(0,ie.pyT)(t.display_id,0))},t.custom_id||(0,ie.pyT)(t.display_id,0)))),ge("span",{className:"partner-item"},ge(L.Z,null)," ",oe()(t.inserted_at).format("DD/MM/YYYY")),ge("span",{className:"partner-item"},t.estimate_delivery_date?ge(M.Fragment,null,ge(U.Z,null)," ",oe()(t.estimate_delivery_date).format("DD/MM/YYYY")):null),ge("span",{className:"partner-item"},ge(A.Z,null)," ",t.shipping_address.phone_number||t.bill_phone_number),ge("span",{className:"partner-item"},ge(j.Z,null)," ",(0,ie.ufS)(t.cod,f.currency)),ge("span",{className:"partner-item"},ge(z.Z,null)," ",ge(u.default,{placement:"top",title:o},o)),ge("span",{className:"partner-item date-item"},ge(W.Z,null)," ",ge(u.default,{placement:"top",title:t.shipping_address.full_address||I},t.shipping_address.full_address||I)),ge("span",null,ge(u.default,{placement:"top",title:h("components.orderPartnerImportExcel.viewOrder")},ge(B.Z,{onClick:function(e){e.stopPropagation(),n.openOrderForm(t)}}))))})):ge("div",{style:{fontSize:14,textAlign:"center",padding:10}},h("components.orderPartnerImportExcel.".concat(x?"cannotFindPartner":"noOrderMatched")))))})),(0,C.Z)((0,v.Z)(n),"headerTable",(function(){var e=n.props.t;return ge("div",{className:"partner-info"},ge("div",{className:"partner-info",style:{borderBottom:0}},ge("span",{className:"partner-item"},ge(R.Z,null)," ",e("extendCode")),ge("span",{key:"1",className:"partner-item"},ge(H.Z,null)," ",e("orders.title")),ge("span",{key:"2",className:"partner-item"},ge(j.Z,null)," COD-Pos"),ge("span",{key:"7",className:"partner-item"},ge(j.Z,null)," COD-Excel"),ge("span",{key:"8",className:"partner-item"},ge(Y.Z,null)," ",e("components.orderPartnerImportExcel.partnerFee")),ge("span",{key:"9",className:"partner-item"},ge(Y.Z,null)," ",e("pages.shop.orderControlInfo.actualReceived")),ge("span",{key:"3",className:"partner-item"},ge(A.Z,null)," ",e("components.orderPartnerImportExcel.phoneNumber")),ge("span",{key:"5",className:"partner-item"},ge(J.Z,null)," ",e("status"))))})),(0,C.Z)((0,v.Z)(n),"renderMatchExtendCode",(function(e){var t=b()(e.filter((function(e){var t,r;return(1!=(null===(t=e.data)||void 0===t?void 0:t.length)||1==(null===(r=e.data)||void 0===r?void 0:r.length)&&!e.success)&&e.id})),(function(e){var t;return!(null!==(t=e.data)&&void 0!==t&&t.length)})),r=e.filter((function(e){var t;return 1==(null===(t=e.data)||void 0===t?void 0:t.length)&&e.success&&e.id})),o=function(e){var r,n,o=e.index;return 43+(42*(null===(r=t[o])||void 0===r||null===(n=r.data)||void 0===n?void 0:n.length)||42)},a=r.reduce((function(e,t){var r;return e+42*((null===(r=t.data)||void 0===r?void 0:r.length)||1)}),0)+42*r.length,d=t.reduce((function(e,t){var r;return e+42*((null===(r=t.data)||void 0===r?void 0:r.length)||1)}),0)+42*t.length;return ge(M.Fragment,null,ge(S.default,{tabPosition:"top",activeKey:n.state.activeKey,onChange:function(e){return n.setState({activeKey:e})},tabBarStyle:{marginBottom:0}},ge(ye,{key:"succeed",tab:n.renderBadgeImport(r,"succeed",!1)},ge("div",{className:"import-item"},n.renderVirtualListImport(r,"succeed",85,o,a))),ge(ye,{key:"failed",tab:n.renderBadgeImport(t,"failed",!1)},ge("div",{className:"import-item"},n.renderVirtualListImport(t,"failed",85,o,d)))))})),(0,C.Z)((0,v.Z)(n),"renderBadgeImport",(function(e,t,r){var o=n.props,a=o.t,d=(o.isOrderControlInfo,"succeed"==t?"#52c41a":"deflected"==t?"#fadb14":"ff4d4f"),i=n.state.activeKey==t&&e.length>0;return ge("div",{style:{display:"flex",alignItems:"center"}},ge("span",null,a("components.orderPartnerImportExcel.".concat(t))),ge(l.Z,{count:e.length,style:{marginLeft:5,marginBottom:3,backgroundColor:d},overflowCount:9999}),i&&ge(u.default,{placement:"top",title:a("crm.export")},ge(V.Z,{style:{color:"#096dd9",fontSize:18,marginLeft:5,marginRight:0},onClick:function(){return n.handleExportExcel(e,t,r)}})),n.state.controlInfo&&i&&ge(u.default,{placement:"top",title:"\u0110\u1ed1i so\xe1t l\u1ea1i \u0111\u01a1n ".concat(a("components.orderPartnerImportExcel.".concat(t)))},n.state.loadingControlAgain?ge(X.Z,{style:{fontSize:18,marginLeft:8,marginRight:0}}):ge(K.Z,{style:{color:"#096dd9",fontSize:18,marginLeft:8,marginRight:0},onClick:function(){return n.handleImportControlAgain(e,t)}})))})),(0,C.Z)((0,v.Z)(n),"renderTabPaneImport",(function(e,t){return e=e.sort((function(e,t){var r,n;return(0,ie.Caf)(null===(r=e.data[0])||void 0===r?void 0:r.status,null===(n=t.data[0])||void 0===n?void 0:n.status,1)?1:-1})),ge(ye,{key:t,tab:n.renderBadgeImport(e,t,!0)},ge("div",{className:"import-item"},n.headerTable(),n.renderVirtualListImport(e,t,42,42)))})),(0,C.Z)((0,v.Z)(n),"renderVirtualListImport",(function(e,t,r,o,a){var d=70*window.innerHeight/100-150,i=a||e.length*r,c=i>d?d:i,s=42==r?"succeed"==t||"deflected"==t?n.renderListOrderSucceed:n.renderListOrderFailed:n.renderOrderMatchExtendCode;return ge("div",{id:"".concat(t,"-virtual-list"),style:{overflowY:"auto",overflowX:"hidden",maxHeight:"calc(70vh - 165px)"}},e.length>0&&(0,ce.ng)(window&&80*window.innerWidth/100,c,e.length,o,s,e))})),(0,C.Z)((0,v.Z)(n),"renderContentMatchExtendCode",(function(e,t,r){var o=n.props.t,a=n.state,d=a.partnerId,i=a.partnerField,c=a.orderIdField,s=a.totalFeeField,l=a.phoneField,p=a.addField,u=a.dateField,m=a.expectedDate;return ge("div",null,("-1"==d||"-1"==e)&&ge("div",{style:t},ge("p",null,ge(G.Z,{style:{marginRight:10}}),o("components.orderPartnerImportExcel.unit")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",value:i,onChange:function(e){return n.setState({partnerField:e})},allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(H.Z,{style:{marginRight:10}}),o("components.orderPartnerImportExcel.orderId")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({orderIdField:e})},value:c,allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(q.Z,{style:{marginRight:10}}),o("components.orderPartnerImportExcel.fee")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({totalFeeField:e})},value:s,allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(A.Z,{style:{marginRight:10}}),o("phoneNumber")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({phoneField:e})},value:l,allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(W.Z,{style:{marginRight:10}}),o("address")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({addField:e})},value:p,allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(L.Z,{style:{marginRight:10}}),o("components.orderPartnerImportExcel.dateTime")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({dateField:e})},value:u,allowClear:!0},r)),ge("div",{style:t},ge("p",null,ge(L.Z,{style:{marginRight:10}}),o("components.orderPartnerImportExcel.dayReceiveIncoming")),ge(O.default,{placeholder:o("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",onChange:function(e){return n.setState({expectedDate:e})},value:m,allowClear:!0},r)))})),(0,C.Z)((0,v.Z)(n),"renderImportControl",(function(e,t){var r=n.props.t,o=n.state,a=o.codField,d=o.totalFeeControl;return ge("div",null,ge("div",{style:e},ge("p",null,ge(q.Z,{style:{marginRight:10}}),"COD"),ge(O.default,{placeholder:r("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",dropdownMatchSelectWidth:!1,onChange:function(e){return n.setState({codField:e})},value:a,style:{minWidth:150},allowClear:!0},t)),ge("div",{style:e},ge("p",null,ge(q.Z,{style:{marginRight:10}}),r("components.orderPartnerImportExcel.totalFee")),ge(O.default,{placeholder:r("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",mode:"multiple",dropdownMatchSelectWidth:!1,onChange:function(e){return n.setState({totalFeeControl:e})},value:d,allowClear:!0,style:{minWidth:150}},t)))})),(0,C.Z)((0,v.Z)(n),"renderContentMatchOrders",(function(){var e=n.props,t=e.t,r=e.currentShop,o=e.i18n,a=e.shopId,l=e.importType,u=n.state,m=u.partnerId,h=u.fileName,f=u.paidAt,g=u.idField,_=u.partnerField,v=u.orderIdField,I=u.phoneField,x=u.totalFeeControl,y=u.codField,C=u.orderPartners,k=localStorage.getItem("last_choice_".concat(a)),S=(null!==r&&void 0!==r&&r.role&&(0,me.zE)(r.role),(null===o||void 0===o?void 0:o.language)||"vi"),P={display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:10,paddingTop:10,borderTop:"1px solid #d9d9d9",fontSize:14,paddingRight:5},F=[];(C||[]).map((function(e){return Object.keys(e).map((function(e){return F.push(e)}))}));var Z=(F=E()(F)).map((function(e,t){return ge(xe,{key:t,value:e},e)})),T=!(m||k)||!h||!g||!f&&0!=l||!I&&!v&&0==l||!x.length&&!y&&[1,2].includes(l)||"-1"==m&&(!_||0!=l),b=(0,ie.ZyC)(r).filter((function(e){return![-1,15].includes(e)}));return ge("div",{style:{width:554}},0==l&&ge(s.default,{message:t("notes"),description:ge("div",{style:{fontSize:14}},ge("p",null," ",t("components.orderPartnerImportExcel.selcetPartnerName")),ge("p",null," ",t("components.orderPartnerImportExcel.systemAuto")),ge("p",null," ",t("components.orderPartnerImportExcel.systemMatchExtendCode")),ge("p",null," ",t("components.orderPartnerImportExcel.customFile"),"\xa0",ge("a",{target:"_blank",href:"en"==S?"/static/files/import_custom_dvvc_english.xlsx":"/static/files/import_custom_dvvc.xlsx"},t("components.orderPartnerImportExcel.sampleFile")))),type:"warning",showIcon:!0}),r.country_code&&("3"==n.state.partnerId&&!r.is_linked_vtp&&r.country_code.includes("84")||"5"==n.state.partnerId&&!r.is_linked_ghn&&r.country_code.includes("84")||"17"==n.state.partnerId&&!r.is_linked_vnpost_v2&&r.country_code.includes("84")||"37"==n.state.partnerId&&!r.is_linked_vpx&&r.country_code.includes("84")||"15"==n.state.partnerId&&!r.is_linked_jnt&&r.country_code.includes("84")||"4"==n.state.partnerId&&!r.is_linked_247&&r.country_code.includes("84")||"39"==n.state.partnerId&&!r.is_linked_hola&&r.country_code.includes("84")||"36"==n.state.partnerId&&!r.is_linked_ntx&&r.country_code.includes("84")||"1"==n.state.partnerId&&!r.is_linked_ghtk&&r.country_code.includes("84")||"30"==n.state.partnerId&&!r.is_linked_njv&&r.country_code.includes("84")||"33"==n.state.partnerId&&!r.is_linked_zto&&r.country_code.includes("84")||"32"==n.state.partnerId&&!r.is_linked_supership&&r.country_code.includes("84")||"2"==n.state.partnerId&&!r.is_linked_ems&&r.country_code.includes("84")||"11"==n.state.partnerId&&!r.is_linked_aha&&r.country_code.includes("84")||"10"==n.state.partnerId&&!r.is_linked_jnt_phi&&r.country_code.includes("63")||"23"==n.state.partnerId&&r.country_code.includes("66")&&!r.is_linked_jnt_thai||"41"==n.state.partnerId&&r.country_code.includes("60")&&!r.is_linked_njv_my||"31"==n.state.partnerId&&r.country_code.includes("63")&&!r.is_linked_njv_phi)&&0==l&&ge(s.default,{type:"warning",showIcon:!0,style:{marginTop:10},message:ge("div",null,"3"==n.state.partnerId&&!r.is_linked_vtp&&r.country_code.includes("84")&&ge("span",null,t("containers.formBox.autoConnectVTPToQuickUpdate")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_vtp=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"5"==m&&!r.is_linked_ghn&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," GHN ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_ghn=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"17"==m&&!r.is_linked_vnpost_v2&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," VNP ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_vnpost_v2=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"37"==m&&!r.is_linked_vpx&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," VP Express ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_vpx=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"15"==m&&!r.is_linked_jnt&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," JNT ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_jnt=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"4"==m&&!r.is_linked_247&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," 247 ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_247=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"39"==m&&!r.is_linked_hola&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," Hola ship ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_hola=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"36"==m&&!r.is_linked_ntx&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," Nh\u1ea5t T\xedn Express ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_ntx=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"1"==m&&!r.is_linked_ghtk&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," GHTK ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_ghtk=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"56"==m&&!r.is_linked_ghsv&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," GHSV ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_ghsv=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"33"==m&&!r.is_linked_zto&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," ZTO Express ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_zto=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"32"==m&&!r.is_linked_supership&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," Super ship ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_supership=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"2"==m&&!r.is_linked_ems&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," EMS ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_ems=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"11"==m&&!r.is_linked_aha&&r.country_code.includes("84")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," AHA ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_aha=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"10"==m&&!r.is_linked_jnt_phi&&r.country_code.includes("63")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," J&T Phi ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_jnt_phi=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"31"==m&&!r.is_linked_njv_phi&&r.country_code.includes("63")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," NinjaVan Phi ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_njv_phi=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")),"23"==n.state.partnerId&&r.country_code.includes("66")&&!r.is_linked_jnt_thai&&ge("div",null,ge("span",null,t("containers.formBox.autoConnectJNTToQuickUpdate")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_jnt_thai=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!"))),"41"==m&&!r.is_linked_njv_my&&r.country_code.includes("60")&&ge("span",null,t("components.orderPartnerImportExcel.connectToPushOrders")," Ninja Van Malaysia ",t("components.orderPartnerImportExcel.andUpdateTheBill")," ",ge("a",{onClick:function(){return D.default.push("/shop/setting/shipping-partner?shopId=".concat(r.id,"&connect_njv_my=1"),"/shop/".concat(r.id,"/setting/shipping-partner"))}},t("containers.formBox.clickToHere"),"!")))}),ge("div",null,0==l&&ge(M.Fragment,null,ge(p.default,{style:{marginTop:15},checked:n.state.isCheckHadFilter,onChange:function(e){return n.handleCheckBoxAndSaveToLocal(e.target.checked,"isCheckHadFilter")}},t("onlyMatchOrderHadFilter")),ge("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:5,marginTop:15,alignItems:"center"}},ge("span",null,ge(Q.Z,{style:{marginRight:10}}),t("components.orderInfoImportExcel.updateStatus")),ge(O.default,{style:{minWidth:150},dropdownMatchSelectWidth:!1,showSearch:!0,allowClear:!0,filterOption:function(e,t){return t.props.children.toLowerCase().indexOf(e.toLowerCase())>=0},onChange:function(e){return n.setState({statusMatchExtendCode:e})},value:n.state.statusMatchExtendCode,placeholder:t("components.orderInfoImportExcel.selectStatus")},b.map((function(e){var t;return ge(xe,{key:e,value:e},null===(t=(0,ie.SX_)()[e])||void 0===t?void 0:t.text)}))))),0!=l&&ge(M.Fragment,null,ge("div",null,ge(p.default,{style:{marginTop:0},checked:n.state.isAddOldCOD,onChange:function(e){return n.handleCheckBoxAndSaveToLocal(e.target.checked,"isAddOldCOD")}},t("isAddOldCOD"))),ge(p.default,{style:{marginTop:5},checked:n.state.isAddOldFree,onChange:function(e){return n.handleCheckBoxAndSaveToLocal(e.target.checked,"isAddOldFree")}},t("isAddOldFree")),ge("div",{style:{display:"flex",justifyContent:"space-between",paddingRight:5,marginTop:15,alignItems:"center"}},ge("span",null,ge(Q.Z,{style:{marginRight:10}}),t("components.orderInfoImportExcel.updateStatus")),ge(O.default,{style:{minWidth:150},dropdownMatchSelectWidth:!1,onChange:function(e){return n.setState({updateOrderStatus:e})},value:n.state.updateOrderStatus,allowClear:!0,placeholder:t("components.orderInfoImportExcel.selectStatus")},ge(xe,{key:2,value:2},t("components.orderInfoImportExcel.delivered")),ge(xe,{key:3,value:3},t("components.orderInfoImportExcel.returned"))))),0!=l&&ge("div",{style:P},ge("p",null,ge(L.Z,{style:{marginRight:10}}),t("components.orderPartnerImportExcel.dateOfPayment")),ge(c.default,{format:"DD/MM/YYYY",placeholder:t("components.orderPartnerImportExcel.selectDate"),value:f,style:{minWidth:0==l?115:150},onChange:function(e){return n.setState({paidAt:e.startOf("day")})}})),ge("div",{style:P},ge("p",null,ge(R.Z,{style:{marginRight:10}}),ke.includes(m||k)?"".concat(t("extendCode")," / ").concat(t("components.orderPartnerImportExcel.orderId")):t("extendCode")),ge(O.default,{placeholder:t("components.orderPartnerImportExcel.columnHeader"),className:"fields-select",dropdownMatchSelectWidth:!1,onChange:function(e){return n.setState({idField:e})},value:g,allowClear:!0,style:{minWidth:0==l?115:150}},Z)),0==l?n.renderContentMatchExtendCode(k,P,Z):n.renderImportControl(P,Z)),ge("div",{style:P},n.renderSelectPartner(k),ge("div",{style:{flex:"auto"}},ge(d.Z,{style:{marginLeft:"-155px"},accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:n.onDrop},ge(i.default,{disabled:!k,style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},h?ge("span",null,ge($.Z,null)," ",h):ge("span",null,ge(ee.Z,null)," ",t("components.orderImportExcel.selectFile"))))),ge(i.default,{onClick:n.onConfirm,disabled:T,type:"primary"},t("start"))))})),(0,C.Z)((0,v.Z)(n),"getPartnerList",(function(){var e=n.props.currentShop,t=(0,ie.URf)();return t=t.filter((function(t){return e.country_code.includes(t.country_code)})),t=(e.custom_partners||[]).map((function(e){return{partner_id:e.id,partner_name:e.name}})).concat(t)})),(0,C.Z)((0,v.Z)(n),"selectPartnerValue",[{value:"ecommerce",label:n.props.t("components.orderImportExcel.ecommercePartner"),children:[{value:"-3",label:"Shopee",children:(n.props.currentShop.shopee_account||[]).map((function(e){return{value:e.shopee_shop_id,label:e.shopee_shop_name}}))},{value:"-4",label:"Lazada",children:(n.props.currentShop.lazada_accounts||[]).map((function(e){return{value:e.lazada_sort_code,label:e.lazada_shop_name}}))},{value:"-9",label:"TikTok",children:(n.props.currentShop.tiktok_accounts||[]).map((function(e){return{value:e.tiktok_shop_id,label:e.shop_name}}))},{value:"-2",label:"Tiki",children:(n.props.currentShop.lazada_accounts||[]).map((function(e){return{value:e.tiki_shop_id,label:e.shop_name}}))}]},{value:"partner",label:n.props.t("components.orderImportExcel.partner"),children:n.getPartnerList().map((function(e){return{value:e.partner_id,label:e.partner_name}}))}]),(0,C.Z)((0,v.Z)(n),"onChangeSelectPartner",(function(e){if(e.length>1){var t=e[2]||e[1];n.setState({partnerId:t}),n.props.isControl&&localStorage.setItem("last_choice_".concat(n.props.shopId),t)}})),(0,C.Z)((0,v.Z)(n),"renderSelectPartner",(function(e){var t=n.props,r=t.currentShop,o=t.shopId,d=t.importType,i=t.isControl,c=n.state.partnerId,s=(r.tiktok_accounts||[]).concat(r.shopee_account||[]).concat(r.lazada_accounts||[]).concat(r.tiki_accounts||[]),l=c||e||void 0;if(ke.includes(l))l=["ecommerce",l];else if(l){var p=s.find((function(e){return e.shopee_shop_id==l||e.lazada_sort_code==l||e.tiktok_shop_id==l||e.tiki_shop_id==l}));if(p){var u=p.shopee_shop_id?"-3":p.lazada_sort_code?"-4":p.tiktok_shop_id?"-9":"-2";l=["ecommerce",u,l]}else l=["partner",l]}return ge(M.Fragment,null,s.length>0&&i?ge(a.Z,{options:n.selectPartnerValue,value:l,onChange:n.onChangeSelectPartner,placeholder:n.props.t("components.orderImportExcel.selectPartner"),style:{width:180,marginRight:10},changeOnSelect:!0}):ge(ue.Z,{placeholder:n.props.t("components.orderPartnerImportExcel.unit"),currentShop:r,shopId:o,importType:d,partnerId:void 0!=c?c:e,onChangePartnerId:function(e){return n.setState({partnerId:e})},allowClear:!0,selectIn:"importOrder"}))})),(0,C.Z)((0,v.Z)(n),"getModalContent",(function(){var e=n.props,t=e.t,r=e.importType,o=n.state,a=o.orderPartners,d=o.updatingInfo;if(!(n.state.isImporting||n.props.isImporting))return n.renderContentMatchOrders();var i=b()(Z()(d),(function(e){return 1==e.data.length?4==e.data[0].status?0:1:-1}));d=d.filter((function(e){return!e.updating}));var c=(d=0===r?d:i).filter((function(e){return 1==e.data.length&&e.success})).length,s=n.state.isImportSucceed?100:Math.floor(100*d.length/a.length),l=d.filter((function(e){return 1==e.data.length&&e.success})),p=l.length>0?l.filter((function(e){return e.message==t("components.orderPartnerImportExcel.controlIsDeflected")})):[],u=l.length>0?l.filter((function(e){return e.message!=t("components.orderPartnerImportExcel.controlIsDeflected")})):[],m=d.filter((function(e){return!e.success&&e.id&&!e.updating})),h={percent:s,successCount:c,updatingInfo:d,listOrderFailed:m,listOrderSucceed:u,listOrderDeflected:p};return n.renderOrderControlInfo(h)})),(0,C.Z)((0,v.Z)(n),"handleUpdateOrderControl",(function(e,t){var r=n.props,o=r.accessToken,a=r.shopId,d=r.updateOldOrderControl,i=n.state.controlInfo;"images"==t&&(i.images=e),n.setState({controlInfo:i}),d(o,a,(0,C.Z)({id:i.id},t,e))})),(0,C.Z)((0,v.Z)(n),"renderOrderControlInfo",(function(e){var t=n.state,r=t.activeKey,a=t.controlInfo,d=n.props,i=d.t,c=d.isOrderControlInfo,s=d.importType,l=d.currentShop,p=d.accessToken,u=c?n.state.listOrderSucceed:e.listOrderSucceed,m=c?n.state.listOrderFailed:e.listOrderFailed,h=c?n.state.listOrderDeflected:e.listOrderDeflected,f=c?100:e.percent,g=((null===u||void 0===u?void 0:u.length)||0)+((null===h||void 0===h?void 0:h.length)||0),_=((null===u||void 0===u?void 0:u.length)||0)+((null===h||void 0===h?void 0:h.length)||0)+((null===m||void 0===m?void 0:m.length)||0),v=c?g:e.successCount,I=c?_:e.updatingInfo.filter((function(e){return e.id})).length,x=n.state.partnerId?n.state.partnerId:localStorage.getItem("last_choice_".concat(n.props.shopId)),y=0,C=0,k=0,O=0,P=0,E=0,F=0,Z=0,T=0;u.map((function(e){F+=e.codExcel||0,C+=(3==x?e.feeExcel:Math.abs(e.feeExcel))||0,y+=n.calcCodReturned(e.data[0])})),m.map((function(e){Z+=e.codExcel||0,O+=(3==x?e.feeExcel:Math.abs(e.feeExcel))||0,k+=n.calcCodReturned(e.data[0])})),h.map((function(e){T+=e.codExcel||0,E+=(3==x?e.feeExcel:Math.abs(e.feeExcel))||0,P+=n.calcCodReturned(e.data[0])}));var b=function(e,t,n,o,a){return ge("div",{style:{display:"flex",alignItems:"center",marginRight:a?5:0}},ge("div",{style:{marginRight:5}},e,":")," ",ge("b",null,(0,ie.ufS)("succeed"==r?t:"failed"==r?n:o,l.currency)))},N=f>=100&&ge("div",{style:{display:"flex",marginRight:10}},b("".concat(i("pages.shop.order.freight"),"-Excel"),C,O,E,!0),b("COD-Excel",F,Z,T,!0),b("COD-Pos",y,k,P,!1)),w=((null===a||void 0===a?void 0:a.images)||[]).map((function(e,t){return{uid:t,response:{content_url:e,success:!0},status:"done",url:e}}));return ge("div",{style:{width:"80vw"},className:"custom-progress"},ge(o.default,{strokeWidth:20,percent:f,success:{percent:f>=100?Math.floor(100*v/I):0},status:f>=100?"exception":"",showInfo:!(f>=100)}),f>=100&&!c&&ge("div",{style:{color:"#00a854",textAlign:"center",marginTop:10}},"".concat(i("updateSuccess")," ").concat(v," ").concat(i("orders.title"),". "),v!=I&&"".concat(i("components.orderPartnerImportExcel.confirmedOrderCount")," ").concat(m.length," ").concat(i("components.orderPartnerImportExcel.orderBelow"))),ge("div",{className:0==s?"import-info":"import-info fix-import-info"},0==s?n.renderMatchExtendCode(e.updatingInfo):ge("div",null,ge(S.default,{tabPosition:"top",tabBarExtraContent:N,activeKey:n.state.activeKey,onChange:function(e){return n.setState({activeKey:e})},tabBarStyle:{marginBottom:0}},n.renderTabPaneImport(u,"succeed"),n.renderTabPaneImport(h,"deflected"),n.renderTabPaneImport(m,"failed"))),ge("div",{style:{marginBottom:10}},ge("div",{style:{fontWeight:500}},i("crm.note")),ge(Ce,{placeholder:i("pages.shop.setting.enterNote"),onChange:function(e){n.setState({controlInfo:ve(ve({},a),{},{note:e.target.value})})},value:null===a||void 0===a?void 0:a.note,style:{width:350},rows:3,onBlur:function(e){return n.handleUpdateOrderControl(e.target.value,"note")}})),ge(fe.Z,{accessToken:p,editFileList:w,handleUploadImages:function(e){return n.handleUpdateOrderControl(e,"images")}})))})),(0,C.Z)((0,v.Z)(n),"fetchOrder",(function(e){var t=n.props,r=t.accessToken,o=t.shopId,a="".concat((0,ie.LpH)(),"/shops/").concat(o,"/orders/").concat(e,"?access_token=").concat(r);return re().get(a).then((function(e){return e.data.data}))})),(0,C.Z)((0,v.Z)(n),"handleOrderClick",(function(e){n.fetchOrder(e).then(function(){var e=(0,f.Z)(h().mark((function e(t){return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.openForm({data:t});case 2:n.props.openFormBoxVisible();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),(0,C.Z)((0,v.Z)(n),"openOrderForm",(function(e){n.handleOrderClick(e.id)})),n.state={partnerId:void 0,fileName:"",isImporting:!1,orderPartners:[],idField:void 0,phoneField:void 0,addField:void 0,dateField:void 0,orderIdField:void 0,codField:void 0,totalFeeField:void 0,updatingInfo:[],paidAt:void 0,partnerField:void 0,partner:void 0,activeKey:"failed",extendCodeList:[],totalFeeControl:[],expectedDate:void 0,isImportSucceed:!1,isAddOldFree:!1,isAddOldCOD:!1,isCheckHadFilter:!1,controlInfo:e.controlInfo,listOrderSucceed:e.listOrderSucceed,listOrderFailed:e.listOrderFailed,listOrderDeflected:e.listOrderDeflected},n.listOrdersUpdate=[],n.mounted=!0,n}return(0,_.Z)(r,[{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){return ge("div",null,this.getModalContent())}}]),r}(M.Component))||n;t.Z=(0,ae.$j)((function(e){return{currentShop:e.shop.currentShop,paramsFilter:e.order.params,user:e.navigation.user,timezone:e.navigation.user.timezone}}),{updateOrder:se.Cs,openForm:se.BQi,createListOrderControl:se.G_l,updateOldOrderControl:se.oBw,updateMultipleOrders:se.dVi})(Se)}}]);