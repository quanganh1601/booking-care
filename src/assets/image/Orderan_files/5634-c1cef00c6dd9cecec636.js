(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5634],{91843:function(e){!function(){"use strict";e.exports=".order-export-excel-container .order-export-excel-header{background-color:#fff;padding:10px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);border-radius:2px !important;margin-bottom:10px;min-height:145px}.order-export-excel-container .order-export-excel-header .ant-checkbox+span{font-weight:500}.order-export-excel-container .order-export-excel-setting{background-color:#fff;padding:10px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15);border-radius:2px !important}.order-export-excel-container .order-export-excel-setting .ant-checkbox-wrapper{font-weight:500}.order-export-excel-container .span-order-export{font-weight:500}.order-export-excel-container .ant-input{border-radius:2px !important}.order-export-excel-container .ant-select-selection{border-radius:2px !important}.order-export-excel-container .ant-transfer{display:flex;flex-direction:row;align-items:center;justify-content:space-around}.order-export-excel-container .ant-transfer .ant-transfer-operation{overflow:inherit;margin:0 18px}.order-export-excel-container .ant-transfer .ant-transfer-operation button .anticon{font-size:10px}.order-export-excel-container .ant-transfer .ant-transfer-operation button span{margin-left:0px !important;font-size:12px}.order-export-excel-container .ant-transfer .ant-transfer-operation button{width:60px;padding:0 5px}@media screen and (max-width: 625px){.order-export-excel-container .ant-transfer{flex-direction:column}.order-export-excel-container .ant-transfer .ant-transfer-list{height:150px !important}.order-export-excel-container .ant-transfer .ant-transfer-operation{overflow:inherit;margin:0 18px}.order-export-excel-container .ant-transfer .ant-transfer-operation button:first-child{margin-top:5px}.order-export-excel-container .ant-transfer .ant-transfer-operation button:last-child{margin-bottom:5px}}.load-img{width:170px;position:relative;height:40px}.load-img:hover,.load-img:focus{border-color:#e9e9e9;color:rgba(0,0,0,.65)}.load-img .cb-li{position:absolute;top:6px;left:7px}.load-img .ant-progress{position:absolute;left:0px;bottom:-5px}.export-excel-container .ant-modal{width:800px !important;margin:0 auto !important}.export-excel-container .ant-modal .ant-radio-group{display:flex;flex-wrap:wrap;justify-content:space-around}.export-excel-container .ant-modal .ant-radio-group label{width:96px !important}.export-excel-container .ant-modal .ant-transfer{display:flex;flex-direction:row;align-items:center;justify-content:space-around}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation{overflow:inherit;margin:0 18px}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation button .anticon{font-size:10px}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation button span{margin-left:0px !important;font-size:12px}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation button{width:50px;padding:0 5px}@media screen and (max-width: 625px){.export-excel-container .ant-modal .ant-transfer{flex-direction:column}.export-excel-container .ant-modal .ant-transfer .ant-transfer-list{height:150px !important}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation{overflow:inherit;margin:0 18px}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation button:first-child{margin-top:5px}.export-excel-container .ant-modal .ant-transfer .ant-transfer-operation button:last-child{margin-bottom:5px}}@media screen and (max-width: 625px){.export-excel-container .ant-modal{width:300px !important}}.export-excel-container .input-form-name{margin-bottom:10px}.export-excel-container .input-form-name input{width:200px}.order-export-excel-setting .droppable-content{display:flex;justify-content:space-between;border:1px solid #e0e0e0;border-bottom:0;padding:2px 12px;border-top-left-radius:2px;border-top-right-radius:2px}.order-export-excel-setting .order-setting-columns .droppable-grid .droppable-grid-box .column-card{padding:3px !important;margin-bottom:3px !important}"}()},92862:function(e){!function(){"use strict";e.exports=""}()},63868:function(e){!function(){"use strict";e.exports=".purchase-suggestion .ant-modal-content .ant-modal-header{padding:0px;border-bottom:none}.purchase-suggestion .ant-modal-content .ant-modal-header .ant-tabs-nav{margin-bottom:0 !important}.purchase-suggestion .ant-modal-content .ant-modal-body{padding:20px}"}()},7436:function(e,t,r){var a=r(41848),n=r(67206),o=r(40554),s=Math.max,c=Math.min;e.exports=function(e,t,r){var i=null==e?0:e.length;if(!i)return-1;var u=i-1;return void 0!==r&&(u=o(r),u=r<0?s(i+u,0):c(u,i-1)),a(e,n(t,3),u,!0)}},90798:function(e,t,r){"use strict";var a,n=r(71535),o=r(94055),s=r(74047),c=r(52700),i=r(4706),u=r(33814),p=r(44102),l=r(20775),d=r(26265),h=r(50361),m=r.n(h),f=r(67294),g=r(14494),y=r(87217),v=r(95213),_=f.createElement;function x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?x(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,l.Z)(e);if(t){var n=(0,l.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,p.Z)(this,r)}}var I=(0,y.Z)()(a=function(e){(0,u.Z)(r,e);var t=P(r);function r(e){var a;return(0,s.Z)(this,r),a=t.call(this,e),(0,d.Z)((0,i.Z)(a),"loopChildren",(function(e,t,r,n){var o=[];e.map((function(e){var r;t.push(e.value),!((null===(r=e.children)||void 0===r?void 0:r.length)>0)||e.children.map((function(e){o.push(e)}))})),o.length?a.loopChildren(o,t,r,n):a.onSelectMenuItem(r,t,n)})),(0,d.Z)((0,i.Z)(a),"onSelectMenuItem",(function(e,t,r){var n=a.props.isType,o=m()(a.props.tags),s=e.length-1,c=e[0];t.unshift(e[s]);var i={key:c,value:t},u=null!==o&&void 0!==o&&o.length?"order"==n?o.findIndex((function(e){return e.key==c})):o.findIndex((function(e){return e.key==c&&e.value==t})):-1;u>-1&&o.splice(u,1);var p={key:c,value:e[s]};if("promotion"!=n&&(p=S(S({},p),{},{info:r})),o.push(p),"order"==n)a.props.handleFilter(i),a.props.handleTags(o);else{var l=m()(a.props.keyTagFilter),d=[];e.map((function(e,t){t>0&&t<s&&d.push(e)})),l=l.filter((function(e){return!d.includes(e)})),t.map((function(e){-1==l.findIndex((function(t){return t==e}))&&l.push(e)})),a.props.handleTags(p,l)}})),(0,d.Z)((0,i.Z)(a),"onChangeCascaderCategory",(function(e,t){var r=a.props,n=r.isType,o=r.tagKey;if(e.length&&t.length){var s=t.length-1,c=m()(e);"inventory"==n?c.unshift("categoryId"):c.unshift(o||"category_id"),a.loopChildren(t[s].children,[],c,t[s]),"order"==n&&a.props.categoriesSelect(t[t.length-1]),a.setState({searchCategory:e})}else a.setState({searchCategory:[]});document.getElementsByClassName("category-options")[0].getElementsByClassName("ant-cascader-input")[0].focus()})),(0,d.Z)((0,i.Z)(a),"handleFocus",(function(){document.getElementsByClassName("category-options")[0].getElementsByClassName("ant-cascader-input")[0].focus()})),(0,d.Z)((0,i.Z)(a),"dropdownRenderCategory",(function(e){var t,r=e.props&&(null===(t=e.props.options)||void 0===t?void 0:t.filter((function(e){return e.__IS_FILTERED_OPTION})));if(null!==r&&void 0!==r&&r.length)return _("div",null,e)})),(0,d.Z)((0,i.Z)(a),"getCategoryOptions",(function(e){var t=[];return e.map((function(e){var r;t.push({label:e.text,value:e.id.toString(),key:e.id,children:(null===(r=e.nodes)||void 0===r?void 0:r.length)>0?a.getCategoryOptions(e.nodes):[]})})),t})),a.state={searchCategory:[]},a}return(0,c.Z)(r,[{key:"render",value:function(){var e=this,t=this.props,r=t.t,a=t.isType,s=t.categoryOptions,c=this.state.searchCategory,i="inventory"==a?s:"accessories"==a?this.getCategoryOptions(this.props.accessoriesCategories):this.getCategoryOptions(this.props.categories),u=function(e,t,r,a){var n=t.map((function(t,a){var n=t.label,o=(0,v.Mle)(e),s=(0,v.Mle)(n).indexOf(o)>-1?function(e,t,r){var a=(0,v.Mle)(e).indexOf(t);if(a>-1){var n=e.substr(0,a),o=e.substr(a,t.length),s=e.substr(a+t.length,e.length);return _("span",null,n,_("span",{className:"".concat(r,"-menu-item-keyword")},o),s)}return e}(n,o,r):n;return 0===a?s:[" / ",s]})),s=t.map((function(e){return e.label})).join(" / ");return _(o.default,{title:s},n)};return _("div",{onClick:function(e){return e.stopPropagation()}},_(n.Z,{className:"category-options",popupClassName:"category-popup",options:i,placeholder:r("pages.shop.product.management.searchCategory"),value:c,onChange:this.onChangeCascaderCategory,changeOnSelect:!0,showSearch:{filter:function(e,t){return t.some((function(t){return(0,v.Mle)(t.label).indexOf((0,v.Mle)(e))>-1}))},render:u,sort:function(){return 0}},autoFocus:!0,dropdownRender:this.dropdownRenderCategory,onClick:function(){return e.handleFocus()}}))}}]),r}(f.Component))||a;t.Z=(0,g.$j)((function(e){return{categories:e.product.categories}}),null)(I)},87378:function(e,t,r){"use strict";r.d(t,{Z:function(){return fe}});var a,n=r(2307),o=r(65400),s=r(59361),c=r(94055),i=r(31059),u=r(51024),p=r(28140),l=r(809),d=r.n(l),h=r(92447),m=r(74047),f=r(4706),g=r(52700),y=r(33814),v=r(44102),_=r(20775),x=r(26265),S=r(14321),P=r(50361),I=r.n(P),b=r(18446),E=r.n(b),Z=r(57557),C=r.n(Z),w=r(65988),O=r(67294),k=r(87217),D=r(14494),R=r(25592),T=r(30381),A=r.n(T),F=r(95213),N=r(36934),B=r(31731),q=r(31432),M=r(50916),j=r(4758),L=r(97705),U=r(74229),z=r(62443),H=r(9669),Y=r.n(H),V=r(7085),K=r(90631),W=r(48176),$=r(78598),Q=O.createElement;function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function J(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function X(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,_.Z)(e);if(t){var n=(0,_.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,v.Z)(this,r)}}var ee,te=(0,k.Z)()(a=function(e){(0,y.Z)(r,e);var t=X(r);function r(e){var a;return(0,m.Z)(this,r),a=t.call(this,e),(0,x.Z)((0,f.Z)(a),"handleFetchPurchase",(function(){var e=a.props,t=e.shopId,r=e.accessToken,n=e.type,o=e.total,s="product"==n?"".concat((0,F.LpH)(),"/shops/").concat(t,"/purchases/get_purchase_items?access_token=").concat(r):"".concat((0,F.LpH)(),"/shops/").concat(t,"/purchase_accessories/get_purchase_items?access_token=").concat(r),c=J(J({},a.props.params),{},{page:-1,page_size:o});a.setState({isLoading:!0}),Y()({method:"post",url:s,params:c}).then((function(e){e.data.success&&a.setState({purchase:e.data.data},(function(){return a.handleFetchData()})),a.setState({isLoading:!1})}))})),(0,x.Z)((0,f.Z)(a),"renderAccessoriesAttributes",(function(e){var t="";return e&&e.length>0&&(t=e.map((function(e){return"".concat(e.name,": ").concat(e.values.map((function(e){return"".concat(e)})).join("/ "))})).join(", ")),t})),(0,x.Z)((0,f.Z)(a),"handleFetchData",(function(){var e=a.props,t=(e.t,e.currentShop),r=e.type,n=e.timezone,o=e.supplier_products,s=a.state.purchase,c=[];"product"==r?s.map((function(e,t){var r,a;if(e.variation){var s,i,u=null===(r=e.variation.fields)||void 0===r?void 0:r.map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", ");if(e.supplier_id)s=((null===o||void 0===o||null===(i=o.data)||void 0===i?void 0:i.find((function(t){return t.id==e.supplier_id})))||{}).name;c.push({STT:t+1,PHIEU_NHAP:e.purchase_display_id,MA_SAN_PHAM:e.variation&&e.variation.product?e.variation.product.custom_id||e.variation.product.display_id:"",TEN_SAN_PHAM:null===(a=e.variation.product)||void 0===a?void 0:a.name,NHA_CUNG_CAP:s,THONG_TIN_SAN_PHAM:u,TEN_KHO:e.warehouse,TONG_SO_LUONG:(null===e||void 0===e?void 0:e.total_quantity)||0,TON_KHO:(null===e||void 0===e?void 0:e.remain)||0,GIA_NHAP:(null===e||void 0===e?void 0:e.imported_price)||0,NHAP_LUC:(0,F.o0x)(n||7,e.import_at,!0)})}})):s.map((function(e,r){c.push({STT:r+1,PHIEU_NHAP:e.purchase_accessories_id,TEN_NGUYEN_PHU_LIEU:e.name,THONG_TIN_NPL:a.renderAccessoriesAttributes(e.accessories_attributes),TEN_KHO:e.warehouse,TONG_SO_LUONG:(0,F.oH6)(e.total_quantity,t.currency),TON_KHO:(0,F.oH6)(e.remain,t.currency),GIA_NHAP:(0,F.ufS)(null===e||void 0===e?void 0:e.imported_price,t),NHAP_LUC:(0,F.o0x)(a.props.timezone||7,e.import_at,!0)})}));var i={SheetNames:[],Sheets:{}},u=XLSX.utils.json_to_sheet(c);c.length&&(u.cols=Object.keys(c[0]).map((function(e){var t=c[0][e.label],r=t?10*t.toString().length:100;return{wpx:r>100?r:100}})));XLSX.utils.book_append_sheet(i,u,"DataSheet 1");var p=XLSX.write(i,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,$.saveAs)(new Blob([(0,F.$iI)(p)],{type:""}),"export_purchase_by_variation.xlsx")})),(0,x.Z)((0,f.Z)(a),"popoverContent",(function(){var e=a.state.isLoading,t=a.props.t;return Q("div",null,Q(o.default,{style:{width:"100%",marginTop:10},type:"primary",icon:Q(e?V.Z:K.Z,null),onClick:a.handleFetchPurchase},t("components.customerExportExcel.download")))})),a.state={isLoading:!1,purchase:[]},a}return(0,g.Z)(r,[{key:"render",value:function(){var e=this.props.t;return Q("div",{style:{display:"inline"}},Q(z.default,{trigger:"click",placement:"bottom",title:e("components.exportVotesToExcel"),content:this.popoverContent()},Q(B.Z,{tooltip:e("components.exportVotesToExcel"),icon:Q(W.Z,null),isButton:!0,title:e("pages.shop.statistic.inventory.exportExcel")})))}}]),r}(O.Component))||a,re=(0,D.$j)((function(e){return J({},(0,q.zN)(e))}),{})(te),ae=r(99791),ne=r(48519),oe=r(41046),se=r(7690),ce=r(37508),ie=O.createElement;function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function pe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){(0,x.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,_.Z)(e);if(t){var n=(0,_.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,v.Z)(this,r)}}var de={page:1,page_size:30},he=S.default.RangePicker,me=(0,k.Z)()(ee=function(e){(0,y.Z)(r,e);var t=le(r);function r(e){var a;return(0,m.Z)(this,r),a=t.call(this,e),(0,x.Z)((0,f.Z)(a),"componentDidUpdate",(function(e){var t=a.props,r=t.tabKey,n=t.params;E()(e.params,n)||(a.setState({params:n}),e.params.type!=n.type&&a.setState({type:n.type})),e.tabKey!=r&&"purchase_items"==r&&a.setState({isFilter:!1})})),(0,x.Z)((0,f.Z)(a),"fetchPurchaseItems",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:pe({},de),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=a.props,o=n.accessToken,s=n.shopId;a.setState({params:e,isLoading:t}),"accessories"==r?a.props.fetchPurchaseAccessoriesByItem(o,s,e).then((function(){return a.setState({isLoading:!1})})):a.props.fetchPurchaseItems(o,s,e).then((function(){return a.setState({isLoading:!1})}))})),(0,x.Z)((0,f.Z)(a),"handleTableChange",(function(e){var t=a.state,r=t.params,n=t.type;r.page=e.current,a.fetchPurchaseItems(r,!0,n)})),(0,x.Z)((0,f.Z)(a),"renderAccessoriesAttributes",(function(e){var t;e.length>0&&(t=e.filter((function(e){return"undefined"!=e.value})).map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", "));return t})),(0,x.Z)((0,f.Z)(a),"columnsAccessories",[{title:a.props.t("components.productPurchaseDetail.productImportForm"),dataIndex:"purchaseAccessoriesDisplayId",width:"8%",ellipsis:!0},{title:a.props.t("components.productPurchaseDetail.accessories"),dataIndex:"accessories",ellipsis:!0},{title:a.props.t("containers.customerInfo.detailedInfo"),dataIndex:"accessorieFields",ellipsis:!0},{title:a.props.t("warehouse"),dataIndex:"warehouseName",width:"15%",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.totalQuantity"),dataIndex:"accessorieTotal",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.remain"),dataIndex:"accessorieRemain",align:"right",ellipsis:!0},{title:a.props.t("components.productPurchaseDetail.price"),dataIndex:"accessorieImportedPrice",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.importAt"),dataIndex:"accessorieImportAt",align:"right",ellipsis:!0},{title:a.props.t("status"),dataIndex:"accessorieStatus",width:"10%",align:"center"}]),(0,x.Z)((0,f.Z)(a),"columns",[{title:a.props.t("components.productPurchaseDetail.productImportForm"),dataIndex:"purchaseDisplayId",width:"8%",ellipsis:!0},{title:a.props.t("products.title"),dataIndex:"product",ellipsis:!0},{title:a.props.t("components.orderExportExcel.productId"),dataIndex:"productId",width:"10%",ellipsis:!0},{title:a.props.t("components.orderExportExcel.vId"),dataIndex:"variationId",width:"10%",ellipsis:!0},{title:a.props.t("containers.customerInfo.detailedInfo"),dataIndex:"fields",ellipsis:!0},{title:a.props.t("warehouse"),dataIndex:"warehouse",width:"15%",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.totalQuantity"),dataIndex:"total",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.remain"),dataIndex:"remain",align:"right",ellipsis:!0},{title:a.props.t("components.productPurchaseDetail.price"),dataIndex:"importedPrice",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.importAt"),dataIndex:"importAt",align:"right",ellipsis:!0},{title:a.props.t("status"),dataIndex:"purchaseStatus",width:"10%",align:"center"}]),(0,x.Z)((0,f.Z)(a),"getDisableButtonDeleteFilter",(function(){var e=a.state.params;return!!a.state.isLoading||!!E()(e,de)})),(0,x.Z)((0,f.Z)(a),"handleOnClickDeleteFilter",(function(){var e=a.state.type;a.setState({productName:"",dataFilter:[],isFilter:!1});var t=pe({},de);a.fetchPurchaseItems(t,!0,e)})),(0,x.Z)((0,f.Z)(a),"handleSearchSupplier",(function(e){var t;a.setState({supplierTextSearch:null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value})})),(0,x.Z)((0,f.Z)(a),"handleChangeFilterExclude",(function(e){var t=a.state,r=t.dataFilter,n=t.params,o=t.type,s=r.find((function(e){return"supplier_id"==e.key}));a.setState({filterExcludeSupplier:e},(function(){s&&a.fetchPurchaseItems(pe(pe({},n),{},{filter_exclude_supplier:e}),!0,o)}))})),(0,x.Z)((0,f.Z)(a),"renderOptionsCascader",(function(){var e,t=a.state,r=t.type,n=t.searchResult,o=t.searchResultProduct,s=t.params,c=s.endDate,l=s.startDate,d=t.filterExcludeSupplier,h=a.props,m=h.t,f=h.shopId,g=h.accessToken,y=h.warehouses,v=h.users,_=(h.currentShop,y.map((function(e){var t=e.name,r=e.full_address;return{value:e.id,label:"".concat(t," - ").concat(r||m("components.orderAdvanceFilter.noAddress"))}}))),S=v.map((function(e){var t=e.user,r=t.name,a=t.fb_id,n=t.avatar_url;return{value:e.user_id,label:ie("div",{style:{display:"flex",alignItems:"center"}},ie(M.Z,{avatar_url:n,id:a,size:[25,25],style:{marginRight:10}}),ie("span",null,r))}})),P=[{label:m("components.orderAdvanceFilter.warehouseId"),value:"warehouse_id",children:_},{label:m("components.productPurchaseDetail.handlingStaff"),value:"user_id",children:S},{label:"".concat(m("accessories"==r?"accessories":"components.orderAdvanceFilter.variation")),value:"".concat("accessories"==r?"accessoriesId":"productId"),children:[{disabled:!0,value:"product_accessories",label:ie("span",{onClick:function(e){return e.stopPropagation()}},"accessories"==r?ie(j.Z,{accessToken:g,shopId:f,searchResult:n,style:{width:200},callback:function(e){return a.setState({searchResult:e})},filterProduct:!0,onSelect:a.handleSelectVariation}):ie(L.Z,{className:"custom-search-bar",accessToken:g,shopId:f,searchResult:n,callback:function(e){return a.setState({searchResult:e})},onSelect:a.handleSelectVariation,is_filter:!0,combo_by:"variation",searchOnly:!0}))}].concat((0,p.Z)(a.renderResult("variation")))},{value:"time",label:m("pages.shop.product.purchase.time"),children:[{disabled:!0,value:"period",label:ie("span",{onClick:function(e){return e.stopPropagation()}},ie(he,{ranges:(e={},(0,x.Z)(e,m("pages.shop.product.inventoryHistory.yesterday"),[A()().add(-1,"days").startOf("day"),A()().add(-1,"days").endOf("day")]),(0,x.Z)(e,m("pages.shop.product.inventoryHistory.today"),[A()().startOf("day"),A()().endOf("day")]),(0,x.Z)(e,m("pages.shop.product.inventoryHistory.sevenDaysAgo"),[A()().add(-7,"days").startOf("day"),A()().endOf("day")]),(0,x.Z)(e,m("pages.shop.product.inventoryHistory.lastMonth"),[A()().add(-30,"days").startOf("day"),A()().endOf("day")]),(0,x.Z)(e,m("pages.shop.product.inventoryHistory.thisMonth"),[A()().startOf("month"),A()().endOf("month")]),e),format:"DD/MM/YYYY",value:c&&l?[A()(l,"X"),A()(c,"X")]:[],style:{width:400,marginRight:10},onChange:a.onChangeFilterDate}))}]}],b=I()(a.props.supplier_products);return a.state.supplierTextSearch&&(b=b.filter((function(e){return null!==(0,F.C6S)((0,F.Mle)(a.state.supplierTextSearch),(0,F.Mle)(e.name))}))),P.push({value:"supplier_id",label:m("pages.shop.product.purchase.supplierProduct"),children:[{value:"input_supplier",label:ie("div",{onClick:function(e){return e.stopPropagation()}},ie(u.default,{onChange:function(e){return a.handleSearchSupplier(e)},placeholder:m("components.orderAdvanceFilter.enterSupplier"),allowClear:!0,value:a.state.supplierText}))},{value:"filter_exclude_supplier",label:ie("span",{onClick:function(e){return e.stopPropagation()}},ie(i.default,{style:{width:"100%"},checked:d,onChange:function(e){return a.handleChangeFilterExclude(e.target.checked)}},m("components.orderAdvanceFilter.filterExclude"))),disabled:!0},{value:"have_supplier",label:m("pages.shop.product.purchase.haveSupplier")},{value:"no_supplier",label:m("pages.shop.product.purchase.noSupplier")},{value:null,label:ie("div",{style:{borderBottom:"1px dashed #aaa"}}),disabled:!0}].concat(b.map((function(e){return{value:e.id,label:e.name}})))}),"product"==r&&P.push({value:"product",label:m("products.title"),children:[{disabled:!0,value:"product_search",label:ie("span",{onClick:function(e){return e.stopPropagation()}},ie(L.Z,{className:"custom-search-bar",accessToken:g,shopId:f,searchResultProduct:o,callback:function(e){return a.setState({searchResultProduct:e})},onSelect:a.handleSelectProduct,filterProduct:!0,is_filter:!0,combo_by:"product",searchOnly:!0}))}].concat((0,p.Z)(a.renderResult("product")))}),(0,F.QIx)(P,"".concat(f,"_filter_purchase_by_variation_source_count"))})),(0,x.Z)((0,f.Z)(a),"renderResult",(function(e){var t=a.state.type,r=a.props,n=r.t,o=r.currentShop,s=r.warehouses;return("accessories"==t?[]:"variation"==e?a.state.searchResult:a.state.searchResultProduct).map((function(t,r){return{value:"variation-".concat(r),label:ie("div",{onClick:function(r){r.stopPropagation(),"variation"!=e?a.handleSelectProduct(t.id):a.handleSelectVariation(t.id)}},ie(ce.Z,{width:"variation"!=e?300:448,t:n,key:r,currentShop:o,combo_by:"variation"!=e?"product":"variation",item:t,warehouses:s}))}}))})),(0,x.Z)((0,f.Z)(a),"onClickMenuItem",(function(e){var t=a.state,r=t.type,n=t.filterExcludeSupplier,o=a.state,s=o.params,c=o.dataFilter,i=e[1],u=e[0];if("time"!=u||"period"!=i){var p=c.findIndex((function(e){return e.key==u}));if("supplier_id"==u)c.find((function(e){return e.value==i}))||(c.find((function(e){return["no_supplier","have_supplier"].includes(e.value)}))&&(c=c.filter((function(e){return!["no_supplier","have_supplier"].includes(e.value)}))),["no_supplier","have_supplier"].includes(i)&&(c=c.filter((function(e){return"supplier_id"!=e.key}))),c.push({key:u,value:i})),s[u]=c.filter((function(e){return e.key==u})).map((function(e){return e.value})),s=n?pe(pe({},s),{},{filter_exclude_supplier:n}):s;else-1!=p?c[p]={key:u,value:i}:c.push({key:u,value:i}),s[u]=i;(0,F.iAs)(u,"".concat(a.props.shopId,"_filter_purchase_by_variation_source_count")),a.setState({dataFilter:c,params:s}),a.fetchPurchaseItems(s,!0,r)}})),(0,x.Z)((0,f.Z)(a),"handleShowDataFilter",(function(e){var t=a.props,r=t.t,n=t.warehouses,o=t.users,s="",c="";switch(e.key){case"warehouse_id":s=r("components.orderAdvanceFilter.warehouseId"),c=(n.find((function(t){return t.id==e.value}))||{}).name;break;case"user_id":s=r("components.productPurchaseDetail.handlingStaff"),c=o.find((function(t){return t.user_id==e.value}))?o.find((function(t){return t.user_id==e.value})).user.name:"";break;case"variation_id":s=r("pages.shop.statistic.variation"),c=e.value;break;case"accessories_variation_id":s=r("accessories"),c=e.value;break;case"time":s=r("pages.shop.product.purchase.time");var i=(0,F.o0x)(a.props.timezone,e.value.startDate||"",!1,"DD/MM/YYYY"),u=(0,F.o0x)(a.props.timezone,e.value.endDate||"",!1,"DD/MM/YYYY");c="".concat(r("pages.shop.product.purchase.from")," ").concat(i," - ").concat(r("pages.shop.product.purchase.to")," ").concat(u);break;case"product_id":s=r("products.title"),c=e.value;break;case"supplier_id":var p;if(s=r("pages.shop.product.purchase.supplierProduct"),["no_supplier","have_supplier"].includes(e.value))c="no_supplier"==e.value?r("pages.shop.product.purchase.noSupplier"):r("pages.shop.product.purchase.haveSupplier");else c=(null===(p=a.props.supplier_products.find((function(t){return t.id==e.value})))||void 0===p?void 0:p.name)||""}return ie("span",null,s,": ",ie("strong",null,c))})),(0,x.Z)((0,f.Z)(a),"handleRowClick",(function(e,t){var r=a.props,n=r.fetchPurchaseByProduct,o=r.shopId,s=r.accessToken,c=r.fetchPurchaseAccessoriesByProduct;"product"==t?n(s,o,e).then((function(e){a.setState({modalDetailVisible:!0,selectedPurchase:e})})):c(s,o,e).then((function(e){a.setState({modalDetailVisible:!0,selectedPurchase:e})}))})),(0,x.Z)((0,f.Z)(a),"onChangeFilterDate",(function(e){var t=a.state,r=t.params,n=t.type,o=t.dataFilter,s=o.findIndex((function(e){return"time"==e.key}));if(e&&e.length>0){var c=e[0].startOf("day").unix(),i=e[1].endOf("day").unix(),u={key:"time",value:{startDate:e[0].startOf("day"),endDate:e[1].endOf("day")}};s>-1?o[s]=u:o.push(u),r.startDate=c,r.endDate=i,a.fetchPurchaseItems(r,!0,n)}else{s>-1&&o.splice(s,1);var p=r;p=(p=p.startDate?C()(p,"startDate"):p).endDate?C()(p,"endDate"):p,a.fetchPurchaseItems(p,!0,n)}(0,F.iAs)("time","".concat(a.props.shopId,"_filter_purchase_by_variation_source_count")),a.setState({dataFilter:o})})),(0,x.Z)((0,f.Z)(a),"handleSelectVariation",(function(e){var t=a.state,r=t.params,n=t.searchResult,o=t.type,s=n.findIndex((function(t){return t.id==e})),c="accessories"==a.state.type?"accessories_variation_id":"variation_id",i="accessories"==o?"".concat(n[s].accessories.name):"".concat(n[s].product.name," (").concat(n[s].custom_id||n[s].display_id,")");"accessories"==o?r.accessories_variation_id=e:r.variation_id=e,a.handleSelectItem(i,r,c)})),(0,x.Z)((0,f.Z)(a),"handleSelectItem",(function(e,t,r){var n=a.state,o=n.type,s=n.dataFilter,c=s.findIndex((function(e){return e.key==r}));-1!=c?s[c].value=e:s.push({key:r,value:e}),a.fetchPurchaseItems(t,!0,o),a.setState({productName:e,dataFilter:s,searchResult:[],searchResultProduct:[]})})),(0,x.Z)((0,f.Z)(a),"handleSelectProduct",(function(e){var t=a.state,r=t.params,n=t.searchResultProduct,o=(t.type,n.findIndex((function(t){return t.id==e}))),s="".concat(n[o].name," (").concat(n[o].custom_id||n[o].display_id,")");r.product_id=e,a.handleSelectItem(s,r,"product_id")})),(0,x.Z)((0,f.Z)(a),"handleClose",(function(e){var t=a.state,r=t.dataFilter,n=t.params,o=t.type,s=r[e].key;"supplier_id"==s?n[s]=n[s].filter((function(t){var a;return(null===(a=r[e])||void 0===a?void 0:a.value)!=t})):n=n[s]?C()(n,s):n,"time"==s&&(n=C()(n,"startDate"),n=C()(n,"endDate")),r.splice(e,1),a.setState({dataFilter:r,params:n},(function(){a.fetchPurchaseItems(n,!0,o)}))})),(0,x.Z)((0,f.Z)(a),"fetch",(function(e){var t=a.state.type;a.setState({params:e,isFilter:!0},(function(){return a.fetchPurchaseItems(e,!0,t)}))})),(0,x.Z)((0,f.Z)(a),"purchaseTableHeighStyle",(function(e){return e?ie(w.default,{id:"3340537037"},[".product-import-table .ant-table-body,.product-import-table .ant-table-body-inner{min-height:calc(100vh - 217px) !important;}"]):ie(w.default,{id:"833491456"},[".product-import-table .ant-table-body,.product-import-table .ant-table-body-inner{min-height:calc(100vh - 180px) !important;}"])})),a.state={isLoading:!1,params:pe({},e.params),type:e.params.type,dataFilter:[],searchResult:[],modalDetailVisible:!1,selectedPurchase:null,isFilter:!1,searchResultProduct:[],supplierTextSearch:"",filterExcludeSupplier:!1},a}return(0,g.Z)(r,null,[{key:"getInitialProps",value:function(){var e=(0,h.Z)(d().mark((function e(t,r){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.store.dispatch,t.query.shopId,t.isServer,e.abrupt("return",{});case 2:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}]),(0,g.Z)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props,r=t.params,a=t.router;a&&(0,F.VZI)(a),this.setState({type:r.type},(function(){return e.fetchPurchaseItems(r,!0,e.state.type)}))}},{key:"getData",value:function(){var e=this,t=this.props,r=t.purchase_items.data,a=t.currentShop,n=t.t,o=t.purchase_accessories_by_item,i=this.state.type,u=[];return"product"==i?r.map((function(t,r){var o,i,p,l;if(t.variation){var d=t.variation.fields.map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", "),h=(0,F.VCw)()[t.purchase_status];u.push({key:r,purchaseId:t.purchase_id,purchaseDisplayId:t.purchase_display_id,productId:t.variation&&t.variation.product?t.variation.product.custom_id||t.variation.product.display_id:"",product:ie(c.default,{placement:"topLeft",title:(null===(o=t.variation)||void 0===o||null===(i=o.product)||void 0===i?void 0:i.name)||n("components.productPurchaseDetail.productWasDelete")},ie("span",null,(null===(p=t.variation)||void 0===p||null===(l=p.product)||void 0===l?void 0:l.name)||n("components.productPurchaseDetail.productWasDelete"))),variationId:t.variation&&t.variation.custom_id?t.variation.custom_id:(0,F.pyT)(t.variation.display_id),warehouse:t.warehouse,total:(0,F.oH6)(t.total_quantity,a.currency),remain:(0,F.oH6)(t.remain,a.currency),importAt:(0,F.o0x)(e.props.timezone||7,t.import_at),importedPrice:(0,F.ufS)(t.imported_price,a.currency),fields:ie(c.default,{title:d,placement:"topLeft"},ie("span",null,d)),purchaseStatus:ie(s.default,{className:"purchase-tag",key:r,color:h.bgColor},h.text)})}})):o.data.map((function(t,r){var n=(0,F.VCw)()[t.purchase_accessories_status];u.push({key:r,purchaseAccessoriesId:t.purchase_accessories_id,accessorieFields:ie(c.default,{placement:"topLeft",title:e.renderAccessoriesAttributes(t.accessories_variation?t.accessories_variation.fields:[])},ie("span",null,e.renderAccessoriesAttributes(t.accessories_variation?t.accessories_variation.fields:[]))),purchaseAccessoriesDisplayId:t.purchase_accessories_display_id,accessories:t.accessories_variation?t.accessories_variation.accessories.name:"",warehouseName:t.warehouse,accessorieTotal:(0,F.oH6)(t.total_quantity,a.currency),accessorieRemain:(0,F.oH6)(t.remain,a.currency),accessorieImportedPrice:(0,F.ufS)(t.imported_price,a.currency),accessorieImportAt:(0,F.o0x)(e.props.timezone||7,t.import_at),accessorieStatus:ie(s.default,{className:"purchase-tag",key:r,color:n.bgColor},n.text)})})),u}},{key:"displayRender",value:function(e){return e[e.length-1]}},{key:"render",value:function(){var e=this,t=this.props,r=t.t,a=t.purchase_items,c=(t.currentShop,t.purchase_accessories_by_item),i=t.shopId,u=t.accessToken,p=t.supplier_products,l=t.tabKey,d=this.state,h=d.params,m=d.isLoading,f=d.type,g=d.dataFilter,y=d.modalDetailVisible,v=d.selectedPurchase,_=d.isFilter,x=this.props.currentShop?(0,ne.zE)(this.props.currentShop.role):{};if(!x.view_imported_price){var S=this.columnsAccessories.findIndex((function(e){return"accessorieImportedPrice"==e.dataIndex}));S>-1&&this.columnsAccessories.splice(S,1)}if(!x.view_imported_price){var P=this.columns.findIndex((function(e){return"importedPrice"==e.dataIndex}));P>-1&&this.columns.splice(P,1)}return ie("div",null,ie("div",{className:"tools-container"},ie(B.Z,{icon:ie(R.Z,null),disabled:m,isButton:!0,tooltip:r("pages.shop.product.inventoryHistory.sync"),onClick:function(){return e.fetchPurchaseItems(e.state.params,!0,f)},title:r("pages.shop.orderControlInfo.sync")}),ie(re,{fetchPurchaseItems:this.fetchPurchaseItems,currentShop:this.props.currentShop,params:this.state.params,shopId:this.props.shopId,accessToken:this.props.accessToken,timezone:this.props.timezone,type:this.state.type,total:"product"==f?a.total_entries:c.total_entries}),ie("div",{className:"filter",style:{display:"flex"}},ie(oe.Z,{params:h,shopId:i,accessToken:u,fetch:function(t){return e.fetch(t)},isFilter:_,type:"purchase"}),(null===g||void 0===g?void 0:g.length)>0&&ie(o.default,{danger:!0,disabled:this.getDisableButtonDeleteFilter(),onClick:this.handleOnClickDeleteFilter},r("pages.shop.product.management.deleteFilter")),"\xa0",ie(se.Z,{options:this.renderOptionsCascader(),popupClassName:"cascader-filter-purchase-by-variation",onChange:function(t){return e.onClickMenuItem(t)},id:"purchase-by-variation"})),(null===g||void 0===g?void 0:g.length)>0&&ie("div",{className:"tags-filter"},g.map((function(t,r){return ie(s.default,{key:t.key,onClose:function(){return e.handleClose(r)},closable:!0},e.handleShowDataFilter(t))})))),ie(n.Z,{className:"product-import-table ".concat(m?"blur-when-loading":""),size:"small",style:{marginTop:5},columns:"product"==f?this.columns:this.columnsAccessories,scroll:{x:1100,y:"calc(100vh - 230px)"},dataSource:this.getData(),pagination:{size:"small",pageSize:30,total:"product"==f?a.total_entries:c.total_entries,current:h.page},onChange:this.handleTableChange,onRow:function(t){return{onClick:function(r){return e.handleRowClick("product"==f?t.purchaseId:t.purchaseAccessoriesId,f)}}}}),y&&ie(ae.Z,{visible:y,close:function(){return e.setState({modalDetailVisible:!1})},purchase:v||[],accessToken:u,shopId:i,supplier_products:p&&p.length>0?this.props.supplier_products:[],isServer:this.props.isServer,showHistories:"product"==f,isAccessories:"accessories"==f}),this.state.isLoading&&ie(U.Z,null),["purchase_items","purchase_accessories_items"].includes(l)&&this.purchaseTableHeighStyle(g&&g.length>0))}}]),r}(O.Component))||ee,fe=(0,D.$j)((function(e){return pe(pe({},(0,q.vw)(e)),(0,q.WI)(e))}),{fetchPurchaseItems:N.JQJ,fetchPurchaseAccessoriesByItem:N.i1k,fetchPurchaseByProduct:N.XOc,fetchPurchaseAccessoriesByProduct:N.JTY})(me)},3122:function(e,t,r){"use strict";r.d(t,{Z:function(){return ir}});var a,n=r(2307),o=r(65400),s=r(10149),c=r(28140),i=r(51024),u=r(31059),p=r(74048),l=r(59361),d=r(94055),h=r(74047),m=r(52700),f=r(4706),g=r(33814),y=r(44102),v=r(20775),_=r(26265),x=r(56697),S=r(14321),P=r(64749),I=r(64713),b=r(50361),E=r.n(b),Z=r(18446),C=r.n(Z),w=r(7436),O=r.n(w),k=r(23279),D=r.n(k),R=r(57557),T=r.n(R),A=r(65988),F=r(67294),N=r(7085),B=r(90631),q=r(84189),M=r(7945),j=r(50161),L=r(95642),U=r(43926),z=r(24616),H=r(49101),Y=r(25592),V=r(30381),K=r.n(V),W=r(9669),$=r.n(W),Q=r(74806),G=r(28465),J=r(4863),X=r(809),ee=r.n(X),te=r(92447),re=r(44908),ae=r.n(re),ne=r(79508),oe=r(48176),se=r(14494),ce=r(7145),ie=r.n(ce),ue=r(36934),pe=r(31731),le=r(95213),de=r(22318),he=r(87217),me=r(78598),fe=r(31432),ge=F.createElement;function ye(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(r),!0).forEach((function(t){(0,_.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ye(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _e(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.Z)(this,r)}}var xe,Se=(0,he.Z)()(a=function(e){(0,g.Z)(r,e);var t=_e(r);function r(e){var a;return(0,h.Z)(this,r),a=t.call(this,e),(0,_.Z)((0,f.Z)(a),"handleCloseModal",(function(){a.setState({isShowResult:!1,modalVisible:!1,fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[],dataError:[],stop:!1,errorCount:0,successCount:0})})),(0,_.Z)((0,f.Z)(a),"onDrop",(function(e){var t=e.file,r=a.props.t,n=new FileReader;n.readAsBinaryString(t),n.onload=function(e){var n=e.target.result,o=XLSX.read(n,{type:"binary"}),s=o.SheetNames[0],c=XLSX.utils.sheet_to_json(o.Sheets[s],{raw:!0});if(0!=c.length){var i=(0,le.wOl)(o.Sheets[s]),u=a.checkFields(i);if(0!=u.length)de.Z.error(r("error"),"".concat(r("components.orderImportExcel.fieldsNotFound"),": ").concat(u.join())),a.setState({productPurchaseFile:[],fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[]});else{var p=[];c.length>0&&c.map((function(e,t){var r=Object.keys(e),a=Object.values(e);r.map((function(e,r){p[t]||(p[t]={}),p[t]=ve(ve({},p[t]),{},(0,_.Z)({},e.toString().trim(),a[r]))}))}));var l=ae()(p.filter((function(e){return!e[r("components.productPurchaseImportExcel.warehouseId")]&&e[r("warehouse")]})).map((function(e){var t,n=null===(t=a.props.warehouses.find((function(t){return(0,le.Mle)(t.name)==(0,le.Mle)(e[r("warehouse")])})))||void 0===t?void 0:t.id;if(!n)return e[r("warehouse")];e[r("components.productPurchaseImportExcel.warehouseId")]=n})).filter((function(e){return e}))).join(", ");if(l)return de.Z.error(r("error"),"Kh\xf4ng t\xecm th\u1ea5y kho ".concat(l)),void a.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]});var d=[],h=0;p.map((function(e,t){if(e[r("components.productPurchaseImportExcel.index")]=t+1,e.line_number=t+2,e[r("components.productPurchaseImportExcel.warehouseId")]||e[r("components.productPurchaseImportExcel.supplier")])h=t,d.push(e);else{var a=E()(e);a[r("components.productPurchaseImportExcel.warehouseId")]=p[h][r("components.productPurchaseImportExcel.warehouseId")],a[r("components.productPurchaseImportExcel.supplier")]=p[h][r("components.productPurchaseImportExcel.supplier")],d.push(a)}})),d=a.handleMergeWarehouse(d),console.log(d,"customRoa"),d=d.filter((function(e){return e[r("components.productPurchaseImportExcel.warehouseId")]&&e[r("components.productPurchaseImportExcel.warehouseId")].toString().trim()||e[r("components.productPurchaseImportExcel.quantity")]||e[r("components.productPurchaseImportExcel.productId")]||e[r("components.productPurchaseImportExcel.variationId")]})),a.setState({productPurchaseFile:d.length?d:p,fileName:t.name,importedCount:0,disableImportBtn:!1,isImporting:!1,errorCount:0,successCount:0})}}else de.Z.error(r("error"),r("components.productImportExcel.index.fileExcelEmpty")),a.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]})}})),(0,_.Z)((0,f.Z)(a),"handleMergeWarehouse",(function(e){var t=a.props,r=t.t,n=(t.currentShop,[]);return e.map(function(){var t=(0,te.Z)(ee().mark((function t(a){var o;return ee().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n.findIndex((function(e){return e[r("components.productPurchaseImportExcel.warehouseId")]==a[r("components.productPurchaseImportExcel.warehouseId")]&&(e[r("components.productPurchaseImportExcel.supplier")]||null)==a[r("components.productPurchaseImportExcel.supplier")]}))<0)){t.next=5;break}return o=e.filter((function(e){return e[r("components.productPurchaseImportExcel.warehouseId")]==a[r("components.productPurchaseImportExcel.warehouseId")]&&(e[r("components.productPurchaseImportExcel.supplier")]||null)==a[r("components.productPurchaseImportExcel.supplier")]})),t.next=5,o.map((function(e,t){if(0==t){if(e[r("components.productPurchaseImportExcel.index")]=t+1,!e[r("components.productPurchaseImportExcel.supplier")]||!e[r("components.productPurchaseImportExcel.status")]||!e[r("components.productPurchaseImportExcel.note")]){var a=o.find((function(e){return e[r("components.productPurchaseImportExcel.supplier")]}));e[r("components.productPurchaseImportExcel.supplier")]=a&&a[r("components.productPurchaseImportExcel.supplier")]?a[r("components.productPurchaseImportExcel.supplier")]:"",a=o.find((function(e){return e[r("components.productPurchaseImportExcel.status")]})),e[r("components.productPurchaseImportExcel.status")]=a&&a[r("components.productPurchaseImportExcel.status")]?a[r("components.productPurchaseImportExcel.status")]:"",a=o.find((function(e){return e[r("components.productPurchaseImportExcel.note")]})),e[r("components.productPurchaseImportExcel.note")]=a&&a[r("components.productPurchaseImportExcel.note")]?a[r("components.productPurchaseImportExcel.note")]:""}n.push(e)}else e[r("components.productPurchaseImportExcel.warehouseId")]=void 0,e[r("components.productPurchaseImportExcel.index")]="",n.push(e)}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),n})),(0,_.Z)((0,f.Z)(a),"checkFields",(function(e){return function(e){return[e("components.productPurchaseImportExcel.warehouseId")]}(a.props.t).reduce((function(t,r){return-1==e.findIndex((function(e){return e==r}))&&t.push(r),t}),[])})),(0,_.Z)((0,f.Z)(a),"confirmImport",(function(){a.setState({isShowResult:!0,importedCount:0,disableImportBtn:!0,isImporting:!0},(function(){"accessories"==a.props.type?a.sendRequestPurchaseAccessories(0):a.sendRequest(0)}))})),(0,_.Z)((0,f.Z)(a),"sendRequestPurchaseAccessories",function(){var e=(0,te.Z)(ee().mark((function e(t){var r,n,o,s,c,i,u,p,l,d,h,m,f,g,y,v,_,x,S,P,I,b,E,Z,C,w,O;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props,n=r.shopId,o=r.accessToken,s=r.t,c=a.state,i=c.productPurchaseFile,u=c.importedCount,p=c.isImporting,l=c.dataError,d=c.isCreateTransaction,h=c.errorCount,m=c.successCount,!(t>i.length-1)){e.next=5;break}return a.setState({stop:!0}),e.abrupt("return");case 5:if(f=i[t],g={line_number:f.line_number||t+2,index:f[s("components.productPurchaseImportExcel.index")],warehouse_id:f[s("components.productPurchaseImportExcel.warehouseId")],inserted_at:f[s("components.productPurchaseImportExcel.insertedAt")],items:[{line_number:f.line_number||t+2,imported_price:a.parseNumberFromExcel(f[s("components.productPurchaseImportExcel.importedPrice")]),retail_price:f[s("components.productPurchaseImportExcel.retailPrice")],quantity:f[s("components.productPurchaseImportExcel.quantity")],accessories_id:f[s("components.productPurchaseImportExcel.accessoriesId")],custom_id:f[s("components.productPurchaseImportExcel.customId")],note_item:f[s("components.accessoriesCreator.noteAccessory")]||null}],note:f[s("components.productPurchaseImportExcel.note")],supplier_products_name:f[s("components.productPurchaseImportExcel.supplier")],status:f[s("components.productPurchaseImportExcel.status")]},f[s("components.productPurchaseImportExcel.warehouseId")]){e.next=10;break}return l.push(g),e.abrupt("return",a.sendRequestPurchaseAccessories(t+1));case 10:if(y=a.validateFields(t,f),!y){e.next=24;break}return e.next=15,a.getProductNextLineAccessories([],t+1,1,[]);case 15:return v=e.sent,_=v.items,x=v.count,S=v.itemErrors,a.setState(ie()(a.state,{resultArr:{$push:[{message:y,success:!1}]},importedCount:{$set:u+1},errorCount:{$set:a.state.errorCount+1}})),P=_.concat(S),g=ve(ve({},g),{},{items:g.items.concat(P)}),l.push(g),e.abrupt("return",a.sendRequestPurchaseAccessories(t+x));case 24:return I={line_number:f.line_number||t+2,imported_price:0==f[s("components.productPurchaseImportExcel.importedPrice")]?0:a.parseNumberFromExcel(f[s("components.productPurchaseImportExcel.importedPrice")]||null),retail_price:0==f[s("components.productPurchaseImportExcel.retailPrice")]?0:f[s("components.productPurchaseImportExcel.retailPrice")]||null,quantity:f[s("components.productPurchaseImportExcel.quantity")]&&f[s("components.productPurchaseImportExcel.quantity")].toString()||"0",accessories_id:f[s("components.productPurchaseImportExcel.accessoriesId")]?f[s("components.productPurchaseImportExcel.accessoriesId")].toString():"",custom_id:f[s("components.productPurchaseImportExcel.customId")]?f[s("components.productPurchaseImportExcel.customId")]:"",note_item:f[s("components.accessoriesCreator.noteAccessory")]||null},e.next=27,a.getProductNextLineAccessories([I],t+1,1,[]);case 27:if(b=e.sent,E=b.items,Z=b.count,C=b.itemErrors,w={line_number:f.line_number||t+2,index:f[s("components.productPurchaseImportExcel.index")],items:E,warehouse_id:f[s("components.productPurchaseImportExcel.warehouseId")].toString().trim(),inserted_at:f[s("components.productPurchaseImportExcel.insertedAt")]?(0,le._MS)(f[s("components.productPurchaseImportExcel.insertedAt")]):null,shop_id:n,note:f[s("components.productPurchaseImportExcel.note")]||"",supplier_products_name:(f[s("components.productPurchaseImportExcel.supplier")]||"").toString().trim(),status:a.getStatus(f[s("components.productPurchaseImportExcel.status")]),is_create_transaction:d,auto_create_debts:!0},!(E.length<Z)){e.next=37;break}return a.setState({importedCount:u+1,errorCount:a.state.errorCount+1}),w=ve(ve({},w),{},{items:w.items.concat(C)}),l.push(w),e.abrupt("return",a.sendRequestPurchaseAccessories(t+Z));case 37:a.state.modalVisible&&p&&(O="".concat((0,le.LpH)(),"/shops/").concat(n,"/purchase_accessories/import?access_token=").concat(o),$().post(O,{purchase_accessories:w}).then((function(e){var r=e.data;if(r.success){var n=r.data.message;n?(l.push(w),a.setState(ie()(a.state,{resultArr:{$push:[{message:n,success:!1}]},errorCount:{$set:h+1}}))):(a.setState(ie()(a.state,{resultArr:{$push:[{message:null,success:!0}]},successCount:{$set:m+1}})),a.props.createPurchaseAccessoriesSuccess(e.data.data))}else l.push(w),a.setState(ie()(a.state,{resultArr:{$push:[{message:r.message,success:!1}]},errorCount:{$set:h+1}}));return a.setState({importedCount:u+1}),a.sendRequestPurchaseAccessories(t+Z)})).catch((function(e){var r,n,o=(null===e||void 0===e||null===(r=e.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||s("action.unknownError");l.push(w),a.setState(ie()(a.state,{resultArr:{$push:[{message:o,success:!1}]},importedCount:{$set:u+1},errorCount:{$set:h+1}})),a.sendRequestPurchaseAccessories(t+Z)})));case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,_.Z)((0,f.Z)(a),"getProductNextLineAccessories",(function(e,t,r,n){var o=a.state.productPurchaseFile,s=a.props.t,c=o[t],i=!(!c||!c[s("components.productPurchaseImportExcel.warehouseId")])&&c[s("components.productPurchaseImportExcel.warehouseId")].toString().trim();if(t>o.length-1||i)return{items:e,count:r,itemErrors:n};var u={line_number:c.line_number||t+2,imported_price:0==c[s("components.productPurchaseImportExcel.importedPrice")]?0:a.parseNumberFromExcel(c[s("components.productPurchaseImportExcel.importedPrice")]||null),retail_price:0==c[s("components.productPurchaseImportExcel.retailPrice")]?0:c[s("components.productPurchaseImportExcel.retailPrice")]||null,quantity:c[s("components.productPurchaseImportExcel.quantity")]&&c[s("components.productPurchaseImportExcel.quantity")].toString()||"0",accessories_id:c[s("components.productPurchaseImportExcel.accessoriesId")]?c[s("components.productPurchaseImportExcel.accessoriesId")].toString():"",custom_id:c[s("components.productPurchaseImportExcel.customId")]?c[s("components.productPurchaseImportExcel.customId")]:"",note_item:c[s("components.accessoriesCreator.noteAccessory")]||null},p=a.validateFields(t,c);return p?(a.setState(ie()(a.state,{resultArr:{$push:[{message:p,success:!1}]}})),a.getProductNextLineAccessories(e,t+1,r+1,n.concat(u))):a.getProductNextLineAccessories(e.concat(u),t+1,r+1,n)})),(0,_.Z)((0,f.Z)(a),"getAutoCreateDebt",(function(e){if(!e)return!1;var t=(0,le.Mle)(e.toString().toLowerCase());return!!["co","c","yes","x","ok"].includes(t)})),(0,_.Z)((0,f.Z)(a),"getStatus",(function(e){if(!e)return"-1";var t=(0,le.Mle)(e.toLowerCase());return a.defaultStatus(t)||"-1"})),(0,_.Z)((0,f.Z)(a),"defaultStatus",(function(e){var t,r=a.props.t;return(t={},(0,_.Z)(t,r("components.productImportExcel.index.new"),"-1"),(0,_.Z)(t,r("components.productImportExcel.index.confirmed"),"0"),(0,_.Z)(t,r("components.productImportExcel.index.success"),"1"),(0,_.Z)(t,r("components.productImportExcel.index.canceled"),"2"),(0,_.Z)(t,r("components.productImportExcel.index.delete"),"7"),t)[e]})),(0,_.Z)((0,f.Z)(a),"parseNumberFromExcel",(function(e){if(!e)return e;var t=a.props.currentShop.currency;return le.cvg.includes(t)?Math.round(e):e})),(0,_.Z)((0,f.Z)(a),"sendRequest",function(){var e=(0,te.Z)(ee().mark((function e(t){var r,n,o,s,c,i,u,p,l,d,h,m,f,g,y,v,_,x,S,P,I,b,E,Z,C,w,O,k,D;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.props,n=r.shopId,o=r.accessToken,s=r.t,c=r.createPurchaseSuccess,i=r.currentShop,u=a.state,p=u.productPurchaseFile,l=u.importedCount,d=u.isImporting,h=u.dataError,m=u.isCreateTransaction,f=u.errorCount,g=u.successCount,!(t>p.length-1)){e.next=5;break}return a.setState({stop:!0}),e.abrupt("return");case 5:if(y=p[t],v={line_number:y.line_number||t+2,index:y[s("components.productPurchaseImportExcel.index")],warehouse_id:y[s("components.productPurchaseImportExcel.warehouseId")],items:[{line_number:y.line_number||t+2,imported_price:a.parseNumberFromExcel(y[s("components.productPurchaseImportExcel.importedPrice")]),retail_price:y[s("components.productPurchaseImportExcel.retailPrice")],quantity:y[s("components.productPurchaseImportExcel.quantity")],product_id:y[s("components.productPurchaseImportExcel.productId")],variation_id:y[s("components.productPurchaseImportExcel.variationId")],product_name:y[s("components.productPurchaseImportExcel.productName")],categories:y[s("components.productPurchaseImportExcel.categories")],attributes:y[s("components.productPurchaseImportExcel.attributes")],retail_price_by_currency:y[s("components.productPurchaseImportExcel.retailPriceByCurrency")],weight:y[s("components.productPurchaseImportExcel.weight")],note_purchase:y[s("components.productPurchaseImportExcel.notePurchaseItem")]}],auto_create_debts:y[s("components.productPurchaseImportExcel.autoCreateDebts")],note:y[s("components.productPurchaseImportExcel.note")],supplier_products_name:y[s("components.productPurchaseImportExcel.supplier")],received_at:y[s("pages.shop.product.purchase.receivedAt")],inserted_at:y[s("pages.shop.product.purchase.importAt")],status:y[s("components.productPurchaseImportExcel.status")],transport_fee:y[s("pages.shop.product.purchase.transportFee")]},y[s("components.productPurchaseImportExcel.warehouseId")]){e.next=10;break}return h.push(v),e.abrupt("return",a.sendRequest(t+1));case 10:if(_=a.validateFields(t,y),!_){e.next=24;break}return e.next=15,a.getProductNextLine([],t+1,1,[]);case 15:return x=e.sent,S=x.items,P=x.count,I=x.itemErrors,a.setState(ie()(a.state,{resultArr:{$push:[{message:_,success:!1}]},importedCount:{$set:l+1},errorCount:{$set:a.state.errorCount+1}})),b=S.concat(I),v=ve(ve({},v),{},{items:v.items.concat(b)}),h.push(v),e.abrupt("return",a.sendRequest(t+P));case 24:return E={line_number:y.line_number||t+2,imported_price:0==y[s("components.productPurchaseImportExcel.importedPrice")]?0:a.parseNumberFromExcel(y[s("components.productPurchaseImportExcel.importedPrice")]||null),retail_price:0==y[s("components.productPurchaseImportExcel.retailPrice")]?0:y[s("components.productPurchaseImportExcel.retailPrice")]||null,quantity:y[s("components.productPurchaseImportExcel.quantity")]&&y[s("components.productPurchaseImportExcel.quantity")].toString()||"0",product_id:y[s("components.productPurchaseImportExcel.productId")]?y[s("components.productPurchaseImportExcel.productId")].toString():"",variation_id:y[s("components.productPurchaseImportExcel.variationId")]?y[s("components.productPurchaseImportExcel.variationId")].toString():"1",product_name:y[s("components.productPurchaseImportExcel.productName")],status:a.getStatus(y[s("components.productPurchaseImportExcel.status")]),categories:a.getCategories(y[s("components.productPurchaseImportExcel.categories")]),attributes:y[s("components.productPurchaseImportExcel.attributes")],retail_price_by_currency:(0,le.$CN)(y[s("components.productPurchaseImportExcel.retailPriceByCurrency")],i),weight:y[s("components.productPurchaseImportExcel.weight")],note_purchase:y[s("components.productPurchaseImportExcel.notePurchaseItem")]},e.next=27,a.getProductNextLine([E],t+1,1,[]);case 27:if(Z=e.sent,C=Z.items,w=Z.count,O=Z.itemErrors,k={line_number:y.line_number||t+2,index:y[s("components.productPurchaseImportExcel.index")],items:C,warehouse_id:y[s("components.productPurchaseImportExcel.warehouseId")].toString().trim(),shop_id:n,note:y[s("components.productPurchaseImportExcel.note")]||"",supplier_products_name:(y[s("components.productPurchaseImportExcel.supplier")]||"").toString().trim(),auto_create_debts:a.getAutoCreateDebt(y[s("components.productPurchaseImportExcel.autoCreateDebts")]),received_at:(0,le._MS)(y[s("pages.shop.product.purchase.receivedAt")]),inserted_at:(0,le._MS)(y[s("pages.shop.product.purchase.importAt")]),status:a.getStatus(y[s("components.productPurchaseImportExcel.status")]),transport_fee:y[s("pages.shop.product.purchase.transportFee")],is_create_transaction:m},!(C.length<w)){e.next=37;break}return a.setState({importedCount:l+1,errorCount:a.state.errorCount+1}),k=ve(ve({},k),{},{items:k.items.concat(O)}),h.push(k),e.abrupt("return",a.sendRequest(t+w));case 37:a.state.modalVisible&&d&&(D="".concat((0,le.LpH)(),"/shops/").concat(n,"/purchases/import?access_token=").concat(o),$().post(D,{purchase:k}).then((function(e){var r=e.data;if(r.success){var n=r.data.message;n?(h.push(k),a.setState(ie()(a.state,{resultArr:{$push:[{message:n,success:!1}]},errorCount:{$set:f+1}}))):(a.setState(ie()(a.state,{resultArr:{$push:[{message:null,success:!0}]},successCount:{$set:g+1}})),c(e.data.data))}else h.push(k),a.setState(ie()(a.state,{resultArr:{$push:[{message:r.message,success:!1}]},errorCount:{$set:f+1}}));return a.setState({importedCount:l+1}),a.sendRequest(t+w)})).catch((function(e){var r,n,o=(null===e||void 0===e||null===(r=e.response)||void 0===r||null===(n=r.data)||void 0===n?void 0:n.message)||s("action.unknownError");h.push(k),a.setState(ie()(a.state,{resultArr:{$push:[{message:o,success:!1}]},importedCount:{$set:l+1},errorCount:{$set:f+1}})),a.sendRequest(t+w)})));case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,_.Z)((0,f.Z)(a),"getCategories",(function(e){return e?e.toString().split(";").map((function(e){return e.toString().trim().split(">>")})):[]})),(0,_.Z)((0,f.Z)(a),"getProductNextLine",(function(e,t,r,n){var o=a.state.productPurchaseFile,s=a.props.t,c=o[t],i=!(!c||!c[s("components.productPurchaseImportExcel.warehouseId")])&&c[s("components.productPurchaseImportExcel.warehouseId")].toString().trim();if(t>o.length-1||i)return{items:e,count:r,itemErrors:n};var u={line_number:c.line_number||t+2,imported_price:0==c[s("components.productPurchaseImportExcel.importedPrice")]?0:a.parseNumberFromExcel(c[s("components.productPurchaseImportExcel.importedPrice")]||null),retail_price:0==c[s("components.productPurchaseImportExcel.retailPrice")]?0:c[s("components.productPurchaseImportExcel.retailPrice")]||null,quantity:c[s("components.productPurchaseImportExcel.quantity")]&&c[s("components.productPurchaseImportExcel.quantity")].toString()||"0",product_id:c[s("components.productPurchaseImportExcel.productId")]?c[s("components.productPurchaseImportExcel.productId")].toString():"",variation_id:c[s("components.productPurchaseImportExcel.variationId")]?c[s("components.productPurchaseImportExcel.variationId")].toString():"1",product_name:c[s("components.productPurchaseImportExcel.productName")],categories:a.getCategories(c[s("components.productPurchaseImportExcel.categories")]),attributes:c[s("components.productPurchaseImportExcel.attributes")],retail_price_by_currency:(0,le.$CN)(c[s("components.productPurchaseImportExcel.retailPriceByCurrency")],a.props.currentShop),weight:c[s("components.productPurchaseImportExcel.weight")],product_supplier:c[s("components.productPurchaseImportExcel.productSupplier")],note_purchase:c[s("components.productPurchaseImportExcel.notePurchaseItem")]},p=a.validateFields(t,c);return p?(a.setState(ie()(a.state,{resultArr:{$push:[{message:p,success:!1}]}})),a.getProductNextLine(e,t+1,r+1,n.concat(u))):a.getProductNextLine(e.concat(u),t+1,r+1,n)})),(0,_.Z)((0,f.Z)(a),"validateFields",(function(e,t){var r=a.props,n=r.t,o=r.currentShop.currency,s=le.cvg.includes(o),c="".concat(n("components.productImportExcel.index.errorNumber")," ").concat(e+2,": ");t[n("components.productPurchaseImportExcel.quantity")]&&(!Number.isInteger((0,le.WNN)(t[n("components.productPurchaseImportExcel.quantity")]))||t[n("components.productPurchaseImportExcel.quantity")]<0)&&(c+=n("components.productImportExcel.index.quantityValue"));var i=a.parseNumberFromExcel(t[n("components.productPurchaseImportExcel.importedPrice")]);return i&&(!Number.isInteger((0,le.WNN)(i))&&s||i<0)&&(c+=n("components.productImportExcel.index.inputPrice")),t[n("components.productPurchaseImportExcel.retailPrice")]&&(!Number.isInteger((0,le.WNN)(t[n("components.productPurchaseImportExcel.retailPrice")]))&&s||t[n("components.productPurchaseImportExcel.retailPrice")]<0)&&(c+=n("components.productImportExcel.index.retailPrice")),c!="".concat(n("components.productImportExcel.index.errorNumber")," ").concat(e+2,": ")&&c})),(0,_.Z)((0,f.Z)(a),"renderError",(function(){return a.state.resultArr.map((function(e,t){var r=t+1;return e.success?void 0:ge("div",{key:t,style:{width:"100%",color:"red"}},ge("span",null," ",ge("strong",null,"#".concat(r))," "),"\xa0",ge("span",{className:"text-danger"}," ",e.message," "))}))})),(0,_.Z)((0,f.Z)(a),"renderSuccess",(function(){var e=a.state.resultArr,t=a.props.t;return e.map((function(e,r){var a=r+1;return e.success?ge("div",{key:r,style:{width:"100%",color:"green"}},ge("span",null," ",ge("strong",null,"#".concat(a))," "),"\xa0",ge("span",{className:"text-success"},t("success"))):void 0}))})),(0,_.Z)((0,f.Z)(a),"downloadListError",(function(){var e=a.state.dataError,t=a.props,r=t.t,n=t.type,o=[];e.map((function(e){e.items.map((function(t,a){var s,c,i,u;"accessories"==n?0==a?o.push((s={},(0,_.Z)(s,r("components.productPurchaseImportExcel.index"),e.index||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.warehouseId"),e.warehouse_id||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.note"),e.note||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.accessoriesId"),t.accessories_id||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.customId"),t.custom_id||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.retailPrice"),t.retail_price||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.importedPrice"),t.imported_price||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.quantity"),t.quantity||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.supplier"),e.supplier_products_name||""),(0,_.Z)(s,r("components.productPurchaseImportExcel.status"),e.status||""),(0,_.Z)(s,r("components.accessoriesCreator.noteAccessory"),t.note||""),s)):o.push((c={},(0,_.Z)(c,r("components.productPurchaseImportExcel.accessoriesId"),t.accessories_id||""),(0,_.Z)(c,r("components.productPurchaseImportExcel.customId"),t.custom_id||""),(0,_.Z)(c,r("components.productPurchaseImportExcel.retailPrice"),t.retail_price||""),(0,_.Z)(c,r("components.productPurchaseImportExcel.importedPrice"),t.imported_price||""),(0,_.Z)(c,r("components.productPurchaseImportExcel.quantity"),t.quantity||""),(0,_.Z)(c,r("components.accessoriesCreator.noteAccessory"),t.note||""),c)):0==a?o.push((i={},(0,_.Z)(i,r("components.productPurchaseImportExcel.index"),e.index||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.warehouseId"),e.warehouse_id||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.note"),e.note||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.productName"),t.product_name||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.productId"),t.product_id||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.variationId"),t.variation_id||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.retailPrice"),t.retail_price||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.importedPrice"),t.imported_price||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.quantity"),t.quantity||""),(0,_.Z)(i,r("components.productPurchaseImportExcel.supplier"),e.supplier_products_name||""),(0,_.Z)(i,r("pages.shop.product.purchase.receivedAt"),e.received_at||""),i)):o.push((u={},(0,_.Z)(u,r("components.productPurchaseImportExcel.productName"),t.product_name||""),(0,_.Z)(u,r("components.productPurchaseImportExcel.productId"),t.product_id||""),(0,_.Z)(u,r("components.productPurchaseImportExcel.variationId"),t.variation_id||""),(0,_.Z)(u,r("components.productPurchaseImportExcel.retailPrice"),t.retail_price||""),(0,_.Z)(u,r("components.productPurchaseImportExcel.importedPrice"),t.imported_price||""),(0,_.Z)(u,r("components.productPurchaseImportExcel.quantity"),t.quantity||""),u))}))}));var s={SheetNames:[],Sheets:{}},c=XLSX.utils.json_to_sheet(o);o.length&&(c["!cols"]=Object.keys(o[0]).map((function(e){var t=e?10*e.toString().length:150;return{wpx:t>120?t:120}})));XLSX.utils.book_append_sheet(s,c,"DataSheet 1");var i=XLSX.write(s,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,me.saveAs)(new Blob([(0,le.$iI)(i)],{type:"application/octet-stream"}),"error_file.xlsx")})),(0,_.Z)((0,f.Z)(a),"renderListFileError",(function(){var e=a.props.t;return ge("div",{style:{marginTop:10,textAlign:"center"}},ge("span",{style:{fontSize:14}},"".concat(e("components.productPurchaseImportExcel.downloadErrorListFile"),": ")),ge("strong",{style:{cursor:"pointer",color:"#fd5b50",fontWeight:"bold"},onClick:function(){return a.downloadListError()}},ge(B.Z,null)," ",e("components.productPurchaseImportExcel.here")))})),(0,_.Z)((0,f.Z)(a),"onChangeCreateTransaction",(function(e){var t=a.props.shopId;a.setState({isCreateTransaction:e.target.checked}),localStorage.setItem("is_create_transaction_".concat(t),JSON.stringify(e.target.checked))})),a.state={modalVisible:!1,fileName:"",productPurchaseFile:[],disableImportBtn:!0,isShowResult:!1,isImporting:!1,resultArr:[],dataError:[],stop:!1,isCreateTransaction:!0,successCount:0,errorCount:0},a}return(0,m.Z)(r,[{key:"componentDidMount",value:function(){var e=this.props.shopId,t=!localStorage.getItem("is_create_transaction_".concat(e))||JSON.parse(localStorage.getItem("is_create_transaction_".concat(e)));this.setState({isCreateTransaction:t})}},{key:"render",value:function(){var e=this,t=this.props,r=t.t,a=t.i18n,n=t.type,s=t.title,c=t.isButton,i=this.state,p=i.modalVisible,l=i.fileName,d=i.importedCount,h=i.productPurchaseFile,m=i.isImporting,f=i.disableImportBtn,g=i.stop,y=i.isCreateTransaction,v=i.successCount,_=i.errorCount,S=i.dataError,P=h.filter((function(e){return"string"==typeof e[r("components.productPurchaseImportExcel.warehouseId")]?!!e[r("components.productPurchaseImportExcel.warehouseId")].toString().trim():e[r("components.productPurchaseImportExcel.warehouseId")]})).length||h.length,I="vi"==a.language?"accessories"==n?"/static/files/import_purchase_accessories.xlsx":"/static/files/import_purchase.xlsx":"accessories"==n?"/static/files/import_purchase_accessories_english.xlsx":"/static/files/import_purchase_english.xlsx";return ge("div",{style:{display:"inline"}},ge(pe.Z,{icon:ge(q.Z,null),title:s,onClick:function(){return e.setState({modalVisible:!0})},isButton:c}),p&&ge(x.Z,{title:r("components.productPurchaseImportExcel.importProductPurchaseFromExcel"),footer:null,visible:p,onCancel:this.handleCloseModal},!m&&ge(J.default,{message:r("notes"),description:ge("div",null,ge("div",{style:{fontSize:14}},"- ",r("components.productPurchaseImportExcel.writtenInTheCorrectFormat")," (",ge("a",{target:"_blank",href:I},r("components.productImportExcel.index.sampleFile")),")"),ge("div",{style:{fontSize:14}},"- ",r("components.productPurchaseImportExcel.note"))),type:"warning",showIcon:!0}),!m&&ge("div",{style:{borderBottom:"1px dashed #d9d9d9",borderTop:"1px dashed #d9d9d9",display:"flex",padding:"5px 0"}},ge(u.default,{onChange:this.onChangeCreateTransaction,checked:y},r("components.productPurchaseImportExcel.isCreateTransaction"))),m?null:ge("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},ge(G.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:this.onDrop},ge(o.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},l?ge("span",null,ge(ne.Z,null),l):ge("span",null,ge(oe.Z,null)," ",r("components.productPurchaseImportExcel.chooseFile")))),ge(o.default,{type:"primary",onClick:this.confirmImport,disabled:f},r("components.productPurchaseImportExcel.start"))),ge("div",null,d<=h.length&&m?ge("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},ge(Q.default,{type:"circle",percent:Math.floor(100*d/P),style:{marginBottom:10}})):null,m&&d==h.filter((function(e){return void 0!=e[r("components.productPurchaseImportExcel.warehouseId")]})).length&&d>0?ge("h4",{style:{textAlign:"center"}},ge("span",{style:{color:"#00a854"}},"".concat(r("components.productImportExcel.index.importSuccess")," ").concat(v," ").concat(r("components.productPurchaseImportExcel.productPurchase"))),ge("span",{style:{color:"#f04134"}},"".concat(_>0?", ".concat(r("pages.admin.failure")," ").concat(_," ").concat(r("components.productPurchaseImportExcel.productPurchase")):""))):null,m?ge("div",{style:{maxHeight:700,width:"100%",display:"flex",flexDirection:"column",border:"1px solid #d9d9d9",borderRadius:2,marginTop:10,padding:10,overflow:"auto"},id:"importing-info"},this.renderError(),this.renderSuccess()):null),ge("div",null,g&&S.length?this.renderListFileError():"")))}}]),r}(F.Component))||a,Pe=(0,se.$j)((function(e){return{currentShop:e.shop.currentShop,warehouses:(0,fe.op)(e)}}),{createPurchaseSuccess:ue.Tg0,createPurchaseAccessoriesSuccess:ue.hn6})(Se),Ie=r(83049),be=r(74229),Ee=r(99791),Ze=r(82891),Ce=r(12386),we=r(32292),Oe=r(54061),ke=r.n(Oe),De=r(73218),Re=r(73171),Te=r(20225),Ae=r(49485),Fe=r(34819),Ne=r(74298),Be=r(91843),qe=r.n(Be),Me=F.createElement;function je(e,t){var r;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"===typeof e)return Le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Le(e,t)}(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var a=0,n=function(){};return{s:n,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,c=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){c=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(c)throw o}}}}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function Ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function ze(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(r),!0).forEach((function(t){(0,_.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function He(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.Z)(this,r)}}var Ye,Ve=P.default.Option,Ke={horizontal:"center",vertical:"middle"},We={type:"pattern",pattern:"solid",fgColor:{argb:"FFF5F5F5"},bgColor:{argb:"FFF5F5F5"}},$e=["PRODUCT NAME","PRODUCT ID","VARIATION ID","BARCODE","NOTE PRODUCT"],Qe=["ACCESSORY NAME","ACCESSORY ID","ACCESSORY VARIATION ID","NOTE ACCESSORY"],Ge=(0,he.Z)()(xe=function(e){(0,g.Z)(r,e);var t=He(r);function r(e){var a;(0,h.Z)(this,r),a=t.call(this,e),(0,_.Z)((0,f.Z)(a),"getExportForm",(function(){var e=[{label:a.props.t("components.orderExportExcel.index"),key:"STT"},{label:a.props.t("pages.shop.product.purchase.purchaseId"),key:"PURCHASE ID"}];return e="product"==a.props.type?e.concat([{title:a.props.t("components.productCreatorFirstStep.nameProduct"),label:a.props.t("components.productCreatorFirstStep.nameProduct"),disabled:!1,key:"PRODUCT NAME"}]):e.concat([{title:a.props.t("pages.shop.product.accessories.nameAccessories"),label:a.props.t("pages.shop.product.accessories.nameAccessories"),disabled:!1,key:"ACCESSORY NAME"}])})),(0,_.Z)((0,f.Z)(a),"columnOptions",[{title:a.props.t("components.orderExportExcel.index"),label:a.props.t("components.orderExportExcel.index"),disabled:!1,key:"STT"},{title:a.props.t("pages.shop.product.purchase.purchaseId"),label:a.props.t("pages.shop.product.purchase.purchaseId"),disabled:!1,key:"PURCHASE ID"},{title:a.props.t("pages.shop.product.purchase.creator"),label:a.props.t("pages.shop.product.purchase.creator"),disabled:!1,key:"CREATOR"},{title:a.props.t("pages.shop.product.purchase.importAt"),label:a.props.t("pages.shop.product.purchase.importAt"),disabled:!1,key:"IMPORT AT"},{title:a.props.t("pages.shop.product.purchase.receivedAt"),label:a.props.t("pages.shop.product.purchase.receivedAt"),disabled:!1,key:"RECEIVED AT"},{title:a.props.t("warehouse"),label:a.props.t("warehouse"),disabled:!1,key:"WAREHOUSE"},{title:a.props.t("pages.shop.product.purchase.warehouseId"),label:a.props.t("pages.shop.product.purchase.warehouseId"),disabled:!1,key:"WAREHOUSE ID"},{title:a.props.t("note"),label:a.props.t("note"),disabled:!1,key:"NOTE"},{title:a.props.t("components.productCreatorFirstStep.nameProduct"),label:a.props.t("components.productCreatorFirstStep.nameProduct"),disabled:!1,key:"PRODUCT NAME"},{title:a.props.t("pages.shop.product.accessories.nameAccessories"),label:a.props.t("pages.shop.product.accessories.nameAccessories"),disabled:!1,key:"ACCESSORY NAME"},{title:a.props.t("pages.shop.product.exportAccessories.accessoriesId"),label:a.props.t("pages.shop.product.exportAccessories.accessoriesId"),disabled:!1,key:"ACCESSORY ID"},{title:a.props.t("pages.shop.product.exportAccessories.variation"),label:a.props.t("pages.shop.product.exportAccessories.variation"),disabled:!1,key:"ACCESSORY VARIATION ID"},{title:a.props.t("components.orderExportExcel.productId"),label:a.props.t("components.orderExportExcel.productId"),disabled:!1,key:"PRODUCT ID"},{title:a.props.t("pages.shop.product.purchase.variationId"),label:a.props.t("pages.shop.product.purchase.variationId"),disabled:!1,key:"VARIATION ID"},{title:a.props.t("components.orderExportExcel.productNote"),label:a.props.t("components.orderExportExcel.productNote"),disabled:!1,key:"NOTE PRODUCT"},{title:a.props.t("components.productPurchaseDetail.unit"),label:a.props.t("components.productPurchaseDetail.unit"),disabled:!1,key:"ACCESSORIES UNIT"},{title:a.props.t("pages.shop.product.purchase.noteAccessory"),label:a.props.t("pages.shop.product.purchase.noteAccessory"),disabled:!1,key:"NOTE ACCESSORY"},{title:a.props.t("importTranslate.PRODUCT_IMAGE"),label:a.props.t("importTranslate.PRODUCT_IMAGE"),disabled:!1,key:"PRODUCT IMAGE"},{title:a.props.t("pages.shop.product.purchase.categories"),label:a.props.t("pages.shop.product.purchase.categories"),disabled:!1,key:"ATTRIBUTES"},{title:a.props.t("pages.shop.product.purchase.quantity"),label:a.props.t("pages.shop.product.purchase.quantity"),disabled:!1,key:"QTY"},{title:a.props.t("components.accessoriesSecondStep.retailPrice"),label:a.props.t("components.accessoriesSecondStep.retailPrice"),disabled:!1,key:"RETAIL PRICE"},{title:a.props.t("pages.shop.product.purchase.remain"),label:a.props.t("pages.shop.product.purchase.remain"),disabled:!1,key:"REMAIN"},{title:a.props.t("pages.shop.product.purchase.totalPrice"),label:a.props.t("pages.shop.product.purchase.totalPrice"),disabled:!1,key:"TOTAL PRICE"},{title:a.props.t("pages.shop.product.purchase.importedPrice"),label:a.props.t("pages.shop.product.purchase.importedPrice"),disabled:!1,key:"IMPORTED PRICE"},{title:a.props.t("orders.totalPrice"),label:a.props.t("orders.totalPrice"),disabled:!1,key:"MONEY"},{title:"Barcode",label:"Barcode",disabled:!1,key:"BARCODE"},{title:a.props.t("pages.shop.product.purchase.transportFee"),label:a.props.t("pages.shop.product.purchase.transportFee"),disabled:!1,key:"TRANSPORT FEE"}]),(0,_.Z)((0,f.Z)(a),"optionForm",(function(){var e=a.props,t=e.t,r=e.type,n=[{title:t("components.productPurchaseDetail.supplierProducts"),label:t("components.productPurchaseDetail.supplierProducts"),disabled:!1,key:"SUPPLIER PRODUCT"}],o=[].concat((0,c.Z)(a.columnOptions),n);return"product"==r&&(o=o.filter((function(e){return!Qe.includes(e.key)}))),"accessories"==r&&(o=o.filter((function(e){return!$e.includes(e.key)}))),o})),(0,_.Z)((0,f.Z)(a),"handleFormFields",(function(){return a.getFormFields(a.state.form)})),(0,_.Z)((0,f.Z)(a),"getFormFields",(function(e){var t=a.state,r=t.exportKeys,n=t.exportOptions;switch(e){case 1:var o=["STT","PURCHASE ID","CREATOR","IMPORT AT","RECEIVED AT","WAREHOUSE","WAREHOUSE ID","NOTE","PRODUCT NAME","ACCESSORY NAME","ACCESSORY ID","ACCESSORY VARIATION ID","NOTE ACCESSORY","PRODUCT ID","VARIATION ID","NOTE PRODUCT","ATTRIBUTES","QTY","RETAIL PRICE","REMAIN","TOTAL PRICE","IMPORTED PRICE","MONEY","BARCODE","SUPPLIER PRODUCT","TRANSPORT FEE"];return n.filter((function(e){return o.includes(e.key)}));case 3:var s=r.filter((function(e){return-1!=n.findIndex((function(t){return t.key===e}))})).map((function(e){var t=n.find((function(t){return t.key===e}));return{label:t.label,key:t.key}}));return a.props.dispatch({type:Fe.p57,payload:s}),s}})),(0,_.Z)((0,f.Z)(a),"transformPurchases",(function(e,t){var r=a.props.t,n=a.state.form,o=a.handleFormFields(),s=[],c=!![3].includes(n)&&a.state.exportPurchaseOneLine,i=!![3].includes(n)&&a.state.exportPurchaseDetail,u=o.find((function(e){return["STT","PRODUCT NAME","PRODUCT ID","VARIATION ID","PRODUCT IMAGE"].includes(e.key)})),p=function(e,t,r){var n={};o.forEach((function(o){var s=o.key,c=o.label;n=ze(ze({},n),{},(0,_.Z)({},"PRODUCT IMAGE"==s?s:c,a.takeValue(s,e,t,r)))})),r||(e.transformIndex=s.length),s.push(n)},l=e;"accessories"!=a.props.type&&(l=e.map((function(e){var t=e.items.filter((function(e){var t;return!(null!==(t=e.variation)&&void 0!==t&&t.is_removed)}));return ze(ze({},e),{},{items:t})})));var d=[];if(l.forEach((function(e,r){if(0==("accessories"==a.props.type?e.accessories_items:e.items).length||c?d.push(r+t+1):c||("accessories"==a.props.type?e.accessories_items:e.items).forEach((function(e){return d.push(r+t+1)})),("accessories"==a.props.type?e.accessories_items:e.items).length&&u)if(c){var n={};o.forEach((function(o){var s=o.key,c=o.label,i=("accessories"==a.props.type?e.accessories_items:e.items).map((function(n,o){return a.takeValue(s,e,r+t,o)})),u=["PRODUCT NAME","PRODUCT ID","VARIATION ID","PRODUCT IMAGE","QTY","RETAIL PRICE","REMAIN","IMPORTED PRICE","BARCODE","MONEY"].findIndex((function(e){return e==s}));n=ze(ze({},n),{},(0,_.Z)({},"PRODUCT IMAGE"==s?s:c,-1!=u?i.join("; "):i.join("")))})),s.push(n)}else("accessories"==a.props.type?e.accessories_items:e.items).forEach((function(a,n){p(e,r+t,n)}));else p(e,r+t)})),i){var h=[r("pages.shop.product.purchase.importedPrice"),r("components.accessoriesSecondStep.retailPrice"),r("orders.totalPrice")];d.forEach((function(e,t){d[t]==d[t-1]&&s[t]&&Object.keys(s[t]).forEach((function(e){if(!s[t]["".concat(e)]&&!h.includes(e)||""===s[t]["".concat(e)])return s[t]["".concat(e)]=s[t-1]["".concat(e)]}))}))}a.transformedPurchases=a.transformedPurchases.concat(s),a.arrRows=a.arrRows.concat(d)})),(0,_.Z)((0,f.Z)(a),"splitList",(function(e){for(var t=[],r=0;r<e.length;r+=3)t=[].concat((0,c.Z)(t),[e.slice(r,r+3)]);return t})),(0,_.Z)((0,f.Z)(a),"getImagesForExport",(0,te.Z)(ee().mark((function e(){var t,r,n,o,s,c;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a.props.accessToken,r="PRODUCT IMAGE",n=[],a.transformedPurchases.forEach((function(e){return e[r]&&e[r].includes("https")&&n.push(e[r])})),n=a.splitList(ae()(n)),a.cancelDownloadImage=!1,a.images=n,o=2,a.setState({downloadingImage:!0,current:0}),s=0;case 10:if(!(s<n.length)){e.next=20;break}if(a.state.downloadingImage){e.next=13;break}return e.abrupt("break",20);case 13:return c=n.slice(s,s+o).map((function(e){return(0,ue.Jxd)(t,e)})),e.next=16,Promise.all(c).then((function(e){var t=e.reduce((function(e,t){return e=ze(ze({},e),t.data)}),{});Object.keys(t).forEach((function(e){a.transformedPurchases.reduce((function(t,a,n){return a[r]==e&&t.push(n),t}),[]).forEach((function(r){return a.transformedPurchases[r].buffer=t[e]}))}))})).catch(console.log);case 16:a.setState({current:s+o});case 17:s+=o,e.next=10;break;case 20:a.setState({downloadingImage:!1});case 21:case"end":return e.stop()}}),e)})))),(0,_.Z)((0,f.Z)(a),"_addImage",(function(e,t,r,a){var n=Object.keys(e).findIndex((function(e){return"PRODUCT IMAGE"==e})),o=r.addImage({base64:e.buffer,extension:"jpeg"});a.addImage(o,{tl:{col:n,row:t+1},ext:{width:100,height:100}})})),(0,_.Z)((0,f.Z)(a),"onDownloadClick",(0,te.Z)(ee().mark((function e(){var t,r,n,o,s,i,u,p,l,d,h,m,f,g;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.state,r=t.purchases,n=t.form,o=t.save,s=t.exportFormName,i=t.listExportForm,u=a.props,p=u.shopId,l=u.accessToken,d=u.exportType,h=u.dispatch,m=u.t,f=u.type,r.length){e.next=5;break}return e.next=5,a.props.fetchAll();case 5:a.setState({isDownloading:!0}),a.props.selectedExportForm&&1==a.props.selectedExportForm.length&&a.setState({form:a.props.selectedExportForm[0]},(function(){return a.hasChangeForm=!0})),a.props.selectedExportForm&&a.props.selectedExportForm.length>1&&3==a.props.selectedExportForm[0]&&(g=a.state.listExportForm.find((function(e){return e.id==a.props.selectedExportForm[1]})),a.setState({form:3,exportKeys:g.value.map((function(e){return e.key}))},(function(){return a.hasChangeForm=!0}))),setTimeout((0,te.Z)(ee().mark((function e(){var t,r,u,g,y,v;return ee().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a.hasChangeForm||3==a.state.form)&&(a.transformedPurchases=[],a.arrRows=[],a.transformPurchases(a.props.purchases,0)),t=a.handleFormFields(),r=3==n&&t.find((function(e){return"PRODUCT IMAGE"==e.key})),localStorage.setItem("purchase_export_type",n),3!=n||!o||!t.length){e.next=12;break}if(""!=s){e.next=8;break}return a.setState({isDownloading:!1}),e.abrupt("return",de.Z.error(Ne.ZP.t("error"),Ne.ZP.t("components.orderExportExcel.notEmptyformName")));case 8:u={id:(0,le.uuG)("custom-form"),name:s,value:t},a.setState({isDeleting:!0}),g=i?i.concat([u]):[u],h((0,Te.Ij)(l,{id:p,listFormFields:g})).then((function(e){return a.setState({isDeleting:!1,listExportForm:g}),de.Z.success(Ne.ZP.t("success"),"Th\xeam m\u1eabu th\xe0nh c\xf4ng")}));case 12:if(!r){e.next=15;break}return e.next=15,a.getImagesForExport();case 15:y=function(){var e=t.map((function(e){var t=a.transformedPurchases[0]&&a.transformedPurchases[0][e.label],r=t?4*t.toString().length:25;return{header:e.label,key:e.label,width:r>=84&&r<=300||r>300&&r>2*(null===t||void 0===t?void 0:t.toString().length)?1.33*t.toString().length:"PRODUCT IMAGE"==e.key?25:r>=60?r:25}}));!function(e,t,n){e||(e="Untitled");var o=new ExcelJS.Workbook,s=new Date;o.created=s,o.modified=s;var c=o.addWorksheet("sheet");c.columns=t,Array.isArray(a.arrRows)&&a.arrRows.length!=n.length&&(a.arrRows=ae()(a.arrRows));var i,u=je(n.entries());try{for(u.s();!(i=u.n()).done;){var p=(0,we.Z)(i.value,2),l=p[0],d=p[1],h=!a.cancelDownloadImage&&r;d.buffer&&(h&&a._addImage(d,l,o,c),delete d.buffer);var m=c.addRow(d);h&&(m.height=50,m.alignment=Ke)}}catch(g){u.e(g)}finally{u.f()}var f=[];a.arrRows=f.concat(a.arrRows),c.eachRow((function(e,t){t>1&&a.arrRows[t-2]%2!=0&&(c.getRow(t).fill=We)})),o.xlsx.writeBuffer().then((function(t){(0,me.saveAs)(new Blob([t],{type:"application/octet-stream"}),"".concat(e,".xlsx"))}))}("product"==f?"purchase_product":"purchase_accessories",e,a.transformedPurchases),a.setState({isDownloading:!1})},v=function(){var e=[],t=a.getFormFields(a.state.form).map((function(e){return"HINH_ANH"!=e.label?e.label:"PRODUCT IMAGE"}));t.map((function(r,a){a!=t.length-1?e.push("auto"):e.push("*")}));var r={pageSize:"A4",content:[{layout:"lightHorizontalLines",table:{headerRows:1,widths:e,body:[t].concat((0,c.Z)(a.transformedPurchases.map((function(e){return ke()(e,(function(e,r,a){return t.includes(a)?(a==m("pages.shop.product.purchase.quantity")||a==m("pages.shop.product.purchase.remain")||a==m("pages.shop.product.purchase.totalPrice")?e.push({text:r,alignment:"right"}):e.push(r),e):e}),[])}))))},fontSize:10}]};pdfMake.createPdf(r).download(),a.setState({isDownloading:!1,length:0})},"excel"==d?y():v();case 18:case"end":return e.stop()}}),e)}))));case 9:case"end":return e.stop()}}),e)})))),(0,_.Z)((0,f.Z)(a),"takeValue",(function(e,t,r,n){var o,s,c,i,u,p,l,d,h,m,f,g,y,v,_,x,S,P,I,b,E,Z=a.props,C=Z.currentShop.currency,w=Z.t,O=Z.timezone,k=Z.supplier_products,D=Z.type,R=("accessories"==a.props.type?t.accessories_items:t.items)[n],T=R?"product"==D?(null===R||void 0===R||null===(o=R.variation)||void 0===o||null===(s=o.product)||void 0===s?void 0:s.name)||w("components.productPurchaseExportExcel.productWasDelete"):(null===R||void 0===R||null===(c=R.accessories_variation)||void 0===c||null===(i=c.accessories)||void 0===i?void 0:i.name)||w("components.productPurchaseExportExcel.productWasDelete"):"",A=le.cvg.includes(C)?1:100,F=0;(("accessories"==a.props.type?t.accessories_items:t.items).forEach((function(e){F+=((null===e||void 0===e?void 0:e.imported_price)||0)*e.quantity})),t.supplier_products_id)&&(b=((null===k||void 0===k||null===(E=k.data)||void 0===E?void 0:E.find((function(e){return e.id==t.supplier_products_id})))||{}).name);switch(e){case"ACCESSORY NAME":case"PRODUCT NAME":return T;case"PRODUCT ID":return R&&R.variation&&R.variation.product?R.variation.product.custom_id?R.variation.product.custom_id:R.variation.product.display_id?R.variation.product.display_id:"":"";case"ACCESSORY ID":return(null===R||void 0===R||null===(u=R.accessories_variation)||void 0===u||null===(p=u.accessories)||void 0===p?void 0:p.custom_id)||(null===R||void 0===R||null===(l=R.accessories_variation)||void 0===l||null===(d=l.accessories)||void 0===d?void 0:d.display_id);case"ACCESSORY VARIATION ID":return(null===R||void 0===R||null===(h=R.accessories_variation)||void 0===h?void 0:h.custom_id)||(null===R||void 0===R||null===(m=R.accessories_variation)||void 0===m?void 0:m.display_id);case"VARIATION ID":return R&&R.variation?R.variation.custom_id?R.variation.custom_id:R.variation.display_id?R.variation.display_id:"":"";case"NOTE PRODUCT":return(null===R||void 0===R?void 0:R.note_purchase)||null;case"ACCESSORIES UNIT":return(null===R||void 0===R||null===(f=R.accessories_variation)||void 0===f||null===(g=f.accessories)||void 0===g?void 0:g.unit)||"";case"NOTE ACCESSORY":return null===R||void 0===R?void 0:R.note;case"ATTRIBUTES":return R?"product"==D?null!==R&&void 0!==R&&null!==(y=R.variation)&&void 0!==y&&y.fields&&R.variation.fields.length?R.variation.fields.map((function(e){return"".concat(e.name,":").concat(e.value)})).join("; "):"":null!==R&&void 0!==R&&null!==(v=R.accessories_variation)&&void 0!==v&&v.fields&&R.accessories_variation.fields.length?R.accessories_variation.fields.map((function(e){return"".concat(e.name,":").concat(e.value)})).join("; "):"":"";case"QTY":return R&&R.quantity;case"RETAIL PRICE":return"product"==D?R&&R.variation?R.variation.retail_price:"":R&&R.accessories_variation?R.accessories_variation.retail_price:"";case"REMAIN":return R&&R.remain_quantity;case"TOTAL PRICE":return 0==n?F/A:null;case"IMPORTED PRICE":return R?R.imported_price/A:"";case"MONEY":return(R?R.imported_price/A:0)*((null===R||void 0===R?void 0:R.quantity)||0);case"BARCODE":return R?(0,le.xLU)(ze(ze({},R.variation),{},{product:{display_id:null===(_=R.variation)||void 0===_||null===(x=_.product)||void 0===x?void 0:x.display_id}}),a.props.currentShop):"";case"PRODUCT IMAGE":return R?"product"==D?null!==R&&void 0!==R&&null!==(S=R.variation)&&void 0!==S&&S.images&&R.variation.images.length?(0,le.UXE)(R.variation.images[0],200,200):"":null!==R&&void 0!==R&&null!==(P=R.accessories_variation)&&void 0!==P&&P.images&&R.accessories_variation.images.length?(0,le.UXE)(R.accessories_variation.images[0],200,200):"":"";case"SUPPLIER PRODUCT":return b||"";case"PURCHASE ID":return null===t||void 0===t?void 0:t.display_id}if(0==n)switch(e){case"STT":return++r;case"CREATOR":return t.user?t.user.name:w("pages.admin.system").toUpperCase();case"IMPORT AT":return t.inserted_at?(0,le.o0x)(O,t.inserted_at,null,"DD/MM/YYYY"):"";case"RECEIVED AT":return t.received_at?(0,le.o0x)(O,t.received_at,null,"DD/MM/YYYY"):"";case"WAREHOUSE":return null===t||void 0===t||null===(I=t.warehouse)||void 0===I?void 0:I.name;case"WAREHOUSE ID":return null===t||void 0===t?void 0:t.warehouse_id;case"NOTE":return null===t||void 0===t?void 0:t.note;case"TRANSPORT FEE":return(t.transport_fee||0)/A;default:return""}return null})),(0,_.Z)((0,f.Z)(a),"onChangeForm",(function(e){a.setState({form:e},(function(){return a.hasChangeForm=!0})),localStorage.setItem("purchase_export_type",e)})),(0,_.Z)((0,f.Z)(a),"onChangeExportOptionsDrag",(function(e){var t=a.props.type;!e.includes("PRODUCT NAME")&&!e.includes("PURCHASE ID")&&!e.includes("VARIATION ID")&&!e.includes("PRODUCT IMAGE")&&(e.includes("QTY")||e.includes("VARIATION ID")||e.includes("PRODUCT ID"))&&e.unshift("PRODUCT NAME"),"product"==t&&localStorage.setItem("purchase_product_export_columns",JSON.stringify({exportKeys:e})),"accessories"==t&&localStorage.setItem("purchase_accessory_export_columns",JSON.stringify({exportKeys:e})),a.setState({exportKeys:e},(function(){return a.hasChangeForm=!0}))})),(0,_.Z)((0,f.Z)(a),"handleFormatDateTime",(function(e){a.setState({valueFormatDateTime:e}),localStorage.setItem("formatTimeType",e)})),(0,_.Z)((0,f.Z)(a),"renderModalFooter",(function(){var e=a.state,t=e.isDownloading,r=e.downloadingImage,n=e.current,s=e.form,c=a.props,i=c.purchaseDownloading,u=c.percent,p=a.props.t,l={display:"flex",justifyContent:"space-between"};return Me("div",{style:3==s?ze(ze({},l),{},{padding:"10px 10px 10px 0px"}):{padding:"10px 10px 10px 0px",textAlign:"right"}},3==s&&Me("div",{style:ze(ze({},l),{},{width:350})},Me("div",{style:{fontWeight:500,paddingTop:3,marginLeft:3}},p("components.customerExportExcel.formatDateTime"),":"),Me(P.default,{style:{width:190},defaultValue:a.state.valueFormatDateTime,onChange:function(e){return a.handleFormatDateTime(e)}},Me(Ve,{value:"default"},p("components.customerExportExcel.default")),Me(Ve,{value:"type1"},"YYYY-MM-DD HH:mm:ss"))),Me("div",null,r?Me(o.default,{className:"order-action-button load-img"},Me("div",{className:"cb-li"},Me("span",{style:{paddingRight:13}},p("crm.loading",{data:p("pages.shop.product.variation.image")})),Me("span",{onClick:function(){a.cancelDownloadImage=!0,a.setState({downloadingImage:!1})}},Me(De.Z,{style:{color:"red"}}))),Me(Q.default,{status:"active",percent:n/((a.images||[]).length||1)*100,showInfo:!1})):Me(o.default,{className:"order-action-button",disabled:t||i,type:"primary",onClick:function(){return a.onDownloadClick()}},i?Me("span",null,Me(Q.default,{style:{width:100},status:"active",percent:u})):Me("span",null,Me(t?N.Z:B.Z,null)," ",p("components.customerExportExcel.download")))))})),(0,_.Z)((0,f.Z)(a),"handleDeleteForm",(function(e){a.setState({isDeleting:!0});var t=a.props,r=t.accessToken,n=t.shopId,o=t.dispatch,s=(a.handleFormFields(),E()(a.state.listExportForm)),c=s.findIndex((function(t){return t.id==e}));c>-1&&s.splice(c,1),o((0,Te.Ij)(r,{id:n,listFormFields:s})).then((function(e){return a.setState({isDeleting:!1,listExportForm:s}),de.Z.success(Ne.ZP.t("success"),Ne.ZP.t("components.orderExportExcel.deleteExportFormSuccess"))}))})),(0,_.Z)((0,f.Z)(a),"handleClickForm",(function(e,t){var r=e.find((function(e){return e.id==t}));a.setState({exportKeys:r.value.map((function(e){return e.key}))},(function(){return a.hasChangeForm=!0}))})),(0,_.Z)((0,f.Z)(a),"menu",(function(){var e=a.state.listExportForm,t=a.props.t,r=e;return Me(Ce.default,{onClick:function(e){var t=e.key;return a.handleClickForm(r,t)}},r&&r.length>0?r.map((function(e){return Me(Ce.default.Item,{style:{display:"flex",justifyContent:"space-between"},key:e.id},Me("span",null,e.name),Me("span",{onClick:function(e){return e.stopPropagation()}},Me(d.default,{title:t("delete")},Me(Re.Z,{style:{fontSize:18,color:"rgb(150, 19, 19)",cursor:"pointer"},onClick:function(){return a.handleDeleteForm(e.id)}}))))})):Me(Ce.default.Item,{disabled:!0},"Ch\u01b0a c\xf3 m\u1eabu l\u01b0u s\u1eb5n"))})),(0,_.Z)((0,f.Z)(a),"renderOptionExport",(function(e,t,r,n,o){return Me(d.default,{title:t},Me("span",{style:{float:"left",marginTop:5,fontSize:14,cursor:"pointer"}},Me(u.default,{checked:e,onChange:function(e){var t=e.target.checked;localStorage.setItem(r,t),a.setState((0,_.Z)({},r,t)),t&&(localStorage.setItem(n,!1),a.setState((0,_.Z)({},n,!1)))}},o)))})),(0,_.Z)((0,f.Z)(a),"renderSettingCustomForm",(function(){var e=a.props,t=e.t,r=e.type,n=a.state,s=n.exportKeys,c=n.exportOptions,p=n.save,l=n.exportFormName,d=n.isDeleting,h=n.exportPurchaseOneLine,m=n.exportPurchaseDetail,f=c.map((function(e){return{title:e.label,dataIndex:e.key}})),g=(0,le.HUL)(f),y=g.translate,v=g.allColumns;return Me("div",{className:"order-export-excel-setting"},Me("div",{className:"check-save",style:{display:"flex",justifyContent:"space-between",padding:"0px 16px 17px 16px"}},Me("div",{style:{display:"grid"}},"product"==r&&Me("div",{style:{display:"flex"}},Me(u.default,{checked:p,onChange:function(e){return a.setState({save:e.target.checked})}},t("components.orderExportExcel.saveTempleteWhenDownloaded")),p&&Me("span",{className:"input-form-name"},Me(i.default,{value:l,onChange:function(e){return a.setState({exportFormName:e.target.value})},placeholder:t("components.orderExportExcel.exportFormName")}))),a.renderOptionExport(m,t("product"==r?"components.exportPurchase.exportPurchaseDetailsForEachProduct":"components.exportPurchase.exportPurchaseDetailsForEachAccessory"),"exportPurchaseDetail","exportPurchaseOneLine",t("product"==r?"components.orderExportExcel.showDetailsOfEachProduct":"components.exportPurchase.showDetailsOfEachAccessory")),a.renderOptionExport(h,t("product"==r?"components.orderExportExcel.showDetailOrderInOneLineTip":"components.exportPurchase.showDetailPurchaseInOneLineTip"),"exportPurchaseOneLine","exportPurchaseDetail",t("product"==r?"components.orderExportExcel.showDetailOrderInOneLine":"components.exportPurchase.showDetailAccessoryInOneLine"))),"product"==r&&Me("span",null,Me(o.default.Group,null,Me(Ze.default,{overlay:a.menu()},Me(o.default,{className:"order-action-button"},d?Me(N.Z,null):"","\xa0",Me("span",null,t("components.orderExportExcel.listExportFormSaved"))))))),Me(Ae.Z,{t:t,isExportExcel:!0,translate:y,defaultCheckedList:[],displayColumns:s,addOptionColumns:v.filter((function(e){return!s.includes(e)})),dataSearch:c,onChangeExportOptionsDrag:a.onChangeExportOptionsDrag}))}));var n=a.getExportForm(),s=JSON.parse(localStorage.getItem("purchase_export_type")),p="product"==e.type?localStorage.getItem("purchase_product_export_columns")?JSON.parse(localStorage.getItem("purchase_product_export_columns")).exportKeys:n.map((function(e){return e.key})):localStorage.getItem("purchase_accessory_export_columns")?JSON.parse(localStorage.getItem("purchase_accessory_export_columns")).exportKeys:n.map((function(e){return e.key}));return a.state={isDownloading:!1,modalVisible:!1,form:s||1,exportOptions:ie()(a.optionForm(),{$apply:function(e){return e.map((function(e){var t=n.find((function(t){return t.key===e.key}));return t?ze(ze({},e),{},{label:t.label}):e}))}}),exportKeys:p,save:!1,listExportForm:e.listExportForm,exportFormName:"",isDeleting:!1,exportPurchaseOneLine:JSON.parse(localStorage.getItem("exportPurchaseOneLine")),purchases:e.purchases,downloadingImage:!1,current:0,valueFormatDateTime:localStorage.getItem("formatTimeType")||"default",exportPurchaseDetail:JSON.parse(localStorage.getItem("exportPurchaseDetail"))},a.barcode="",a.transformedPurchases=[],a.arrRows=[],a.hasChangeForm=!1,a.cancelDownloadImage=!1,a}return(0,m.Z)(r,[{key:"componentDidUpdate",value:function(e){var t=this;C()(e.purchases,this.props.purchases)||(this.transformedPurchases=[],this.arrRows=[],this.setState({purchases:this.props.purchases},(function(){t.hasChangeForm||t.transformPurchases(t.state.purchases,0)})))}},{key:"render",value:function(){var e=this.props,t=e.currentShop,r=e.t,a=this.state.form,n=(0,le.odE)();return Me("div",{className:"order-export-excel-container"},1==t.type&&Me("div",{className:"order-export-excel-header",style:{paddingBottom:0}},Me("div",{style:{display:"flex"}},Me("div",{style:{display:"grid",paddingTop:10}},Me("span",{className:"span-order-export"},r("components.exportPurchase.chooseDownloadTemplate")),Me(P.default,{style:{width:350,marginTop:5},value:a,onChange:this.onChangeForm},n.map((function(e){return Me(Ve,{value:e.value,key:e.value},e.label)}))))),this.renderModalFooter()),3==a&&this.renderSettingCustomForm(),Me("style",{dangerouslySetInnerHTML:{__html:qe()}}))}}]),r}(F.Component))||xe,Je=(0,se.$j)((function(e){return{currentShop:(0,fe.tf)(e),timezone:e.navigation.user.timezone}}),null)(Ge),Xe=r(92862),et=r.n(Xe),tt=F.createElement;function rt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function at(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(r),!0).forEach((function(t){(0,_.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function nt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.Z)(this,r)}}var ot,st=I.default.Group,ct=(0,he.Z)()(Ye=function(e){(0,g.Z)(r,e);var t=nt(r);function r(e){var a;return(0,h.Z)(this,r),a=t.call(this,e),(0,_.Z)((0,f.Z)(a),"fetchPurchases",(function(){var e=a.props,t=e.shopId,r=e.accessToken,n=e.type,o=e.selectedRowKeys,s="accessories"==n?"".concat((0,le.LpH)(),"/shops/").concat(t,"/purchase_accessories?access_token=").concat(r):"".concat((0,le.LpH)(),"/shops/").concat(t,"/purchases?access_token=").concat(r),c=at(at({},a.props.params),{},{page:1,page_size:30,preload_items:!0,purchase_ids:o&&o.length>0?o.join(","):void 0}),i=[],u=0;return function e(t){return $().get(s,{params:t}).then((function(r){var n=r.data.data;return u+=1,i=i.concat(n),a.setState({purchases:i,percent:Math.round(100*u/r.data.total_pages)}),0==n.length||i.length>=r.data.total_entries?i:(t.page+=1,e(t))}))}(c)})),(0,_.Z)((0,f.Z)(a),"handleFetchPurchase",(function(){var e=a.props,t=e.selectedPurchases,r=e.type;if(a.setState({isDownloading:!0}),!("accessories"==r&&t.length>0))return a.fetchPurchases().then((function(){return a.setState({isDownloading:!1})}));a.setState({purchases:t,isDownloading:!1})})),(0,_.Z)((0,f.Z)(a),"renderModalTitle",(function(e){var t=a.props.t;return tt("div",null,tt("span",null,"".concat(t("components.customerExportExcel.download")," ").concat(e.length?e.length+" "+t("components.exportPurchase.selectedPurchaseTo"):"")),tt("span",{style:{marginLeft:10}},tt(st,{value:a.state.exportType,onChange:function(e){return a.setState({exportType:e.target.value})}},tt(I.default,{value:"excel"},"Excel"),tt(I.default,{value:"pdf"},"PDF"))))})),(0,_.Z)((0,f.Z)(a),"renderExportPurchase",(function(e){var t=a.props,r=t.shopId,n=t.accessToken,o=t.supplier_products,s=t.listExportForm,c=a.state,i=c.exportType,u=c.purchases,p=c.percent,l=c.isDownloading;return tt(Je,{exportType:i,fetchAll:a.handleFetchPurchase,shopId:r,accessToken:n,purchases:u,percent:p,purchaseDownloading:l,listExportForm:s,supplier_products:o,type:e})})),a.state={isDownloading:!1,exportType:"excel",length:0,purchases:[],modalVisible:!1,percent:0},a}return(0,m.Z)(r,[{key:"componentDidMount",value:function(){var e=this.props,t=e.accessToken,r=e.shopId;(0,e.fetchPurchaseListExportForm)(t,r)}},{key:"render",value:function(){var e=this,t=this.props,r=t.t,a=t.selectedRowKeys,n=t.title,o=t.isButton,s=t.type,c=this.state.modalVisible;return tt("div",{style:{display:"inline"}},tt(pe.Z,{title:n,icon:tt(B.Z,null),onClick:function(){return e.setState({modalVisible:!0})},isButton:o,tooltip:a.length>0?r("components.customerExportExcel.download")+" "+a.length+r("components.productPurchaseExportExcel.selectedPurchase"):r("components.productPurchaseExportExcel.exportImportProductToExcel")}),tt(x.Z,{wrapClassName:"update-order-tool",visible:c,title:this.renderModalTitle(a),width:800,footer:null,onCancel:function(){return e.setState({modalVisible:!1,purchases:[]})}},"product"==s&&this.renderExportPurchase(s),"accessories"==s&&this.renderExportPurchase(s)),tt("style",{dangerouslySetInnerHTML:{__html:et()}}))}}]),r}(F.Component))||Ye,it=(0,se.$j)((function(e){return at(at({totalEntries:e.product.purchases.total_entries,timezone:e.navigation.user.timezone},(0,fe.zN)(e)),{},{listExportForm:e.order.listPurchaseExportForm})}),{fetchPurchases:ue.T0T,fetchPurchaseListExportForm:ue.jdW})(ct),ut=r(50916),pt=r(60676),lt=r(20838),dt=r(63868),ht=r.n(dt),mt=r(76570),ft=r(97705),gt=r(7463),yt=r(20920),vt=F.createElement;function _t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.Z)(this,r)}}function xt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function St(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(r),!0).forEach((function(t){(0,_.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Pt,It=P.default.Option,bt=S.default.RangePicker,Et=lt.default.TabPane,Zt={items:[],accessories_items:[],note:"",warehouse:{},status:0,not_create_transaction:!1,auto_create_debts:!0},Ct={isCreating:!1,searchResult:[],purchaseBySale:{warehouse:{},items:[],start_time:null,end_time:null,loadingCreatePurchase:!1,pending_quantity:!1,returning_quantity:!1,remain_quantity:!1,intendedDay:"default",dayQuantity:0},purchaseByRemain:{warehouse:{},warehouse_id:null,quantity:0,page:1,page_size:30,total_entries:0,typePurchase:"remain_quantity_max",pending_quantity:!1,returning_quantity:!1},purchaseBySellingStatus:{warehouse:{},warehouse_id:null,page:-1,returning_quantity:!1,purchase_warn_range:null,is_suggest_selling_status:!0},isLoadingSuggestion:!1,listSuggestions:[],listSuggestionsBySellingStatus:[],selectedRowKeys:[],activeKey:"1",purchaseDetailVisible:!1,selectedPurchase:St({},Zt),textSearch:null},wt=(0,he.Z)()(ot=function(e){(0,g.Z)(r,e);var t=_t(r);function r(e){var a,o;return(0,h.Z)(this,r),o=t.call(this,e),(0,_.Z)((0,f.Z)(o),"componentDidMount",(function(){window.addEventListener("beforeunload",(function(e){e.preventDefault(),"undefined"!==typeof Storage&&o.handleSetStorage()}))})),(0,_.Z)((0,f.Z)(o),"componentWillUnmount",(function(){o.handleSetStorage()})),(0,_.Z)((0,f.Z)(o),"handleGetLocalStorage",(function(){var e=o.state.activeKey;if("undefined"!==typeof localStorage)try{if(localStorage.purchase_suggestion_by_sale&&"1"==e&&o.setState({purchaseBySale:JSON.parse(localStorage.getItem("purchase_suggestion_by_sale"))},(function(){localStorage.removeItem("purchase_suggestion_by_sale")})),localStorage.purchase_suggestion_by_remain&&"2"==e){var t=JSON.parse(localStorage.getItem("purchase_suggestion_by_remain"));t.page=1,o.setState({purchaseByRemain:t},(function(){var e,r;null!==(e=t.warehouse)&&void 0!==e&&e.id&&o.handleFetchSuggestion(null===(r=t.warehouse)||void 0===r?void 0:r.id),localStorage.removeItem("purchase_suggestion_by_remain")}))}if(localStorage.purchase_suggestion_by_selling_status&&"3"==e){var r=JSON.parse(localStorage.getItem("purchase_suggestion_by_selling_status"));o.setState({purchaseBySellingStatus:r},(function(){var e,t;null!==(e=r.warehouse)&&void 0!==e&&e.id&&o.handleFetchSuggestion(null===(t=r.warehouse)||void 0===t?void 0:t.id),localStorage.removeItem("purchase_suggestion_by_selling_status")}))}}catch(a){console.log(a)}})),(0,_.Z)((0,f.Z)(o),"handleOpenModal",(function(){o.handleGetLocalStorage(),o.setState({isCreating:!0})})),(0,_.Z)((0,f.Z)(o),"handleCancelModal",(function(){var e,t=o.props.currentShop;o.handleSetStorage(),o.setState(St(St({},Ct),{},{purchaseBySellingStatus:St(St({},Ct.purchaseBySellingStatus),{},{purchase_warn_range:(null===(e=t.settings)||void 0===e?void 0:e.purchase_warn_range)||0})}))})),(0,_.Z)((0,f.Z)(o),"handleSetStorage",(function(){var e=E()(o.state.purchaseBySale),t=E()(o.state.purchaseByRemain),r=E()(o.state.purchaseBySellingStatus);C()(e,Ct.purchaseBySale)||(0,le.kzT)(e)||localStorage.setItem("purchase_suggestion_by_sale",JSON.stringify(e)),C()(t,Ct.purchaseByRemain)||(0,le.kzT)(t)||localStorage.setItem("purchase_suggestion_by_remain",JSON.stringify(t)),C()(r,Ct.purchaseBySellingStatus)||(0,le.kzT)(r)||localStorage.setItem("purchase_suggestion_by_selling_status",JSON.stringify(r))})),(0,_.Z)((0,f.Z)(o),"handleSelectItem",(function(e){var t=o.state.searchResult.find((function(t){return t.id==e})),r=o.state.purchaseBySale,a=r.items.findIndex((function(t){return t.id==e}));a>-1?r.items[a].quantity+=1:r.items.push(St(St({},t),{},{quantity:1})),o.setState({purchaseBySale:r})})),(0,_.Z)((0,f.Z)(o),"onChangeWarehouse",(function(e){var t=o.state.activeKey,r=o.props.warehouses.find((function(t){return t.id==e}));if("1"==t){var a=E()(o.state.purchaseBySale);a.warehouse=r,o.setState({purchaseBySale:a})}else{var n,s="2"==t?"purchaseByRemain":"purchaseBySellingStatus",c="2"==t?E()(o.state.purchaseByRemain):E()(o.state.purchaseBySellingStatus);c.warehouse=r||{},c.warehouse_id=null===r||void 0===r?void 0:r.id,c.page=1,o.setState((n={},(0,_.Z)(n,s,c),(0,_.Z)(n,"selectedRowKeys",[]),n),(function(){null!==r&&void 0!==r&&r.id&&o.handleFetchSuggestion(null===r||void 0===r?void 0:r.id)}))}})),(0,_.Z)((0,f.Z)(o),"handleInputNumberChange",(function(e,t){switch(o.state.activeKey){case"1":var r=E()(o.state.purchaseBySale);r.items[e].quantity=t,o.setState({purchaseBySale:r});break;case"2":var a=E()(o.state.purchaseByRemain);a.quantity=t,o.setState({purchaseByRemain:a});break;case"3":var n=E()(o.state.purchaseBySellingStatus);n.purchase_warn_range!=t&&(n.purchase_warn_range=t,o.setState({purchaseBySellingStatus:n},(function(){o.handleFetchSuggestion(o.state.purchaseBySellingStatus.warehouse_id)})))}})),(0,_.Z)((0,f.Z)(o),"onChangeFilterDate",(function(e){var t=o.state.purchaseBySale;t.start_time=e&&e[0]?e[0].startOf("day"):null,t.end_time=e&&e[1]?e[1].endOf("day"):null,o.setState({purchaseBySale:t})})),(0,_.Z)((0,f.Z)(o),"handleOnChangeCheckBox",(function(e,t){var r=o.state.purchaseBySale;r[t]=e,o.setState({purchaseBySale:r})})),(0,_.Z)((0,f.Z)(o),"handleOnChangeCheckBoxPurchaseByRemain",(function(e,t){var r="2"==o.state.activeKey?"purchaseByRemain":"purchaseBySellingStatus",a=E()(o.state[r]);a[t]=e,o.setState((0,_.Z)({},r,a))})),(0,_.Z)((0,f.Z)(o),"columns",[{title:o.props.t("components.orderExportExcel.index"),dataIndex:"index",ellipsis:!0,width:"10%"},{title:o.props.t("products.title"),dataIndex:"product",ellipsis:!0,width:"15%"},{title:o.props.t("components.productComboDetail.productId"),dataIndex:"productId",width:"15%",ellipsis:!0},{title:o.props.t("components.purchaseSuggestion.intendedQuantity"),dataIndex:"quantity",align:"right",ellipsis:!0,width:"15%",render:function(e){var t=e.quantity,r=e.index;return vt(gt.default,{value:t,size:"small",currency:o.props.currentShop.currency,isMoney:!1,min:0,callBack:function(e){return o.handleInputNumberChange(r,e)}})}},{title:"",dataIndex:"delete",width:"4%",render:function(e){return vt(De.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){var t=o.state.purchaseBySale;t.items.length>0&&t.items.splice(e,1),o.setState({purchaseBySale:t})}})}}]),(0,_.Z)((0,f.Z)(o),"intendedColumn",[{title:o.props.t("components.orderExportExcel.index"),dataIndex:"index",ellipsis:!0,width:"10%"},{title:o.props.t("products.title"),dataIndex:"product",ellipsis:!0,width:"15%"},{title:o.props.t("components.productComboDetail.productId"),dataIndex:"productId",width:"15%",ellipsis:!0},{title:"",dataIndex:"delete",width:"4%",render:function(e){return vt(De.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){var t=o.state.purchaseBySale;t.items.length>0&&t.items.splice(e,1),o.setState({purchaseBySale:t})}})}}]),(0,_.Z)((0,f.Z)(o),"getData",(function(){return o.state.purchaseBySale.items.map((function(e,t){return{key:t,index:t+1,product:e.name,productId:e.custom_id||e.display_id,quantity:{quantity:e.quantity,index:t},delete:t}}))})),(0,_.Z)((0,f.Z)(o),"handleCreatePurchase",(function(){switch(o.state.activeKey){case"1":o.createPurchaseBySale();break;case"2":o.createPurchaseByRemain();break;case"3":o.createPurchaseBySellingStatus()}})),(0,_.Z)((0,f.Z)(o),"createPurchaseBySellingStatus",(function(){var e=o.state,t=e.selectedRowKeys,r=e.purchaseBySellingStatus.warehouse,a=E()(o.state.listSuggestionsBySellingStatus),n=St(St({},E()(Zt)),{},{warehouse:r}),s=((null===t||void 0===t?void 0:t.length)>0?a.filter((function(e){return t.includes(e.id)})):a).map((function(e){var t=o.renderNeedImportQuantity(e);return o.objectVariation(e,t)}));n.items=s,o.setState({purchaseDetailVisible:!0,selectedPurchase:n})})),(0,_.Z)((0,f.Z)(o),"objectVariation",(function(e,t){return{variation:St({},e),imported_price:(null===e||void 0===e?void 0:e.last_imported_price)||0,product_name:e.product.name,quantity:t,variation_id:e.id}})),(0,_.Z)((0,f.Z)(o),"createPurchaseByRemain",(function(){var e=o.props,t=e.shopId,r=e.accessToken,a=o.state.selectedRowKeys,n=E()(o.state.purchaseByRemain);switch(n.typePurchase){case"remain_quantity_max":n.sorter="ascend";break;case"remain_quantity_min":n.sorter="descend"}n.page=-1,n.selectedRowKeys=a;var s="".concat((0,le.LpH)(),"/shops/").concat(t,"/purchases/purchase_suggestion?access_token=").concat(r);$()({method:"get",url:s,params:n}).then((function(e){if(e.data.success){var t=St(St({},E()(Zt)),{},{warehouse:n.warehouse});e.data.data.reduce((function(e,r){var a=Math.abs(r.remain_quantity);n.pending_quantity&&(a-=r.pending_quantity||0),n.returning_quantity&&(a-=r.returning_quantity||0),a<0&&(a=0);var s=0;return 0==e?0:(e-a<0?(s=e,e=0):(s=a,e-=a),t.items.push(o.objectVariation(r,s)),e)}),n.quantity),o.setState({purchaseDetailVisible:!0,selectedPurchase:t})}}))})),(0,_.Z)((0,f.Z)(o),"createPurchaseBySale",(function(){var e=o.props,t=e.shopId,r=e.accessToken,a=e.currentShop,n=o.state.purchaseBySale,s=[];n.items.map((function(e){e.variations.map((function(e){return s.push(e.id)}))}));var c=St(St({success_status:1,success_record:"inserted_at",returned_record:"success_record"},a.overview_setting||{}),{},{since:n.start_time,until:n.end_time,split_by:["Variation.id"],select_fields:["product_count"],filter:{"Variation.id":s}});o.setState({loadingCreatePurchase:!0});var i="".concat((0,le.LpH)(),"/shops/").concat(t,"/analytics/sale?access_token=").concat(r);$().post(i,{params:c}).then((function(e){o.setState({loadingCreatePurchase:!1});var t=St(St({},E()(Zt)),{},{warehouse:n.warehouse});e.data.success&&(n.items.map((function(r){var a=r.variations.map((function(e){return e.id})),o=e.data.data.reduce((function(e,t){return a.includes(t["Variation.id"])?e+(t.success.product_count<0?0:t.success.product_count):e}),0);r.variations.map((function(a){var s,c,i=null===(s=e.data.data.find((function(e){return e["Variation.id"]==a.id})))||void 0===s||null===(c=s.success)||void 0===c?void 0:c.product_count;i=i<0?0:i;var u=(K()(n.end_time).unix()-K()(n.start_time).unix())/86400,p="default"==n.intendedDay?r.quantity:Math.round(o*n.dayQuantity/Math.round(u)),l=Math.floor(i*p/o),d=a.variations_warehouses.find((function(e){return e.warehouse_id==n.warehouse.id}));d&&(n.pending_quantity&&(l-=d.pending_quantity),n.returning_quantity&&(l-=d.returning_quantity),n.remain_quantity&&(l+=Math.abs(d.remain_quantity)),n.actual_remain_quantity&&(l-=d.actual_remain_quantity)),t.items.push({variation:St(St({},a),{},{product:St({},r)}),quantity:l,imported_price:0,variation_id:a.id,product_name:r.name})}))})),o.setState({purchaseDetailVisible:!0,selectedPurchase:t}))}))})),(0,_.Z)((0,f.Z)(o),"columnsSuggestion",(function(){var e=o.state.activeKey,t="2"==e?"purchaseByRemain":"purchaseBySellingStatus",r=[{title:o.props.t("products.title"),dataIndex:"name",ellipsis:!0},{title:o.props.t("components.productComboDetail.productId"),dataIndex:"product_id",ellipsis:!0},{title:o.props.t("components.productComboDetail.variationId"),dataIndex:"variation_id",ellipsis:!0},{title:o.props.t("components.productComboDetail.attributes"),dataIndex:"variation_fields",ellipsis:!0},{title:o.props.t("components.productComboDetail.importedPrice"),dataIndex:"last_imported_price",ellipsis:!0,align:"right"}];return o.state.purchaseByRemain.pending_quantity&&r.push({title:o.props.t("components.productPurchaseDetail.pendingQuantity"),dataIndex:"pending_quantity",ellipsis:!0,align:"right"}),o.state[t].returning_quantity&&r.push({title:o.props.t("components.productPurchaseDetail.returningQuantity"),dataIndex:"returning_quantity",ellipsis:!0,align:"right"}),"2"==e&&r.push({title:o.props.t("components.productPurchaseDetail.remain"),dataIndex:"remain_quantity",ellipsis:!0,align:"right",sorter:!0}),"3"==e&&r.push({title:o.props.t("pages.shop.product.management.sellingSpeed"),dataIndex:"selling_status",ellipsis:!0,align:"right"},{title:o.props.t("components.purchaseSuggestion.needImportQuantity"),dataIndex:"need_import_quantity",ellipsis:!0,align:"right",sorter:!0}),r})),(0,_.Z)((0,f.Z)(o),"renderNeedImportQuantity",(function(e){var t=o.state.purchaseBySellingStatus.returning_quantity,r=e.need_import_quantity;return t&&(r-=e.returning_quantity),r<0&&(r=0),r})),(0,_.Z)((0,f.Z)(o),"getDataSuggestion",(function(){var e=o.state,t=e.activeKey,r=e.textSearch,a=e.listSuggestions,n=e.listSuggestionsBySellingStatus,s=o.props.currentShop,c=a;return"3"==t&&(c=n),(c=c||[]).filter((function(e){var a,n,o;return"1"==t||!r||(0,le.st5)(r,(e.custom_id||"").toString())||(0,le.st5)(r,e.display_id.toString())||(0,le.st5)(r,((null===(a=e.product)||void 0===a?void 0:a.custom_id)||"").toString())||(0,le.st5)(r,null===(n=e.product)||void 0===n?void 0:n.display_id.toString())||(0,le.st5)(r,null===(o=e.product)||void 0===o?void 0:o.name.toString())})).map((function(e){var t=e.fields.map((function(e){return"".concat(e.name,": ").concat(e.value)})).join(", ");return{key:e.id,name:vt(d.default,{title:e.product.name,placement:"topLeft"},vt("span",null,e.product.name)),product_id:vt(d.default,{title:e.product.custom_id||e.product.display_id},vt("span",null,e.product.custom_id||e.product.display_id)),variation_id:vt(d.default,{title:e.custom_id||e.display_id},vt("span",null,e.custom_id||e.display_id)),variation_fields:vt(d.default,{title:t,placement:"topLeft"},vt("span",null,t)),last_imported_price:vt(d.default,{title:(0,le.ufS)(e.last_imported_price,s.currency),placement:"topLeft"},vt("span",null,(0,le.ufS)(e.last_imported_price,s.currency))),remain_quantity:vt(d.default,{title:(0,le.oH6)(e.remain_quantity,s.currency),placement:"topLeft"},vt("span",null,(0,le.oH6)(e.remain_quantity,s.currency))),pending_quantity:vt(d.default,{title:(0,le.oH6)(e.pending_quantity,s.currency),placement:"topLeft"},vt("span",null,(0,le.oH6)(e.pending_quantity,s.currency))),returning_quantity:vt(d.default,{title:(0,le.oH6)(e.returning_quantity,s.currency),placement:"topLeft"},vt("span",null,(0,le.oH6)(e.returning_quantity,s.currency))),need_import_quantity:vt(d.default,{title:(0,le.oH6)(o.renderNeedImportQuantity(e),s.currency),placement:"topLeft"},vt("span",null,(0,le.oH6)(o.renderNeedImportQuantity(e),s.currency))),selling_status:(0,yt.SZ)([e],!1,!1),action:e}}))})),(0,_.Z)((0,f.Z)(o),"handleOnChangeTypePurchase",(function(e){var t=E()(o.state.purchaseByRemain);t.typePurchase=e.target.value,o.setState({purchaseByRemain:t})})),(0,_.Z)((0,f.Z)(o),"onSearchVariation",(function(e){o.setState({textSearch:e})})),(0,_.Z)((0,f.Z)(o),"renderContent",(function(){var e,t=o.props,r=t.t,a=t.warehouses,s=t.currentShop,c=o.state,p=c.isLoadingSuggestion,l=c.selectedRowKeys,d=c.activeKey,h=c.listSuggestionsBySellingStatus,m=c.textSearch,f=a.map((function(e){var t=e.name,r=e.id;return vt(It,{key:r,value:r},t)})),g={selectedRowKeys:l,onChange:function(e){return o.setState({selectedRowKeys:e})}},y=St({},"2"==d?o.state.purchaseByRemain:o.state.purchaseBySellingStatus);return vt(F.Fragment,null,vt("div",{className:"content"},vt("div",{className:"content-info"},vt("div",{className:"info-item",style:{marginBottom:10}},vt("div",null,vt("div",{className:"header"},r("components.purchaseSuggestion.chooseWarehouse")),vt(P.default,{value:(null===(e=y.warehouse)||void 0===e?void 0:e.id)||void 0,placeholder:r("components.orderImportExcel.selectWarehouse"),onChange:o.onChangeWarehouse,dropdownClassName:"select-warehouse-dropdown",style:{width:"100%",marginBottom:10}},f)),"3"==d&&vt("div",{style:{marginBottom:10}},vt("div",{className:"header"},r("components.purchaseSuggestion.purchaseWarnRangeQuantity")),vt(gt.default,{style:{width:"100%"},isMoney:!1,min:0,currency:s.currency,suffix:"d",value:y.purchase_warn_range,callBack:function(e){return o.handleInputNumberChange(null,e)}})),"2"==d&&vt("div",{style:{marginBottom:10}},vt("div",{className:"header"},r("components.purchaseSuggestion.enterQuantity")),vt(gt.default,{value:y.quantity,currency:s.currency,isMoney:!1,min:0,style:{width:"100%"},callBack:function(e){return o.handleInputNumberChange(null,e)}})),"2"==d&&vt("div",{style:{width:"100%",marginBottom:10}},vt("div",{className:"header"},r("components.purchaseSuggestion.import")),vt(I.default.Group,{value:y.typePurchase,onChange:o.handleOnChangeTypePurchase},vt(I.default,{value:"remain_quantity_max"},r("components.purchaseSuggestion.prioritizeProductMissingLot")),vt(I.default,{value:"remain_quantity_min"},r("components.purchaseSuggestion.prioritizeProductMissingFew")))),vt("div",{style:{width:"100%",marginBottom:10}},vt("div",{className:"header"},r("components.purchaseSuggestion.additionalOptions")),vt("div",null,"2"==d&&vt(u.default,{checked:y.pending_quantity,onChange:function(e){return o.handleOnChangeCheckBoxPurchaseByRemain(e.target.checked,"pending_quantity")}},r("components.purchaseSuggestion.options1"),vt("br",null)),vt(u.default,{checked:y.returning_quantity,onChange:function(e){return o.handleOnChangeCheckBoxPurchaseByRemain(e.target.checked,"returning_quantity")}},r("components.purchaseSuggestion.options2")),vt("br",null)))),"3"==d&&vt("div",{className:"alert"},vt(J.default,{message:vt("b",null,r("components.purchaseSuggestion.needImportQuantity")," = ",o.props.t("components.purchaseSuggestion.calculationWarnRangeQuantity"))}))),vt("div",{className:"table-info"},"1"!=d&&vt("div",null,vt(i.default,{placeholder:r("components.productCreatorFirstStep.enterTheCodeSample"),style:{width:"100%",height:32,marginBottom:10},value:m,onChange:function(e){return o.onSearchVariation(e.target.value)},prefix:vt(mt.Z,null),allowClear:!0})),vt("div",{className:"table"},vt("div",{style:{width:"100%"}},vt(n.Z,{className:"table-container",columns:o.columnsSuggestion(),loading:p,dataSource:o.getDataSuggestion(),size:"small",pagination:"2"==d&&{size:"small",pageSize:y.page_size,total:y.total_entries||0,current:y.page,showSizeChanger:!1},scroll:{y:500},onChange:o.handleOnChangeTableSuggestion,rowSelection:g,footer:function(){if("3"==d&&null!==h&&void 0!==h&&h.length){var e=h.reduce((function(e,t){return e+=o.renderNeedImportQuantity(t)}),0);return vt("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},vt("b",null,r("components.purchaseSuggestion.selected"),": ",(null===l||void 0===l?void 0:l.length)>0?"".concat(l.length," ").concat(r("products.title")):r("commons.all")),vt("b",null,r("pages.shop.product.purchase.total"),": ",(0,le.ufS)(e)))}}})),l.length>0&&"2"==d&&vt("div",{style:{position:"absolute",bottom:5,left:20}},vt("b",null,r("components.purchaseSuggestion.selected"),": ",l.length," ",r("products.title")))))))})),(0,_.Z)((0,f.Z)(o),"handleOnChangeTableSuggestion",(function(e,t,r){var a=o.state.activeKey,n="3"==a?St({},o.state.purchaseBySellingStatus):St(St({},o.state.purchaseByRemain),{},{page:e.current}),s="3"==a?"purchaseBySellingStatus":"purchaseByRemain";o.setState((0,_.Z)({},s,n),(function(){o.state[s].warehouse_id&&o.handleFetchSuggestion(o.state[s].warehouse_id,r)}))})),(0,_.Z)((0,f.Z)(o),"handleFetchSuggestion",(function(e,t){var r=o.props,a=r.shopId,n=r.accessToken,s=o.state,c=s.activeKey,i=s.purchaseByRemain,u=s.purchaseBySellingStatus,p="3"==c?u:i;o.setState({isLoadingSuggestion:!0}),p.warehouse_id=e,null!==t&&void 0!==t&&t.order&&(p.sorter=t.order);var l=function(e){var t="".concat((0,le.LpH)(),"/shops/").concat(a,"/purchases/purchase_suggestion?access_token=").concat(n);return $()({method:"get",url:t,params:e}).then((function(t){var r;if(null!==t&&void 0!==t&&null!==(r=t.data)&&void 0!==r&&r.success)return"2"==c&&o.setState({listSuggestions:t.data.data||[],purchaseByRemain:St(St({},e),{},{total_entries:t.data.total_entries})}),t.data.data}))};"3"==c?o.props.fetchNeedPurchseQuantity(n,a,St(St({},p),{},{page:-1})).then((function(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.success){var r=e.data.data||[],a=r.map((function(e){return e.variation_id})),n=(0,le.F33)(a).map((function(e){return l(St(St({},p),{},{selectedRowKeys:e})).then((function(e){return e.map((function(e){var t=r.find((function(t){return t.variation_id==e.id}));return e.need_import_quantity=null!=(null===t||void 0===t?void 0:t.quantity)?t.quantity:0,e}))}))}));Promise.all(n).then((function(e){var t=e.map((function(e){switch(p.sorter){case"descend":return e.sort((function(e,t){return t.need_import_quantity-e.need_import_quantity}));case"ascend":return e.sort((function(e,t){return e.need_import_quantity-t.need_import_quantity}));default:return e}}));o.setState({listSuggestionsBySellingStatus:t.flat(),isLoadingSuggestion:!1})}))}else o.setState({isLoadingSuggestion:!1})})):l(p).then((function(){return o.setState({isLoadingSuggestion:!1})}))})),(0,_.Z)((0,f.Z)(o),"changeImportQuantity",(function(e){var t=o.state.purchaseBySale;t.intendedDay=e.target.value,o.setState({purchaseBySale:t})})),(0,_.Z)((0,f.Z)(o),"handleInputDayChange",(function(e){var t=o.state.purchaseBySale;t.dayQuantity=e||0,o.setState({purchaseBySale:t})})),(0,_.Z)((0,f.Z)(o),"renderContentBySale",(function(){var e,t,r,a=o.props,s=a.t,c=a.accessToken,i=a.shopId,p=a.warehouses,l=o.state,d=l.searchResult,h=l.purchaseBySale,m=l.loadingCreatePurchase,f=p.map((function(e){var t=e.name,r=e.id;return vt(It,{key:r,value:r},t)})),g="default"==h.intendedDay?o.columns:o.intendedColumn;return vt(F.Fragment,null,vt("div",{className:"alert"},vt(J.default,{message:vt("div",null,vt("div",null,vt("b",null,"- ",s("components.purchaseSuggestion.description1"))),vt("div",null,vt("b",null,"- ",s("components.purchaseSuggestion.description2"))))})),vt("div",{className:"content"},vt("div",{className:"content-info"},vt("div",{className:"info-item"},vt("div",null,vt("div",{className:"header"},s("components.purchaseSuggestion.chooseWarehouse")),vt(P.default,{value:(null===(e=h.warehouse)||void 0===e?void 0:e.id)||void 0,placeholder:s("components.orderImportExcel.selectWarehouse"),onChange:o.onChangeWarehouse,dropdownClassName:"select-warehouse-dropdown",style:{width:"100%",marginBottom:10}},f)),vt("div",null,vt("div",{className:"header"},s("components.purchaseSuggestion.statisticsDate")),vt(bt,{ranges:(t={},(0,_.Z)(t,s("pages.shop.product.inventoryHistory.yesterday"),[K()().add(-1,"days").startOf("day"),K()().add(-1,"days").endOf("day")]),(0,_.Z)(t,s("pages.shop.product.inventoryHistory.today"),[K()().startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.product.inventoryHistory.sevenDaysAgo"),[K()().add(-7,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.product.inventoryHistory.lastMonth"),[K()().add(-30,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.product.inventoryHistory.thisMonth"),[K()().startOf("month"),K()().endOf("month")]),t),format:"DD/MM/YYYY",style:{width:"100%",marginBottom:10},value:h.start_time&&h.end_time?[K()(h.start_time),K()(h.end_time)]:[],onChange:o.onChangeFilterDate})),vt("div",{style:{width:"100%",marginBottom:10}},vt("div",{className:"header"},s("components.purchaseSuggestion.enterIntendedQuantity")),vt(I.default.Group,{onChange:o.changeImportQuantity,value:h.intendedDay},vt(I.default,{value:"default"},s("components.purchaseSuggestion.default")),vt(I.default,{value:"byday"},s("components.purchaseSuggestion.byDay"))),"byday"==h.intendedDay&&vt("div",{style:{marginTop:5,display:"flex",justifyContent:"space-between",marginLeft:25}},vt("div",null,s("components.purchaseSuggestion.typeIntendDay"),":"),vt(gt.default,{value:h.dayQuantity?h.dayQuantity:0,size:"small",currency:o.props.currentShop.currency,isMoney:!1,min:0,callBack:function(e){return o.handleInputDayChange(e)},style:{width:110}}))),vt("div",{style:{width:"100%",marginBottom:10}},vt("div",{className:"header"},s("components.purchaseSuggestion.additionalOptions")),vt("div",null,vt(u.default,{checked:h.pending_quantity,onChange:function(e){return o.handleOnChangeCheckBox(e.target.checked,"pending_quantity")}},s("components.purchaseSuggestion.options1")),vt("br",null),vt(u.default,{checked:h.returning_quantity,onChange:function(e){return o.handleOnChangeCheckBox(e.target.checked,"returning_quantity")}},s("components.purchaseSuggestion.options2")),vt("br",null),vt(u.default,{checked:h.remain_quantity,onChange:function(e){return o.handleOnChangeCheckBox(e.target.checked,"remain_quantity")}},s("components.purchaseSuggestion.options3")),vt("br",null),vt(u.default,{checked:h.actual_remain_quantity,onChange:function(e){return o.handleOnChangeCheckBox(e.target.checked,"actual_remain_quantity")}},s("components.purchaseSuggestion.options4")),vt("br",null))))),vt("div",{className:"table-info"},vt("div",{style:{width:"100%"}},vt(ft.Z,{accessToken:c,searchResult:d,shopId:i,onSelect:o.handleSelectItem,callback:function(e){return o.setState({searchResult:e})},combo_by:"product",warehouse_id:null===(r=h.warehouse)||void 0===r?void 0:r.id}),vt(n.Z,{className:"table-container",columns:g,loading:m,dataSource:o.getData(),size:"small",pagination:!1,scroll:{y:500}})))))})),(0,_.Z)((0,f.Z)(o),"handleChangeTab",(function(e){o.setState({activeKey:e,selectedRowKeys:[]},(function(){return o.handleGetLocalStorage()}))})),o.state=St(St({},Ct),{},{purchaseBySellingStatus:St(St({},Ct.purchaseBySellingStatus),{},{purchase_warn_range:(null===(a=e.currentShop.settings)||void 0===a?void 0:a.purchase_warn_range)||0})}),o}return(0,m.Z)(r,[{key:"render",value:function(){var e,t=this,r=this.props,a=r.t,n=r.accessToken,s=r.shopId,c=r.isButton,i=r.title,u=this.state,p=u.isCreating,l=u.purchaseBySale,d=u.loadingCreatePurchase,h=u.purchaseDetailVisible,m=u.selectedPurchase,f=u.activeKey,g=u.purchaseByRemain,y="1"==f&&(!l.warehouse.id||!l.start_time||!l.end_time||d)||"2"==f&&!(null!==(e=g.warehouse)&&void 0!==e&&e.id);return vt("div",{style:{display:"inline"}},vt(pe.Z,{icon:vt(U.Z,null),tooltip:a("components.purchaseSuggestion.title"),title:i,onClick:function(){return t.handleOpenModal()},isButton:c}),p&&vt(x.Z,{className:"modal-detail purchase-suggestion",visible:p,width:"95%",title:vt(lt.default,{activeKey:f,onChange:this.handleChangeTab},vt(Et,{key:"1",tab:a("components.purchaseSuggestion.importBySaleRate")}),vt(Et,{key:"2",tab:a("components.purchaseSuggestion.importByMissingQuantity")}),vt(Et,{key:"3",tab:a("components.purchaseSuggestion.importBySellingStatus")})),onCancel:function(){return t.handleCancelModal()},footer:vt("div",null,vt(o.default,{disabled:y,type:"primary",onClick:function(){return t.handleCreatePurchase()}},a("components.purchaseSuggestion.createPurchase")))},"1"==f&&this.renderContentBySale(),"1"!=f&&this.renderContent(),vt(Ee.Z,{visible:h,close:function(){return t.handleCancelModal()},purchase:m,accessToken:n,shopId:s,supplier_products:[],isServer:this.props.isServer})),vt("style",{dangerouslySetInnerHTML:{__html:ht()}}))}}]),r}(F.Component))||ot,Ot=(0,se.$j)((function(e){return{currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone,warehouses:(0,fe.op)(e)}}),{fetchNeedPurchseQuantity:ue.sIh})(wt),kt=r(19925),Dt=r(4758),Rt=r(7859),Tt=r(41046),At=r(48519),Ft=r(7690),Nt=r(37508),Bt=r(43745),qt=r(24781),Mt=r(41850),jt=r(45812),Lt=r(43831),Ut=r(71586),zt=r(90798),Ht=F.createElement;function Yt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function Vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Yt(Object(r),!0).forEach((function(t){(0,_.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Kt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,a=(0,v.Z)(e);if(t){var n=(0,v.Z)(this).constructor;r=Reflect.construct(a,arguments,n)}else r=a.apply(this,arguments);return(0,y.Z)(this,r)}}var Wt=I.default.Group,$t=I.default.Button,Qt=P.default.Option,Gt=S.default.RangePicker,Jt=x.Z.confirm,Xt=[-1,0,1,2],er=["30","50","100"],tr={page:1,page_size:30,status:"-2"},rr="product-import-table",ar="lastUpdateAt",nr=["creator","warehouse","note","image","supplierProductsName","createdType","total","remain","totalPrice","transportFee","importAt","receivedAt","purchase_tag","totalPriceRemain","totalExport"],or=["creator","warehouse","note","supplierProductsName","createdType","total","remain","totalPrice","transportFee","importAt"],sr=[],cr=(0,he.Z)()(Pt=function(e){(0,g.Z)(r,e);var t=Kt(r);function r(e){var a;(0,h.Z)(this,r),a=t.call(this,e),(0,_.Z)((0,f.Z)(a),"fetchPurchases",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vt({},tr),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,n=a.props,o=n.accessToken,s=n.shopId,c=n.fetchPurchases,i=n.countersPurchase,u=n.fetchPurchaseAccessories,p=n.fetchGetTotalPriceRemain;r=r||a.state.type,e=Vt(Vt(Vt({},a.state.params),e),{},{type:r}),a.setState({params:e,isLoading:t}),p(o,s,e),"accessories"==r?u(o,s,e).then((function(){return a.setState({isLoading:!1})})):c(o,s,e).then((function(){return a.setState({isLoading:!1})})),i(o,s,e)})),(0,_.Z)((0,f.Z)(a),"purchaseTableHeighStyle",(function(e){return e?Ht(A.default,{id:"3930970936"},[".".concat(rr," .ant-table-body,.").concat(rr," .ant-table-body-inner{min-height:calc(100vh - 280px) !important;}")]):Ht(A.default,{id:"669365110"},[".".concat(rr," .ant-table-body,.").concat(rr," .ant-table-body-inner{max-height:calc(100vh - 246px) !important;min-height:calc(100vh - 246px) !important;}")])})),(0,_.Z)((0,f.Z)(a),"getColumns",(function(){var e=a.columns,t=a.props.currentShop?(0,At.zE)(a.props.currentShop.role):{};if(!(0,le.rqq)(1,a.props.currentShop)){var r=e.findIndex((function(e){return"type"==e.dataIndex}));r>-1&&e.splice(r,1)}if(!t.view_imported_price){var n=e.findIndex((function(e){return"totalPrice"==e.dataIndex}));n>-1&&e.splice(n,1)}return e})),(0,_.Z)((0,f.Z)(a),"columns",[{title:"ID",dataIndex:"id",width:"6%",ellipsis:!0,fixed:"left"},{title:a.props.t("pages.shop.product.purchase.creator"),dataIndex:"creator",ellipsis:!0},{title:a.props.t("warehouse"),dataIndex:"warehouse",ellipsis:!0},{title:a.props.t("note"),dataIndex:"note",ellipsis:!0},{title:a.props.t("defaultPrint.image"),dataIndex:"image",ellipsis:!0},{title:a.props.t("pages.shop.product.management.tag"),dataIndex:"purchase_tag",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.supplier"),dataIndex:"supplierProductsName",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.createdType"),dataIndex:"createdType",ellipsis:!0},{key:"total_quantity",title:a.props.t("pages.shop.product.purchase.totalQuantity"),dataIndex:"total",align:"right",ellipsis:!0},{key:"remain",title:a.props.t("pages.shop.product.purchase.remain"),dataIndex:"remain",align:"right",ellipsis:!0},{key:"total_price",title:a.props.t("pages.shop.product.purchase.totalPrice"),dataIndex:"totalPrice",align:"right",ellipsis:!0},{key:"total_price_remain",title:a.props.t("pages.shop.product.purchase.totalPriceRemain"),dataIndex:"totalPriceRemain",align:"right",ellipsis:!0},{key:"total_export",title:a.props.t("pages.shop.product.inventoryHistory.totalExport"),dataIndex:"totalExport",align:"right",ellipsis:!0},{key:"transport_fee",title:a.props.t("pages.shop.product.purchase.transportFee"),dataIndex:"transportFee",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.importAt"),dataIndex:"importAt",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.receivedAt"),dataIndex:"receivedAt",align:"right",ellipsis:!0},{title:a.props.t("pages.shop.product.purchase.lastUpdateAt"),dataIndex:ar,align:"right",ellipsis:!0,width:160}]),(0,_.Z)((0,f.Z)(a),"renderCreatorName",(function(e){var t=a.props,r=t.apiKeys,n=t.t,o=e.user_id&&r.find((function(t){return t.user_id==e.user_id}))?"Api":null;return e.user?e.user.name:o||n("pages.admin.system")})),(0,_.Z)((0,f.Z)(a),"getNameSupplierProducts",(function(e){var t=a.props.supplier_products;return t&&t.length>0&&e&&t.filter((function(t){return t.id==e})).length>0?t.filter((function(t){return t.id==e}))[0].name:""})),(0,_.Z)((0,f.Z)(a),"getPurchaseTags",(function(e){var t=(a.props.purchase_tags||[]).filter((function(t){return e.includes(t.id)})).map((function(e){return e.name})).join("; ");return Ht(d.default,{title:t},t)})),(0,_.Z)((0,f.Z)(a),"getTotalPriceRemain",(function(e,t){var r=e.reduce((function(e,t){return e+(((null===t||void 0===t?void 0:t.remain_quantity)||0)>0&&(null===t||void 0===t?void 0:t.remain_quantity)||0)*((null===t||void 0===t?void 0:t.imported_price)||0)}),0);return(0,le.ufS)(r,t)})),(0,_.Z)((0,f.Z)(a),"getData",(function(){var e=a.props,t=e.t,r=e.currentShop,n=e.purchases,o=e.warehouses,s=e.timezone;return!n||n&&0==n.data.length?[]:n.data.map((function(e){var n=o.find((function(t){return t.id==e.warehouse_id}))||{name:"Kho \u0111\xe3 x\xf3a"};return{key:e.display_id,id:Ht(d.default,{title:(0,le.pyT)(e.display_id,0)},(0,le.pyT)(e.display_id,0)),creator:e.user?Ht(ut.Z,{seed:(e.user||{}).id,avatar_url:e.user?e.user.avatar_url:null,id:e.user?e.user.fb_id:e.user_id||null,size:[20,20],style:{marginRight:5,float:"left"},name:a.renderCreatorName(e),showName:!0}):Ht("span",{style:{display:"flex",alignItems:"center"}},Ht(ut.Z,{id:null,size:[20,20],color:"#00707f",style:{marginRight:10},name:t("components.orderAdvanceFilter.system")}),Ht("span",null,t("pages.admin.system"))),warehouse:Ht(d.default,{title:null===n||void 0===n?void 0:n.name},null===n||void 0===n?void 0:n.name),note:Ht(d.default,{title:e.note},e.note),total:(0,le.oH6)((e.items||[]).reduce((function(e,t){return e+t.quantity}),0)||e.total_quantity||0,r.currency),remain:(0,le.oH6)((e.items||[]).reduce((function(e,t){return e+t.remain_quantity}),0)||e.total_remain_quantity||0,r.currency),importAt:(0,le.o0x)(s||7,e.inserted_at),receivedAt:e.received_at?(0,le.p6d)(e.received_at,a.props.timezone||7):"",lastUpdateAt:(0,le.o0x)(s||7,e.updated_at),action:e,totalPrice:(0,le.ufS)((e.items||[]).reduce((function(e,t){return e+t.quantity*((null===t||void 0===t?void 0:t.imported_price)||0)}),0)||(e.total_price||0)-(e.discount||0),r.currency),totalPriceRemain:(0,le.ufS)((e.items||[]).reduce((function(e,t){return e+t.remain_quantity*((null===t||void 0===t?void 0:t.imported_price)||0)}),0)||e.total_remain_price||0,r.currency),totalExport:(0,le.oH6)((e.items||[]).reduce((function(e,t){return e+(t.quantity-t.remain_quantity)}),0)||(e.total_quantity||0)-(e.total_remain_quantity||0),r.currency),supplierProductsName:Ht(d.default,{title:a.getNameSupplierProducts(e.supplier_products_id)},a.getNameSupplierProducts(e.supplier_products_id)),image:(0,yt.ip)(e.images||[]),purchase_tag:a.getPurchaseTags(e.tags||[]),transportFee:(0,le.ufS)(e.transport_fee,a.props.currentShop.currency),createdType:Ht(d.default,{title:(0,le.dou)(e.created_type)},(0,le.dou)(e.created_type))}}))})),(0,_.Z)((0,f.Z)(a),"getAccessoriesData",(function(){var e=a.props,t=e.purchase_accessories,r=e.currentShop;e.t;return!t||t&&0==t.data.length?[]:t.data.map((function(e){var t,n;return{key:e.id,id:e.id?Ht(d.default,{title:(0,le.pyT)(e.display_id,0)},(0,le.pyT)(e.display_id,0)):"",creator:e.user?Ht(ut.Z,{avatar_url:e.user.avatar_url,id:e.user.fb_id,size:[20,20],style:{marginRight:5,float:"left"},name:e.user.name,showName:!0}):Ht(l.default,{color:"#00707f"},a.props.t("pages.admin.system")),warehouse:Ht(d.default,{title:null===e||void 0===e||null===(t=e.warehouse)||void 0===t?void 0:t.name},null===e||void 0===e||null===(n=e.warehouse)||void 0===n?void 0:n.name),note:Ht(d.default,{title:e.note},e.note),total:e.accessories_items&&e.accessories_items.length>0?(0,le.oH6)(parseInt(1e3*e.accessories_items.reduce((function(e,t){return e+t.quantity}),0))/1e3,a.props.currentShop.currency):0,remain:e.accessories_items&&e.accessories_items.length>0?(0,le.oH6)(parseInt(1e3*e.accessories_items.reduce((function(e,t){return e+t.remain_quantity}),0))/1e3,a.props.currentShop.currency):0,totalPrice:e.accessories_items&&e.accessories_items.length>0?(0,le.ufS)(e.accessories_items.reduce((function(e,t){return e+t.quantity*((null===t||void 0===t?void 0:t.imported_price)||0)}),0),a.props.currentShop.currency):0,totalPriceRemain:e.accessories_items&&e.accessories_items.length>0?a.getTotalPriceRemain(e.accessories_items,r.currency):0,totalExport:e.accessories_items&&e.accessories_items.length>0?(0,le.oH6)(e.accessories_items.reduce((function(e,t){return e+(t.quantity-t.remain_quantity)}),0),r.currency):0,importAt:(0,le.o0x)(a.props.timezone||7,e.inserted_at),lastUpdateAt:(0,le.o0x)(a.props.timezone||7,e.updated_at),action:e,supplierProductsName:Ht(d.default,{title:a.getNameSupplierProducts(e.supplier_products_id)},a.getNameSupplierProducts(e.supplier_products_id)),image:(0,yt.ip)(e.images||[]),transportFee:(0,le.ufS)(e.transport_fee,a.props.currentShop.currency),purchase_tag:a.getPurchaseTags(e.tags||[])}}))})),(0,_.Z)((0,f.Z)(a),"handleRowClick",(function(e){var t=e.action;a.setState({modalDetailVisible:!0,selectedPurchase:t})})),(0,_.Z)((0,f.Z)(a),"handleTableChange",(function(e){var t=a.state,r=t.params,n=t.type;r.page=e.current,a.setState({pageSize:e.pageSize},(function(){localStorage.setItem("".concat(a.keyPurchasePageSize),e.pageSize),r.page_size=e.pageSize,a.fetchPurchases(r,!0,n)})),document.querySelector(".ant-table-body").scrollTop=0})),(0,_.Z)((0,f.Z)(a),"onChangeFilterByOrderPrice",(function(e){return a.setState({filterByOrderPrice:e})})),(0,_.Z)((0,f.Z)(a),"handleOnChangeOrderPrice",(function(e,t){if(""===e){var r=a.state.dataFilter.findIndex((function(e){return e.key==t}));a.handleCloseTag(r)}else{var n=parseInt(e)||0,o=a.state.filterByOrderPrice;a.onSelectMenuItem([t,[o,n]])}})),(0,_.Z)((0,f.Z)(a),"debounceHandleOnChangeOrderPrice",D()((function(e,t){return a.handleOnChangeOrderPrice(e,t)}),500)),(0,_.Z)((0,f.Z)(a),"handleShowDataFilter",(function(e,t){var r=a.props,n=r.t,o=r.supplier_products,s=r.warehouses,c=r.purchase_tags,i="",u="",p=["no_supplier","have_supplier","no_tag","no_categories"].includes(e.value);switch(e.key){case"creator_id":i=n("pages.shop.product.purchase.creator"),u="created_by_system"==e.value?n("pages.shop.product.purchase.createdBySystem"):"created_by_user"==e.value?n("pages.shop.product.purchase.createdByUser"):a.props.users.find((function(t){return t.user_id==e.value})).user.name;break;case"supplier_id":p?u="no_supplier"==e.value?n("pages.shop.product.purchase.noSupplier"):n("pages.shop.product.purchase.haveSupplier"):(i=n("pages.shop.product.purchase.supplierProduct"),u=(o.find((function(t){return t.id==e.value}))||{}).name);break;case"purchase_tags":p?u=n("crm.notTag"):(i=n("components.orderAdvanceFilter.tag"),u=((c||[]).find((function(t){return t.id==e.value}))||{}).name);break;case"category_id":var d,h=(0,Ut.bu)(a.props.categories);if(p)u=n("pages.shop.setting.warehouse.noCategories");else i=n("components.productCategory.categoryProduct"),u=null===(d=h.find((function(t){return t.id.toString()==e.value}))||{})||void 0===d?void 0:d.text;break;case"time":i=n("pages.shop.product.purchase.time");var m=(0,le.o0x)(a.props.timezone,e.value.startDate||"",!1,"DD/MM/YYYY"),f=(0,le.o0x)(a.props.timezone,e.value.endDate||"",!1,"DD/MM/YYYY");u="".concat(n("pages.shop.product.purchase.from")," ").concat(m," - ").concat(n("pages.shop.product.purchase.to")," ").concat(f);break;case"updated_at_status":if(null!=e.value.updateStatus){i=n("pages.shop.product.purchase.updatedAt");var g=(0,le.o0x)(a.props.timezone,e.value.startDateUpdatedAtStatus||"",!1,"DD/MM/YYYY"),y=(0,le.o0x)(a.props.timezone,e.value.endDateUpdatedAtStatus||"",!1,"DD/MM/YYYY");u="".concat(n("pages.shop.product.purchase.from")," ").concat(g," - ").concat(n("pages.shop.product.purchase.to")," ").concat(y)}break;case"received_at":if("object"==typeof e.value){i=n("pages.shop.product.purchase.receivedAt");var v=(0,le.o0x)(a.props.timezone,e.value.startDateReceive||"",!1,"DD/MM/YYYY"),_=(0,le.o0x)(a.props.timezone,e.value.endDateReceive||"",!1,"DD/MM/YYYY");u="".concat(n("pages.shop.product.purchase.from")," ").concat(v," - ").concat(n("pages.shop.product.purchase.to")," ").concat(_)}else"over_received_at"==e.value&&(i=n("pages.shop.product.purchase.overReceivedAt"),u=e.value);break;case"warehouse_id":i=n("pages.shop.setting.conditionWarehouse"),u=s.find((function(t){return t.id===e.value})).name;break;case"variation_id":i=n("pages.shop.statistic.variation"),u=e.value;break;case"accessories_variation_id":i=n("accessories"),u=e.value;break;case"product_id":i=n("products.title"),u=e.value;break;case"created_type":i=n("pages.shop.product.purchase.createdType"),u=(0,le.dou)(e.value);break;case"separate_by":i="T\xe1ch ho\u1eb7c li\xean quan phi\u1ebfu",u=null===e||void 0===e?void 0:e.value[0];break;case"payment_price":i=n("pages.shop.product.purchase.purchaseValue");var x="";switch(e.value[0]){case"greaterOrEqual":x=">=";break;case"smallerOrEqual":x="<=";break;case"equal":x="="}u="".concat(x," ").concat((0,le.ufS)(e.value[1]));break;case"item_price":i=n("pages.shop.product.purchase.importPrice");var S="";switch(e.value[0]){case"greaterOrEqual":S=">=";break;case"smallerOrEqual":S="<=";break;case"equal":S="="}u="".concat(S," ").concat((0,le.ufS)(e.value[1]))}var P=null!=e.value.updateStatus?(0,le.VCw)()[e.value.updateStatus]:null;return Ht(l.default,{key:"".concat(e.key,"_").concat(e.value,"}"),closable:!0,onClose:function(){return a.handleCloseTag(t)}},"over_received_at"==u?Ht("span",null,Ht("strong",null,i)):"updated_at_status"==e.key&&P?Ht("span",null,Ht("span",{style:{color:"".concat(P.bgColor)}},P.text),": ",Ht("strong",null,u)):Ht("span",null,p?null:"".concat(i,":")," ",Ht("strong",null,u)))})),(0,_.Z)((0,f.Z)(a),"renderStatus",(function(){var e=a.state,t=e.params,r=e.isLoading,n=e.type,o=a.props,s=o.purchases,c=o.t,i="accessories"==n?a.props.purchase_accessories.counters:s.counters,u=i&&i.length>0?i.reduce((function(e,t){return e+t.count}),0):0,p=function(e){var t=i&&i.length>0?i.find((function(t){return t.status==e})):0;return t?t.count:0},d=[{text:c("commons.all"),value:"-2",count:u},{text:c("tool.new"),value:-1,count:p(-1)},{text:c("tool.confirmed"),value:0,count:p(0)},{text:c("tool.importedGoods"),value:1,count:p(1)},{text:c("tool.canceled"),value:2,count:p(2)}];return Ht("div",{className:"status-dropdown"},Ht(Wt,{id:"status-group",onChange:function(e){return a.fetchPurchases({status:e.target.value},!0,n)},value:t.status},d.map((function(e){return Ht($t,{value:e.value,key:e.value},e.text,Ht(l.default,{key:e.value},r&&t.status==e.value?Ht(N.Z,null):e.count))}))))})),(0,_.Z)((0,f.Z)(a),"loopChildrenDelete",(function(e,t){var r=[];return e.map((function(e){!e.children.length||e.children.map((function(e){r.push(e)})),t.push(e.value)})),r.length>0?a.loopChildrenDelete(r,t):t})),(0,_.Z)((0,f.Z)(a),"getParamsCategories",(function(e,t){var r=a.state,n=r.dataFilter,o=r.params,s=r.isFilterCategoryByOr,c=[],i=o[e]||[];if(s){var u=n[t].value;(i=i.filter((function(e){return e!=u}))).map((function(e){var t=n.find((function(t){return t.value==e}));if(t){var r;c.push(e);var o=a.loopChildrenDelete((null===(r=t.info)||void 0===r?void 0:r.children)||[],[]);o&&o.length&&o.map((function(e){-1==c.findIndex((function(t){return t==e}))&&c.push(e)}))}}))}else c=c.concat(i);return c})),(0,_.Z)((0,f.Z)(a),"handleCloseTag",(function(e){var t=a.state,r=t.dataFilter,n=t.params,o=t.type,s=r[e].key;if(["supplier_id","purchase_tags"].includes(s))n[s]=n[s].filter((function(t){var a;return(null===(a=r[e])||void 0===a?void 0:a.value)!=t}));else if("category_id"==s){var c=a.getParamsCategories(s,e);c.length?n[s]=c:n=n[s]?T()(n,s):n}else n=n[s]?T()(n,s):n;"time"==s&&(n=T()(n,"startDate"),n=T()(n,"endDate")),"received_at"==s&&(n=T()(n,"startDateReceive"),n=T()(n,"endDateReceive")),"updated_at_status"==s&&(n=T()(n,"startDateUpdatedAtStatus"),n=T()(n,"endDateUpdatedAtStatus"),n=T()(n,"updateStatus")),r.splice(e,1),a.setState({dataFilter:r,params:n},(function(){a.fetchPurchases(a.state.params,!0,o)}))})),(0,_.Z)((0,f.Z)(a),"getTotalData",(function(e){var t=a.state.type,r={total_amount:0,total_quantity:0,total_remain_price:0};return!e||e&&0==e.length||("accessories"==t?e.forEach((function(e){return e.accessories_items&&e.accessories_items.forEach((function(e){return r.total_remain_price+=e.remain_quantity*((null===e||void 0===e?void 0:e.imported_price)||0),r.total_quantity+=e.quantity,r.total_amount+=e.quantity*((null===e||void 0===e?void 0:e.imported_price)||0)}))})):e.forEach((function(e){return r.total_remain_price+=e.total_remain_price,r.total_quantity+=e.total_quantity,r.total_amount+=e.total_price}))),r})),(0,_.Z)((0,f.Z)(a),"onSelectChange",(function(e,t){var r=a.state.type,n=a.props,o=n.purchases,s=n.purchase_accessories,c="accessories"==r?s:o,i="accessories"==r?"id":"display_id",u=t&&t.length>0?t:c.data,p=a.state,l=p.selectedPurchases,d=p.selectedRowKeys,h=l.concat(e.filter((function(e){return!d.includes(e)})).map((function(e){return u.find((function(t){return t[i]==e}))}))).filter((function(t){return e.includes(t[i])}));a.setState({selectedRowKeys:e,selectedPurchases:h})})),(0,_.Z)((0,f.Z)(a),"onChangeFilterDate",(function(e,t){var r=a.state,n=r.params,o=r.type,s=r.dataFilter,c=r.updateStatus,i=s.findIndex((function(e){return e.key==t}));if(e&&e.length>0){var u=e[0].startOf("day").unix(),p=e[1].endOf("day").unix(),l={key:t,value:"time"==t?{startDate:e[0].startOf("day"),endDate:e[1].endOf("day")}:"updated_at_status"==t?{startDateUpdatedAtStatus:e[0].startOf("day"),endDateUpdatedAtStatus:e[1].endOf("day"),updateStatus:c}:{startDateReceive:e[0].startOf("day"),endDateReceive:e[1].endOf("day")}};i>-1?s[i]=l:s.push(l),"time"==t?(n.startDate=u,n.endDate=p):"updated_at_status"==t?(n.startDateUpdatedAtStatus=u,n.endDateUpdatedAtStatus=p,n.updateStatus=c):(n.startDateReceive=u,n.endDateReceive=p,n.received_at&&(n.received_at="")),a.fetchPurchases(n,!0,o)}else{i>-1&&a.setState({dataFilter:s.splice(i,1)});var d=n;d="time"==t?(d=d.startDate?T()(d,"startDate"):d).endDate?T()(d,"endDate"):d:"updated_at_status"==t?(d=(d=d.startDateUpdatedAtStatus?T()(d,"startDateUpdatedAtStatus"):d).endDateUpdatedAtStatus?T()(d,"endDateUpdatedAtStatus"):d).updateStatus?T()(d,"updateStatus"):d:(d=(d=d.startDateReceive?T()(d,"startDateReceive"):d).endDateReceive?T()(d,"endDateReceive"):d).received_at?T()(d,"received_at"):d,a.setState({params:d},(function(){return a.fetchPurchases(d,!0,o)}))}(0,le.iAs)(t,"".concat(a.props.shopId,"_filter_purchase_source_count")),a.setState({dataFilter:s})})),(0,_.Z)((0,f.Z)(a),"handleClearFilter",(function(){a.setState({params:Vt(Vt({},tr),{},{page_size:a.state.pageSize}),dataFilter:[],type:"product",isFilter:!1,updateStatus:null},(function(){a.fetchPurchases(a.state.params,!0,a.state.type)}))})),(0,_.Z)((0,f.Z)(a),"handleClearSearch",(function(){a.state.type;a.setState({params:Vt(Vt({},tr),{},{page_size:a.state.pageSize})},(function(){a.fetchPurchases(a.state.params,!0,a.state.type)}))})),(0,_.Z)((0,f.Z)(a),"loopChildren",(function(e,t,r,n){var o=[];e.map((function(e){t.push(e.value),!e.children.length||e.children.map((function(e){o.push(e)}))})),o.length?a.loopChildren(o,t,r,n):a.onSelectMenuItem(r,t,n)})),(0,_.Z)((0,f.Z)(a),"onClickMenuItem",(function(e,t){if(1!=(null===t||void 0===t?void 0:t.length))if("category_id"==e[0]){var r=t.length-1;a.loopChildren(t[r].children,[],e,t[r])}else a.onSelectMenuItem(e)})),(0,_.Z)((0,f.Z)(a),"getValueCategoriesFilter",(function(e){var t=[];return e.map((function(e){if("category_id"==e.key){t.push(e.value);var r=(0,le.das)(e.info.children,[]);t=t.concat(r)}})),t})),(0,_.Z)((0,f.Z)(a),"onSelectMenuItem",(function(e,t,r){var n=a.state,o=n.params,s=n.type,c=n.filterExcludeSupplier,i=n.filterExcludeTag,u=n.isFilterTagByOr,p=n.isFilterCategoryByOr,l=n.filterExcludeCategory,d=a.state.dataFilter;t=e[e.length-1];var h=e[0],m=o;if("time"!=h&&"received_at"!=h&&"updated_at_status"!=h||"period"!=t&&"update_status"!=t){"over_received_at"==t&&(m=m.startDateReceive?T()(m,["startDateReceive","endDateReceive"]):m);var f=d.findIndex((function(e){return e.key==h})),g=d.find((function(e){return e.value==t}));switch(h){case"supplier_id":g||(d.find((function(e){return["no_supplier","have_supplier"].includes(e.value)}))&&(d=d.filter((function(e){return!["no_supplier","have_supplier"].includes(e.value)}))),["no_supplier","have_supplier"].includes(t)&&(d=d.filter((function(e){return"supplier_id"!=e.key}))),d.push({key:h,value:t})),m[h]=d.filter((function(e){return e.key==h})).map((function(e){return e.value})),m=c?Vt(Vt({},m),{},{filter_exclude_supplier:c}):m;break;case"purchase_tags":g||(d.find((function(e){return["no_tag"].includes(e.value)}))&&(d=d.filter((function(e){return!["no_tag"].includes(e.value)}))),["no_tag"].includes(t)&&(d=d.filter((function(e){return"purchase_tags"!=e.key}))),d.push({key:h,value:t})),m[h]=d.filter((function(e){return e.key==h})).map((function(e){return e.value})),m=u?Vt(Vt({},m),{},i?{is_filter_tag_by_or:u,filter_exclude_tag:i}:{is_filter_tag_by_or:u}):i?Vt(Vt({},m),{},{filter_exclude_tag:i}):m;break;case"category_id":if(!g){d.find((function(e){return["no_categories"].includes(e.value)}))&&(d=d.filter((function(e){return!["no_categories"].includes(e.value)}))),["no_categories"].includes(t)&&(d=d.filter((function(e){return e.key!=h}))),d.push({key:h,value:t,info:r});var y=(0,le.das)(r.children,[]),v=(0,le.Pwm)(d,t,"category_id");d=d.filter((function(e){return"category_id"!=e.key||!y.includes(e.value)&&!v.includes(e.value)&&"category_id"==e.key}))}m[h]=a.getValueCategoriesFilter(d),m=Vt(Vt({},m),{},{is_filter_category_by_or:p||void 0,filter_exclude_category:l||void 0});break;default:f>-1?d[f]={key:h,value:t}:d.push({key:h,value:t}),m[h]=t}(0,le.iAs)(h,"".concat(a.props.shopId,"_filter_purchase_source_count")),a.setState({params:m,dataFilter:d},(function(){return a.fetchPurchases(m,!0,s)}))}})),(0,_.Z)((0,f.Z)(a),"handleSelectVariation",(function(e){var t=a.state,r=t.params,n=t.searchResult,o=t.type,s=n.findIndex((function(t){return t.id==e})),c="accessories"==o?"".concat(n[s].accessories.name," (").concat(n[s].custom_id||n[s].display_id,")"):"".concat(n[s].product.name," (").concat(n[s].custom_id||n[s].display_id,")");"accessories"==o?r.accessories_variation_id=e:r.variation_id=e;var i="accessories"==a.state.type?"accessories_variation_id":"variation_id";a.handleSelectItem(c,r,i)})),(0,_.Z)((0,f.Z)(a),"handleSelectItem",(function(e,t,r){var n=a.state,o=n.type,s=n.dataFilter,c=s.findIndex((function(e){return e.key==r}));-1!=c?s[c].value=e:s.push({key:r,value:e}),a.fetchPurchases(t,!0,o),a.setState({productName:e,dataFilter:s,searchResult:[],searchResultProduct:[]})})),(0,_.Z)((0,f.Z)(a),"handleSelectProduct",(function(e){var t=a.state,r=t.params,n=t.searchResultProduct,o=(t.type,n.findIndex((function(t){return t.id==e}))),s="".concat(n[o].name," (").concat(n[o].custom_id||n[o].display_id,")");r.product_id=e,a.handleSelectItem(s,r,"product_id")})),(0,_.Z)((0,f.Z)(a),"handleSearchEmployee",(function(e,t){var r=e.target?e.target.value:e;a.props.pushUsersTextSearch(r,a.props.users,t,"purchaseFilter")})),(0,_.Z)((0,f.Z)(a),"handleSearchSupplier",(function(e,t){var r=a.props,n=r.pushSupplierTextSearch,o=r.supplier_products;n(e.target?e.target.value:e,o,t,"purchaseFilter")})),(0,_.Z)((0,f.Z)(a),"handleUpdateStatus",(function(e){var t=a.state,r=t.params;e!=t.updateStatus&&(r=T()(r,"startDateUpdatedAtStatus"),r=T()(r,"endDateUpdatedAtStatus"),r=T()(r,"updateStatus"),a.setState({updateStatus:e,params:r}))})),(0,_.Z)((0,f.Z)(a),"onChangeFilterAndOr",(function(e,t,r,n){var o=a.state,s=o.dataFilter,c=o.params,i=o.type,u=s.find((function(e){return e.key==n}));a.setState((0,_.Z)({},t,e),(function(){u&&a.fetchPurchases(Vt(Vt({},c),{},(0,_.Z)({},r,e)),!0,i)}))})),(0,_.Z)((0,f.Z)(a),"renderFilterAndOr",(function(e,t,r,n){var o=a.props.t;return Ht(Wt,{className:"radio-filter-order-tag",style:{marginLeft:15,marginTop:10},value:e,onChange:function(e){return a.onChangeFilterAndOr(e.target.value,t,r,n)}},Ht(p.default,{direction:"vertical"},Ht(I.default,{value:!0},o("components.orderAdvanceFilter.filterByConditionOr")),Ht(I.default,{value:!1},o("components.orderAdvanceFilter.filterByConditionAnd"))))})),(0,_.Z)((0,f.Z)(a),"handleChangeFilterExclude",(function(e,t,r,n){var o=a.state,s=o.dataFilter,c=o.params,i=o.type,u=s.find((function(e){return e.key==n}));a.setState((0,_.Z)({},t,e),(function(){u&&a.fetchPurchases(Vt(Vt({},c),{},(0,_.Z)({},r,e)),!0,i)}))})),(0,_.Z)((0,f.Z)(a),"renderFilterExclude",(function(e,t,r,n){var o=a.props.t;return Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(u.default,{style:{width:"100%"},checked:e,onChange:function(e){return a.handleChangeFilterExclude(e.target.checked,t,r,n)}},o("components.orderAdvanceFilter.filterExclude")))})),(0,_.Z)((0,f.Z)(a),"showOptionsFilter",(function(){var e,t,r,n=a.props,o=n.supplier_products,s=n.t,u=n.users,p=n.accessToken,l=n.shopId,d=n.warehouses,h=n.employeeList,m=n.purchase_tags,f=n.categories,g=a.state,y=g.params,v=g.type,x=g.searchResult,S=g.searchResultProduct,I=g.filterByOrderPrice,b=g.updateStatus,Z=g.filterExcludeSupplier,C=g.isFilterTagByOr,w=g.filterExcludeTag,O=g.filterExcludeCategory,k=g.isFilterCategoryByOr,D=g.dataFilter,R=h&&h.length?h.findIndex((function(e){return"supplier_id"==e.which&&"purchaseFilter"==e.type})):-1,T=-1==R?o:h[R].supplier,A=R>-1?h[R].text:void 0,F=T.map((function(e){return{value:e.id,label:e.name}})),N=d.map((function(e){return{value:e.id,label:e.name}})),B=h&&h.length?h.findIndex((function(e){return"creator_id"==e.which&&"purchaseFilter"==e.type})):-1,q=-1==B?u:h[B].users,M=B>-1?h[B].text:void 0,j=q.map((function(e){var t=e.user_id;return{value:t,label:(0,le.q$s)(t,q)}})),L=Ht(P.default,{onChange:a.onChangeFilterByOrderPrice,value:I,id:"orderPriceSelect"},Ht(Qt,{className:"orderPriceOpt",value:"greaterOrEqual",key:1},">="),Ht(Qt,{className:"orderPriceOpt",value:"smallerOrEqual",key:2},"<="),Ht(Qt,{className:"orderPriceOpt",value:"equal",key:3},"=")),U=[{label:Ht("div",{onClick:function(e){return e.stopPropagation()}},Ht("div",null,s("components.orderAdvanceFilter.filterMultipleTag")),a.renderFilterAndOr(C,"isFilterTagByOr","is_filter_tag_by_or","purchase_tags")),value:"is_filter_by_and_or"},{label:a.renderFilterExclude(w,"filterExcludeTag","filter_exclude_tag","purchase_tags"),disabled:!0,value:"filter_exclude_tag"},{label:s("crm.notTag"),value:"no_tag"}];m.map((function(e){U.push({value:e.id,label:e.name})}));var z=[{value:"purchase_tags",label:s("components.orderAdvanceFilter.tag"),children:U},{value:"category_id",label:s("pages.shop.product.management.filterByCategory"),children:[{value:"search",key:"search",disabled:!0,label:Ht(zt.Z,{handleTags:function(e,t){var r=E()(D);-1==r.findIndex((function(t){return t.key==e.key&&t.value==e.value}))&&(r.push(e),y.category_id=t,a.setState({dataFilter:r,params:y},(function(){a.fetchPurchases(a.state.params,!0,v)})))},tags:D,keyTagFilter:a.getValueCategoriesFilter(D),isType:"product"})},{label:Ht("div",{onClick:function(e){return e.stopPropagation()}},Ht("div",null,s("pages.shop.product.management.filterMultipleCategories")),a.renderFilterAndOr(k,"isFilterCategoryByOr","is_filter_category_by_or","category_id")),value:"is_filter_by_and_or"},{disabled:!0,label:a.renderFilterExclude(O,"filterExcludeCategory","filter_exclude_category","category_id"),value:"filter_exclude_categories"}].concat((0,yt.ux)(f,!0))},{value:"creator_id",label:s("pages.shop.product.purchase.creator"),children:[{value:100,label:Ht("div",{onClick:function(e){return e.stopPropagation()}},Ht(i.default,{onChange:function(e){return a.handleSearchEmployee(e,"creator_id")},value:M,placeholder:s("components.orderAdvanceFilter.enterEmployee"),allowClear:!0}))},{value:"created_by_user",label:Ht("div",null,s("pages.shop.product.purchase.createdByUser"))},{value:"created_by_system",label:Ht("div",null,s("pages.shop.product.purchase.createdBySystem"))}].concat(j)},{value:"time",label:s("pages.shop.product.purchase.time"),children:[{value:"period",label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(Gt,{ranges:(e={},(0,_.Z)(e,s("pages.shop.statistic.yesterday"),[K()().add(-1,"days").startOf("day"),K()().add(-1,"days").endOf("day")]),(0,_.Z)(e,s("pages.shop.statistic.today"),[K()().startOf("day"),K()().endOf("day")]),(0,_.Z)(e,s("pages.shop.statistic.lastWeek"),[K()().add(-7,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(e,s("pages.shop.statistic.lastMonth"),[K()().add(-30,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(e,s("pages.shop.statistic.thisMonth"),[K()().startOf("month").startOf("day"),K()().endOf("month").endOf("day")]),e),value:y&&y.endDate&&y.startDate?[K()(y.startDate,"X"),K()(y.endDate,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(e){return a.onChangeFilterDate(e,"time")}}))}]},{value:"updated_at_status",label:s("pages.shop.product.purchase.updatedAt"),children:[{value:"update_status",label:Ht("div",{style:{borderBottom:"1px dashed #aaa",paddingBottom:10},onClick:function(e){return e.stopPropagation()}},Ht(P.default,{style:{width:"50%"},onChange:function(e){return a.handleUpdateStatus(e)},value:b,placeholder:s("pages.shop.product.purchase.selectUpdateStatus"),allowClear:!0},Xt.map((function(e){var t=(0,le.VCw)()[e];return Ht(Qt,{key:e,value:e},t.text)}))))},{value:"period",label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(Gt,{ranges:(t={},(0,_.Z)(t,s("pages.shop.statistic.yesterday"),[K()().add(-1,"days").startOf("day"),K()().add(-1,"days").endOf("day")]),(0,_.Z)(t,s("pages.shop.statistic.today"),[K()().startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.statistic.lastWeek"),[K()().add(-7,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.statistic.lastMonth"),[K()().add(-30,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(t,s("pages.shop.statistic.thisMonth"),[K()().startOf("month").startOf("day"),K()().endOf("month").endOf("day")]),t),value:y&&y.endDateUpdatedAtStatus&&y.startDateUpdatedAtStatus?[K()(y.startDateUpdatedAtStatus,"X"),K()(y.endDateUpdatedAtStatus,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(e){return a.onChangeFilterDate(e,"updated_at_status")},disabled:null==b}))}]},{value:"received_at",label:s("pages.shop.product.purchase.receivedAt"),children:[{value:"over_received_at",label:Ht("div",{style:{marginLeft:5}},s("pages.shop.product.purchase.overReceivedAt"))},{value:null,label:Ht("div",{style:{borderBottom:"1px dashed #aaa"}}),disabled:!0},{value:"period",label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(Gt,{ranges:(r={},(0,_.Z)(r,s("pages.shop.statistic.yesterday"),[K()().add(-1,"days").startOf("day"),K()().add(-1,"days").endOf("day")]),(0,_.Z)(r,s("pages.shop.statistic.today"),[K()().startOf("day"),K()().endOf("day")]),(0,_.Z)(r,s("pages.shop.statistic.lastWeek"),[K()().add(-7,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(r,s("pages.shop.statistic.lastMonth"),[K()().add(-30,"days").startOf("day"),K()().endOf("day")]),(0,_.Z)(r,s("pages.shop.statistic.thisMonth"),[K()().startOf("month").startOf("day"),K()().endOf("month").endOf("day")]),r),value:y&&y.endDateReceive&&y.startDateReceive?[K()(y.startDateReceive,"X"),K()(y.endDateReceive,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(e){return a.onChangeFilterDate(e,"received_at")}}))}]},{value:"created_type",label:s("pages.shop.product.purchase.createdType"),children:[{value:"actual_purchase",label:Ht("div",null,s("pages.shop.product.purchase.actualPurchase"))},{value:"adjust_warehouse",label:Ht("div",null,s("pages.shop.product.purchase.adjustWarehouse"))},{value:"transfer_warehouse",label:Ht("div",null,s("pages.shop.product.purchase.transferWarehouse"))}]},{value:"warehouse_id",label:s("pages.shop.setting.conditionWarehouse"),children:N},{value:"variation",label:s("product"==v?"pages.shop.statistic.variation":"accessories"),children:[{disabled:!0,value:"product_accessories",label:"accessories"==v?Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(Dt.Z,{accessToken:p,className:"custom-search-bar",shopId:l,searchResult:x,style:{width:200},callback:function(e){return a.setState({searchResult:e})},filterProduct:!0,onSelect:a.handleSelectVariation})):Ht("div",{onClick:function(e){return e.stopPropagation()}},Ht(ft.Z,{className:"custom-search-bar",accessToken:p,shopId:l,searchResult:x,callback:function(e){return a.setState({searchResult:e})},is_filter:!0,searchOnly:!0,combo_by:"variation"}))}].concat((0,c.Z)(a.renderResult("variaion")))},{value:"payment_price",label:s("pages.shop.product.purchase.valueOfPurchase"),children:[{value:I,label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(i.default,{addonBefore:L,placeholder:s("pages.shop.product.purchase.enterValueOfPurchase"),onClick:function(e){return e.target.focus()},onChange:function(e){return a.debounceHandleOnChangeOrderPrice(e.target.value,"payment_price")}}))}]},{value:"item_price",label:s("pages.shop.product.purchase.importPrice"),children:[{value:I,label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(i.default,{addonBefore:L,placeholder:s("pages.shop.product.purchase.enterValueOfProduct"),onClick:function(e){return e.target.focus()},onChange:function(e){return a.debounceHandleOnChangeOrderPrice(e.target.value,"item_price")}}))}]}];if("product"==v&&z.push({value:"product",label:s("products.title"),children:[{disabled:!0,value:"product_search",label:Ht("span",{onClick:function(e){return e.stopPropagation()}},Ht(ft.Z,{className:"custom-search-bar",accessToken:p,shopId:l,searchResult:S,callback:function(e){return a.setState({searchResultProduct:e})},is_filter:!0,combo_by:"product",searchOnly:!0}))}].concat((0,c.Z)(a.renderResult("product")))}),z.push({value:"supplier_id",label:s("pages.shop.product.purchase.supplierProduct"),children:[{value:"search",disabled:!0,label:Ht("div",{onClick:function(e){return e.stopPropagation()}},Ht(i.default,{onChange:function(e){return a.handleSearchSupplier(e,"supplier_id")},value:A,placeholder:s("components.orderAdvanceFilter.enterSupplier"),allowClear:!0}))},{label:a.renderFilterExclude(Z,"filterExcludeSupplier","filter_exclude_supplier","supplier_id"),disabled:!0,value:"filter_exclude_supplier"},{value:"have_supplier",label:s("pages.shop.product.purchase.haveSupplier")},{value:"no_supplier",label:s("pages.shop.product.purchase.noSupplier")},{value:null,label:Ht("div",{style:{borderBottom:"1px dashed #aaa"}}),disabled:!0}].concat(F)}),"accessories"==v){var H=z.findIndex((function(e){return"received_at"==e.value}));z.splice(H,1);var Y=z.findIndex((function(e){return"updated_at_status"==e.value}));z.splice(Y,1);var V=z.findIndex((function(e){return"created_type"==e.value}));z.splice(V,1)}return(0,le.QIx)(z,"".concat(l,"_filter_purchase_source_count"))})),(0,_.Z)((0,f.Z)(a),"renderResult",(function(e){var t=a.state.type,r=a.props,n=r.t,o=r.currentShop,s=r.warehouses;return("accessories"==t?[]:"variaion"==e?a.state.searchResult:a.state.searchResultProduct).map((function(t,r){return{value:"variation-".concat(r),label:Ht("div",{onClick:function(r){r.stopPropagation(),"variaion"!=e?a.handleSelectProduct(t.id):a.handleSelectVariation(t.id)}},Ht(Nt.Z,{width:"variaion"!=e?300:448,t:n,key:r,currentShop:o,combo_by:"variaion"!=e?"product":"variation",item:t,warehouses:s}))}}))})),(0,_.Z)((0,f.Z)(a),"getInc",(function(){var e;return(null===(e=a.state.columnsWidth)||void 0===e?void 0:e.inc)||0})),(0,_.Z)((0,f.Z)(a),"onResize",(function(e,t){var r,n=a.state.columnsWidth;e==ar&&(t=a.getInc()+t-((null===(r=document.getElementsByClassName(e)[0])||void 0===r?void 0:r.offsetWidth)||0));n[e=e==ar?"inc":e]=t,a.setState({columnsWidth:n},(function(){localStorage.setItem("".concat(a.keyColumnWidth),JSON.stringify(n))}))})),(0,_.Z)((0,f.Z)(a),"setSelectPurchase",(function(){var e=a.props,t=e.shopId,r=e.t,n=JSON.parse(localStorage.getItem("product_purchase_shop_".concat(t)))||null;localStorage.getItem("product_purchase_shop_".concat(t))?Jt({title:r("pages.shop.product.purchase.alert"),content:r("pages.shop.product.purchase.contentPurchase"),okText:r("pages.shop.product.purchase.continous"),cancelText:r("pages.shop.product.purchase.delete"),onOk:function(){return a.setState({selectedPurchase:n,modalDetailVisible:!0})},onCancel:function(){a.setState({selectedPurchase:null,modalDetailVisible:!0}),localStorage.removeItem("product_purchase_shop_".concat(t))}}):a.setState({selectedPurchase:null,modalDetailVisible:!0})})),(0,_.Z)((0,f.Z)(a),"fetch",(function(e){var t=a.state.type;a.setState({params:e,isFilter:!0},(function(){return a.fetchPurchases(e,!0,t)}))})),(0,_.Z)((0,f.Z)(a),"renderTotalFooter",(function(){var e=a.props,t=e.totalData,r=e.currentShop,n=e.t,o=a.state,c=o.isLoading,i=o.selectedPurchases,u=r?(0,At.zE)(r.role):{},p=i.length>0?a.getTotalData(i):t;return Ht("div",{style:{position:"absolute",zIndex:100,left:10,bottom:10,display:"flex"}},Ht("div",{style:{display:"flex"}},u.view_imported_price&&Ht(F.Fragment,null,Ht("span",null,"".concat(n("pages.shop.product.purchase.totalPriceRemain"),":")),"\xa0",Ht("div",null,c?Ht(s.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Ht("div",{className:"purchase-total"},(0,le.ufS)(p.total_remain_price,r.currency))),"\xa0\xa0"),Ht("span",null,"".concat(n("pages.shop.product.purchase.totalProductsQuantity"),":")),"\xa0",Ht("div",null,c?Ht(s.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Ht("div",{className:"purchase-total"},(0,le.oH6)(p.total_quantity,r.currency))),"\xa0\xa0",u.view_imported_price&&Ht(F.Fragment,null,Ht("span",null,"".concat(n("pages.shop.product.purchase.totalProductsValue"),":")),"\xa0",Ht("div",null,c?Ht(s.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Ht("div",{className:"purchase-total"},(0,le.ufS)(p.total_amount,r.currency))))))})),(0,_.Z)((0,f.Z)(a),"renderSettingColumn",(function(e){var t=a.state.checkedListPurchase,r=a.props,n=r.t,o=(r.currentShop,a.columns.reduce((function(e,t){var r=t.dataIndex,a=t.title;return e[r]=a,e}),{})),s=nr.filter((function(e){return!t.includes(e)}));return Ht(Ae.Z,{defaultCheckedList:sr,onChange:function(e){return a.onChangeColumns(e)},translate:o,t:n,isIcon:!1,displayColumns:t,addOptionColumns:s,isButton:e,isTools:!0,title:n("pages.shop.setting.crmProfile.columnsSetting")})})),(0,_.Z)((0,f.Z)(a),"onChangeColumns",(function(e){a.setState({checkedListPurchase:e}),localStorage.setItem("".concat(a.keyColumn),JSON.stringify({checkedListPurchase:e}))})),(0,_.Z)((0,f.Z)(a),"handleCreateTagPurchase",(function(e){var t=a.props;return(0,t.createPurchaseTags)(t.accessToken,t.shopId,e=Vt(Vt({},e),{},{name:e.name}))})),(0,_.Z)((0,f.Z)(a),"handleUpdatePurchase",(function(e,t){var r=a.props;return(0,r.updatePurchaseTags)(r.accessToken,r.shopId,e=Vt(Vt({},e),{},{name:e.name}),t)})),(0,_.Z)((0,f.Z)(a),"getListActionTools",(function(){var e=a.state,t=e.params,r=e.selectedRowKeys,n=e.type,o=e.selectedPurchases,s=a.props,c=s.accessToken,i=s.shopId,u=s.t,p=s.currentShop,l=s.isServer,d=s.purchase_tags,h=s.supplier_products,m=p?(0,At.zE)(p.role):{};return[{icon:Ht(B.Z,null),title:u("pages.shop.statistic.inventory.exportExcel"),key:"export_excel",content:function(e){return Ht(it,{params:t,accessToken:c,shopId:i,selectedRowKeys:r,selectedPurchases:o,permissions:m.view_imported_price,title:u("pages.shop.statistic.inventory.exportExcel"),isButton:e,type:a.state.type})}},{icon:Ht(q.Z,null),title:u("pages.shop.actionTools.importExcel"),key:"import_excel",content:function(e){return Ht(Pe,{accessToken:c,shopId:i,type:n,isButton:e,title:u("pages.shop.actionTools.importExcel")})}},{icon:Ht(M.Z,null),title:"In phi\u1ebfu nh\u1eadp h\xe0ng",key:"purchase_transaction_printer",content:function(e){return Ht(pt.Z,{accessToken:c,shopId:i,selectedRowKeys:r,selectedData:o,printer:"purchase",permissions:m.view_imported_price,type:(0,le.rqq)(1,p)?a.state.type:"product",supplier_products:h||[],isButton:e})}},{icon:Ht(j.Z,null),title:u("pages.shop.actionTools.quickUpdate"),key:"quick_update",content:function(e){return Ht(Bt.Z,{shopId:i,accessToken:c,selectedRowKeys:r,clearSelectedKeys:function(){return a.setState({selectedRowKeys:[],selectedPurchases:[]})},selectedData:o,handleCallbackFetchData:function(){return a.fetchPurchases()},name:"accessories"==n?"purchase_accessories":"purchase",isButton:e,title:u("pages.shop.actionTools.quickUpdate")})}},{icon:Ht(L.Z,null),title:u("pages.shop.actionTools.productTag.productTag"),key:"product_tag",content:function(e){return Ht(Lt.Z,{keyView:"product",isButton:e,tags:d.map((function(e){return{name:e.name,id:e.id}})),title:u("pages.shop.product.purchase.purchaseTag"),deleteData:function(e){return a.handleUpdatePurchase(e,!0)},updateData:a.handleUpdatePurchase,createData:a.handleCreateTagPurchase})}},{icon:Ht(U.Z,null),title:u("components.productPurchaseDetail.purchaseSuggestion"),key:"purchase_suggestion",content:function(e){return Ht(Ot,{accessToken:c,shopId:i,isServer:l,isButton:e,title:u("components.productPurchaseDetail.purchaseSuggestion")})}},{icon:Ht(z.Z,null),title:u("pages.shop.setting.crmProfile.columnsSetting"),key:"setting_column",content:a.renderSettingColumn}]})),(0,_.Z)((0,f.Z)(a),"onSelectRow",(function(){var e=a.props,t=e.shopId,r=e.accessToken,n=a.state,o=n.params,s=n.type,c="accessories"==s?"".concat((0,le.LpH)(),"/shops/").concat(t,"/purchase_accessories?access_token=").concat(r):"".concat((0,le.LpH)(),"/shops/").concat(t,"/purchases?access_token=").concat(r),i="accessories"==s?"id":"display_id";a.setState({loadingData:!0});(function e(t){return $().get(c,{params:t}).then((function(r){var n=a.state,o=n.selectedRowKeys,s=n.loadingData,c=r.data.data,u=c.map((function(e){return e[i]})),p=o.filter((function(e){return!u.includes(e)})).concat(u);return s&&a.onSelectChange(p,c),(p||[]).length>=r.data.total_entries||0==c.length||!s?void 0:(t.page+=1,e(t))}))})(Vt(Vt({},o),{},{page:1})).then((function(e){return a.setState({loadingData:!1})}))})),(0,_.Z)((0,f.Z)(a),"parseTableKey",(function(e){switch(e){case"total_price":return"total_amount";case"remain":return"total_remain_quantity";case"total_price_remain":return"total_remain_price";case"transport_fee":return"total_transport_fee";default:return e}})),a.keyColumn="columnsPurchase".concat(e.params.type),a.keyColumnWidth="columnsWidthPurchase".concat(e.params.type),a.keyPurchasePageSize="purchasePageSize".concat(e.params.type);var n=e.isServer?or:localStorage.getItem("".concat(a.keyColumn))?JSON.parse(localStorage.getItem("".concat(a.keyColumn))).checkedListPurchase:or,o=e.isServer?{}:localStorage.getItem("".concat(a.keyColumnWidth))?JSON.parse(localStorage.getItem("".concat(a.keyColumnWidth))):{};return a.state={isLoading:!1,params:Vt({},e.params),modalDetailVisible:!1,selectedPurchase:null,selectedRowKeys:[],type:e.params.type,dataFilter:[],productName:"",searchResult:[],columnsWidth:o,pageSize:parseInt(localStorage.getItem("".concat(a.keyPurchasePageSize))||30),isFilter:!1,filterByOrderPrice:"greaterOrEqual",searchResultProduct:[],updateStatus:null,checkedListPurchase:n,loadingData:!1,selectedPurchases:[],filterExcludeSupplier:!1,filterExcludeTag:!1,isFilterTagByOr:!0,filterExcludeCategory:!1,isFilterCategoryByOr:!0},a}return(0,m.Z)(r,[{key:"componentDidMount",value:function(){var e=this,t=this.props.params;this.setState({params:t,type:t.type},(function(){var t=e.state,r=t.params,a=t.pageSize,n=t.type;if((0,le.oSE)(rr),e.props.isServer){var o=localStorage.getItem("".concat(e.keyColumn)),s=localStorage.getItem("".concat(e.keyColumnWidth));o&&e.setState({checkedListPurchase:JSON.parse(o).checkedListPurchase}),s&&e.setState({columnsWidth:JSON.parse(s)})}e.setState({searchResult:[],searchResultProduct:[]}),r.page_size=a,e.fetchPurchases(r,!0,n)}))}},{key:"componentDidUpdate",value:function(e,t){var r=this.props,a=r.params,n=r.tabKey;C()(e.params,a)||this.setState({params:a,type:a.type}),e.tabKey!=n&&"purchase"==n&&this.setState({isFilter:!1})}},{key:"render",value:function(){var e,t=this,r=this.state,a=r.params,s=r.isLoading,i=r.modalDetailVisible,u=r.selectedPurchase,p=r.selectedRowKeys,l=r.type,d=r.dataFilter,h=r.columnsWidth,m=r.pageSize,f=r.isFilter,g=r.checkedListPurchase,y=r.loadingData,v=this.props,_=v.purchases.total_entries,x=v.accessToken,S=v.shopId,P=v.t,I=v.currentShop,b=v.totalData,E=v.supplier_products,Z=v.tabKey,C={selectedRowKeys:p,onChange:function(e){return t.onSelectChange(e)},preserveSelectedRowKeys:!0,isSelection:!0,onSelectRow:this.onSelectRow},w=this.getColumns(),k=w.map((function(e){return h&&h[e.dataIndex]?e.width=h[e.dataIndex]:e.width=160,e}));k=g.map((function(e){return w.find((function(t){return t.dataIndex==e}))}));var D=[{dataIndex:"id",title:"ID",ellipsis:!0,fixed:"left",width:null===(e=w.filter((function(e){return"id"==e.dataIndex}))[0])||void 0===e?void 0:e.width}],R=[{title:P("pages.shop.product.purchase.lastUpdateAt"),dataIndex:ar,align:"right",ellipsis:!0,width:160}],T=[{dataIndex:"action",title:P("status"),align:"center",fixed:"right",width:130,render:function(e){return Ht(kt.Z,{purchase:e,accessToken:x,shopId:S,t:P,params:a})}}];k=(k=[].concat(D,(0,c.Z)(k),R,T)).filter((function(e){return e}));var A=(0,le.f2Q)(k,this.getInc());k.map((function(e){return e.dataIndex==ar&&e.width&&delete e.width,e})),k=k.map((function(e){return Vt(Vt({},e),{},{onHeaderCell:function(e){return{id:e.dataIndex,width:e.width,tableClassName:rr,onResize:t.onResize,isInc:e.dataIndex==ar}}})}));var F={header:{cell:Rt.Z}};return Ht("div",null,Ht("div",{className:"tools-container",style:{marginBottom:10}},Ht(Ie.Z,{icon:Ht(H.Z,null),color:"#096DD9",title:P("pages.shop.product.purchase.purchase"),onClick:function(){return t.setSelectPurchase()}}),Ht(pe.Z,{onClick:function(){return t.fetchPurchases(a,!0,l)},icon:Ht(Y.Z,null),disabled:s,title:P("pages.shop.orderControlInfo.sync"),isButton:!0}),["purchase","purchase_accessories"].includes(Z)&&Ht(qt.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(e){return e.key})),keyView:"purchase",subWidth:p.length>0||y?120:0}),Ht(jt.Z,{selectedLength:p.length,loadingData:y,total:_,onClick:function(){return t.setState({loadingData:!1,selectedRowKeys:[],selectedPurchases:[]})}}),Ht("div",{className:"filter"},["purchase","purchase_accessories"].includes(Z)&&Ht(Tt.Z,{params:a,shopId:S,accessToken:x,fetch:function(e){return t.fetch(e)},isFilter:f,type:"purchase"}),Ht("div",null,d&&d.length>0&&Ht(o.default,{danger:!0,onClick:function(){return t.handleClearFilter()}},P("pages.shop.statistic.customer.deleteFilter")),Ht(Ft.Z,{options:this.showOptionsFilter(),popupClassName:"cascader-filter-customer",onChange:this.onClickMenuItem,changeOnSelect:!0}))),d&&d.length>0&&Ht("div",{className:"tags-filter"},d.map(this.handleShowDataFilter))),this.renderStatus(),Ht(Mt.Z,{components:F,className:"".concat(rr," ").concat(s?"blur-when-loading":""),size:"small",dataSource:(0,le.rqq)(1,I)&&"accessories"==l?this.getAccessoriesData():this.getData(),columns:k,pagination:{size:"small",pageSize:m,total:"accessories"==l?this.props.purchase_accessories.total_entries:_,current:a.page,pageSizeOptions:er,showSizeChanger:!0},scroll:{x:A,y:d&&d.length>0?"calc(100vh - 280px)":"calc(100vh - 246px)"},onChange:this.handleTableChange,onRow:function(e){return{onClick:function(r){return t.handleRowClick(e)}}},rowSelection:C,rowClassName:function(e){var t,r,a;return(null===(t=e.action)||void 0===t?void 0:t.status)<1&&null!==(r=e.action)&&void 0!==r&&r.received_at&&K()(null===(a=e.action)||void 0===a?void 0:a.received_at)<K()()?"highlight-duplicated-customer":""},summary:function(){var e=O()(k,(function(e){return"left"==e.fixed}));return Ht(n.Z.Summary,{fixed:!0},Ht(n.Z.Summary.Row,null,[{title:"",dataIndex:"checkBox",fixed:"left"}].concat((0,c.Z)(k)).map((function(r,a){var o,s=a==e+1;if(s)o=P("crm.sum");else{o=null!==b&&void 0!==b&&b[t.parseTableKey(r.key)]?["total_price","transport_fee"].includes(r.key)?(0,le.ufS)(parseInt(b[t.parseTableKey(r.key)]),I.currency):(0,le.oH6)(parseInt(b[t.parseTableKey(r.key)])):""}return Ht(n.Z.Summary.Cell,{className:"ant-table-cell ant-table-cell-ellipsis",index:a,align:s?"right":r.align},Ht("span",{style:{fontWeight:"bolder",height:35}},o))}))))}}),this.renderTotalFooter(),Ht(Ee.Z,{visible:i,fetchPurchase:function(){return t.fetchPurchases(a,!0,l)},close:function(){return t.setState({modalDetailVisible:!1})},purchase:u,accessToken:x,shopId:S,isServer:this.props.isServer,params:a,supplier_products:E||[],onfilterPurchase:function(e){return t.onClickMenuItem(e)},showHistories:"product"==l,isAccessories:"accessories"==l}),s&&Ht(be.Z,null),this.purchaseTableHeighStyle((null===d||void 0===d?void 0:d.length)>0))}}]),r}(F.Component))||Pt,ir=(0,se.$j)((function(e){return Vt(Vt(Vt({timezone:e.navigation.user.timezone,user:e.navigation.user,users:e.user.users},(0,fe.$b)(e)),(0,fe.DJ)(e)),{},{totalData:e.product.total_price_remain||{},warehouses:e.warehouse.warehouses,employeeList:e.user.filterEmployeeList,apiKeys:e.user.apiKeys,purchase_tags:e.product.purchase_tags,categories:(0,fe.us)(e)})}),{fetchPurchases:ue.T0T,fetchPurchaseAccessories:ue.reP,fetchGetTotalPriceRemain:ue.eAQ,fetchListOfSupplierProducts:ue.fYC,countersPurchase:ue.u5D,pushUsersTextSearch:ue.mw6,fetchPrintBarcodes:ue.P3w,pushSupplierTextSearch:ue.ZrE,fetchMaterials:ue.A56,fetchPurchaseTags:ue.z4F,createPurchaseTags:ue.OWI,updatePurchaseTags:ue.jLf})(cr)}}]);