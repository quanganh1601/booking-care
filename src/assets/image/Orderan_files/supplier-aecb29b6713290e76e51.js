(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7057],{68442:function(e){!function(){"use strict";e.exports=".supplier-management .supplier-tab .ant-tabs-nav-wrap{line-height:2.3;border-left:1px solid #e8e5e5;padding-left:5px}.supplier-management .supplier-tab .ant-tabs-nav{border-bottom:unset;position:absolute;top:-54px;z-index:1000;width:100%}.supplier-management .supplier-tab .ant-tabs{overflow:visible}.supplier-management .supplier-tab .ant-upload-list{display:none}@media screen and (max-width: 780px){.supplier-management .supplier-table .ant-table-body{max-height:calc(100vh - 254px) !important;min-height:calc(100vh - 254px) !important}}.supplier-management .supplier-table .ant-table-body .ant-table-row{cursor:pointer !important}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row>td:last-child{padding:0}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row .ant-table-wrapper{background-color:transparent !important;border:0 !important}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row .ant-table{border:none;border-bottom:0 !important;position:relative;margin-left:40px !important}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row .ant-table .ant-table-body{min-height:auto !important;line-height:0}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row .ant-table .ant-table-body .ant-table-thead>tr>th{background:none;font-size:14px;height:36px}.supplier-management .supplier-table .ant-table-body .ant-table-expanded-row .ant-table .ant-table-body .ant-table-tbody>tr>td{padding:3px 8px;height:36px}.supplier-products-modal .ant-modal-content .ant-modal-header{border-bottom:none !important}"}()},77193:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Fe}});var r,o=n(10149),s=n(65400),i=n(59361),a=n(74047),p=n(52700),l=n(4706),c=n(33814),u=n(44102),d=n(20775),h=n(26265),f=n(64713),m=n(56697),g=n(18446),S=n.n(g),y=n(44908),v=n.n(y),b=n(45578),_=n.n(b),x=n(23279),Z=n.n(x),I=n(50361),w=n.n(I),k=n(65988),C=n(67294),T=n(14494),O=n(9669),E=n.n(O),N=n(95642),D=n(90631),R=n(84189),L=n(73171),A=n(24616),P=n(7085),z=n(25592),F=n(65644),j=n(31731),B=n(17567),M=n(74806),H=n(28465),K=n(4863),W=n(809),V=n.n(W),$=n(92447),X=n(79508),q=n(48176),J=n(7145),U=n.n(J),Q=n(36934),G=n(95213),Y=n(22318),ee=n(87217),te=n(78598),ne=C.createElement;function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var oe,se=["TEN_NCC"],ie=(0,ee.Z)()(r=function(e){(0,c.Z)(n,e);var t=re(n);function n(e){var r;return(0,a.Z)(this,n),r=t.call(this,e),(0,h.Z)((0,l.Z)(r),"handleCloseModal",(function(){r.setState({isShowResult:!1,modalVisible:!1,fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[],dataError:[],stop:!1}),r.props.callback()})),(0,h.Z)((0,l.Z)(r),"onDrop",(function(e){var t=e.file,n=r.props.t,o=new FileReader;o.readAsBinaryString(t),o.onload=function(e){var o=e.target.result,s=XLSX.read(o,{type:"binary"}),i=s.SheetNames[0],a=XLSX.utils.sheet_to_json(s.Sheets[i],{raw:!0});if(0!=a.length){var p=(0,G.wOl)(s.Sheets[i]),l=r.checkFields(p);0!=l.length?(Y.Z.error(n("error"),"".concat(n("components.orderImportExcel.fieldsNotFound"),": ").concat(l.join())),r.setState({productSupplierFile:[],fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[]})):r.setState({productSupplierFile:a,fileName:t.name,importedCount:0,disableImportBtn:!1,isImporting:!1})}else Y.Z.error(n("error"),n("components.productImportExcel.index.fileExcelEmpty")),r.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]})}})),(0,h.Z)((0,l.Z)(r),"checkFields",(function(e){return se.reduce((function(t,n){return-1==e.findIndex((function(e){return e==n}))&&t.push(n),t}),[])})),(0,h.Z)((0,l.Z)(r),"confirmImport",(function(){r.setState({isShowResult:!0,importedCount:0,disableImportBtn:!0,isImporting:!0},(function(){r.sendRequest(0)}))})),(0,h.Z)((0,l.Z)(r),"sendRequest",function(){var e=(0,$.Z)(V().mark((function e(t){var n,o,s,i,a,p,l,c,u,d,h,f,m,g,S,y,v,b,_;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.props,o=n.shopId,s=n.accessToken,i=n.t,n.createSupplierSuccess,n.updateSupplierSuccess,a=r.state,p=a.productSupplierFile,l=a.importedCount,c=a.isImporting,u=a.dataError,!(t>p.length-1)){e.next=5;break}return r.setState({stop:!0}),e.abrupt("return");case 5:if(d=p[t],h={line_number:t+2,index:d.STT,name:d.TEN_NCC,custom_id:d.MA_NCC,phone_number:d.SO_DIEN_THOAI,address:d.DIA_CHI,description:d.MO_TA},d.MA_NCC){e.next=10;break}return u.push(h),e.abrupt("return",r.sendRequest(t+1));case 10:if(f=r.validateFields(t,d),!f){e.next=20;break}return e.next=15,r.getSupplierNextLine([],t+1,1);case 15:return m=e.sent,g=m.count,r.setState(U()(r.state,{resultArr:{$push:[{message:f,success:!1}]},importedCount:{$set:l+g}})),u.push(h),e.abrupt("return",r.sendRequest(t+g));case 20:return S={custom_id:d.MA_NCC&&d.MA_NCC.toString(),name:d.TEN_NCC&&d.TEN_NCC.toString(),phone_number:d.SO_DIEN_THOAI&&d.SO_DIEN_THOAI.toString()||"",address:d.DIA_CHI&&d.DIA_CHI.toString()||"",description:d.MO_TA&&d.MO_TA.toString()||""},e.next=23,r.getSupplierNextLine([S],t+1,1);case 23:y=e.sent,v=y.count,b={supplier_products:{custom_id:d.MA_NCC&&d.MA_NCC.toString(),name:d.TEN_NCC&&d.TEN_NCC.toString(),phone_number:d.SO_DIEN_THOAI&&d.SO_DIEN_THOAI.toString()||"",address:d.DIA_CHI&&d.DIA_CHI.toString()||"",description:d.MO_TA&&d.MO_TA.toString()||"",is_import_excel:!0}},r.state.modalVisible&&c&&(_="".concat((0,G.LpH)(),"/shops/").concat(o,"/supplier/import?access_token=").concat(s),E().post(_,b).then((function(e){var n=e.data;return n.success?r.setState(U()(r.state,{resultArr:{$push:[{message:null,success:!0}]}})):(u.push(b),r.setState(U()(r.state,{resultArr:{$push:[{message:n.message,success:!1}]}}))),r.setState({importedCount:l+1}),r.sendRequest(t+v)})).catch((function(e){u.push(b),r.setState(U()(r.state,{resultArr:{$push:[{message:i("action.unknownError"),success:!1}]},importedCount:{$set:l+1}})),r.sendRequest(t+v)})));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,h.Z)((0,l.Z)(r),"getSupplierNextLine",(function(e,t,n){var o=r.state.productSupplierFile,s=o[t];if(t>o.length-1||s.STT||s.MO_TA)return{items:e,count:n};var i=r.validateFields(t,s);return i?(r.setState(U()(r.state,{resultArr:{$push:[{message:i,success:!1}]}})),r.getSupplierNextLine(e,t+1,n+1)):r.getSupplierNextLine(e,t+1,n+1)})),(0,h.Z)((0,l.Z)(r),"validateFields",(function(e,t){var n=r.props.t,o="L\u1ed7i \u1edf d\xf2ng ".concat(e+2,": ");return t.SO_DIEN_THOAI&&!t.SO_DIEN_THOAI.toString().match(/^\d+$/g)&&(o+=n("components.productImportExcel.index.phoneNumberInvalid")),o!="".concat(n("components.productImportExcel.index.errorNumber")," ").concat(e+2,": ")&&o})),(0,h.Z)((0,l.Z)(r),"renderError",(function(){return r.state.resultArr.map((function(e,t){var n=t+1;return e.success?void 0:ne("div",{key:t,style:{width:"100%",color:"red"}},ne("span",null," ",ne("strong",null,"#".concat(n))," "),"\xa0",ne("span",{className:"text-danger"}," ",e.message," "))}))})),(0,h.Z)((0,l.Z)(r),"renderSuccess",(function(){var e=r.state.resultArr,t=r.props.t;return e.map((function(e,n){var r=n+1;return e.success?ne("div",{key:n,style:{width:"100%",color:"green"}},ne("span",null," ",ne("strong",null,"#".concat(r))," "),"\xa0",ne("span",{className:"text-success"},t("success"))):void 0}))})),(0,h.Z)((0,l.Z)(r),"downloadListError",(function(){var e=r.state.dataError,t=[];e.map((function(e){t.push({STT:e.index||"",TEN_NCC:e.name||"",MA_NCC:e.custom_id,SO_DIEN_THOAI:e.phone_number||"",DIA_CHI:e.address||"",MO_TA:e.description||""})}));var n={SheetNames:[],Sheets:{}},o=XLSX.utils.json_to_sheet(t);t.length&&(o["!cols"]=Object.keys(t[0]).map((function(e){var t=e?10*e.toString().length:150;return{wpx:t>120?t:120}})));XLSX.utils.book_append_sheet(n,o,"DataSheet 1");var s=XLSX.write(n,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,te.saveAs)(new Blob([(0,G.$iI)(s)],{type:""}),"error_file.xlsx")})),(0,h.Z)((0,l.Z)(r),"renderListFileError",(function(){var e=r.props.t;return ne("div",null,ne("span",{style:{marginTop:10,fontSize:15}},"".concat(e("components.productSupplierImportExcel.downloadErrorListFile"),": ")),ne("strong",{style:{cursor:"pointer",color:"#003399",fontWeight:"bold"},onClick:function(){return r.downloadListError()}},ne(D.Z,null)," ",e("components.productSupplierImportExcel.here")))})),r.state={modalVisible:!1,fileName:"",productSupplierFile:[],disableImportBtn:!0,isShowResult:!1,isImporting:!1,resultArr:[],dataError:[],stop:!1},r}return(0,p.Z)(n,[{key:"render",value:function(){var e=this,t=this.props,n=(t.currentShop,t.t),r=t.title,o=t.isButton,i=this.state,a=i.modalVisible,p=i.fileName,l=i.importedCount,c=i.productSupplierFile,u=i.isImporting,d=i.disableImportBtn,h=i.resultArr,f=i.stop,g=h.filter((function(e){return e.success})).length,S=h.filter((function(e){return!e.success})).length,y=c.filter((function(e){return e.MA_NCC})).length||c.length;return ne("div",{style:{display:"inline"}},ne(j.Z,{icon:ne(R.Z,null),title:r,onClick:function(){return e.setState({modalVisible:!0})},isButton:o}),a&&ne(m.Z,{title:n("components.productSupplierImportExcel.importProductSupplierFromExcel"),footer:null,visible:a,onCancel:this.handleCloseModal},!u&&ne(K.default,{message:n("notes"),description:ne("div",null,ne("div",{style:{fontSize:14}},"- ",n("components.productSupplierImportExcel.note1")),ne("div",{style:{fontSize:14}},"- ",n("components.productSupplierImportExcel.note2")),ne("div",{style:{fontSize:14}},"- ",n("components.productSupplierImportExcel.writtenInTheCorrectFormat")," (",ne("a",{target:"_blank",href:"/static/files/import_supplier.xlsx"},n("components.productImportExcel.index.sampleFile")),")")),type:"warning",showIcon:!0}),u?null:ne("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},ne(H.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:this.onDrop},ne(s.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},p?ne("span",null,ne(X.Z,null),p):ne("span",null,ne(q.Z,null)," ",n("components.productSupplierImportExcel.chooseFile")))),ne(s.default,{type:"primary",onClick:this.confirmImport,disabled:d},n("components.productSupplierImportExcel.start"))),ne("div",null,l<=c.length&&u?ne("div",{style:{width:520,display:"flex",flexDirection:"column",alignItems:"center"}},ne(M.default,{type:"circle",percent:Math.floor(100*l/y),style:{marginBottom:10}})):null,u&&l>0&&l==c.filter((function(e){return void 0!=e.TEN_NCC})).length?ne("h4",{style:{textAlign:"center"}},ne("span",{style:{color:"#00a854"}},"".concat(n("components.productImportExcel.index.importSuccess")," ").concat(g," ").concat(n("components.productSupplierImportExcel.productSupplier"))),ne("span",{style:{color:"#f04134"}},"".concat(S>0?", ".concat(n("pages.admin.failure")," ").concat(S," ").concat(n("components.productSupplierImportExcel.productSupplier")):""))):null,u?ne("div",{style:{maxHeight:700,width:"100%",display:"flex",flexDirection:"column",border:"1px solid #d9d9d9",borderRadius:2,marginTop:10,padding:10,overflow:"auto"},id:"importing-info"},this.renderError(),this.renderSuccess()):null),ne("div",null,f?this.renderListFileError():"")))}}]),n}(C.Component))||r,ae=(0,T.$j)((function(e){return{currentShop:e.shop.currentShop}}),{createSupplierSuccess:Q.QkB,updateSupplierSuccess:Q.n9Z})(ie),pe=n(92902),le=n(68442),ce=n.n(le),ue=n(31432),de=n(49485),he=n(41046),fe=n(7859),me=n(62443),ge=C.createElement;function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){(0,h.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var be=(0,ee.Z)()(oe=function(e){(0,c.Z)(n,e);var t=ve(n);function n(e){var r;return(0,a.Z)(this,n),r=t.call(this,e),(0,h.Z)((0,l.Z)(r),"handleFetchData",(0,$.Z)(V().mark((function e(){var t,n,o,s,i,a,p,l;return V().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.setState({isDownloading:!0,suppliers:[]}),t=r.props,n=t.accessToken,o=t.shopId,t.t,s=t.selectedSuppliers,i={page:1,page_size:30},a=[],p="".concat((0,G.LpH)(),"/shops/").concat(o,"/export_suppliers?access_token=").concat(n),l=function e(t){return E().post(p,ye({},t)).then((function(n){if(n.data.success){var o=n.data.data;return a=a.concat(o),0==o.length||a.length>=n.data.total_entries?(r.setState({suppliers:a}),a.length==n.data.total_entries&&r.setState({isLoading:!1}),a):(t.page+=1,e(t))}return a})).catch(G.s0o)},s&&s.length>0?r.setState({suppliers:s,isDownloading:!1},(function(){return r.handleExportExcel()})):l(i).then((function(e){e?r.setState({suppliers:e,isDownloading:!1},(function(){return r.handleExportExcel()})):r.setState({isDownloading:!1})}));case 7:case"end":return e.stop()}}),e)})))),(0,h.Z)((0,l.Z)(r),"handleExportExcel",(function(){var e=r.state.suppliers,t=r.props.t,n=new ExcelJS.Workbook,o=n.addWorksheet("My Sheet");return o.columns=[{header:"STT",key:"stt",width:10},{header:[t("pages.shop.product.supplier.custom")],key:"id",width:20},{header:[t("pages.shop.product.supplier.name")],key:"name",width:20},{header:[t("crm.phone")],key:"phone_number",width:20},{header:[t("pages.shop.product.supplier.type")],key:"type",width:20},{header:[t("pages.shop.product.supplier.address")],key:"address",width:30},{header:[t("importTranslate.QUOC_GIA")],key:"country",width:20},{header:[t("pages.shop.product.supplier.supplierDescription")],key:"description",width:20}],e.map((function(e,n){o.addRow({stt:n+1,id:e.custom_id||"",name:e.name,phone_number:e.phone_number||"",type:0==e.type?t("pages.shop.product.supplier.supplierByProduct"):t("pages.shop.product.supplier.supplierByAccessories"),address:e.address||"",country:e.country_code?(0,G.bbV)(e.country_code.toString()):"",description:e.description||""})})),o.getRow(1).font={size:12,bold:!0},n.xlsx.writeBuffer().then((function(e){(0,te.saveAs)(new Blob([e],{type:"application/octet-stream"}),"suppliers.xlsx")}))})),(0,h.Z)((0,l.Z)(r),"content",(function(){var e=r.props,t=e.selectedRowKeys,n=e.t,o=r.state.isDownloading;return ge("div",null,ge(s.default,{type:"primary",style:{marginTop:10,borderRadius:2},icon:ge(o?P.Z:D.Z,null),onClick:r.handleFetchData,disabled:o},(null===t||void 0===t?void 0:t.length)>0?"".concat(n("pages.shop.product.export.download")," ").concat(t.length," ").concat(n("pages.shop.product.supplier.supplierProduct")):n("pages.shop.product.supplier.downloadAllSuppliers")))})),r.state={suppliers:[],isDownloading:!1},r}return(0,p.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.isButton,r=e.title;return ge("div",{style:{display:"inline-block"}},ge(me.default,{title:t("pages.shop.product.supplier.exportSupplierToExcel"),content:this.content(),trigger:"click"},ge(j.Z,{title:r,isButton:n,icon:ge(D.Z,null)})))}}]),n}(C.Component))||oe,_e=(0,T.$j)((function(e){return{currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone,warehouses:(0,ue.op)(e)}}),null)(be),xe=n(24781),Ze=n(41850),Ie=n(45812),we=n(43831),ke=n(7690),Ce=C.createElement;function Te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Te(Object(n),!0).forEach((function(t){(0,h.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,d.Z)(e);if(t){var o=(0,d.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var Ne=["30","50","100"],De={page:1,page_size:30},Re="supplier-table",Le="total_purchase",Ae=(m.Z.confirm,f.default.Group),Pe=f.default.Button,ze=function(e){(0,c.Z)(n,e);var t=Ee(n);function n(e){var r;(0,a.Z)(this,n),r=t.call(this,e),(0,h.Z)((0,l.Z)(r),"fetchListOfSupplierProducts",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Oe({},De),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=r.props,o=n.accessToken,s=n.shopId;r.setState({params:e,isLoading:t}),r.props.fetchSupplierCounter(o,s,e),r.props.fetchListOfSupplierProducts(o,s,e).then((function(){return r.setState({isLoading:!1})}))})),(0,h.Z)((0,l.Z)(r),"supplierTableHeighStyle",(function(e){return e?Ce(k.default,{id:"2720695105"},[".".concat(Re," .ant-table-body,.").concat(Re," .ant-table-body-inner{min-height:calc(100vh - 271px);}")]):Ce(k.default,{id:"3707216353"},[".".concat(Re," .ant-table-body,.").concat(Re," .ant-table-body-inner{min-height:calc(100vh - 233px);}")])})),(0,h.Z)((0,l.Z)(r),"handleSyncSupplierProduct",(function(){var e=r.state.params;r.setState({isLoading:!0,textSearch:""},(function(){return r.fetchListOfSupplierProducts(e)}))})),(0,h.Z)((0,l.Z)(r),"getData",(function(){var e=r.props,t=e.t,n=e.currentShop,o=r.props.supplier_products.data,s=[];return o&&o.length>0&&(s=o.filter((function(e){return(0,G.C6S)(r.state.textSearch,e.name)||(0,G.C6S)(r.state.textSearch,e.phone_number)})).map((function(e){return{key:e.id,nameSupplier:e.name,type:Ce(i.default,{color:1==e.type?"pink":"green"},1==e.type?t("pages.shop.product.supplier.accessories"):t("products.title")),phone_number:e.phone_number,address:e.address,description:e.description,debt_must_pay:(0,G.ufS)(e.debt_must_pay,n.currency),total_purchase:(0,G.ufS)(e.total_purchase,n.currency),country_code:e.country_code,province_id:e.province_id,district_id:e.district_id,commune_id:e.commune_id,custom_id:e.custom_id,action:e}}))),s})),(0,h.Z)((0,l.Z)(r),"handleRowClick",(function(e){var t={id:e.key,name:e.nameSupplier,address:e.address,description:e.description,phone_number:e.phone_number,country_code:e.country_code,province_id:e.province_id,district_id:e.district_id,commune_id:e.commune_id,custom_id:e.action.custom_id,type:e.action.type,is_activated:e.action.is_activated,tags:e.action.tags};r.setState({modalVisible:!0,selectedSupplier:t})})),(0,h.Z)((0,l.Z)(r),"clearFilter",(function(){r.setState({textSearch:"",params:Oe(Oe({},De),{},{page_size:r.state.pageSize}),isFilter:!1})})),(0,h.Z)((0,l.Z)(r),"columns",[{title:r.props.t("pages.shop.product.supplier.name"),dataIndex:"nameSupplier",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.custom"),dataIndex:"custom_id",align:"center",ellipsis:!0,sorter:!0},{title:r.props.t("pages.shop.product.supplier.type"),dataIndex:"type",align:"center",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.phone"),dataIndex:"phone_number",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.address"),dataIndex:"address",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.description"),dataIndex:"description",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.debtMustPay"),dataIndex:"debt_must_pay",align:"right",ellipsis:!0},{title:r.props.t("pages.shop.product.supplier.totalPurchase"),dataIndex:"total_purchase",align:"right",ellipsis:!0}]),(0,h.Z)((0,l.Z)(r),"handleDeleteSupplier",(function(){var e=r.props.t,t=r.state.selectedRowKeys;t.length&&m.Z.confirm({title:e("pages.shop.product.supplier.deleteSupplier"),content:"".concat(e("pages.shop.product.supplier.confirmDeleteSupplier")," ").concat(t.length," ").concat(e("pages.shop.product.supplier.supplierProduct")),okText:e("delete"),cancelText:e("cancel"),onOk:function(){var e=r.props,n=e.accessToken,o=e.shopId;(0,e.deleteSupplierProducts)(n,o,{supplier_product_ids:t}).then((function(){return r.setState({selectedRowKeys:[]})}))}})})),(0,h.Z)((0,l.Z)(r),"onSortFieldsProduct",(function(e,t){var n={asc_desc:"ascend"==t?"asc":"desc"};return n.sort_by=e,localStorage.setItem("sort_accessories",JSON.stringify(n)),n})),(0,h.Z)((0,l.Z)(r),"handleTableChange",(function(e,t,n){var o=r.state.params;if(o.page=e.current,0!=Object.keys(n).length&&n.order){var s=r.onSortFieldsProduct(n.field,n.order);o.data_sort=s}else localStorage.setItem("supplierPageSize",e.pageSize),o.page_size=e.pageSize,o.data_sort=null;r.setState({pageSize:e.pageSize},(function(){r.fetchListOfSupplierProducts(o)}))})),(0,h.Z)((0,l.Z)(r),"onChangeColumns",(function(e){-1!=e.findIndex((function(e){return"nameSupplier"==e}))&&-1!=e.findIndex((function(e){return"phone_number"==e}))&&(r.setState({checkedList:e}),localStorage.setItem("supplier-columns",JSON.stringify(e)))})),(0,h.Z)((0,l.Z)(r),"onResize",(function(e,t){var n,o=r.state.columnsWidth;e==Le&&(t=r.getInc()+t-((null===(n=document.getElementsByClassName(e)[0])||void 0===n?void 0:n.offsetWidth)||0));o[e=e==Le?"inc":e]=t,r.setState({columnsWidth:o},(function(){var n,s;"inc"==e&&t<=0&&((null===(n=document.getElementsByClassName("ant-table-body")[0])||void 0===n?void 0:n.scrollWidth)||0)<=((null===(s=document.getElementsByClassName("ant-table-body")[0])||void 0===s?void 0:s.offsetWidth)||0)&&(o[e]=0,r.setState({columnsWidth:o})),localStorage.setItem("columnsWidthSupplierProducts",JSON.stringify(o))}))})),(0,h.Z)((0,l.Z)(r),"getInc",(function(){var e;return(null===(e=r.state.columnsWidth)||void 0===e?void 0:e.inc)||0})),(0,h.Z)((0,l.Z)(r),"handleCreateSupplierTag",(function(e){var t=r.props,n=t.accessToken,o=t.shopId;return r.props.createSupplierTag(n,o,Oe(Oe({},e),{},{name:e.name}))})),(0,h.Z)((0,l.Z)(r),"handleUpdateSupplierTag",(function(e,t){var n=r.props,o=n.accessToken,s=n.shopId;return r.props.updateSupplierTag(o,s,Oe(Oe({},e),{},{name:e.name}),t)})),(0,h.Z)((0,l.Z)(r),"getListActionTools",(function(){var e=r.props,t=e.t,n=e.accessToken,o=e.shopId,s=e.supplier_tags,i=r.state,a=i.selectedRowKeys,p=i.params,l=i.checkedList,c=i.selectedSuppliers,u=(0,G.HUL)(r.columns),d=u.translate,h=u.allColumns;return[{icon:Ce(N.Z,null),title:t("pages.shop.actionTools.tag"),key:"supplier_tags",content:function(e){return Ce(we.Z,{keyView:"supplier",isButton:e,tags:s.map((function(e){return{name:e.name,id:e.id}})),title:t("pages.shop.actionTools.tag"),deleteData:function(e){return r.handleUpdateSupplierTag(e,!0)},updateData:r.handleUpdateSupplierTag,createData:r.handleCreateSupplierTag})}},{icon:Ce(D.Z,null),title:t("pages.shop.statistic.inventory.exportExcel"),key:"export_excel",content:function(e){return Ce(_e,{accessToken:n,shopId:o,params:p,selectedRowKeys:a,selectedSuppliers:c,isButton:e,title:t("pages.shop.statistic.inventory.exportExcel")})}},{icon:Ce(R.Z,null),title:t("pages.shop.actionTools.importExcel"),key:"import_excel",content:function(e){return Ce(ae,{accessToken:n,shopId:o,isButton:e,title:t("pages.shop.actionTools.importExcel"),callback:function(){return r.fetchSupplier(p)}})}},{icon:Ce(L.Z,null),title:t("pages.shop.actionTools.multiDelete"),key:"multi_delete",content:function(e){return Ce(j.Z,{icon:Ce(L.Z,null),title:t("pages.shop.actionTools.multiDelete"),onClick:r.handleDeleteSupplier,isButton:e})}},{icon:Ce(A.Z,null),title:t("pages.shop.setting.crmProfile.columnsSetting"),key:"setting_column",content:function(e){return Ce(de.Z,{t:t,defaultCheckedList:["nameSupplier","phone_number"],displayColumns:l,addOptionColumns:h.filter((function(e){return!l.includes(e)})),translate:d,onChange:r.onChangeColumns,title:t("pages.shop.setting.crmProfile.columnsSetting"),isButton:e,isTools:!0})}}]})),(0,h.Z)((0,l.Z)(r),"onSelectRow",(function(){var e=r.props,t=e.shopId,n=e.accessToken,o=r.state.params,s="".concat((0,G.LpH)(),"/shops/").concat(t,"/supplier?access_token=").concat(n);r.setState({loadingData:!0});(function e(t){return E().get(s,{params:t}).then((function(n){var o=r.state,s=o.loadingData,i=o.selectedRowKeys,a=n.data.data,p=a.map((function(e){return e.id})),l=i.filter((function(e){return!p.includes(e)})).concat(p);return s&&r.onChangeSelectRowKey(l,a),(l||[]).length>=n.data.total_entries||0==a.length||!s?void 0:(t.page+=1,e(t))}))})(Oe(Oe({},o),{},{page:1})).then((function(e){return r.setState({loadingData:!1})}))})),(0,h.Z)((0,l.Z)(r),"onChangeSelectRowKey",(function(e,t){var n=r.props.supplier_products,o=t&&t.length>0?t:(null===n||void 0===n?void 0:n.data)||[],s=r.state,i=s.selectedRowKeys,a=s.selectedSuppliers.concat(e.filter((function(e){return!i.includes(e)})).map((function(e){return o.find((function(t){return t.id==e}))}))).filter((function(t){return e.includes(t.id)}));r.setState({selectedRowKeys:e,selectedSuppliers:a})})),(0,h.Z)((0,l.Z)(r),"renderStatus",(function(){var e=r.state,t=e.params,n=e.isLoading,o=r.props,s=o.t,a=o.supplier_products.counters,p=(null===a||void 0===a?void 0:a.length)>0?a.reduce((function(e,t){return e+t.count}),0):0,l=function(e){return((null===a||void 0===a?void 0:a.length)>0?a.filter((function(t){return t.status==e})):[]).reduce((function(e,t){return e+t.count}),0)},c=[{text:s("commons.all"),value:-1,count:p},{text:s("pages.shop.product.management.active"),value:0,count:l(0)},{text:s("pages.shop.product.management.deactive"),value:1,count:l(1)}];return Ce("div",{className:"status-dropdown",style:{marginTop:10}},Ce(Ae,{id:"status-group",onChange:function(e){return r.fetchListOfSupplierProducts(Oe(Oe({},t),{},{status:e.target.value}))},value:null!=t.status?t.status:-1},c.map((function(e){return Ce(Pe,{value:e.value,key:e.value},e.text,Ce(i.default,{key:e.value},n&&t.status==e.value?Ce(P.Z,null):e.count))}))))})),(0,h.Z)((0,l.Z)(r),"handleDeleteFilter",(function(){S()(r.state.params,De)||r.setState({params:Oe({},De),filterTags:[]},(function(){r.fetchListOfSupplierProducts(r.state.params)}))})),(0,h.Z)((0,l.Z)(r),"getOptions",(function(){var e=r.props,t=e.t,n=e.supplier_tags,o=[];n.map((function(e){o.push({value:e.id,label:e.name})}));var s=[];return o.length>0&&s.push({value:"tags",label:t("pages.shop.actionTools.tag"),isRoot:!0,children:o}),s})),(0,h.Z)((0,l.Z)(r),"onCloseTag",(function(e){var t=r.state,n=t.filterTags,o=t.params,s=n[e],i=s.key;n.splice(e,1),o[i]=o[i].filter((function(e){return e!=s.value})),r.fetchListOfSupplierProducts(o),r.setState({filterTags:n})})),(0,h.Z)((0,l.Z)(r),"onClickMenuItem",(function(e){var t,n=r.state.params,o=w()(r.state.filterTags),s=e[1],i=e[0];if(s){var a={key:i,value:s};o.findIndex((function(e){return e.key==i&&e.value==s}))<0&&o.push(a),n[i]=(null===(t=n[i])||void 0===t?void 0:t.length)>0?n[i].concat(s):[s],r.fetchListOfSupplierProducts(Oe(Oe({},n),{},(0,h.Z)({},i,v()(n[i])))),r.setState({filterTags:o})}})),(0,h.Z)((0,l.Z)(r),"renderTag",(function(e,t){var n,o,s=r.props,a=s.t,p=s.supplier_tags;switch(e.key){case"tags":o=a("pages.shop.actionTools.tag");var l=p.find((function(t){return t.id==e.value}));n=(null===l||void 0===l?void 0:l.name)||""}return Ce(i.default,{key:"".concat(t,"_").concat(n),closable:!0,onClose:function(){return r.onCloseTag(t)}},Ce("span",{className:"content-tag"},o,": ",n))})),(0,h.Z)((0,l.Z)(r),"calcSupplierWhenSelectedRowKeys",Z()((function(){var e=r.state.selectedRowKeys,t=r.props.supplier_products,n=0,o=[];t.data.map((function(t){e.includes(t.id)&&o.push(t)})),_()(o,(function(e){return e.id})).map((function(t){e.includes(t.id)&&(n+=parseInt(t.debt_must_pay||"0"))})),r.aggsData={totalDebt:n},r.setState({isLoadingAggs:!1})}),800)),(0,h.Z)((0,l.Z)(r),"fetchSupplier",(function(e){r.setState({params:e,isFilter:!0,isLoading:!0},(function(){return r.fetchListOfSupplierProducts(e)}))})),(0,h.Z)((0,l.Z)(r),"onChangeTab",(function(e){r.setState({tab:e,params:Oe(Oe({},De),{},{page_size:r.state.pageSize}),isFilter:!1},(function(){r.fetchListOfSupplierProducts()}))}));var o=(0,G.VKr)(Oe(Oe({},e),{},{columns:r.columns,localKey:"supplier-columns"})),s=e.isServer?{}:localStorage.getItem("columnsWidthSupplierProducts")?JSON.parse(localStorage.getItem("columnsWidthSupplierProducts")):{};return r.state={params:Oe({},De),isLoading:!1,modalVisible:!1,selectedSupplier:{id:0,name:"",address:"",phone_number:"",description:"",country_code:"",province_id:"",district_id:"",commune_id:"",custom_id:"",is_activated:null,tags:[]},textSearch:"",selectedRowKeys:[],checkedList:o,pageSize:parseInt(localStorage.getItem("supplierPageSize")||30),isLoadingAggs:!1,isFilter:!1,tab:"info",columnsWidth:s,loadingData:!1,selectedSuppliers:[],filterTags:[]},r.aggsData={totalDebt:0},r}return(0,p.Z)(n,[{key:"componentDidMount",value:function(){if((0,G.oSE)(Re),this.props.isServer){var e=localStorage.getItem("columnsWidthSupplierProducts");e&&this.setState({columnsWidth:JSON.parse(e)})}var t=this.state,n=t.params,r=t.pageSize,o=localStorage.getItem("supplier-columns");o&&this.setState({checkedList:JSON.parse(o)}),n.page_size=r,this.fetchListOfSupplierProducts(n);var s=this.props,i=s.accessToken,a=s.shopId;(0,s.fetchSupplierTags)(i,a)}},{key:"componentWillUnmount",value:function(){var e=this.props,t=e.accessToken,n=e.shopId;this.props.fetchListOfSupplierProducts(t,n,{page:-1})}},{key:"renderInfoSupplierProduct",value:function(){var e=this,t=this.props,n=t.t,r=t.accessToken,o=t.shopId,i=t.supplier_products.total_entries,a=this.state,p=a.isLoading,l=a.modalVisible,c=a.selectedRowKeys,u=a.params,d=a.checkedList,h=a.pageSize,f=a.columnsWidth,m=a.loadingData,g=a.filterTags,S=d.map((function(t){return e.columns.find((function(e){return e.dataIndex==t}))}));S=S.map((function(e){return f&&f[e.dataIndex]?e.width=f[e.dataIndex]:e.width=160,e}));var y=(0,G.f2Q)(S,this.getInc());S=S.map((function(t){return Oe(Oe({},t),{},{onHeaderCell:function(n){return{id:n.dataIndex,width:n.width,tableClassName:Re,onResize:e.onResize,isInc:t.dataIndex==Le}}})}));var v={header:{cell:fe.Z}};return Ce(C.Fragment,null,Ce("div",{className:"tools-container"},Ce(B.Z,{currentShop:this.props.currentShop,accessToken:r,shopId:o,visible:l,setVisible:function(t){return e.setState({modalVisible:t})},selectedSupplier:this.state.selectedSupplier,setSelectedSupplier:function(t){return e.setState({selectedSupplier:t})}}),Ce(j.Z,{icon:Ce(z.Z,null),title:n("pages.shop.orderControlInfo.sync"),onClick:function(){return e.handleSyncSupplierProduct()},disabled:p,isButton:!0}),Ce(xe.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(e){return e.key})),keyView:"supplier"}),Ce(Ie.Z,{selectedLength:c.length,loadingData:m,total:i,onClick:function(){return e.setState({loadingData:!1,selectedRowKeys:[],selectedSuppliers:[]})}}),Ce("div",{className:"filter"},g.length>0&&Ce(s.default,{danger:!0,onClick:function(){return e.handleDeleteFilter()}},n("pages.shop.statistic.customer.deleteFilter")),Ce(ke.Z,{options:this.getOptions(),popupClassName:"cascader-filter-customer",onChange:this.onClickMenuItem})),g&&g.length>0&&Ce("div",{className:"tags-filter"},g.map(this.renderTag))),this.renderStatus(),Ce(Ze.Z,{components:v,className:"".concat(Re," ").concat(this.state.isLoading?"blur-when-loading":""),columns:S,size:"small",scroll:{x:y,y:(null===g||void 0===g?void 0:g.length)>0?"calc(100vh - 271px)":"calc(100vh - 233px)"},dataSource:this.getData(),onRow:function(t){return{onClick:function(n){return e.handleRowClick(t)}}},onChange:this.handleTableChange,pagination:{size:"small",pageSize:h,total:i,current:u.page,pageSizeOptions:Ne,showSizeChanger:!0},rowSelection:{selectedRowKeys:c,onChange:function(t){e.onChangeSelectRowKey(t),e.calcSupplierWhenSelectedRowKeys()},isSelection:!0,onSelectRow:this.onSelectRow,preserveSelectedRowKeys:!0}}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.t,r=t.currentShop,s=t.supplier_products,i=t.shopId,a=t.accessToken,p=this.state,l=p.isLoading,c=p.isLoadingAggs,u=p.selectedRowKeys,d=p.isFilter,h=p.params,f=p.filterTags,m=this.aggsData.totalDebt,g=u.length>0?{color:"#096dd9"}:{},S=s.total_debt||0;return Ce(F.Z,{className:"supplier-management",style:{overflow:"visible"}},this.renderInfoSupplierProduct(),Ce("div",{className:"filter"},Ce(he.Z,{params:h,shopId:i,accessToken:a,fetch:function(t){return e.fetchSupplier(t)},isFilter:d,type:"supplier"})),Ce("div",{style:{position:"absolute",zIndex:100,left:10,bottom:16,display:"flex"}},Ce("div",{style:{display:"flex",alignItems:"center"}},Ce("div",{style:{marginRight:5}},n("pages.shop.product.supplier.totalDebt"),":")," ",l||c?Ce(o.default,{className:"skeleton-small",active:!0,title:!1,paragraph:{rows:1,width:100}}):Ce("b",{style:g},(0,G.ufS)(u.length>0?m:S,r.currency)))),this.supplierTableHeighStyle((null===f||void 0===f?void 0:f.length)>0))}}]),n}(C.Component);(0,h.Z)(ze,"pageInfo",{title:"pages.shop.product.supplier.title",sassStyle:ce()});var Fe=(0,T.$j)((function(e){return Oe({},(0,ue.zN)(e))}),{fetchListOfSupplierProducts:Q.fYC,createSupplierProduct:Q.qkV,deleteSupplierProducts:Q.MtH,fetchSupplierCounter:Q.ba7,fetchSupplierTags:Q.ATc,createSupplierTag:Q.LvB,updateSupplierTag:Q.$Wc})((0,pe.Z)(ze))},90559:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shop/product/supplier",function(){return n(77193)}])}},function(e){e.O(0,[5460,5074,6977,3924,2902,4517,2653,3177,517,532,9648,9774,2888,179],(function(){return t=90559,e(e.s=t);var t}));var t=e.O();_N_E=t}]);