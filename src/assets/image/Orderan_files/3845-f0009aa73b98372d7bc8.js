(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3845],{12797:function(t){!function(){"use strict";t.exports=".ant-popover-placement-bottomLeft{width:60%}.modal-missing-product .ant-modal-footer .ant-btn{border-radius:2px}.input-warning{border-color:#f5222d !important;box-shadow:none}.input-warning:focus{box-shadow:none}"}()},3845:function(t,e,a){"use strict";a.d(e,{Z:function(){return Pt}});var n,i=a(65400),o=a(31059),r=a(4863),s=a(2307),c=a(64713),u=a(71535),l=a(14321),d=a(59361),p=a(809),h=a.n(p),g=a(28140),f=a(92447),k=a(56697),_=a(94055),y=a(74047),v=a(52700),m=a(4706),b=a(33814),S=a(44102),w=a(20775),I=a(26265),Z=a(20838),x=a(51024),q=a(64749),C=a(23279),P=a.n(C),N=a(50361),O=a.n(N),D=a(67294),L=a(14494),R=a(73218),B=a(21796),E=a(90631),A=a(34707),T=a(7085),j=a(92104),z=a(30381),Q=a.n(z),M=a(87217),F=a(97705),W=a(12797),H=a.n(W),K=a(31432),V=a(36934),Y=a(95213),J=a(20920),U=a(9051),$=a(7463),G=a(22318),X=a(9669),tt=a.n(X),et=a(17918),at=a(74806),nt=a(83049),it=D.createElement;function ot(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function rt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?ot(Object(a),!0).forEach((function(e){(0,I.Z)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ot(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function st(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=(0,w.Z)(t);if(e){var i=(0,w.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,S.Z)(this,a)}}var ct,ut={page:1,page_size:20,actualQuantity:{type:"greaterOrEqual",value:1,warehouseId:"all"}},lt=(0,M.Z)()(n=function(t){(0,b.Z)(a,t);var e=st(a);function a(t){var n;return(0,y.Z)(this,a),n=e.call(this,t),(0,I.Z)((0,m.Z)(n),"fetchListProducts",(function(){n.setState({isLoading:!0});var t=n.props,e=t.currentShop,a=t.accessToken,i=n.state.params,o="".concat((0,Y.LpH)(),"/shops/").concat(e.id,"/products/not_stocktaking?access_token=").concat(a);tt()({method:"post",url:o,data:i}).then((function(t){n.setState({data:{data:t.data.data,total_entries:t.data.total_entries,page:t.data.page_number},isLoading:!1})}))})),(0,I.Z)((0,m.Z)(n),"handleAddVariation",(function(){var t=n.state.selectedRowKeys,e=n.props,a=e.currentShop,i=e.accessToken,o=e.warehouse_id,r=e.items,s=e.stocktaking;n.setState({isFilling:!0});var c=rt(rt({},ut),{},{page_size:100,shop_id:a.id,warehouse:o,item_ignore:r.map((function(t){return t.variation_id})),stocktaking_by:s.stocktaking_by,stocktaking_by_value:s.stocktaking_by_value});t.length>0&&(c=rt(rt({},c),{},{variation_ids:t}));var u="".concat((0,Y.LpH)(),"/shops/").concat(a.id,"/products/not_stocktaking?access_token=").concat(i),l=[];(function t(e){var a=O()(e);return tt().post(u,a).then((function(a){var i=a.data.data;return n.props.callbackFillItem(i),l=l.concat(i),n.setState({currentData:l.length,totalEntriesFill:a.data.total_entries}),0==i.length||l.length>=a.data.total_entries?l:(e.page=e.page+1,t(e))}))})(c).then((function(t){var e=O()(n.state.params);e.item_ignore=e.item_ignore.concat(t.map((function(t){return t.id}))),n.setState({isFilling:!1,params:e,selectedRowKeys:[]},(function(){n.fetchListProducts(e)}))}))})),(0,I.Z)((0,m.Z)(n),"handleTableChange",(function(t){var e=n.state.params;e.page=t.current,e.page_size=t.pageSize,n.setState({params:e,pageSize:t.pageSize},(function(){localStorage.setItem("listProductNotStocktaking",t.pageSize),n.fetchListProducts()}))})),(0,I.Z)((0,m.Z)(n),"onCancel",(function(){if(n.state.isFilling)return!1;n.props.close()})),(0,I.Z)((0,m.Z)(n),"columns",[{title:n.props.t("pages.shop.product.stocktaking.productId"),dataIndex:"product_id",ellipsis:!0,width:"17%"},{title:n.props.t("pages.shop.product.stocktaking.productName"),dataIndex:"name",ellipsis:!0,width:"17%"},{title:n.props.t("pages.shop.product.stocktaking.variationId"),dataIndex:"variation_id",ellipsis:!0,width:"17%"},{title:n.props.t("pages.shop.product.stocktaking.variationInfo"),dataIndex:"variation_info",ellipsis:!0},{title:n.props.t("pages.shop.product.stocktaking.actual"),dataIndex:"actual_remain_quantity",align:"right",ellipsis:!0,width:"17%"}]),(0,I.Z)((0,m.Z)(n),"getData",(function(){return n.state.data.data.map((function(t){var e=t.variations_warehouses.find((function(t){return t.warehouse_id==n.props.warehouse_id}));return{key:t.id,product_id:t.product.custom_id||t.product.display_id,name:t.product.name,variation_id:t.custom_id||t.display_id,variation_info:n.renderInfo(t.fields),actual_remain_quantity:(null===e||void 0===e?void 0:e.actual_remain_quantity)||0}}))})),(0,I.Z)((0,m.Z)(n),"renderInfo",(function(t){return t.map((function(t){return it("span",{key:t.name},it("strong",{style:{color:"#005667"}},t.name,":")," ",it("i",{style:{marginRight:4}},t.value))}))})),n.state={params:rt(rt({},ut),{},{shop_id:t.currentShop.id,warehouse:t.warehouse_id,item_ignore:t.items.map((function(t){return t.variation_id})),stocktaking_by:t.stocktaking.stocktaking_by,stocktaking_by_value:t.stocktaking.stocktaking_by_value}),data:{data:[],total_entries:0,page:1},pageSize:parseInt(localStorage.getItem("listProductNotStocktaking")||20),isLoading:!1,selectedRowKeys:[],currentData:0,totalEntriesFill:0},n}return(0,v.Z)(a,[{key:"componentDidMount",value:function(){var t=this.state,e=t.params,a=t.pageSize;e.page_size=a,this.setState({params:e}),this.fetchListProducts()}},{key:"getProgress",value:function(){return this.state.totalEntriesFill&&0!=this.state.totalEntriesFill?Math.round(this.state.currentData/this.state.totalEntriesFill*100):0}},{key:"render",value:function(){var t=this,e=this.props,a=e.visibleListProduct,n=e.t,o=this.state,r=o.isLoading,c=o.data,u=c.total_entries,l=c.page,d=o.selectedRowKeys,p=o.isFilling,h=o.pageSize;return it(k.Z,{wrapClassName:"modal-missing-product",visible:a,width:"80%",onCancel:function(){return t.onCancel()},closable:!p,title:n("pages.shop.product.stocktaking.listProductNotStocktaking"),footer:it(_.default,{title:"Th\xeam ".concat(d.length>0?d.length:"t\u1ea5t c\u1ea3"," s\u1ea3n ph\u1ea9m v\xe0o phi\u1ebfu ki\u1ec3m")},it(i.default,{type:"primary",onClick:function(){return t.handleAddVariation()},disabled:0==this.state.data.data.length||p},d.length>0?n("components.orderExportExcel.add"):n("components.orderExportExcel.addAll")))},p&&it(at.default,{percent:this.getProgress()}),it(s.Z,{columns:this.columns,dataSource:this.getData(),loading:r,size:"small",pagination:{size:"small",pageSize:h,total:u,current:l},onChange:this.handleTableChange,rowSelection:{selectedRowKeys:d,onChange:function(e){return t.setState({selectedRowKeys:e})},preserveSelectedRowKeys:!0},scroll:{y:400}}),it("div",{style:{position:"absolute",bottom:82,left:40,zIndex:100,display:"".concat(d.length<=0?"none":"flex")}},it("strong",null,d.length," ",n("pages.shop.product.stocktaking.productSelected"))))}}]),a}(D.Component))||n,dt=(0,L.$j)((function(t){return{currentShop:t.shop.currentShop}}),{})(lt),pt=a(7859),ht=a(41850),gt=a(50916),ft=a(78598),kt=a(44122),_t=a(88460),yt=a(48519),vt=D.createElement;function mt(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function bt(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?mt(Object(a),!0).forEach((function(e){(0,I.Z)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):mt(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function St(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=(0,w.Z)(t);if(e){var i=(0,w.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,S.Z)(this,a)}}var wt=q.default.Option,It=x.default.TextArea,Zt=x.default.Search,xt=Z.default.TabPane,qt="table-container",Ct=(0,M.Z)()(ct=function(t){(0,b.Z)(a,t);var e=St(a);function a(t){var n,p;(0,y.Z)(this,a),p=e.call(this,t),(0,I.Z)((0,m.Z)(p),"componentDidMount",(function(){var t=p.props.variationsStocktaking,e=localStorage&&localStorage.getItem("columns_width_stocktaking_detail_table");e&&(e=JSON.parse(e),p.setState({widthColumns:e})),p.setState({variations:t||[]}),window.addEventListener("beforeunload",(function(t){t.preventDefault(),p.handleSetDraft()}))})),(0,I.Z)((0,m.Z)(p),"submitStocktaking",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;p.setState({stocktaking:t}),p.props.submit&&p.props.submit(t),p.handleScrollTo(e)})),(0,I.Z)((0,m.Z)(p),"getVariationWarehouse",(function(t,e){var a={actual_remain_quantity:0,remain_quantity:0,pending_transfer_quantity:0,shelf_quantity:0};return t?0==t.length?a:t.find((function(t){return t.warehouse_id==e}))||a:a})),(0,I.Z)((0,m.Z)(p),"handleDeleteStocktaking",(function(t){var e=O()(p.state.stocktaking),a=O()(p.state.variations),n=a.findIndex((function(a){return a.id==e.items[t].variation_id}));n>-1&&(a.splice(n,1),p.setState({variations:a})),a.splice(n,1),e.items[t].id?e.items[t].do_remove=!0:e.items.splice(t,1),p.submitStocktaking(e)})),(0,I.Z)((0,m.Z)(p),"handleChangeSortTable",(function(t,e,a){"variationId"==a.field&&p.setState({sorterVariationId:a.order})})),(0,I.Z)((0,m.Z)(p),"getColumns",(function(){var t=p.props,e=t.t,a=t.currentShop,n=p.state,i=n.stocktaking,o=n.isCreating,r=n.widthColumns,s=[{title:function(){return vt("div",null,e("components.productComboDetail.variationId")," / ",e("components.productCreatorFirstStep.properties"))},dataIndex:"variation",ellipsis:!0,render:function(t,e){return vt("div",{className:"variation-info"},vt("div",{className:"copy-text",style:{color:"#434343",fontWeight:500}},vt(_t.default,{recordSrc:e.variationId},e.variationId)),vt("div",null,(0,J.Br)(e.fields)))}},{title:function(){return vt("div",null,e("products.title")," / ",e("components.productComboDetail.productId"))},dataIndex:"product",ellipsis:!0,render:function(t,e){return vt("div",{className:"product-info"},vt("div",{style:{color:"#434343",fontWeight:500}},e.productName),vt("div",{className:"copy-text"},vt(_t.default,{recordSrc:e.productId},e.productId)))}},{title:e("components.orderExportExcel.image"),dataIndex:"images",align:"center",width:70,ellipsis:!0},{title:e("pages.shop.product.stocktaking.actual"),dataIndex:"remain",align:"right",ellipsis:!0,width:.14*p.tableWidth},{title:e("pages.shop.product.stocktaking.changed"),dataIndex:"changed",align:"right",ellipsis:!0,width:.14*p.tableWidth},{title:e("pages.shop.product.stocktaking.fixed"),dataIndex:"quantity",align:"right",width:.14*p.tableWidth,ellipsis:!0,render:function(t){var n=t.value,r=t.index,s=t.warning,c=t.pending,u=s?"".concat(e("pages.shop.product.stocktaking.enterToManyQuantity",{value:c})):null;return o||0===i.status?vt(_.default,{title:u},vt("div",null,vt($.default,{warning:s,currency:a.currency,placeholder:e("components.orderExportExcel.quantity"),size:"small",value:n,callBack:function(t){return p.handleQuantityChange(r,t)},min:0}))):n}},{title:"",dataIndex:"delete",width:50,render:function(t,e){return vt(R.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){return p.handleDeleteStocktaking(e.key)}})}}];if(i&&0!=i.status&&!o){var c=s.findIndex((function(t){return"delete"==t.dataIndex}));-1!=c&&s.splice(c,1)}s=s.map((function(t,e){return bt(bt({},t),{},{onHeaderCell:function(t){return{id:t.dataIndex,width:t.width,tableClassName:qt,columnNotResize:s.length-1==e&&t.dataIndex,onResize:p.onResize}}})}));var u=Object.keys(r);return s=s.map((function(t){return u.includes(t.dataIndex)?bt(bt({},t),{},{width:r[t.dataIndex]}):t}))})),(0,I.Z)((0,m.Z)(p),"getBatchShelfColumns",(function(){var t=p.props,e=t.t,a=t.currentShop,n=p.state,i=n.stocktaking,o=n.isCreating,r=[{title:function(){return vt("div",null,e("components.productComboDetail.variationId")," / ",e("components.productCreatorFirstStep.properties"))},dataIndex:"variation",ellipsis:!0,render:function(t,e){return vt("div",{className:"variation-info",style:{color:e.style?e.style.color:null}},vt("div",{style:{color:"#434343",fontWeight:500}},e.variationId),vt("div",null,(0,J.Br)(e.fields)))}},{title:function(){return vt("div",null,e("products.title")," / ",e("components.productComboDetail.productId"))},dataIndex:"product",ellipsis:!0,render:function(t,e){return vt("div",{className:"product-info",style:{color:e.style?e.style.color:null}},vt("div",{style:{color:"#434343",fontWeight:500}},e.productName),vt("div",null,e.productId))}},{title:"H\xecnh \u1ea3nh",dataIndex:"images",align:"center",width:60,ellipsis:!0},{title:e("pages.shop.product.stocktaking.batchQuantity"),dataIndex:"current_batch_quantity",align:"right",ellipsis:!0,width:"10%"},{title:e("pages.shop.product.stocktaking.changed"),dataIndex:"changed_batch_quantity",align:"right",ellipsis:!0,width:"10%"},{title:e("pages.shop.product.stocktaking.fixed"),dataIndex:"batch_quantity",align:"right",width:"10%",ellipsis:!0,render:function(t){var n=t.value,r=t.index,s=t.warning,c=s?"".concat(e("pages.shop.product.stocktaking.enterBatchToManyQuantity",{value:i.items[r].pending})):null;return o||0==i.status?vt(_.default,{title:c},vt("div",null,vt($.default,{key:"batch",size:"small",warning:s,currency:a.currency,placeholder:e("components.orderExportExcel.quantity"),value:n,callBack:function(t){return p.handleBatchShelfQuantityChange(r,t,"batch_quantity")},min:0}))):n}},{title:e("pages.shop.product.stocktaking.shelfQuantity"),dataIndex:"current_shelf_quantity",align:"right",ellipsis:!0,width:"10%"},{title:e("pages.shop.product.stocktaking.changed"),dataIndex:"changed_shelf_quantity",align:"right",ellipsis:!0,width:"10%"},{title:e("pages.shop.product.stocktaking.fixed"),dataIndex:"shelf_quantity",align:"right",width:"10%",ellipsis:!0,render:function(t){var n=t.value,r=t.index,s=t.warning,c=s?"".concat(e("pages.shop.product.stocktaking.enterBatchToManyQuantity",{value:i.items[r].pending})):null;return o||0==i.status?vt(_.default,{title:c},vt("div",null,vt($.default,{key:"shelf",size:"small",warning:s,currency:a.currency,placeholder:e("components.orderExportExcel.quantity"),value:n,callBack:function(t){return p.handleBatchShelfQuantityChange(r,t,"shelf_quantity")},min:0}))):n}},{title:"",dataIndex:"delete",width:50,render:function(t,e){return vt(R.Z,{style:{color:"rgb(255, 56, 96)",cursor:"pointer"},onClick:function(){return p.handleDeleteStocktaking(e.key)}})}}];if(i&&0!=i.status&&!o){var s=r.findIndex((function(t){return"delete"==t.dataIndex}));-1!=s&&r.splice(s,1)}return r})),(0,I.Z)((0,m.Z)(p),"getData",(function(){var t=p.state,e=t.stocktaking,a=e.items,n=e.status,i=t.isCreating,o=t.onScreenBarcode,r=t.searchProduct;if(a){return O()(a||[]).map((function(t,e){return t.key=e,t})).filter((function(t){return!t.do_remove})).map((function(t){var e,a,r,s,c=(0!=n?t.current_quantity-t.current_shelf_quantity:t.variation_warehouse.actual_remain_quantity-t.variation_warehouse.shelf_quantity)+(t.changed_quantity-t.changed_shelf_quantity),u=(0!=n?t.current_shelf_quantity:t.variation_warehouse.shelf_quantity)+(t.changed_shelf_quantity||0),l=(0!=n?t.current_quantity:t.variation_warehouse.actual_remain_quantity)+t.changed_quantity,d=(l=i?t.quantity:l)<((null===t||void 0===t||null===(e=t.variation_warehouse)||void 0===e?void 0:e.pending_transfer_quantity)||0),p=t.variation.product||{};return{selectedId:t.variation_id,key:t.key,id:t.id,style:t.style,productId:p.custom_id||p.display_id,productName:p.name,variationId:t.variation.custom_id||t.variation.display_id,fields:t.variation.fields,images:(0,J.ip)(t.variation.images),remain:i||0==n?t.variation_warehouse.actual_remain_quantity:t.current_quantity,changed:i?t.quantity-t.variation_warehouse.actual_remain_quantity:t.changed_quantity,quantity:{value:l,index:t.key,warning:t.warning||d,variation_id:t.variation_id,pending:(null===t||void 0===t||null===(a=t.variation_warehouse)||void 0===a?void 0:a.pending_transfer_quantity)||0},current_batch_quantity:i||0==n?t.variation_warehouse.actual_remain_quantity-t.variation_warehouse.shelf_quantity:t.current_quantity-(t.current_shelf_quantity||0),changed_batch_quantity:i?t.batch_quantity-(t.variation_warehouse.actual_remain_quantity-t.variation_warehouse.shelf_quantity):t.changed_quantity-(t.changed_shelf_quantity||0),batch_quantity:{value:i?t.batch_quantity:o?t.batch_quantity||0:c,index:t.key,warning:t.warning_batch},current_shelf_quantity:i||0==n?t.variation_warehouse.shelf_quantity:t.current_shelf_quantity||0,changed_shelf_quantity:i?t.shelf_quantity-t.variation_warehouse.shelf_quantity:t.changed_shelf_quantity||0,shelf_quantity:{value:i?t.shelf_quantity:o?t.shelf_quantity||0:u,index:t.key,warning:t.warning_shelf},custom_id:(null===(r=t.variation)||void 0===r?void 0:r.custom_id)||"".concat(null===p||void 0===p?void 0:p.display_id,"-").concat(null===(s=t.variation)||void 0===s?void 0:s.display_id),originItem:t}})).filter((function(t){var e,a,n,i,o,s,c,u,l,d=t.originItem,p=((null===(e=d.variation)||void 0===e?void 0:e.fields)||[]).map((function(t){return t.value})),h=function(t,e){return(0,Y.Mle)(t).includes((0,Y.Mle)(e))};return h(null===(a=d.variation)||void 0===a||null===(n=a.product)||void 0===n?void 0:n.name,r)||h(null===(i=d.variation)||void 0===i||null===(o=i.product)||void 0===o?void 0:o.custom_id,r)||h(null===(s=d.variation)||void 0===s||null===(c=s.product)||void 0===c?void 0:c.display_id,r)||h(null===(u=d.variation)||void 0===u?void 0:u.display_id,r)||h(null===(l=d.variation)||void 0===l?void 0:l.custom_id,r)||p.find((function(t){return h(t,r)}))}))}})),(0,I.Z)((0,m.Z)(p),"handleQuantityChange",(function(t,e){var a=O()(p.state.stocktaking);a.items[t].changed_quantity=e-a.items[t].variation_warehouse.actual_remain_quantity,a.items[t].quantity=e,a.items[t].pending=a.items[t].variation_warehouse.pending_transfer_quantity,a.items[t].warning=e<a.items[t].variation_warehouse.pending_transfer_quantity,p.submitStocktaking(a)})),(0,I.Z)((0,m.Z)(p),"handleBatchShelfQuantityChange",(function(t,e,a){var n=O()(p.state.stocktaking),i=n.items[t].variation_warehouse;n.items[t][a]=e,"batch_quantity"==a?(n.items[t].changed_batch_quantity=e-i.actual_remain_quantity-i.shelf_quantity,n.items[t].warning_batch=e<n.items[t].variation_warehouse.pending_transfer_quantity-n.items[t].shelf_quantity):(n.items[t].changed_shelf_quantity=e-i.shelf_quantity,n.items[t].warning_shelf=e<n.items[t].variation_warehouse.pending_transfer_quantity-n.items[t].batch_quantity),p.submitStocktaking(n)})),(0,I.Z)((0,m.Z)(p),"renderInfo",(function(t){return!t||t&&0==t.length?"":t.map((function(t){return vt("span",{key:t.name},vt("strong",{style:{color:"#005667"}},t.name,":")," ",vt("i",{style:{marginRight:4}},t.value))}))})),(0,I.Z)((0,m.Z)(p),"handleWarehouseChange",(function(t){var e=O()(p.state.stocktaking),a=O()(p.state.variations);e.warehouse_id=t,e.items&&e.items.forEach((function(e){var n=a.find((function(t){return t.id==e.variation_id})),i=p.getVariationWarehouse(null===n||void 0===n?void 0:n.variations_warehouses,t),o=e.variation_warehouse;e.variation_warehouse=i,e.changed_quantity=(e.hasOwnProperty("quantity")?e.quantity:e.changed_quantity+o.actual_remain_quantity)-i.actual_remain_quantity,e.pending=i.pending_transfer_quantity})),p.submitStocktaking(e)})),(0,I.Z)((0,m.Z)(p),"handleNoteChange",(function(t){var e=O()(p.state.stocktaking);e.note=t.target.value,p.submitStocktaking(e)})),(0,I.Z)((0,m.Z)(p),"handleDisplayElement",(function(t,e){var a="#".concat(t," .react-resizable-handle");if("undefined"!==typeof document){var n=document.getElementById(t);n&&("block"==e?(n.style.borderLeft="1px dashed #bbb",p.setState({isResizing:!0})):(n.style.border="none",p.setState({isResizing:!1})));var i=document.querySelector(a);i&&(i.style.display=e)}})),(0,I.Z)((0,m.Z)(p),"renderSumRow",(function(){var t=p.state,e=t.stocktaking,a=t.isCreating,n=p.props.t,i=0,o=0,r=0,s=0;return(e.items||[]).filter((function(t){return!t.do_remove})).map((function(t){var n=e.is_batch_shelf?t.batch_quantity+t.shelf_quantity:t.quantity;i+=a?n:(0!=e.status?t.current_quantity:t.variation_warehouse.actual_remain_quantity)+t.changed_quantity,o+=Math.abs(a?n-t.variation_warehouse.actual_remain_quantity:t.changed_quantity),s+=a?t.shelf_quantity:(0!=e.status?t.current_shelf_quantity:t.variation_warehouse.shelf_quantity)+t.changed_shelf_quantity,r+=Math.abs(a?t.shelf_quantity-t.variation_warehouse.shelf_quantity:t.changed_shelf_quantity)})),e.is_batch_shelf?vt("div",{style:{textAlign:"right"}},vt("span",{className:"total-info"},n("pages.shop.statistic.statisticItem.total_product"),": ",vt("strong",null,(0,Y.ufS)((e.items||[]).length))),vt("span",{className:"total-info"},vt("span",null,n("pages.shop.product.stocktaking.totalQuantityChanged"),":"),vt("span",null,n("pages.shop.product.stocktaking.batch"),": ")," ",vt("strong",null," ",(0,Y.oH6)(o-r)),vt("span",null,n("pages.shop.product.stocktaking.shelf"),": ")," ",vt("strong",null," ",(0,Y.oH6)(r))),vt("span",{className:"total-info"},vt("span",null,n("pages.shop.product.stocktaking.totalQuantityFixed"),":"),vt("span",null,n("pages.shop.product.stocktaking.batch"),": ")," ",vt("strong",null," ",(0,Y.oH6)(i-s)),vt("span",null,n("pages.shop.product.stocktaking.shelf"),": ")," ",vt("strong",null," ",(0,Y.oH6)(s)))):vt("div",{style:{textAlign:"right"}},vt("span",{className:"total-info"},n("pages.shop.statistic.statisticItem.total_product"),": ",vt("strong",null,(0,Y.ufS)((e.items||[]).length))),vt("span",{className:"total-info"},vt(_.default,{title:"".concat(n("pages.shop.product.stocktaking.totalQuantityChanged"),": ").concat(o)},n("pages.shop.product.stocktaking.totalQuantityChanged"),":",vt("strong",null," ",(0,Y.oH6)(o)))),vt("span",{className:"total-info"},vt(_.default,{title:"".concat(n("pages.shop.product.stocktaking.totalQuantityFixed"),": ").concat(i)},n("pages.shop.product.stocktaking.totalQuantityFixed"),":",vt("strong",null," ",(0,Y.oH6)(i)))))})),(0,I.Z)((0,m.Z)(p),"checkElementInAnotherArray",(function(t,e){if(!t||!e)return!1;var a=!1;return e.map((function(e){t.map((function(t){t==e&&(a=!0)}))})),a})),(0,I.Z)((0,m.Z)(p),"handleSelectItem",(function(t){var e=p.state,a=e.search_by,n=e.onScreenBarcode;p.setState({isSelectItem:!0}),"product"!=a||n?p.handleSelectItemSearchByVariation(t):p.handleSelectItemSearchByProduct(t)})),(0,I.Z)((0,m.Z)(p),"handleSelectItemSearchByProduct",(function(t){var e=p.state.searchResult.find((function(e){return e.id==t})),a=O()(p.state.variations),n=O()(p.state.stocktaking);e.variations.map((function(t){t.product={name:e.name,custom_id:e.custom_id,display_id:e.display_id,manipulation_warehouses:e.manipulation_warehouses||[]},p.handleSelectItemSearch(t,t.id,a,n,!0)})),p.setState({variations:a,selectedId:t})})),(0,I.Z)((0,m.Z)(p),"handleSelectItemSearchByVariation",(function(t){var e=p.state.searchResult.find((function(e){return e.id==t})),a=O()(p.state.stocktaking),n=O()(p.state.variations);p.handleSelectItemSearch(e,t,n,a),p.setState({variations:n,selectedId:t})})),(0,I.Z)((0,m.Z)(p),"handleSelectItemSearch",(function(t,e,a,n,i){var o=p.state.onScreenBarcode;a.find((function(e){return e.id==t.id}))||a.unshift(t);var r=!0,s="";if(n.stocktaking_by&&n.stocktaking_by_value)switch(n.stocktaking_by){case"category_ids":r=p.checkElementInAnotherArray(t.product.category_ids,n.stocktaking_by_value),s="danh m\u1ee5c";break;case"supplier_product_ids":r=p.checkElementInAnotherArray(t.product.supplier_product_ids,n.stocktaking_by_value),s="nh\xe0 cung c\u1ea5p";break;case"brand_id":r=n.stocktaking_by_value.includes(t.product.brand_id),s="th\u01b0\u01a1ng hi\u1ec7u"}if(!r)return G.Z.error("S\u1ea3n ph\u1ea9m kh\xf4ng n\u1eb1m trong ".concat(s," \u0111\u01b0\u1ee3c ch\u1ecdn"));var c=p.getVariationWarehouse(t.variations_warehouses,p.state.stocktaking.warehouse_id),u=n.items.findIndex((function(t){return t.variation_id==e}));if(-1==u){var l=o?1:c.actual_remain_quantity;n.items.push({variation_id:t.id,changed_quantity:l-c.actual_remain_quantity,current_quantity:c.actual_remain_quantity,quantity:l,variation_warehouse:c,pending:c.pending_transfer_quantity,warning:l<c.pending_transfer_quantity,brand_id:t.product.brand_id,supplier_product_ids:t.product.supplier_product_ids,category_ids:t.product.category_ids,manipulation_warehouses:t.product.manipulation_warehouses,current_batch_quantity:c.actual_remain_quantity-c.shelf_quantity,changed_batch_quantity:l-(c.actual_remain_quantity-c.shelf_quantity),current_shelf_quantity:c.shelf_quantity,changed_shelf_quantity:0,batch_quantity:l-c.shelf_quantity,shelf_quantity:c.shelf_quantity,warning_batch:l<c.pending_transfer_quantity,warning_shelf:l<c.pending_transfer_quantity,variation:t}),p.submitStocktaking(n,n.items.length-1)}else if(!i)if(n.items[u].do_remove)n.items[u].do_remove=!1,p.submitStocktaking(n,u);else{var d=p.getData(),h=d.findIndex((function(t){return t.selectedId==e}));p.handleQuantityChange(h,d[h].quantity.value+1),n.is_batch_shelf&&p.handleBatchShelfQuantityChange(h,d[h].batch_quantity.value+1,"batch_quantity"),p.handleScrollTo(h)}o&&G.Z.success("".concat(p.props.t("pages.shop.addProductSuccess")," ").concat(t.product.name))})),(0,I.Z)((0,m.Z)(p),"handleScrollTo",P()((function(t){p.setState({scrollIndex:t},(function(){p.setState({isSelectItem:!1})}))}),200)),(0,I.Z)((0,m.Z)(p),"handleConfirm",(function(){var t,e=p.props.t;(null===(t=p.state.stocktaking.stocktaking_by_value)||void 0===t?void 0:t.length)>0?k.Z.confirm({title:e("containers.formBox.warningConfirm"),content:"B\u1ea1n \u0111ang ki\u1ec3m kho theo ".concat(p.getLabelStocktakingBy(!0),". \u0110i\u1ec1u n\xe0y c\xf3 th\u1ec3 l\xe0m m\u1ea5t m\u1ed9t s\u1ed1 s\u1ea3n ph\u1ea9m kh\xf4ng thu\u1ed9c ").concat(p.getLabelStocktakingBy(!0)," \u0111\xe3 ch\u1ecdn"),okText:e("containers.formBox.confirmOK"),cancelText:e("cancel"),onOk:function(){return p.handleSave()},onCancel:function(){}}):p.handleSave()})),(0,I.Z)((0,m.Z)(p),"handleSave",(function(){var t;p.setState({isLoading:!0,searchProduct:""});var e=p.props,a=e.updateStocktakings,n=e.createStocktakings,i=e.accessToken,o=e.shopId,r=e.close,s=e.warehouses,c=p.state,u=c.isCreating,l=c.stocktaking,d=c.sorterVariationId,h=c.createAndPrint;l.stocktaking_by_value&&(null===(t=l.stocktaking_by_value)||void 0===t?void 0:t.length)>0&&(l=p.handleFilterItems());var g=l.items||[];d&&(g=g.sort((function(t,e){var a,n,i,o,r,s,c,u,l=(null===(a=t.variation)||void 0===a?void 0:a.custom_id)||"".concat(null===(n=t.variation)||void 0===n||null===(i=n.product)||void 0===i?void 0:i.display_id,"-").concat(null===(o=t.variation)||void 0===o?void 0:o.display_id),d=(null===(r=e.variation)||void 0===r?void 0:r.custom_id)||"".concat(null===(s=e.variation)||void 0===s||null===(c=s.product)||void 0===c?void 0:c.display_id,"-").concat(null===(u=e.variation)||void 0===u?void 0:u.display_id);return l<d?-1:l>d?1:0})),g="descend"==d?g.reverse():g),g=g.map((function(t,e){return bt(bt({},t),{},{display_id:e})})),l.items=g,u?n(i,o,l).then((function(){localStorage["product_stocktaking_shop_".concat(o)]&&localStorage.removeItem("product_stocktaking_shop_".concat(o)),h&&p.child.handlePrint(),r(),p.setState({isLoading:!1,searchResult:[],stocktaking:{warehouse_id:s[0].id,stocktaking_by:void 0,stocktaking_by_value:void 0,items:[],note:"",shop_id:o,status:0}})})).catch(p.handleSetDraft()):a(i,o,l).then((function(){h&&p.child.handlePrint(),r(),p.setState({isLoading:!1,searchResult:[],stocktaking_by:void 0,stocktaking_by_value:void 0})}))})),(0,I.Z)((0,m.Z)(p),"getWarehouse",(function(t){return p.props.warehouses.find((function(e){return e.id==t}))})),(0,I.Z)((0,m.Z)(p),"onChangeStocktakingAt",function(){var t=(0,f.Z)(h().mark((function t(e){var a,n,i,o,r,s,c,u,l,d;return h().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p.setState({isLoadingItem:!0}),a=30,n=p.props,i=n.shopId,o=n.accessToken,r=p.state.stocktaking,s=[],c=0;case 6:if(!(c<r.items.length)){t.next=16;break}return u=r.items.slice(c,c+a).map((function(t){return t.variation_id})),l="".concat((0,Y.LpH)(),"/shops/").concat(i,"/products/variations?access_token=").concat(o),t.next=11,tt().get(l,{params:{page:-1,variation_ids:u,warehouse_until:e?Q().utc(e).toISOString():null}});case 11:d=t.sent,s.push.apply(s,(0,g.Z)(d.data.data));case 13:c+=a,t.next=6;break;case 16:p.setState({isLoadingItem:!1,variations:s,stocktaking:bt(bt({},r),{},{stocktaking_at:e})},(function(){return p.handleWarehouseChange(r.warehouse_id)}));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),(0,I.Z)((0,m.Z)(p),"onChangeInsertedAt",(function(t){t&&p.setState({stocktaking:bt(bt({},p.state.stocktaking),{},{inserted_at:t,change_inserted_at:!0})})})),(0,I.Z)((0,m.Z)(p),"handleChangeStocktakingBy",(function(t){var e=O()(p.state.stocktaking);e.stocktaking_by=t,e.stocktaking_by_value=void 0,p.setState({stocktaking:e})})),(0,I.Z)((0,m.Z)(p),"getLabelStocktakingBy",(function(t){switch(p.state.stocktaking.stocktaking_by){case"category_ids":return t?"danh m\u1ee5c":"Ch\u1ecdn danh m\u1ee5c";case"supplier_product_ids":return t?"nh\xe0 cung c\u1ea5p":"Ch\u1ecdn nh\xe0 cung c\u1ea5p";case"brand_id":return t?"th\u01b0\u01a1ng hi\u1ec7u":"Ch\u1ecdn th\u01b0\u01a1ng hi\u1ec7u"}})),(0,I.Z)((0,m.Z)(p),"getOptionsCascader",(function(){var t=p.state.stocktaking,e=p.props,a=e.categories,n=e.supplier_products,i=e.brands,o=[],r=[];switch(t.stocktaking_by){case"category_ids":o=a||[],r=p.getCategoryOptions(o);break;case"supplier_product_ids":o=(null===n||void 0===n?void 0:n.data)||[];break;case"brand_id":o=(null===i||void 0===i?void 0:i.data)||[]}return 0==r.length&&(r=o.map((function(t){return{label:t.name,value:t.id,key:t.id}}))),r})),(0,I.Z)((0,m.Z)(p),"getCategoryOptions",(function(t){var e=[];return t.map((function(t){e.push({label:t.text,value:t.id.toString(),key:t.id,children:t.nodes.length>0?p.getCategoryOptions(t.nodes):[]})})),e})),(0,I.Z)((0,m.Z)(p),"getAllCategoriesId",(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return(t||[]).map((function(t){e.push(t.value),(t.children||[]).length>0&&p.getAllCategoriesId(t.children,e)})),e})),(0,I.Z)((0,m.Z)(p),"onClickMenuCascader",(function(t,e){var a=O()(p.state.stocktaking);if(0==e.length)return a.stocktaking_by_value=void 0,void p.setState({stocktaking:a});var n=e[e.length-1];if("category_ids"==a.stocktaking_by){var i=p.getAllCategoriesId(n.children);i.unshift(n.value),a.stocktaking_by_value=i,p.setState({stocktaking:a},(function(){return p.handleFilterItems()}))}else a.stocktaking_by_value=[n.value],p.setState({stocktaking:a},(function(){return p.handleFilterItems()}))})),(0,I.Z)((0,m.Z)(p),"handleFilterItems",(function(){var t,e=O()(p.state.stocktaking),a=O()(e.items);return e.stocktaking_by_value&&0!=(null===(t=e.stocktaking_by_value)||void 0===t?void 0:t.length)?(e.items=a.filter((function(t){var a,n;return"brand_id"==e.stocktaking_by?e.stocktaking_by_value.includes(t.brand_id||(null===(a=t.variation)||void 0===a||null===(n=a.product)||void 0===n?void 0:n.brand_id)):p.checkElementInAnotherArray(t[e.stocktaking_by]||t.variation.product[e.stocktaking_by],e.stocktaking_by_value)})),p.submitStocktaking(e),e):e})),(0,I.Z)((0,m.Z)(p),"fillDataIntoItem",(function(t){var e=O()(p.state.stocktaking);(t||[]).map((function(t){var a=p.getVariationWarehouse(t.variations_warehouses,p.state.stocktaking.warehouse_id);if(-1==e.items.findIndex((function(e){return e.variation_id==t.id})))e.items.push({variation_id:t.id,changed_quantity:-a.actual_remain_quantity,current_quantity:a.actual_remain_quantity,quantity:0,variation_warehouse:a,pending:a.pending_transfer_quantity,warning:a.actual_remain_quantity<a.pending_transfer_quantity,brand_id:t.product.brand_id,supplier_product_ids:t.product.supplier_product_ids,category_ids:t.product.category_ids,manipulation_warehouses:t.product.manipulation_warehouses,style:{color:"#096dd9"},variation:t}),p.submitStocktaking(e);else{var n=p.getData().findIndex((function(t){return t.selectedId==selectedId}));p.handleQuantityChange(n,p.getData()[n].quantity.value+1)}}))})),(0,I.Z)((0,m.Z)(p),"onResize",(function(t,e){var a=p.state.widthColumns;a[t]=e,p.setState({widthColumns:a}),localStorage.setItem("columns_width_stocktaking_detail_table",JSON.stringify(a))})),(0,I.Z)((0,m.Z)(p),"setClassName",(function(t){var e=p.state.selectedId;return e&&t.selectedId==e?"stocktaking-table-row-light":""})),(0,I.Z)((0,m.Z)(p),"renderContent",(function(){var t,e=p.state,a=e.searchResult,n=e.isCreating,i=e.stocktaking,o=e.isLoadingItem,r=e.search_by,s=e.scrollIndex,h=p.props,g=h.warehouses,f=h.accessToken,k=h.shopId,_=h.t,y=h.currentShop,v=h.disbaledSelectWarehouse,m=h.timezone,b=i.items&&i.items.length>0?i.items.map((function(t){return t.variation_id})):[],S={header:{cell:pt.Z}};return vt("div",{className:"content",style:{padding:20}},vt("div",{className:"content-info"},vt("div",{className:"info-item",style:{flex:2}},vt("div",{className:"header"},_("pages.shop.product.stocktaking.warehouse")),vt("div",{className:"warehouse-info"},vt(q.default,{onChange:p.handleWarehouseChange,value:i.warehouse_id,style:{width:"100%"},disabled:!n||v,dropdownClassName:"select-warehouse-dropdown"},(t=i.warehouse_id,g.map((function(e){var a=e.name,n=e.id;return vt(wt,{key:n,value:n,disabled:n==t},a)})))))),vt("div",{className:"info-item"},i.id&&vt("div",{style:{display:"flex",justifyContent:"space-between",fontWeight:500,flexFlow:"wrap"}},vt("span",null,_("pages.shop.product.stocktaking.creator"),":"),i.creator?vt(gt.Z,{seed:i.creator.id,avatar_url:i.creator.avatar_url,id:i.creator.fb_id,size:[20,20],name:i.creator.name,showName:!0}):vt(d.default,{color:"#00707f"},p.props.t("pages.admin.system"))),vt("div",{className:"info"},vt("div",{className:"header"},_("systemLogs.purchases.inserted_at")),vt(l.default,{showTime:!0,format:"HH:mm DD-MM-YYYY",value:i&&i.inserted_at?Q().utc(i.inserted_at).utcOffset(parseFloat(m)):Q()(),style:{width:"100%",marginRight:10,borderRadius:"unset"},getCalendarContainer:function(t){return t.parentNode},onChange:p.onChangeInsertedAt})),vt("div",{className:"info"},vt("div",{className:"header"},_("pages.shop.product.stocktaking.stocktakingAt")),vt(l.default,{disabled:0!=i.status,showTime:!0,format:"HH:mm DD-MM-YYYY",value:i&&i.stocktaking_at?Q().utc(i.stocktaking_at).utcOffset(parseFloat(m)):void 0,style:{width:"100%",marginRight:10,borderRadius:"unset"},getCalendarContainer:function(t){return t.parentNode},onChange:p.onChangeStocktakingAt})),vt("div",{className:"info"},vt("div",{className:"header"},_("pages.shop.product.stocktaking.stocktakingBy"),i.stocktaking_by&&vt(et.Z,{icon:vt(B.Z,null),tip:"B\u1ea1n \u0111ang ki\u1ec3m kho theo ".concat(p.getLabelStocktakingBy(!0),". \u0110i\u1ec1u n\xe0y c\xf3 th\u1ec3 l\xe0m m\u1ea5t m\u1ed9t s\u1ed1 s\u1ea3n ph\u1ea9m kh\xf4ng thu\u1ed9c ").concat(p.getLabelStocktakingBy(!0)," \u0111\xe3 ch\u1ecdn")})),vt(q.default,{value:i.stocktaking_by,onChange:function(t){return p.handleChangeStocktakingBy(t)},style:{width:"100%"},allowClear:!0,disabled:i.status,placeholder:"Ch\u1ecdn"},vt(wt,{key:"category_ids",value:"category_ids"},_("pages.shop.product.variation.category")),vt(wt,{key:"supplier_product_ids",value:"supplier_product_ids"},_("pages.shop.product.variation.supplierProducts")),vt(wt,{key:"brand_id",value:"brand_id"},_("pages.shop.product.management.brand")))),i.stocktaking_by&&vt("div",{className:"info"},vt("div",{className:"header"},p.getLabelStocktakingBy()),vt(u.Z,{options:p.getOptionsCascader(),expandTrigger:"click",placeholder:p.getLabelStocktakingBy(),defaultValue:i.stocktaking_by_value,displayRender:p.displayRender,style:{width:"100%"},onChange:p.onClickMenuCascader,changeOnSelect:!0}))),vt("div",{className:"info-item"},vt("div",{className:"header"},_("note")),vt(It,{placeholder:_("note"),onChange:p.handleNoteChange,style:{fontSize:14},value:i.note}))),vt("div",{className:"table-info"},p.props.viewProduct?"":(n||0===i.status)&&vt("div",{style:{display:"flex"}},vt("div",{className:"select-layout"},vt("div",{className:"item-info"},vt(q.default,{className:"ant-select-filter-type-combo",value:r,onChange:function(t){return p.setState({search_by:t,searchResult:[]})}},vt(wt,{value:"variation",className:"ant-select"},_("components.productComboDetail.variation")),vt(wt,{value:"product",className:"ant-select"},_("products.title"))))),vt("div",{style:{width:"100%",marginLeft:5,display:"flex",justifyContent:"space-between"}},vt(F.Z,{warehouseUntil:i.stocktaking_at,accessToken:f,searchResult:a,onSelect:p.handleSelectItem,shopId:k,callback:function(t){return p.setState({searchResult:t})},combo_by:r,selectedVariationIds:b,onScreenBarcode:function(t){return p.setState({onScreenBarcode:t,searchResult:[]})},selected_warehouse_id:[i.warehouse_id],warehouse_id:i.warehouse_id,localClassName:"stocktaking-search",style:{display:"flex",flex:1}}),n&&y.use_warehouse_position&&vt(c.default.Group,{value:i.is_batch_shelf,buttonStyle:"solid",style:{textAlign:"end",marginLeft:5},onChange:function(t){p.setState({stocktaking:bt(bt({},i),{},{is_batch_shelf:t.target.value})})}},vt(c.default.Button,{value:!1},_("pages.shop.product.stocktaking.defaulf")),vt(c.default.Button,{value:!0},_("pages.shop.product.stocktaking.batchShelf"))))),vt(ht.Z,{components:S,className:"table-container",columns:i.is_batch_shelf?p.getBatchShelfColumns():p.getColumns(),dataSource:p.getData(),size:"small",scroll:{y:400},pagination:!1,title:p.renderSearchProduct,footer:function(){return p.renderSumRow()},rowClassName:p.setClassName,rowKey:function(t){return t.key},loading:o,onChange:p.handleChangeSortTable,scrollIndex:s||0,isSelectItem:p.state.isSelectItem})))})),(0,I.Z)((0,m.Z)(p),"handleSetDraft",(function(){var t=p.props.shopId,e=p.state.stocktaking;if(e&&"undefined"!==typeof Storage){var a,n=e.items,i=e.note,o=e.id,r={stocktaking:e,variationsStocktaking:null!==(a=p.state.variations)&&void 0!==a&&a.length?p.state.variations:[]};(0,Y.kzT)(r)||(localStorage["product_stocktaking_shop_".concat(t)]&&localStorage.removeItem("product_stocktaking_shop_".concat(t)),((null===n||void 0===n?void 0:n.length)>0||i)&&!o&&localStorage.setItem("product_stocktaking_shop_".concat(t),JSON.stringify(r)))}})),(0,I.Z)((0,m.Z)(p),"handleOnCancel",(function(){var t=p.state,e=t.onScreenBarcode,a=t.isLoading,n=t.stocktaking;p.handleSetDraft(),e||(a||(n.items=null,n.stocktaking_by=void 0,n.stocktaking_by_value=void 0,p.setState({searchResult:[],variations:[],stocktaking:n}),p.props.close()),p.setState({searchProduct:"",statistic:{},scrollIndex:0,isSelectItem:!1,tabKey:"stocktaking"}))})),(0,I.Z)((0,m.Z)(p),"handleStatisticExportExcel",(function(){var t=new ExcelJS.Workbook,e=t.addWorksheet("My Sheet"),a=p.state.statistic,n=p.props,i=n.t,o=n.currentShop,r=o?(0,yt.zE)(o.role):{},s=r.ql_nhaphang&&r.view_imported_price,c=parseInt(a.missing_price||0),u=parseInt(a.price||0),l=parseInt(a.excess_price||0),d=parseInt(a.change_price||0),h=[{key:"quantity",title:i("pages.shop.product.purchase.quantity"),actual:a.current_quantity,currentActual:a.current_quantity+a.change,change:a.change,rateChange:0==a.current_quantity?"":"".concat((100*Math.abs(a.change)/a.current_quantity).toFixed(2),"%"),excessQuantity:a.excess_quantity,missingQuantity:a.missing_quantity},{key:"importedPrice",title:i("pages.shop.product.purchase.importedPrice"),actual:a.import_price,currentActual:a.import_price+a.change_import_price,change:a.change_import_price,rateChange:0==a.import_price?"":"".concat((100*Math.abs(a.change_import_price)/a.import_price).toFixed(2),"%"),excessQuantity:a.excess_import_price,missingQuantity:a.missing_import_price},{key:"price",title:i("pages.shop.product.variation.retailPrice"),actual:s?u:0,currentActual:s?u+d:0,change:d,rateChange:0==u?"":"".concat((100*Math.abs(d)/u).toFixed(2),"%"),excessQuantity:l,missingQuantity:c}],g=[{header:"",key:"title",width:20},{header:i("pages.shop.product.stocktaking.systemActual"),key:"actual",width:20},{header:i("pages.shop.product.stocktaking.currentActual"),key:"currentActual",width:20},{header:i("pages.shop.product.stocktaking.excess"),key:"excessQuantity",width:20},{header:i("pages.shop.product.stocktaking.missing"),key:"missingQuantity",width:20},{header:i("pages.shop.product.stocktaking.change"),key:"change",width:20},{header:i("pages.shop.product.stocktaking.rateChange"),key:"rateChange",width:20}];if(!s){var f=g.findIndex((function(t){return"rateChange"==t.key}));g.splice(f,1);var k=h.findIndex((function(t){return"importedPrice"==t.key}));h.splice(k,1)}return e.columns=g,h.map((function(t){e.addRow(bt({},t))})),t.xlsx.writeBuffer().then((function(t){(0,ft.saveAs)(new Blob([t],{type:"application/octet-stream"}),"stocktaking_statistic.xlsx")}))})),(0,I.Z)((0,m.Z)(p),"renderStocktakingStatistic",(function(){var t=p.state,e=t.statistic,a=t.statisticLoading,n=p.props,i=n.currentShop,o=n.stocktaking,c=n.t,u=[{title:"",dataIndex:"title",width:150,align:"center",render:function(t){return vt("div",{style:{fontWeight:500}},t)}},{title:c("pages.shop.product.stocktaking.systemActual"),align:"center",children:[{title:"[1]",dataIndex:"actual",width:150,align:"center"}]},{title:c("pages.shop.product.stocktaking.currentActual"),align:"center",children:[{title:"[2]",dataIndex:"currentActual",align:"center",width:150}]},{title:c("pages.shop.product.stocktaking.excess"),align:"center",children:[{title:"[3]",align:"center",dataIndex:"excessQuantity",width:150}]},{title:c("pages.shop.product.stocktaking.missing"),align:"center",children:[{title:"[4]",align:"center",dataIndex:"missingQuantity",width:150}]},{title:c("pages.shop.product.stocktaking.change"),align:"center",children:[{title:"[5 = 3 - 4]",align:"center",dataIndex:"change",width:150,render:function(t){var e=t.value,a=t.isMoney;return{props:{style:{color:e<=0?"#F04134":"rgba(0, 0, 0, 0.65)"}},children:vt("div",null,a?(0,Y.ufS)(e,i.currency):(0,Y.oH6)(e))}}}]},{title:c("pages.shop.product.stocktaking.rateChange"),dataIndex:"rateChange",align:"center",children:[{title:"[6 = 5 / 1]",align:"center",dataIndex:"rateChange",width:150,render:function(t){return vt("div",null,t||0===t?"".concat(t.toFixed(2),"%"):"_")}}]}],l=p.props.currentShop?(0,yt.zE)(p.props.currentShop.role):{},d=l.ql_nhaphang&&l.view_imported_price,h=parseInt(e.missing_price||0),g=parseInt(e.price||0),f=parseInt(e.excess_price||0),k=parseInt(e.change_price||0),_=[{key:"quantity",title:c("pages.shop.product.purchase.quantity"),actual:(0,Y.oH6)(e.current_quantity),currentActual:(0,Y.oH6)(e.current_quantity+e.change),change:{value:e.change,isMoney:!1},rateChange:0==e.current_quantity?"":100*Math.abs(e.change)/e.current_quantity,excessQuantity:(0,Y.oH6)(e.excess_quantity),missingQuantity:(0,Y.oH6)(e.missing_quantity)},{key:"importedPrice",title:c("pages.shop.product.purchase.importedPrice"),actual:(0,Y.ufS)(e.import_price,i.currency),currentActual:(0,Y.ufS)(e.import_price+e.change_import_price,i.currency),change:{value:e.change_import_price,isMoney:!0},rateChange:0==e.import_price?"":100*Math.abs(e.change_import_price)/e.import_price,excessQuantity:(0,Y.ufS)(e.excess_import_price,i.currency),missingQuantity:(0,Y.ufS)(e.missing_import_price,i.currency)},{key:"retailPrice",title:c("pages.shop.product.variation.retailPrice"),actual:d?(0,Y.ufS)(g,i.currency):"-",currentActual:d?(0,Y.ufS)(g+k,i.currency):"-",change:{value:k,isMoney:!0},rateChange:0==g?"":100*Math.abs(k)/g,excessQuantity:(0,Y.ufS)(f,i.currency),missingQuantity:(0,Y.ufS)(h,i.currency)}];if(!d){var y=u.findIndex((function(t){return"rateChange"==t.dataIndex}));u.splice(y,1);var v=_.findIndex((function(t){return"importedPrice"==t.key}));_.splice(v,1)}return vt("div",{style:{width:"100%",padding:"16px 16px 24px 16px"}},vt("div",{style:{display:"flex",justifyContent:"space-between",paddingBottom:10}},vt("div",{style:{fontWeight:500,fontSize:16}},c("pages.shop.product.stocktaking.stocktakingStatistic"),": ",c("pages.shop.product.stocktaking.stocktakings")," ",vt("span",{style:{fontWeight:500,color:"#096dd9"}},"#",o&&o.display_id)),vt(nt.Z,{title:c("pages.shop.product.export.exportToExcel"),icon:vt(E.Z,null),color:"#00d1b2",onClick:function(){return p.handleStatisticExportExcel()}})),vt(s.Z,{columns:u,dataSource:_,bordered:!0,size:"middle",pagination:!1,loading:a}),vt("div",{style:{marginTop:16}},vt(r.default,{description:p.renderNoteStatistic(),type:"warning"})))})),(0,I.Z)((0,m.Z)(p),"renderSearchProduct",(function(){var t=p.props.t;return vt("div",{className:"info-item text-align-left",style:{display:"flex",justifyContent:"flex-end"}},vt(Zt,{placeholder:t("components.productPurchaseDetail.textSearch"),allowClear:!0,style:{width:350},onChange:function(t){return p.setState({searchProduct:t.target.value})}}))})),(0,I.Z)((0,m.Z)(p),"renderNoteStatistic",(function(){var t=p.props.t;return vt("div",{className:"warning-statistic"},vt("strong",null,t("pages.shop.product.stocktaking.note"),":")," ",t("pages.shop.product.stocktaking.statisticInfo1")," ",vt("br",null),vt("div",null,t("pages.shop.product.stocktaking.statisticInfo2")),vt("div",null,t("pages.shop.product.stocktaking.statisticInfo3")),vt("div",null,t("pages.shop.product.stocktaking.statisticInfo4")),vt("div",null,t("pages.shop.product.stocktaking.statisticInfo5")),vt("strong",null,"-",">")," ",t("pages.shop.product.stocktaking.statisticInfo6"),vt("br",null),vt("div",null,"- ",t("pages.shop.product.stocktaking.excess")," = A(3) + B(0) + C(0) + D(2) = 5"),vt("div",null,"- ",t("pages.shop.product.stocktaking.missing")," = A(0) + B(0) + C(1) + D(0) = 1"))})),(0,I.Z)((0,m.Z)(p),"fetchStatistic",(function(){var t=p.props,e=t.stocktakingStatistic,a=t.accessToken,n=t.shopId,i=t.stocktaking;p.setState({statisticLoading:!0}),i&&e(a,n,{stocktaking_id:i.id}).then((function(t){t&&t.success&&p.setState({statistic:t.data,statisticLoading:!1})}))})),(0,I.Z)((0,m.Z)(p),"handleTab",(function(t){p.setState({tabKey:t}),"statistic"==t&&p.fetchStatistic()})),(0,I.Z)((0,m.Z)(p),"handleSetPrintBarcode",(function(){var t=p.props,e=t.shopId,a=t.accessToken,n=t.currentShop,i=p.state.stocktaking,o=[];return i.items&&i.items.length>0&&i.items.forEach((function(t){var e=o.findIndex((function(e){return t.variation.id==e.id}));-1!=e?o[e]=bt(bt({},o[e]),{},{printQuantity:o[e].printQuantity+t.quantity}):o.push(bt(bt({},t.variation),{},{printQuantity:t.current_quantity+t.changed_quantity,variation_warehouses:[t.variation_warehouse]}))})),vt("span",{style:{marginRight:12}},vt(kt.Z,{accessToken:a,shopId:e,currentShop:n,variations:o,createAndPrint:!0,onRef:function(t){p.child=t},isType:"barcode",noTitle:!0,width:40}))})),(0,I.Z)((0,m.Z)(p),"renderModalTitle",(function(){var t=p.state,e=t.isCreating,a=t.stocktaking,n=t.tabKey,i=p.props.t;return e?vt("div",{style:{padding:"18px 24px"}},i("pages.shop.product.stocktaking.stocktakingDetail")," ",e?"":a&&a.display_id||""):vt(Z.default,{className:"title-export-detail",activeKey:n,onChange:p.handleTab},vt(xt,{tab:"".concat(i("pages.shop.product.stocktaking.stocktakingDetail")," #").concat(a&&a.display_id||""),key:"stocktaking"}),vt(xt,{tab:i("pages.shop.statistic.manageReports.report"),key:"statistic"}))})),(0,I.Z)((0,m.Z)(p),"renderModalFooter",(function(){var t,e=p.props,a=e.t,n=e.close,r=p.state,s=r.isLoading,c=r.isCreating,u=r.stocktaking,l=r.isLoadingItem,d=r.tabKey,h=r.createAndPrint,g=u.items&&u.items.findIndex((function(t){return 1==t.warning_batch})),f=u.items&&u.items.findIndex((function(t){return 1==t.warning_shelf})),k=u.is_batch_shelf?g||f:u.items&&u.items.findIndex((function(t){return 1==t.warning})),_=l||0==(null===u||void 0===u||null===(t=u.items)||void 0===t?void 0:t.length)&&!c||-1!==k&&!c||0!=u.status;return c||"statistic"!=d?vt("div",{style:{display:"flex",justifyContent:"space-between"}},vt("span",{style:{display:"flex",alignItems:"center"}},u.warehouse_id&&0==u.status&&vt("span",{onClick:function(){return p.setState({visibleListProduct:!0})},style:{cursor:"pointer"}},vt(A.Z,null),"\xa0",a("pages.shop.product.stocktaking.listProductNotStocktaking"))),vt("span",null,!_&&vt(o.default,{onChange:function(){p.setState({createAndPrint:!h}),localStorage.setItem("printBarcodeStocktaking",!h)},checked:h},a(c?"components.productComboDetail.createAndPrintBarcode":"components.productComboDetail.saveAndPrintBarcode")),h&&!_&&p.handleSetPrintBarcode(),_&&p.handleSetPrintBarcode(),vt(U.Z,{size:"large",stocktaking:p.state.stocktaking,t:a,onChange:function(t){return p.setState({stocktaking:bt(bt({},u),{},{status:t})})},disabled:!0}),vt(i.default,{type:"primary",style:{marginLeft:12},icon:vt(s?T.Z:j.Z,null),onClick:function(){s||l||(_?(p.child.handlePrint(),setTimeout((function(){n()}),500)):p.handleConfirm())}},c?a("components.productCategory.create"):_?"".concat(a("components.variationBarcodePrinter.print")," Barcode"):a("save")))):null}));var v=t.stocktaking;v=O()(v)||{warehouse_id:t.warehouses.length>0&&t.warehouses?t.warehouses[0].id:void 0,status:0,items:[]};var b=.8*(.95*((null===(n=window)||void 0===n?void 0:n.innerWidth)||1200)-48);return p.state={stocktaking:v,isLoading:!1,isCreating:!t.stocktaking||!t.stocktaking.id,searchResult:[],totalEntries:null,currentPage:null,variations:[],onScreenBarcode:!1,isResizing:!1,isLoadingItem:!v.items,visibleListProduct:!1,widthColumns:JSON.parse(localStorage.getItem("columns_width_stocktaking_detail_table"))||{},searchProduct:"",selectedId:null,search_by:"variation",sorterVariationId:void 0,tabKey:"stocktaking",statistic:{},statisticLoading:!1,createAndPrint:JSON.parse(localStorage.getItem("printBarcodeStocktaking"))||!1,scrollIndex:0,isSelectItem:!1},p.tableWidth=Math.floor(b),p}return(0,v.Z)(a,[{key:"componentDidUpdate",value:function(t){var e=this,a=this.props,n=a.shopId,i=a.accessToken,o=a.warehouses,r=a.selectedRowKeys,s=a.visible,c=a.defaultParams,u=a.isLoadingItem,l=a.showStocktaking;if((0,Y.oSE)(qt),!t.visible&&s){var d=this.props.stocktaking||{warehouse_id:o&&o.length>0&&o[0].id,items:[],note:"",shop_id:n,status:0,is_batch_shelf:!1};if(this.setState({stocktaking:d,isCreating:!this.props.stocktaking||!this.props.stocktaking.id,isLoadingItem:!d.items||u||!1}),!d.items&&s&&!u){var p=this.props;l(p.accessToken,p.shopId,d.id).then((function(t){e.setState({stocktaking:t,isLoadingItem:!1})}))}}if(t.visible!=s&&s&&"statistic"==this.state.tabKey&&this.fetchStatistic(),s&&r&&r.length>0&&this.state.isLoadingItem){var h=[],g={warehouse_id:o[0].id,items:[],note:"",shop_id:n,status:0},f="".concat((0,Y.LpH)(),"/shops/").concat(n,"/products/variations?access_token=").concat(i),k=bt(bt({},c),{},{variation_ids:r,page:-1});tt()({method:"get",url:f,params:k}).then((function(t){t.data&&t.data.success&&(t.data.data.map((function(t){if(r.includes(t.id)){var a=e.getVariationWarehouse(t.variations_warehouses,g.warehouse_id);g.items.push({variation_id:t.id,changed_quantity:0,current_quantity:a.actual_remain_quantity,quantity:a.actual_remain_quantity,variation_warehouse:a,manipulation_warehouses:t.product.manipulation_warehouses,variation:t}),h.push(t)}})),e.setState({stocktaking:g,variations:h})),e.setState({isLoadingItem:!1})}))}}},{key:"displayRender",value:function(t){return t[t.length-1]}},{key:"render",value:function(){var t=this,e=this.props,a=e.visible,n=e.accessToken,i=this.state,o=i.stocktaking,r=i.visibleListProduct,s=i.tabKey;return vt("div",null,a&&vt(k.Z,{className:"modal-detail stocktaking",visible:a,width:"95%",title:this.renderModalTitle(),onCancel:function(){return t.handleOnCancel()},footer:this.renderModalFooter()},"stocktaking"==s?this.renderContent():this.renderStocktakingStatistic()),r&&vt(dt,{accessToken:n,items:o.items,stocktaking:o,visibleListProduct:r,close:function(){return t.setState({visibleListProduct:!1})},warehouse_id:o.warehouse_id,callbackFillItem:function(e){return t.fillDataIntoItem(e)}}),vt("style",{dangerouslySetInnerHTML:{__html:H()}}))}}]),a}(D.Component))||ct,Pt=(0,L.$j)((function(t){return bt(bt(bt({warehouses:(0,K.op)(t),currentShop:t.shop.currentShop,timezone:t.navigation.user.timezone},(0,K.RR)(t)),(0,K.zN)(t)),{},{categories:(0,K.us)(t),userLocale:t.navigation.user.locale})}),{createStocktakings:V.y1I,updateStocktakings:V.ENA,showStocktaking:V.vDF,stocktakingStatistic:V.Gnd})(Ct)},9051:function(t,e,a){"use strict";var n=a(62443),i=a(65400),o=a(12386),r=a(74806),s=a(74047),c=a(52700),u=a(4706),l=a(33814),d=a(44102),p=a(20775),h=a(26265),g=a(44908),f=a.n(g),k=a(67294),_=a(14494),y=a(7085),v=a(57254),m=a(95213),b=a(36934),S=a(22318),w=a(74298),I=k.createElement;function Z(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,n)}return a}function x(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?Z(Object(a),!0).forEach((function(e){(0,h.Z)(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):Z(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function q(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,n=(0,p.Z)(t);if(e){var i=(0,p.Z)(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return(0,d.Z)(this,a)}}var C=function(t){(0,l.Z)(a,t);var e=q(a);function a(t){var n;return(0,s.Z)(this,a),n=e.call(this,t),(0,h.Z)((0,u.Z)(n),"getStatus",(function(){var t=n.props,e=t.stocktaking.id,a=t.hideActions,i=t.disabled;if(a||i)return[];if(!e)return[0];switch(n.state.status){case 0:return[1,2];default:return[]}})),(0,h.Z)((0,u.Z)(n),"getButtonStatus",(function(){return{"-2":{text:w.ZP.t("commons.all")},0:{text:w.ZP.t("stocktakings.stocktaking")},1:{text:w.ZP.t("tool.confirm")},2:{text:w.ZP.t("tool.cancelled")}}})),(0,h.Z)((0,u.Z)(n),"onClick",(function(t){var e=t.key,a=n.props,i=a.updateStocktakings,o=a.accessToken,r=a.shopId,s=a.stocktaking,c=a.showStocktaking,u=function(t){var a=t.items.findIndex((function(t){return t.variation_warehouse.actual_remain_quantity+t.changed_quantity<t.variation_warehouse.pending_transfer_quantity}));if(n.props.onChange)n.props.onChange(parseInt(e));else if(-1!=a&&2!=e){var s,c,u;n.setState({isLoading:!1});var l=(null===(s=t.items[a])||void 0===s?void 0:s.variation)||{},d=(null===(c=t.items[a])||void 0===c||null===(u=c.variation)||void 0===u?void 0:u.product)||{};S.Z.error(n.props.t("pages.shop.product.stocktaking.enterToManyQuantity"),"S\u1ea3n ph\u1ea9m: ".concat(null===d||void 0===d?void 0:d.name," (").concat((null===d||void 0===d?void 0:d.custom_id)||(null===d||void 0===d?void 0:d.display_id)," / ").concat((null===l||void 0===l?void 0:l.custom_id)||(null===l||void 0===l?void 0:l.display_id),")"))}else n.setState({isLoading:!0}),i(o,r,x(x({},t),{},{status:e})).then((function(t){n.setState({isLoading:!1,status:t?parseInt(e):n.state.status})}))};s.items?u(s):(n.setState({isLoading:!0}),c(o,r,s.id,!1).then(u))})),n.state={isLoading:!1,status:t.stocktaking.status},n}return(0,c.Z)(a,[{key:"componentDidUpdate",value:function(t){t.stocktaking.status!=this.props.stocktaking.status&&this.setState({status:this.props.stocktaking.status})}},{key:"render",value:function(){var t=this,e=this.state.isLoading,a=this.props,s=a.size,c=a.stocktaking,u=(0,m.Fps)()[c.status],l=this.getStatus(),d="large"==s;return d&&(l=f()(l.concat([this.state.status]))),1==c.status&&Math.round(c.progress)<100?I(r.default,{className:"updating-progress",strokeWidth:d?32:22,showInfo:d,percent:Math.floor(c.progress),status:"active",style:{width:d?300:140,marginRight:d?10:0}}):I(n.default,{content:I(o.default,{className:"dropdown-container",onClick:this.onClick},l.filter((function(t){return t!==c.status})).map((function(a){var n=t.getButtonStatus()[a];return I(o.default.Item,{disabled:e,key:a},n.text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},I(i.default,{type:"primary",style:{fontSize:"large"==s?14:12,width:"large"==s?170:140,height:"large"==s?40:22,background:u.bgColor,borderColor:u.bgColor,position:"relative",overflow:"hidden",padding:"0 5px"}},u.text,(this.state.isLoading||-1==c.status)&&I(y.Z,{style:{position:"absolute",left:0,top:"calc((100% / 2) - 6px)"}}),l.length>0&&!this.props.onChange&&I(v.Z,{style:{position:"absolute",right:5,top:"calc((100% / 2) - 5px)"}})))}}]),a}(k.Component);e.Z=(0,_.$j)(null,{updateStocktakings:b.ENA,showStocktaking:b.vDF})(C)}}]);