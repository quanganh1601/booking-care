(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7457],{7457:function(e,t,n){"use strict";var i,a=n(56697),o=n(4863),r=n(94055),d=n(59361),l=n(51024),s=n(65400),c=n(11187),u=n(28140),p=n(74047),g=n(52700),f=n(4706),h=n(33814),y=n(44102),m=n(20775),v=n(26265),C=n(50361),Z=n.n(C),x=n(44908),b=n.n(x),S=n(67294),k=n(8212),D=n(49101),w=n(73171),P=n(92104),E=n(88282),F=n(87307),R=n(76570),O=n(95642),T=n(31731),I=n(95213),N=n(87217),j=n(51181),A=S.createElement;function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){(0,v.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,m.Z)(e);if(t){var a=(0,m.Z)(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return(0,y.Z)(this,n)}}var L=(0,N.Z)()(i=function(e){(0,h.Z)(n,e);var t=_(n);function n(e){var i;return(0,p.Z)(this,n),i=t.call(this,e),(0,v.Z)((0,f.Z)(i),"onSelect",(function(e){var t=i.state.expandedKeys,n=(0,u.Z)(t),a=n.findIndex((function(t){return t==e[0]})),o=i.props.categories.find((function(t){return t.id==e[0]}));o&&!o.nodes.length||(a>-1?n.splice(a,1):n=b()(t.concat(e)),i.setState({expandedKeys:n,autoExpandParent:!1}))})),(0,v.Z)((0,f.Z)(i),"findCategory",(function(e){var t=null;return i.props.categories.forEach((function(n){n.id==e&&(t=Z()(n))})),t})),(0,v.Z)((0,f.Z)(i),"onExpand",(function(e){i.setState({expandedKeys:e,autoExpandParent:!1})})),(0,v.Z)((0,f.Z)(i),"onSearchChange",(function(e){var t=e.target.value,n=(0,u.Z)(i.state.expandedKeys);if(t){n=[];!function e(i,a){i.forEach((function(i){var o,r,d=i.text||i.name,l=(0,I.Mle)(d).indexOf((0,I.Mle)(t))>-1,s=[];if(null!==(o=i.nodes)&&void 0!==o&&o.length&&function e(t){var n;s.push(t.id),null!==(n=t.nodes)&&void 0!==n&&n.length&&t.nodes.map((function(t){return e(t)}))}(i),l&&a){var c,p=[a.id,i.id].concat(s);(c=n).push.apply(c,(0,u.Z)(p))}else if(l&&!a){var g;(g=n).push.apply(g,(0,u.Z)([i.id].concat(s)))}null!==(r=i.nodes)&&void 0!==r&&r.length&&e(i.nodes,i)}))}(i.props.categories),n=b()(n)}else t||(n=[]);i.setState({search:t,autoExpandParent:!0,expandedKeys:n})})),(0,v.Z)((0,f.Z)(i),"handleAction",(function(e,t){t=t||i.state.selected;var n={name:""};"create"!=e&&"createChildren"!=e&&(n.id=t.id,n.name=t.text||t.name),"delete"==e&&(n.is_removed=!0),"createChildren"==e&&t&&(n.parent_id=t.id),"delete"!=e&&setTimeout((function(){var e;return null===(e=i.input)||void 0===e?void 0:e.focus()})),i.setState({editting:n,action:e})})),(0,v.Z)((0,f.Z)(i),"onNameChange",(function(e){var t=B({},i.state.editting);t.name=e.target.value,i.setState({editting:t})})),(0,v.Z)((0,f.Z)(i),"handleSave",(function(){var e=i.state,t=e.editting,n=e.action,a=e.isLoading,o=i.props,r=o.createData,d=o.updateData,l=o.deleteData,s=o.t,u=o.fetchData,p=o.callBackFetchData;if(!t.name)return c.default.warning(s("components.productCategory.nameTagNotEmpty"));a||(i.setState({isLoading:!0}),"create"!=n&&"createChildren"!=n?"update"!=n?"delete"!=n||l&&l(t).then((function(e){i.setState({isLoading:!1,editting:null,selected:null,action:""}),u&&u(),p&&p()})):d&&d(t).then((function(e){i.setState({isLoading:!1,editting:null,selected:null,action:""}),u&&u()})):r&&r(t).then((function(e){i.setState({isLoading:!1,editting:null,action:""}),u&&u()})))})),(0,v.Z)((0,f.Z)(i),"onDrop",(function(e){var t,n,a,o=i.props,r=o.updateData,d=o.dispatch,l=o.categories,s=e.node.key,c=e.dragNode.key,p=e.node.pos.split("-"),g=e.dropPosition-Number(p[p.length-1]),f=function e(t,n,i){t.forEach((function(t,a,o){t.id!==n?t.nodes&&e(t.nodes,n,i):i(t,a,o)}))},h=(0,u.Z)(l);(f(h,c,(function(e,n,i){i.splice(n,1),t=e})),0===g)?f(h,s,(function(e){e.nodes=e.nodes||[],e.nodes.unshift(t)})):(f(h,s,(function(e,t,i){n=i,a=t})),-1===g?n.splice(a,0,t):n.splice(a+1,0,t));var y=-1;0===g&&(y=s),1===g&&(y=i.findParent(s,l||[])),r(B(B({},t),{},{parent_id:y})).then((function(){d({type:"FETCH_CATEGORIES",payload:h})}))})),(0,v.Z)((0,f.Z)(i),"findParent",(function(e,t){return t.reduce((function(t,n){return-1==t?n.nodes.map((function(e){return e.id})).includes(e)?t=n.id:i.findParent(e,n.nodes||[]):t}),-1)})),(0,v.Z)((0,f.Z)(i),"getDragCategories",(function(e){var t=i.state,n=t.action,a=t.editting,o=[],r=Z()(e),d=i.props.categories.map((function(e){return e.id}));return r.forEach((function(e){var t,r={height:40};"createChildren"==n&&e.id==(a||{}).parent_id&&(r={height:88,background:"#F0F5FF"}),"update"==n&&e.id==(a||{}).id&&(r={height:46,background:"#F0F5FF"}),"delete"==n&&e.id==(a||{}).id&&(r={height:96,background:"#FFF1F0"}),e.is_removed||o.push({title:i.renderItemTitle(e),key:e.id,children:(null===(t=e.nodes)||void 0===t?void 0:t.length)>0?i.getDragCategories(e.nodes):[],style:B(B({},r),{},{width:"100%",display:"flex",borderTop:d.includes(e.id)?"1px solid #D9D9D9":"none"})})})),o})),(0,v.Z)((0,f.Z)(i),"renderItemTitle",(function(e){if(!e)return"";var t=i.state,n=t.search,a=t.action,o=t.editting,r=i.props,d=r.t,l=r.disableChildren,c=e.text||e.name,u=(0,I.Mle)(c).indexOf((0,I.Mle)(n)),p=c.substr(0,u),g=c.substr(u,n.length),f=c.substr(u+n.length);return"update"==a&&e.id==(o||{}).id?i.renderUpdateItem():u>-1?A("div",null,A("div",{style:{display:"flex",width:"100%",justifyContent:"space-between"}},A("div",null,p,A("span",{style:{color:"#f50"}},g),f),!a&&A("div",{className:"actions"},A(k.Z,{style:{marginRight:10},onClick:function(t){t.stopPropagation(),i.handleAction("update",e)}}),!l&&A(D.Z,{style:{marginRight:10},onClick:function(t){t.stopPropagation(),i.handleAction("createChildren",e)}}),A(w.Z,{onClick:function(t){t.stopPropagation(),i.handleAction("delete",e)}}))),"createChildren"==a&&(o||{}).parent_id==e.id&&i.renderUpdateItem(),"delete"==a&&(o||{}).id==e.id&&A("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderTop:"1px solid #FFA39E",paddingTop:8,marginTop:8}},A("div",null,A("div",null,"B\u1ea1n c\xf3 ch\u1eafc mu\u1ed1n x\xf3a danh m\u1ee5c n\xe0y?"),A("div",null,"Sau khi xo\xe1 c\xe1c SP hi\u1ec7n thu\u1ed9c danh m\u1ee5c n\xe0y s\u1ebd kh\xf4ng c\xf3 danh m\u1ee5c")),A("div",null,A(s.default,{onClick:function(e){e.stopPropagation(),i.setState({editting:null,action:"",selected:null})},style:{marginRight:12}},d("cancel")),A(s.default,{onClick:i.handleSave,icon:A(w.Z,null),type:"danger"},d("delete"))))):A("span",null,c)})),(0,v.Z)((0,f.Z)(i),"renderUpdateItem",(function(){var e=i.state,t=e.editting,n=e.isLoading,a=e.action,o=i.props,r=o.t,d=o.isReturnedReason;if(!t)return"";var c={};return"create"==a&&(c={border:"1px solid #ADC6FF",marginBottom:16,borderRadius:2,padding:"8px 16px",background:"#F0F5FF"}),"createChildren"==a&&(c={borderTop:"1px solid #ADC6FF",marginTop:8,borderRadius:2,paddingTop:8}),A("div",{style:B({display:"flex",justifyContent:"space-between",alignItems:"center"},c)},A(l.default,{value:t.name,onChange:i.onNameChange,placeholder:r(d?"components.productCategory.reason":"components.productCategory.category"),style:{width:"100%",marginRight:24},ref:function(e){return i.input=e}}),A("div",{style:{display:"flex"}},A(s.default,{onClick:function(e){e.stopPropagation(),i.setState({editting:null,action:"",selected:null})},style:{marginRight:12},disabled:n},r("cancel")),A(s.default,{loading:n,icon:A(P.Z,null),onClick:i.handleSave,type:"primary"},r("pages.shop.setting.application.save"))))})),(0,v.Z)((0,f.Z)(i),"handleAddDefault",(function(e){var t=i.props,n=t.fetchData,a=t.createData,o={name:e.text,id:e.id};a&&a(o).then((function(e){i.setState({isLoading:!1,editting:null,action:""}),n&&n()}))})),(0,v.Z)((0,f.Z)(i),"getValidExpandsKeys",(function(e,t){if(!t.length||!i.state.search)return e;var n=function e(n){return n.find((function(n){var i;return!!t.includes(n.key)||!(null===(i=n.children)||void 0===i||!i.length)&&e(n.children)}))};return e.filter((function(e){return t.includes(e.key)||n(e.children)}))})),(0,v.Z)((0,f.Z)(i),"customSwitcherIcon",(function(e){var t=e.isLeaf,n=e.expanded;return t?A("img",{style:{width:16,height:16},src:"/static/img/TagChevron.svg"}):A(n?E.Z:F.Z,null)})),(0,v.Z)((0,f.Z)(i),"countAllCategories",(function(e){var t=0;return e.map((function(e){var n;t+=1,(null===(n=e.nodes)||void 0===n?void 0:n.length)>0&&(t+=i.countAllCategories(e.nodes))})),t})),(0,v.Z)((0,f.Z)(i),"renderTreeSelect",(function(){var e=i.state,t=e.expandedKeys,n=e.autoExpandParent,a=e.selectedKeys,o=e.search,c=e.action,u=i.props,p=u.t,g=u.categories,f=u.canDrag,h=u.isReturnedReason,y=[{id:1,text:p("containers.formBoxModal.byCustomer")},{id:2,text:p("containers.formBoxModal.byEmployee")},{id:3,text:p("containers.formBoxModal.byErrorProduct")},{id:4,text:p("containers.formBoxModal.byShippingPartner")},{id:5,text:p("containers.formBoxModal.byChangeOrder")}].filter((function(e){return!(g||[]).map((function(e){return e.id})).includes(e.id)})),m=i.getDragCategories(g),v=70*window.innerHeight/100-150;return A("div",{className:"draggable-demo",style:{cursor:"pointer"}},h&&A("div",{className:"order-source-popular",style:{display:"flex",marginBottom:10}},A("div",{style:{marginRight:10}},p("components.orderSourceDetail.returnedReasonPopular"),": "),A("div",null,y.map((function(e,t){if(-1==g.findIndex((function(t){return t.id==e.id})))return A(r.default,{title:p("components.orderSourceDetail.clickToAddReason")},A(d.default,{style:{cursor:"pointer",marginTop:t>3?5:0},color:"blue",onClick:function(){return i.handleAddDefault(e)}},e.text))})))),A(l.default,{placeholder:p(h?"components.productCategory.searchReturnedReason":"components.productCategory.searchCategory"),style:{width:"100%"},onChange:i.onSearchChange,value:o,prefix:A(R.Z,null)}),A("div",{style:{display:"flex",justifyContent:"space-between",margin:"16px 0px",alignItems:"center"}},A("div",{style:{color:"#595959"}},A("span",{style:{fontWeight:700}},p("components.productCategory.totalCategories"),":"),"\xa0",A("span",null,i.countAllCategories(g))),A(s.default,{icon:A(D.Z,null),type:"primary",onClick:function(){return i.handleAction("create")},disabled:"create"==c},p("components.productCategory.create"))),"create"==c&&i.renderUpdateItem(),g&&g.length>0?A(S.Fragment,null,A(j.Z,{expandedKeys:t,onExpand:i.onExpand,draggable:f,autoExpandParent:n,onDrop:i.onDrop,treeData:i.getValidExpandsKeys(m,t),height:v,virtual:!1,onSelect:i.onSelect,selectedKeys:a,showIcon:!1,switcherIcon:i.customSwitcherIcon,rootClassName:"categories-tree"}),A("div",{draggable:!0})):A("div",{className:"empty-text"},p("components.productCategory.noCategory")))})),i.state={modalVisible:!1,selected:null,search:"",selectedKeys:[],expandedKeys:[],editting:null,isLoading:!1,autoExpandParent:!0,action:""},i}return(0,g.Z)(n,[{key:"render",value:function(){var e=this,t=this.state.modalVisible,n=this.props,i=n.t,r=n.isButton,d=n.title,l=n.disableChildren,c=n.isReturnedReason;return A("div",{style:{display:"inline-block"}},!c&&A(T.Z,{icon:A(O.Z,null),title:d,onClick:function(){return e.setState({modalVisible:!0})},isButton:r}),c&&A(s.default,{className:"setting-button",onClick:function(){return e.setState({modalVisible:!0})}},A("span",{className:"setting-button-title"},i("pages.shop.setting.list")),A("span",{className:"icon-setting"},A(k.Z,null))),A(a.Z,{wrapClassName:"drag-categories-tree",visible:t,title:A("span",null,A(O.Z,null)," ",d),closable:!1,width:900,footer:l?null:A(o.default,{message:i(c?"components.productCategory.suggestReason":"components.productCategory.suggest"),type:"info",showIcon:!0,style:{width:"fit-content"}}),onCancel:function(){return e.setState({modalVisible:!1,search:"",editting:null,selected:null,expandedKeys:[],selectedKeys:[],action:""})}},this.renderTreeSelect()))}}]),n}(S.Component))||i;t.Z=L}}]);