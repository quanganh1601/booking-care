(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4560],{89651:function(e){!function(){"use strict";e.exports=".export-advance-filter .ant-btn{border-radius:2px !important}.cascader-filter-export .ant-cascader-menu{min-width:150px}.cascader-filter-export input{border-radius:2px !important}"}()},89181:function(e){!function(){"use strict";e.exports=".purchase-printer{font-size:14px;font-family:Arial,Helvetica,sans-serif;color:#000;background-color:#fff}.purchase-printer .title{font-size:18px;display:flex;justify-content:center;text-align:center}.purchase-printer .info{margin-top:16px}.purchase-printer .info>div{padding-bottom:3px}.purchase-printer .info>div>div{padding-bottom:3px}.printer-exports .export-printer-container{width:200px}.printer-exports .export-printer-container .printer-export-content .item-content{padding:10px 5px}.printer-exports .export-printer-container .printer-export-content .item-content .label{display:block;font-weight:600;line-height:20px;padding-bottom:5px}.printer-exports .export-printer-container .printer-export-content .item-content:not(:last-child){border-bottom:1px dashed #d9d9d9}.printer-exports .export-printer-container .printer-export-content .item-content .ant-select{width:100%}.printer-exports .export-printer-container .printer-export-footer{display:flex;flex-direction:row;justify-content:flex-end;padding:5px 5px 0 5px;border-top:1px solid #e8e8e8}"}()},20051:function(e,t,r){"use strict";var n,o=r(28140),a=r(51024),i=r(31059),s=r(74048),c=r(74047),l=r(52700),u=r(4706),p=r(33814),d=r(44102),f=r(20775),h=r(26265),m=r(64713),v=r(14321),g=r(18446),y=r.n(g),_=r(50361),x=r.n(_),b=r(67294),S=r(14494),Z=r(87217),A=r(7690),O=r(97705),I=r(37508),E=r(89651),k=r.n(E),w=r(79508),P=r(31432),M=r(95213),C=r(30381),T=r.n(C),F=r(36934),N=b.createElement;function R(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,f.Z)(e);if(t){var o=(0,f.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,d.Z)(this,r)}}var L=v.default.RangePicker,U=m.default.Group,D=(0,Z.Z)()(n=function(e){(0,p.Z)(r,e);var t=R(r);function r(e){var n;return(0,c.Z)(this,r),n=t.call(this,e),(0,h.Z)((0,u.Z)(n),"handleSelectVariation",(function(e){var t=n.props.params,r=n.state.searchResult,o=r.findIndex((function(t){return t.id==e})),a="".concat(r[o].product.name," (").concat(r[o].custom_id||r[o].display_id,")");t.variation_id=e,n.handleSelectItem(a,t,"variation_id")})),(0,h.Z)((0,u.Z)(n),"handleSelectItem",(function(e,t,r){var o=n.state.filters,a=o.findIndex((function(e){return e.key==r}));-1!=a?o[a].value=e:o.push({id:t.variation_id||t.accessories_variation_id||t.product_id,key:r,value:e}),n.props.fetch(o)})),(0,h.Z)((0,u.Z)(n),"handleSelectProduct",(function(e){var t=n.props.params,r=n.state.searchResultProduct,o=r.findIndex((function(t){return t.id==e})),a="".concat(r[o].name," (").concat(r[o].custom_id||r[o].display_id,")");t.product_id=e,n.handleSelectItem(a,t,"product_id")})),(0,h.Z)((0,u.Z)(n),"renderResult",(function(e){var t=n.props,r=t.t,o=t.currentShop,a=t.warehouses;return("variaion"==e?n.state.searchResult:n.state.searchResultProduct).map((function(t,i){return{value:"variation-".concat(i),label:N("div",{onClick:function(r){r.stopPropagation(),"variaion"!=e?n.handleSelectProduct(t.id):n.handleSelectVariation(t.id)}},N(I.Z,{width:"variaion"!=e?300:448,t:r,key:i,currentShop:o,combo_by:"variaion"!=e?"product":"variation",item:t,warehouses:a}))}}))})),(0,h.Z)((0,u.Z)(n),"onChangeFilterAndOr",(function(e){var t=n.props.fetch,r=n.state.filters,o=r.find((function(e){return"tags"==e.key}));n.setState({isFilterTagByOr:e},(function(){o&&t(r,{isFilterTagByOr:e})}))})),(0,h.Z)((0,u.Z)(n),"renderFilterAndOr",(function(e){var t=n.props.t;return N(U,{className:"radio-filter-order-tag",onChange:function(e){return n.onChangeFilterAndOr(e.target.value)},value:e,style:{marginLeft:15,marginTop:10}},N(s.default,{direction:"vertical"},N(m.default,{value:!0},t("components.orderAdvanceFilter.filterByConditionOr")),N(m.default,{value:!1},t("components.orderAdvanceFilter.filterByConditionAnd"))))})),(0,h.Z)((0,u.Z)(n),"handleChangeFilterExclude",(function(e,t,r){var o=n.props.fetch,a=n.state.filters,i=a.find((function(e){return e.key==r}));n.setState((0,h.Z)({},t,e),(function(){if(i){var r=(0,h.Z)({},t,e);o(a,r)}}))})),(0,h.Z)((0,u.Z)(n),"renderFilterExclude",(function(e,t,r){var o=n.props.t;return N("span",{onClick:function(e){return e.stopPropagation()}},N(i.default,{style:{width:"100%"},checked:e,onChange:function(e){return n.handleChangeFilterExclude(e.target.checked,t,r)}},o("components.orderAdvanceFilter.filterExclude")))})),(0,h.Z)((0,u.Z)(n),"getOptions",(function(){var e,t=n.props,r=t.supplier_products,s=t.t,c=t.params,l=t.employeeList,u=t.users,p=t.warehouses,d=t.accessToken,f=t.shopId,m=t.tags_export,v=n.state,g=v.searchResultProduct,y=v.searchResult,_=v.type,x=v.supplierText,b=v.filterExcludeSupplier,S=v.isFilterTagByOr,Z=v.filterExcludeTag,A=l&&l.length?l.findIndex((function(e){return"creator_id"==e.which&&"exportFilter"==e.type})):-1,I=-1==A?u:l[A].users,E=A>-1?l[A].text:void 0,k=I.map((function(e){var t=e.user_id;return{value:t,label:n.renderLabel("creator_id",t,(0,M.q$s)(t,I))}})),w=(r||[]).filter((function(e){return(0,M.vo8)(e,x)})).map((function(e){return{value:e.id,label:n.renderLabel("supplier_products_id",e.id,e.name)}})),P=[{value:"supplier_products_id",label:s("pages.shop.debt.supplierProducts"),children:[{value:"search",label:N("div",{onClick:function(e){return e.stopPropagation()}},N(a.default,{onChange:function(e){var t;return n.setState({supplierText:null===e||void 0===e||null===(t=e.target)||void 0===t?void 0:t.value})},value:x,placeholder:s("components.orderAdvanceFilter.enterSupplier"),allowClear:!0}))},{label:N("span",{onClick:function(e){return e.stopPropagation()}},N(i.default,{style:{width:"100%"},checked:b,onChange:function(e){return n.handleChangeFilterExclude(e.target.checked,"filterExcludeSupplier","supplier_products_id")}},s("components.orderAdvanceFilter.filterExclude"))),disabled:!0,value:"filter_exclude_supplier"}].concat(w)}],C=[{label:N("div",{onClick:function(e){return e.stopPropagation()}},N("div",null,s("components.orderAdvanceFilter.filterMultipleTag")),n.renderFilterAndOr(S)),value:"is_filter_by_and_or"},{label:n.renderFilterExclude(Z,"filterExcludeTag","tags"),disabled:!0,value:"filter_exclude_tag"},{label:s("crm.notTag"),value:"no_tag"}];m.map((function(e){C.push({value:e.id,label:e.name})}));var F=[{value:"tags",label:s("components.orderAdvanceFilter.tag"),children:C}];F=F.concat(P);var R=[{value:"inserted_at",label:s("pages.shop.debt.insertedAt"),children:[{value:"inserted_at",label:N("span",{onClick:function(e){return e.stopPropagation()}},N(L,{ranges:(e={},(0,h.Z)(e,s("pages.shop.statistic.yesterday"),[T()().add(-1,"days").startOf("day"),T()().add(-1,"days").endOf("day")]),(0,h.Z)(e,s("pages.shop.statistic.today"),[T()().startOf("day"),T()().endOf("day")]),(0,h.Z)(e,s("pages.shop.statistic.lastWeek"),[T()().add(-7,"days").startOf("day"),T()().endOf("day")]),(0,h.Z)(e,s("pages.shop.statistic.lastMonth"),[T()().add(-30,"days").startOf("day"),T()().endOf("day")]),(0,h.Z)(e,s("pages.shop.statistic.thisMonth"),[T()().startOf("month").startOf("day"),T()().endOf("month").endOf("day")]),e),value:c&&c.end_date&&c.start_date?[T()(c.start_date,"X"),T()(c.end_date,"X")]:[],format:"DD/MM/YYYY",style:{width:300,marginRight:10},onChange:function(e){return n.onChangeFilterDate(e,"inserted_at")}}))}]},{value:"creator_id",label:s("pages.shop.debt.creator"),children:[{value:100,label:N("div",{onClick:function(e){return e.stopPropagation()}},N(a.default,{onChange:function(e){return n.handleSearchEmployee(e,"creator_id")},value:E,placeholder:s("components.orderAdvanceFilter.enterEmployee"),allowClear:!0}))},{value:"created_by_user",label:N("div",null,s("pages.shop.product.purchase.createdByUser"))},{value:"created_by_system",label:N("div",null,s("pages.shop.product.purchase.createdBySystem"))}].concat(k)},{value:"warehouse_id",label:s("pages.shop.debt.warehouse"),children:p.map((function(e){return{value:e.id,label:n.renderLabel("warehouse_id",e.id,e.name)}}))},{value:"variation",label:s("pages.shop.statistic.variation"),children:[{disabled:!0,value:"product_accessories",label:N("div",{onClick:function(e){return e.stopPropagation()}},N(O.Z,{className:"custom-search-bar",accessToken:d,shopId:f,searchResult:y,callback:function(e){return n.setState({searchResult:e})},is_filter:!0,searchOnly:!0,combo_by:"variation"}))}].concat((0,o.Z)(n.renderResult("variaion")))}];return"product"==_&&F.push({value:"product",label:s("products.title"),children:[{disabled:!0,value:"product_search",label:N("span",{onClick:function(e){return e.stopPropagation()}},N(O.Z,{className:"custom-search-bar",accessToken:d,shopId:f,searchResult:g,callback:function(e){return n.setState({searchResultProduct:e})},is_filter:!0,combo_by:"product",searchOnly:!0}))}].concat((0,o.Z)(n.renderResult("product")))}),F.concat(R)})),(0,h.Z)((0,u.Z)(n),"handleSearchEmployee",(function(e,t){var r=n.props.users,o=e.target?e.target.value:e;n.props.pushUsersTextSearch(o,r,t,"exportFilter")})),(0,h.Z)((0,u.Z)(n),"onChangeFilterDate",(function(e,t){var r=x()(n.state.filters),o=x()(n.props.params),a=r.findIndex((function(e){return e.key==t}));if(e&&e.length>0){var i=e[0].startOf("day").unix(),s=e[1].endOf("day").unix(),c={key:t,value:{startDate:e[0].startOf("day"),endDate:e[1].endOf("day")}};a>-1?r[a]=c:r.push(c),o.startDate=i,o.endDate=s}else o.startDate=void 0,o.endDate=void 0,a>-1&&r.splice(a,1);n.setState({filters:r},(function(){n.props.fetch(r)}))})),(0,h.Z)((0,u.Z)(n),"renderLabel",(function(e,t,r,o){var a=n.state.filters;return N("div",{style:{display:"flex",justifyContent:"space-between"}},N("div",null,r),a.find((function(r){return r.key==e&&(r.value==t||r.value.length>1&&r.value[0]==o&&r.value[1]==t)}))&&N("div",{style:{marginLeft:10}},N(w.Z,{style:{color:"#096dd9"}})))})),(0,h.Z)((0,u.Z)(n),"onChangeCascader",(function(e,t){var r=n.state,o=r.filterExcludeTag,a=r.isFilterTagByOr,i=r.filterExcludeSupplier;if((1!=t.length||!t[0].isRoot)&&e){var s,c,l=n.state.filters;switch(e.length){case 1:s=e[0],c=!0;break;case 2:s=e[0],c=e[1]}var u,p={key:s,value:c};if(["supplier_products_id","tags"].includes(s)?(u=l.findIndex((function(e){return e.key==s&&e.value==c})),"no_tag"==c&&(l=l.filter((function(e){return"tags"!=e.key})))):u=l.findIndex((function(e){return e.key==s})),-1!=u&&l.splice(u,1),l.push(p),n.setState({filters:l}),"tags"==s){var d={};return a&&(d.is_filter_tag_by_or=a),o&&(d.filter_exclude_tag=o),n.props.fetch(l,d)}return"supplier_products_id"==s&&i?n.props.fetch(l,{filterExcludeSupplier:i}):n.props.fetch(l)}})),n.state={filters:[],searchResult:[],searchResultProduct:[],type:"product",filterExcludeSupplier:e.filterExcludeSupplier||!1,filterExcludeTag:e.filterExcludeTag||!1,isFilterTagByOr:e.filterExcludeTag||!0},n}return(0,l.Z)(r,[{key:"componentDidUpdate",value:function(e){y()(this.props.filters,e.filters)&&y()(this.state.filters,e.filters)||this.setState({filters:this.props.filters})}},{key:"render",value:function(){return N("div",{className:"export-advance-filter"},this.getOptions().length>0?N(b.Fragment,null,N(A.Z,{id:this.props.id,options:this.getOptions(),popupClassName:this.props.className||"cascader-filter-export",onChange:this.onChangeCascader}),N("style",{dangerouslySetInnerHTML:{__html:k()}})):"")}}]),r}(b.Component))||n;t.Z=(0,S.$j)((function(e){return{currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone,employeeList:e.user.filterEmployeeList,users:e.user.users,warehouses:(0,P.op)(e),tags_export:e.product.tags_export}}),{pushUsersTextSearch:F.mw6})(D)},54320:function(e,t,r){"use strict";var n,o=r(62443),a=r(65400),i=r(74047),s=r(52700),c=r(4706),l=r(33814),u=r(44102),p=r(20775),d=r(26265),f=r(64749),h=r(67294),m=r(14494),v=r(9669),g=r.n(v),y=r(87217),_=r(7085),x=r(7945),b=r(31731),S=r(95213),Z=r(31432),A=r(28510),O=r(89181),I=r.n(O),E=r(52653),k=r(36934),w=h.createElement;function P(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function M(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?P(Object(r),!0).forEach((function(t){(0,d.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,p.Z)(e);if(t){var o=(0,p.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,u.Z)(this,r)}}var T=f.default.Option,F=(0,y.Z)()(n=function(e){(0,l.Z)(r,e);var t=C(r);function r(e){var n;return(0,i.Z)(this,r),n=t.call(this,e),(0,d.Z)((0,c.Z)(n),"componentDidMount",(function(){var e=n.props,t=e.accessToken,r=e.shopId;n.props.fetchPrintExports(t,r).then((function(){var e=n.props.printExports,t=e.length>0?(e.find((function(e){return e.default}))||e[0]).id.toString():null,r=localStorage.getItem("selectPrintExport");r=r&&e.find((function(e){return e.id==r}))?r:t,n.setState({labelId:r})}))})),(0,d.Z)((0,c.Z)(n),"handleFetchExport",(function(){var e,t=n.props,r=t.accessToken,o=t.shopId,a=t.keys,i=t.selectedData,s=t.selectedRowKeys,c={page:-1};switch(null!==i&&void 0!==i&&i.length&&"product"==a&&(c=M(M({},c),{},{display_ids:i.map((function(e){return e.display_id}))})),null!==s&&void 0!==s&&s.length&&"batch-shelf"==a&&(c=M(M({},c),{},{export_ids:s})),a){case"product":e="".concat((0,S.LpH)(),"/shops/").concat(o,"/export?access_token=").concat(r);break;case"batch-shelf":e="".concat((0,S.LpH)(),"/shops/").concat(o,"/batch_exports?access_token=").concat(r);break;case"product_defect":e="".concat((0,S.LpH)(),"/shops/").concat(o,"/export?access_token=").concat(r),c=M(M({},c),{},{status:-1,type:1})}i&&i.length>0&&"product"!=a?(n.setState({export_products:i}),n.handlePrint()):(n.setState({showLoading:!0}),g().get(e,{params:c}).then((function(e){e.data.success&&(n.setState({export_products:e.data.data}),n.handlePrint())})))})),(0,d.Z)((0,c.Z)(n),"handlePrint",(function(){return n.setState({isPrinting:!0},(function(){var e=document.getElementById(n.printDivId).innerHTML,t=document.createElement("iframe");t.name="frame1",t.style.position="absolute",t.style.top="-1000000px",document.body.appendChild(t);var r=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument;r.document.open(),r.document.write("\n          <!DOCTYPE html>\n            <head>\n                <style type='text/css'>\n                    @media print {\n                        @page {\n                            size: auto;\n                            margin: 6mm;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n              ".concat(e,"\n            </body>\n          </html>\n        ")),r.document.close(),setTimeout((function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(t)}),500),n.setState({isPrinting:!1,showLoading:!1})}))})),(0,d.Z)((0,c.Z)(n),"onChangeSelectLabel",(function(e){localStorage.setItem("selectPrintExport",e),n.setState({labelId:e})})),(0,d.Z)((0,c.Z)(n),"renderPrinter",(function(){var e=n.props,t=e.t,r=e.printExports,o=n.state,i=o.labelId,s=o.showLoading;return w("div",{className:"export-printer-container"},w("div",{className:"printer-export-content"},w("div",{className:"item-content"},w("label",{className:"label"},t("components.orderPrinter.selectPrintingForm")),w(f.default,{onFocus:function(){return n.setState({selecting:!0})},onBlur:function(){return n.setState({selecting:!1})},value:i?i+"":void 0,onChange:function(e){return n.onChangeSelectLabel(e)},placeholder:t("components.orderPrinter.printingForm")},r.map((function(e){return w(T,{key:e.id,value:e.id.toString()},e.name)}))))),w("div",{className:"printer-export-footer"},w(a.default,{icon:s?w(_.Z,null):void 0,className:"order-action-button",key:"print",type:"primary",disabled:s,onClick:n.handleFetchExport},t("confirmed"))))})),n.state={isPrinting:!1,export_products:[],selecting:!1,labelId:null},n.printDivId=(0,S.uuG)(),n}return(0,s.Z)(r,[{key:"render",value:function(){var e=this.state,t=e.isPrinting,r=e.export_products,n=e.labelId,a=this.props,i=a.isButton,s=a.t,c=a.printExports,l={pageBreakInside:"avoid",minHeight:"190mm",padding:"1mm"},u=n?parseInt(n):void 0,p=u&&c.find((function(e){return e.id==u}))||A.b8,d=p&&A._$.find((function(e){return e.id==p.paper_id}))||A._$[0];return w("div",{style:{display:"inline"}},w(o.default,{overlayClassName:"printer-exports",content:this.renderPrinter,trigger:"click",placement:"rightTop"},w(b.Z,{title:s("printProductDeliveryNotes"),icon:w(x.Z,null),isButton:i})),t&&w("div",{id:this.printDivId,className:"print-div"},r.map((function(e){return w("div",{key:e.id,style:l},w(E.Z,{key:e.id,data:e,params:p,paperSize:d,type:"exports"}))}))),w("style",{dangerouslySetInnerHTML:{__html:I()}}))}}]),r}(h.Component))||n;t.Z=(0,m.$j)((function(e){return{currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone,printExports:(0,Z.kE)(e)}}),{fetchPrintExports:k.j0i})(F)},74018:function(e,t,r){"use strict";var n,o=r(51024),a=r(74047),i=r(52700),s=r(4706),c=r(33814),l=r(44102),u=r(20775),p=r(26265),d=r(18446),f=r.n(d),h=r(23279),m=r.n(h),v=r(67294),g=r(14494),y=r(87217),_=r(76570),x=r(7145),b=r.n(x),S=v.createElement;function Z(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(r),!0).forEach((function(t){(0,p.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,u.Z)(e);if(t){var o=(0,u.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,l.Z)(this,r)}}var I=(0,y.Z)()(n=function(e){(0,c.Z)(r,e);var t=O(r);function r(e){var n;return(0,a.Z)(this,r),n=t.call(this,e),(0,p.Z)((0,s.Z)(n),"delaySearch",m()((function(){return n.props.fetch(n.state.params)}),800)),(0,p.Z)((0,s.Z)(n),"onChangeSearchText",(function(e){e.persist();var t=e.target.value;t?n.setState({params:A(A({},n.props.params),{},{search:t})}):n.setState({params:b()(n.props.params,{$unset:["search"]})}),n.delaySearch()})),n.state={params:A({},e.params)},n}return(0,i.Z)(r,[{key:"componentDidUpdate",value:function(e){f()(e.params,this.props.params)||this.setState({params:this.props.params})}},{key:"render",value:function(){var e=this.props,t=e.t,r=e.placeholder,n=this.state.params;return S(o.default,{placeholder:r||"".concat(t("pages.shop.product.purchase.displayId")," / ").concat(t("pages.shop.product.purchase.note")),onChange:this.onChangeSearchText,prefix:S(_.Z,null),value:n.search,className:"export-search-bar",style:{width:"44vw",left:450}})}}]),r}(v.Component))||n;t.Z=(0,g.$j)((function(e){return{currentShop:e.shop.currentShop}}),null)(I)},21037:function(e,t,r){"use strict";var n,o=r(56697),a=r(74806),i=r(28465),s=r(65400),c=r(4863),l=r(809),u=r.n(l),p=r(92447),d=r(74047),f=r(52700),h=r(4706),m=r(33814),v=r(44102),g=r(20775),y=r(26265),_=r(44908),x=r.n(_),b=r(50361),S=r.n(b),Z=r(67294),A=r(9669),O=r.n(A),I=r(90631),E=r(84189),k=r(79508),w=r(48176),P=r(14494),M=r(7145),C=r.n(M),T=r(36934),F=r(31731),N=r(95213),R=r(22318),L=r(87217),U=r(78598),D=r(31432),j=Z.createElement;function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=(0,g.Z)(e);if(t){var o=(0,g.Z)(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return(0,v.Z)(this,r)}}var H=["MA_KHO"],B=(0,L.Z)()(n=function(e){(0,m.Z)(r,e);var t=G(r);function r(e){var n;return(0,d.Z)(this,r),n=t.call(this,e),(0,y.Z)((0,h.Z)(n),"handleCloseModal",(function(){n.setState({isShowResult:!1,modalVisible:!1,fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[],dataError:[]})})),(0,y.Z)((0,h.Z)(n),"onDrop",(function(e){var t=e.file,r=n.props.t,o=new FileReader;o.readAsBinaryString(t),o.onload=function(e){var o=e.target.result,a=XLSX.read(o,{type:"binary"}),i=a.SheetNames[0],s=XLSX.utils.sheet_to_json(a.Sheets[i],{raw:!0});if(0!=s.length){var c=(0,N.wOl)(a.Sheets[i]),l=n.checkFields(c);if(0!=l.length)R.Z.error(r("error"),"".concat(r("components.orderImportExcel.fieldsNotFound"),": ").concat(l.join())),n.setState({productImportFile:[],fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[]});else{var u=x()(s.filter((function(e){return!e.MA_KHO&&e.TEN_KHO})).map((function(e){var t,r=null===(t=n.props.warehouses.find((function(t){return(0,N.Mle)(t.name)==(0,N.Mle)(e.TEN_KHO)})))||void 0===t?void 0:t.id;if(!r)return e.TEN_KHO;e.MA_KHO=r})).filter((function(e){return e}))).join(", ");if(u)return R.Z.error(r("error"),"Kh\xf4ng t\xecm th\u1ea5y kho ".concat(u)),void n.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]});var p=n.mergeWarehouseDuplicate(s);n.setState({productImportFile:p,fileName:t.name,importedCount:0,disableImportBtn:!1,isImporting:!1})}}else R.Z.error(r("error"),r("components.productImportExcel.index.fileExcelEmpty")),n.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]})}})),(0,y.Z)((0,h.Z)(n),"mergeWarehouseDuplicate",(function(e){var t,r={},n=!1;return e.map((function(e,o){t=e.MA_KHO?e.MA_KHO:t,0!=o||t||(n=!0),n||(t?r[t]?r[t].push({MA_SP:e.MA_SP,MA_MAU_MA:e.MA_MAU_MA,SO_LUONG:e.SO_LUONG,GIA_XUAT:e.GIA_XUAT}):r[t]=[e]:r[t].push({MA_SP:e.MA_SP,MA_MAU_MA:e.MA_MAU_MA,SO_LUONG:e.SO_LUONG,GIA_XUAT:e.GIA_XUAT}))})),n&&R.Z.error("L\u1ed7i","D\xf2ng \u0111\u1ea7u ti\xean kh\xf4ng t\u1ed3n t\u1ea1i kho"),r=Object.values(r).flat()})),(0,y.Z)((0,h.Z)(n),"checkFields",(function(e){return H.reduce((function(t,r){return-1==e.findIndex((function(e){return e==r}))&&t.push(r),t}),[])})),(0,y.Z)((0,h.Z)(n),"confirmImport",(function(){n.setState({isShowResult:!0,importedCount:0,disableImportBtn:!0,isImporting:!0},(function(){n.sendRequest(0)}))})),(0,y.Z)((0,h.Z)(n),"geProducttItems",(function(e){for(var t=n.state.productImportFile,r=[],o=t.length-1,a=0,i=S()(n.state.resultArr),s=!1,c=e;c<=o;c++)if(!s)if(t[c].MA_KHO)c==e?r.push({warehouse_id:t[c].MA_KHO,line_number:c+2,imported_price:0==t[c].GIA_XUAT?0:t[c].GIA_XUAT||null,quantity:t[c].SO_LUONG?t[c].SO_LUONG.toString():"1",product_id:t[c].MA_SP?t[c].MA_SP.toString():"",variation_id:t[c].MA_MAU_MA?t[c].MA_MAU_MA.toString():"1"}):s=!0;else{var l=n.validateFields(c,t[c]);l?i.push({message:l,success:!1}):r.push({line_number:c+2,imported_price:0==t[c].GIA_XUAT?0:t[c].GIA_XUAT||null,quantity:t[c].SO_LUONG?t[c].SO_LUONG.toString():"1",product_id:t[c].MA_SP?t[c].MA_SP.toString():"",variation_id:t[c].MA_MAU_MA?t[c].MA_MAU_MA.toString():"1"}),a+=1}return n.setState({resultArr:i}),{items:r,count:a}})),(0,y.Z)((0,h.Z)(n),"sendRequest",function(){var e=(0,p.Z)(u().mark((function e(t){var r,o,a,i,s,c,l,p,d,f,h,m,v,g,y,_,x,b,S,Z,A;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.props,o=r.shopId,a=r.accessToken,i=r.t,s=r.createExportSuccess,c=r.type,l=n.state,p=l.productImportFile,d=l.importedCount,f=l.isImporting,h=l.dataError,!(t>p.length-1)){e.next=5;break}return 1==c&&n.props.fetch(),e.abrupt("return");case 5:if(m=p[t],v={line_number:t+2,index:m.STT,warehouse_id:m.MA_KHO,items:[{imported_price:m.GIA_XUAT,quantity:m.SO_LUONG,product_id:m.MA_SP,variation_id:m.MA_MAU_MA}],note:m.GHI_CHU},m.MA_KHO){e.next=10;break}return h.push(v),e.abrupt("return",n.sendRequest(t+1));case 10:if(g=n.validateFields(t,m),!g){e.next=17;break}return y=n.geProducttItems(t),_=y.count,n.setState(C()(n.state,{resultArr:{$push:[{message:g,success:!1}]},importedCount:{$set:d+_}})),h.push(v),e.abrupt("return",n.sendRequest(t+_));case 17:if(x=n.geProducttItems(t),b=x.items,S=(S=x.count)||1,!(b.length<S)){e.next=23;break}return n.setState({importedCount:t+S}),h.push(b),e.abrupt("return",n.sendRequest(t+S));case 23:Z={line_number:t+2,index:m.STT,items:b.filter((function(e){return""!=e.product_id})),warehouse_id:m.MA_KHO.toString().trim(),shop_id:o,note:m.GHI_CHU||"",type:c||0},n.state.modalVisible&&f&&(A="".concat((0,N.LpH)(),"/shops/").concat(o,"/product_export/import?access_token=").concat(a),O().post(A,{productExport:Z}).then((function(e){var r=e.data;if(r.success){var o=r.data.message;o?(h.push(Z),n.setState(C()(n.state,{resultArr:{$push:[{message:o,success:!1}]}}))):(n.setState(C()(n.state,{resultArr:{$push:[{message:null,success:!0}]}})),s(e.data.data))}else h.push(Z),n.setState(C()(n.state,{resultArr:{$push:[{message:r.message,success:!1}]}}));return n.setState({importedCount:d+1}),n.sendRequest(t+S)})).catch((function(e){h.push(Z),n.setState(C()(n.state,{resultArr:{$push:[{message:i("action.unknownError"),success:!1}]},importedCount:{$set:d+1}})),n.sendRequest(t+S)})));case 25:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,y.Z)((0,h.Z)(n),"validateFields",(function(e,t){var r=n.props,o=r.t,a=r.currentShop.currency,i=N.cvg.includes(a),s="L\u1ed7i \u1edf d\xf2ng ".concat(e+2,": ");return t.SO_LUONG&&(!Number.isInteger((0,N.WNN)(t.SO_LUONG))||t.SO_LUONG<0)&&(s+=o("components.productImportExcel.index.quantityValue")),t.GIA_XUAT&&(!Number.isInteger((0,N.WNN)(t.GIA_XUAT))&&i||t.GIA_XUAT<0)&&(s+=o("components.productImportExcel.index.inputPrice")),s!="".concat(o("components.productImportExcel.index.errorNumber")," ").concat(e+2,": ")&&s})),(0,y.Z)((0,h.Z)(n),"renderError",(function(){return n.state.resultArr.map((function(e,t){var r=t+1;return e.success?void 0:j("div",{key:t,style:{width:"100%",color:"red"}},j("span",null," ",j("strong",null,"#".concat(r))," "),"\xa0",j("span",{className:"text-danger"}," ",e.message," "))}))})),(0,y.Z)((0,h.Z)(n),"renderSuccess",(function(){var e=n.state.resultArr,t=n.props.t;return e.map((function(e,r){var n=r+1;return e.success?j("div",{key:r,style:{width:"100%",color:"green"}},j("span",null," ",j("strong",null,"#".concat(n))," "),"\xa0",j("span",{className:"text-success"},t("success"))):void 0}))})),(0,y.Z)((0,h.Z)(n),"downloadListError",(function(){var e=n.state.dataError,t=[];e.map((function(e){e.items.map((function(r,n){0==n?t.push({STT:e.index||"",MA_KHO:e.warehouse_id||"",GHI_CHU:e.note||"",MA_SP:r.product_id||"",MA_MAU_MA:r.variation_id||"",GIA_XUAT:r.imported_price||"",SO_LUONG:r.quantity||""}):t.push({MA_SP:r.product_id||"",MA_MAU_MA:r.variation_id||"",GIA_XUAT:r.imported_price||"",SO_LUONG:r.quantity||""})}))}));var r={SheetNames:[],Sheets:{}},o=XLSX.utils.json_to_sheet(t);t.length&&(o["!cols"]=Object.keys(t[0]).map((function(e){var t=e?10*e.toString().length:150;return{wpx:t>120?t:120}})));XLSX.utils.book_append_sheet(r,o,"DataSheet 1");var a=XLSX.write(r,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,U.saveAs)(new Blob([(0,N.$iI)(a)],{type:""}),"error_file.xlsx")})),(0,y.Z)((0,h.Z)(n),"renderListFileError",(function(){var e=n.props.t;return j("div",null,j("span",{style:{marginTop:10,fontSize:15}},"".concat(e("components.productPurchaseImportExcel.downloadErrorListFileExport"),": ")),j("strong",{style:{cursor:"pointer",color:"#003399",fontWeight:"bold"},onClick:function(){return n.downloadListError()}},j(I.Z,null)," ",e("components.productPurchaseImportExcel.here")))})),n.state={modalVisible:!1,fileName:"",productImportFile:[],disableImportBtn:!0,isShowResult:!1,isImporting:!1,resultArr:[],dataError:[]},n}return(0,f.Z)(r,[{key:"render",value:function(){var e=this,t=this.props,r=t.t,n=t.isButton,l=t.title,u=this.state,p=u.modalVisible,d=u.fileName,f=u.importedCount,h=u.productImportFile,m=u.isImporting,v=u.disableImportBtn,g=u.resultArr,y=u.dataError,_=g.filter((function(e){return e.success})).length,x=g.filter((function(e){return!e.success})).length,b=h.filter((function(e){return e.MA_KHO})).length||h.length;return j("div",{style:{display:"inline"}},j(F.Z,{icon:j(E.Z,null),title:l,onClick:function(){return e.setState({modalVisible:!0})},isButton:n}),p&&j(o.Z,{title:r("components.productPurchaseImportExcel.importProductExportFromExcel"),footer:null,visible:p,onCancel:this.handleCloseModal},!m&&j(c.default,{message:r("notes"),description:j("div",{style:{fontSize:14}},r("components.productPurchaseImportExcel.writtenInTheCorrectFormatExport")," (",j("a",{target:"_blank",href:"/static/files/import_product_export.xlsx"},r("components.productImportExcel.index.sampleFile")),")"),type:"warning",showIcon:!0}),m?null:j("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},j(i.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:this.onDrop},j(s.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},d?j("span",null,j(k.Z,null),d):j("span",null,j(w.Z,null)," ",r("components.productPurchaseImportExcel.chooseFile")))),j(s.default,{type:"primary",onClick:this.confirmImport,disabled:v},r("components.productPurchaseImportExcel.start"))),j("div",null,f<h.length&&m?j("div",{style:{width:520,display:"flex",flexDirection:"column",alignItems:"center"}},j(a.default,{type:"circle",percent:Math.floor(100*f/b),style:{marginBottom:10}})):null,m&&f==h.filter((function(e){return void 0!=e.MA_KHO})).length&&f>0?j("h4",{style:{textAlign:"center"}},j("span",{style:{color:"#00a854"}},"".concat(r("components.productImportExcel.index.importSuccess")," ").concat(_," ").concat(r("components.productPurchaseImportExcel.productExport"))),j("span",{style:{color:"#f04134"}},"".concat(x>0?", ".concat(r("pages.admin.failure")," ").concat(x," ").concat(r("components.productPurchaseImportExcel.productExport")):""))):null,m?j("div",{style:{maxHeight:700,width:"100%",display:"flex",flexDirection:"column",border:"1px solid #d9d9d9",borderRadius:2,marginTop:10,padding:10,overflow:"auto"},id:"importing-info"},this.renderError(),this.renderSuccess()):null),j("div",null,(null===y||void 0===y?void 0:y.length)>0?this.renderListFileError():"")))}}]),r}(Z.Component))||n;t.Z=(0,P.$j)((function(e){return{currentShop:e.shop.currentShop,warehouses:(0,D.op)(e)}}),{createExportSuccess:T.$Yw})(B)}}]);