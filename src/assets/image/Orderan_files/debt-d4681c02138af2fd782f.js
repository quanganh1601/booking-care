(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3301],{57837:function(e){!function(){"use strict";e.exports=".debt-advance-filter .ant-btn{border-radius:2px !important}.debt-advance-filter .btn-advance-filter{margin-right:0px}.cascader-filter-debt .ant-cascader-menu{min-width:150px}.cascader-filter-debt input{border-radius:2px !important}.customer-info .ant-cascader-menu{max-height:600px;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}"}()},36409:function(e){!function(){"use strict";e.exports=".debt-printer{font-size:14px;font-family:Arial,Helvetica,sans-serif;color:#000;background-color:#fff}.debt-printer table{width:100%;margin-top:10px}.debt-printer tr,.debt-printer td{page-break-inside:avoid}.debt-printer table,.debt-printer th,.debt-printer td{border:1px solid #000;border-collapse:collapse}.debt-printer th,.debt-printer td{padding:6px}.debt-printer .display-number{text-align:right}.debt-printer .title{font-size:18px;display:flex;justify-content:center}.debt-printer .info{margin-top:16px}.debt-printer .info>div{padding-bottom:3px}.debt-printer .info>div>div{padding-bottom:3px}"}()},91051:function(e){!function(){"use strict";e.exports=".product-debt .ant-table-wrapper .ant-table-header{padding-right:0}.product-debt .ant-table-wrapper .ant-table-body .ant-table-row{cursor:pointer}.product-debt .delete{border-radius:2px !important}.product-debt .filter .ant-input-affix-wrapper{width:55vw}.debts-detail .ant-modal-content{overflow:hidden;border-radius:4px}.debts-detail .ant-modal-content .ant-modal-header{padding:12px 24px}.debts-detail .ant-modal-content .ant-modal-footer{padding:12px 24px}.debts-detail .ant-modal-content .ant-modal-close-x{height:47px;width:47px;line-height:47px}.debts-detail .ant-modal-body{background-color:#f5f5f5;border-radius:2px;padding:16px 24px}.debts-detail .ant-modal-body .containers{display:flex;width:100%}.debts-detail .ant-modal-body .containers .debts-info{display:grid;width:100%;padding:16px;background-color:#fff;border-radius:2px;font-size:14px;box-shadow:0 0 0 1px rgba(63,63,68,.05),0 1px 3px 0 rgba(63,63,68,.15)}.debts-detail .ant-modal-body .containers .debts-info:first-child{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.debts-detail .ant-modal-body .containers .debts-info span{font-weight:500}.debts-detail .ant-modal-body .containers .debts-info .item-info{width:100%;display:grid;margin-bottom:16px;align-items:center;height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.debts-detail .ant-modal-body .containers .debts-info .item-info .ant-select{width:100% !important}.debts-detail .ant-modal-body .containers .debts-info .item-info .ant-select .ant-select-selection{border-radius:2px !important}.debts-detail .ant-modal-body .containers .debts-info .item-info .ant-select .ant-select-selector{background-color:#fafafa}.debts-detail .ant-modal-body .containers .debts-info .item-info .box-input-number-wrapper{border-radius:2px !important;background-color:#fafafa}.debts-detail .ant-modal-body .containers .debts-info .item-info .box-input-number-wrapper .ant-input-number-focused{border-radius:2px !important}.debts-detail .ant-modal-body .containers .debts-info .item-info .box-input-number-wrapper .ant-input-suffix{top:0px}.debts-detail .ant-modal-body .containers .debts-info .item-info .box-input-number-wrapper .input-format-number{background-color:#fafafa}.debts-detail .ant-modal-body .containers .debts-info .item-info .ant-input{border-radius:2px !important;background-color:#f5f5f5}.debts-detail .ant-modal-body .containers .debts-info .item-info .ant-radio-wrapper span{font-weight:unset !important}.cascader-filter-debt .ant-cascader-menu{height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}"}()},83847:function(e,t,n){"use strict";var o,r=n(51024),s=n(74047),a=n(52700),i=n(4706),l=n(33814),c=n(44102),d=n(20775),p=n(26265),u=n(50361),h=n.n(u),f=n(23279),m=n.n(f),b=n(18446),g=n.n(b),y=n(67294),v=n(14494),_=n(87217),x=n(7690),Z=n(50916),S=n(57837),k=n.n(S),D=n(79508),w=n(31432),C=n(95213),O=n(20920),I=n(9669),P=n.n(I),N=y.createElement;function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,d.Z)(e);if(t){var r=(0,d.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,c.Z)(this,n)}}var R=(0,_.Z)()(o=function(e){(0,l.Z)(n,e);var t=j(n);function n(e){var o;return(0,s.Z)(this,n),o=t.call(this,e),(0,p.Z)((0,i.Z)(o),"onChangeSearchCustomer",m()((function(e){var t=o.props,n=t.accessToken,r=t.shopId,s="".concat((0,C.LpH)(),"/shops/").concat(r,"/customers?access_token=").concat(n);P()({method:"get",url:s,params:{search:e}}).then((function(e){o.setState({shopCustomers:e.data.data})}))}),500)),(0,p.Z)((0,i.Z)(o),"handleSearchSupplier",(function(e){var t=e.target?e.target.value:e;o.setState({searchSupplierProduct:t})})),(0,p.Z)((0,i.Z)(o),"getOptions",(function(){var e=o.props,t=e.currentShop,n=e.supplier_products,s=e.t,a=e.isReport,i=o.state,l=i.shopCustomers,c=i.searchSupplierProduct,d=c?n.data.filter((function(e){return(0,C.Mle)(e.name).includes((0,C.Mle)(c))})):n.data;d=(d||[]).map((function(e){return{value:e.id,label:o.renderLabel("supplier_products_id",e.id,e.name)}}));var p,u,h,f,m=[{value:"shop_customer_tags",label:s("pages.shop.debt.filterByTag"),children:[{label:s("pages.shop.customer.filterInclude"),value:"include",children:t.tags.map((function(e){return{value:e,label:o.renderLabel("shop_customer_tags",e,e,"include")}}))},{label:s("pages.shop.customer.filterExclude"),value:"exclude",children:t.tags.map((function(e){return{value:e,label:o.renderLabel("shop_customer_tags",e,e,"exclude")}}))}]},{value:"onlineOrOffline",label:s("pages.shop.customer.customerOnlineOffline"),children:[{value:"online",label:o.renderLabel("onlineOrOffline","online",s("pages.shop.customer.fbCustomer"))},{value:"offline",label:o.renderLabel("onlineOrOffline","offline",s("pages.shop.customer.offlineCustomer"))}]},{value:"is_adjust_debts",label:o.renderLabel("is_adjust_debts",!0,s("pages.shop.debt.debtsAjusted"))},{value:"has_debts",label:o.renderLabel("has_debts",!0,s("pages.shop.debt.stillOwe"))}],b={value:"supplier_products_id",label:s("pages.shop.debt.supplierProducts"),children:[{value:100,label:N("div",{onClick:function(e){return e.stopPropagation()}},N(r.default,{onChange:function(e){return o.handleSearchSupplier(e)},value:c,placeholder:s("pages.shop.debt.searchSupplierProduct"),allowClear:!0}))}].concat(d)},g={value:"shop_customer_id",label:s("customers.title"),children:[{value:"input",label:N("span",{onClick:function(e){return e.stopPropagation()}},N(r.default,{onChange:function(e){return o.onChangeSearchCustomer(e.target.value)},style:{width:400},onClick:function(e){return e.target.focus()},placeholder:s("components.customerSearchBar.enterCustomerNameOrPhoneNumber")}))}].concat(l.map((function(e){var t,n;return{value:null===(t=e.shop_customer)||void 0===t?void 0:t.id,label:o.renderLabel("shop_customer_id",null===(n=e.shop_customer)||void 0===n?void 0:n.id,o.renderLabelShopCustomer(e)),customer_info:e}})))};(a||m.push({value:"status",label:s("pages.shop.debt.debtStatus"),children:[{value:"0",label:o.renderLabel("status",0,s("pages.shop.debt.notTraded"))},{value:"1",label:o.renderLabel("status",1,s("pages.shop.debt.traded"))},{value:"2",label:o.renderLabel("status",2,s("pages.shop.debt.canceled"))}]},{value:"type",label:s("pages.shop.debt.type"),children:[{value:"0",label:o.renderLabel("type","0",s("pages.shop.debt.debtMustPay"))},{value:"1",label:o.renderLabel("type","1",s("pages.shop.debt.debtMustCollect"))}]}),(0,C.rqq)(2,t))&&(null!==(p=t.settings)&&void 0!==p&&null!==(u=p.auto_create_debt)&&void 0!==u&&u.customer&&m.push(g),null!==(h=t.settings)&&void 0!==h&&null!==(f=h.auto_create_debt)&&void 0!==f&&f.supplier&&m.push(b));return(0,C.QIx)(m,"".concat(o.props.shopId,"_filter_debt_source_count"))})),(0,p.Z)((0,i.Z)(o),"renderLabel",(function(e,t,n,r){var s=o.state.filters;return N("div",{style:{display:"flex",justifyContent:"space-between"}},N("div",null,n),s.find((function(n){return n.key==e&&(n.value==t||n.value.length>1&&n.value[0]==r&&n.value[1]==t)}))&&N("div",{style:{marginLeft:10}},N(D.Z,{style:{color:"#096dd9"}})))})),(0,p.Z)((0,i.Z)(o),"renderLabelShopCustomer",(function(e){var t=o.props.t;return N("div",{style:{borderBottom:"1px dashed #d9d9d9",paddingBottom:5}},N("div",null,N(Z.Z,{avatar_url:(0,O.E$)(e,o.props.accessToken),id:e.fb_id,name:e.name,size:[20,20],seed:e.id}),N("span",{style:{marginLeft:5}},e.name)),e.shop_customer&&N("div",{style:{borderLeft:"2px solid #ff3860",paddingLeft:5}},N("div",null,t("containers.customerInfo.purchased"),": ",e.shop_customer.order_count," ",t("containers.customerInfo.count")),N("div",null,t("phoneNumber"),": ",e.shop_customer.phone_numbers[0])))})),(0,p.Z)((0,i.Z)(o),"handleFilterShopCustomerTags",(function(e,t){var n,r=h()(o.state.filters),s="shop_customer_tags",a=t.filter((function(e){return e.value!=s})).map((function(e){return e.value})),i=null===(n=t[t.length-1])||void 0===n?void 0:n.value,l={key:s,value:a},c=r.findIndex((function(e){return e.key==s&&e.value.includes(i)&&!g()(e.value,a)}));c>-1&&r.splice(c,1);var d=r.findIndex((function(e){return e.key==s&&g()(e.value,a)}));d>-1?r.splice(d,1):r.push(l),(0,C.iAs)(s,"".concat(o.props.shopId,"_filter_debt_source_count")),o.setState({filters:r}),o.props.fetch(r)})),(0,p.Z)((0,i.Z)(o),"onChangeCascader",(function(e,t){var n;if(e&&(!t[1]||100!=t[1].value)){var r,s,a=h()(o.state.filters);if(t&&"shop_customer_tags"==(null===(n=t[0])||void 0===n?void 0:n.value))o.handleFilterShopCustomerTags(e,t);else{switch(e.length){case 1:r=e[0],s=!0;break;case 2:r=e[0],s=e[1]}var i={key:r,value:s},l=a.findIndex((function(e){return e.key==r&&e.value==s}));-1!=l?a.splice(l,1):("shop_customer_id"==r&&(i=T(T({},i),{},{customer_info:t[1].customer_info})),a.push(i)),(0,C.iAs)(r,"".concat(o.props.shopId,"_filter_debt_source_count")),o.setState({filters:a}),o.props.fetch(a)}}})),o.state={shopCustomers:[],filters:[],searchSupplierProduct:""},o}return(0,a.Z)(n,[{key:"componentDidUpdate",value:function(e){g()(this.props.filters,e.filters)&&g()(this.state.filters,e.filters)||this.setState({filters:this.props.filters})}},{key:"render",value:function(){var e=this.state.shopCustomers;return N("div",{className:"debt-advance-filter"},N(x.Z,{options:this.getOptions(),popupClassName:"cascader-filter-debt ".concat(e.length&&"customer-info"),onChange:this.onChangeCascader}),N("style",{dangerouslySetInnerHTML:{__html:k()}}))}}]),n}(y.Component))||o;t.Z=(0,v.$j)((function(e){return T({currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone},(0,w.zN)(e))}),{})(R)},74229:function(e,t,n){"use strict";var o=n(89552),r=n(67294),s=n(7085),a=r.createElement;t.Z=function(){return a("div",{className:"spinner"},a(o.default,{indicator:a(s.Z,{style:{fontSize:40}})}))}},84535:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Pt}});var o,r=n(10149),s=n(62443),a=n(65400),i=n(51024),l=n(28140),c=n(32292),d=n(59361),p=n(94055),u=n(40987),h=n(809),f=n.n(h),m=n(92447),b=n(74047),g=n(4706),y=n(52700),v=n(33814),_=n(44102),x=n(20775),Z=n(26265),S=n(56697),k=n(64749),D=n(64713),w=n(14321),C=n(23279),O=n.n(C),I=n(18446),P=n.n(I),N=n(50361),L=n.n(N),T=n(65988),j=n(67294),R=n(92902),E=n(91051),z=n.n(E),A=n(14494),F=n(57119),M=n(90631),B=n(84189),H=n(7945),K=n(2877),Y=n(50161),q=n(49101),$=n(25592),W=n(73171),X=n(76570),Q=n(78338),G=n(83049),V=n(74229),U=n(65644),J=n(36934),ee=n(95213),te=n(20920),ne=n(17669),oe=n(87217),re=n(7463),se=n(7085),ae=n(92104),ie=n(68628),le=n(30381),ce=n.n(le),de=n(74298),pe=n(36492),ue=n(22318),he=n(50916),fe=n(31432),me=n(9669),be=n.n(me),ge=n(17918),ye=j.createElement;function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){(0,Z.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var Ze=(0,oe.Z)()(o=function(e){(0,v.Z)(n,e);var t=xe(n);function n(e){var o;return(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"handleSave",(function(){o.setState({isLoading:!0});var e=o.state.isCreating,t=_e(_e({},o.state.debts),{},{money_payed_or_collected:o.state.debts.money_payed_or_collected+(o.state.debts.extra_amount||0)}),n=o.props,r=n.accessToken,s=n.shopId,a=n.createDebts,i=n.close,l=n.updateDebts,c=n.t;return t.money_must_pay_or_collect<t.money_payed_or_collected?(o.setState({isLoading:!1}),ue.Z.error(de.ZP.t("pages.admin.failure"),de.ZP.t("components.debtDetail.errorMoneyDebt"))):ce()(t.expired_at).unix()<ce()(t.deal_date).unix()?(o.setState({isLoading:!1}),ue.Z.error(de.ZP.t("pages.admin.failure"),de.ZP.t("components.debtDetail.errorTime"))):(e?(a(r,s,t),localStorage["draft_debt_shop_".concat(s)]&&localStorage.removeItem("draft_debt_shop_".concat(s)),i()):P()(t,o.props.debts)?(i(),ue.Z.success(c("success"),"".concat(c("components.debtDetail.updatedDebts")," ").concat(t.name_debt))):(l(r,s,t),o.props.fetchListOfDebt(),i()),void o.setState({isLoading:!1}))})),(0,Z.Z)((0,g.Z)(o),"handleSelectDate",(function(e,t,n){var r=L()(o.state.debts);r[n]="deal_date"==n?e:null===e||void 0===e?void 0:e.endOf("day"),o.setState({debts:r})})),(0,Z.Z)((0,g.Z)(o),"handleOnChangeType",(function(e){var t=L()(o.state.debts);t=_e(_e({},t),{},{type:e,shop_customer_id:null,supplier_products_id:null,dealer_name:""}),o.setState({debts:t,customerName:""})})),(0,Z.Z)((0,g.Z)(o),"handleOnChangeInput",(function(e,t){var n=L()(o.state.debts);if(n[e]=t,"supplier_products_id"==e){var r=o.props.supplier_products.data.find((function(e){return e.id==t}));n.dealer_name=(null===r||void 0===r?void 0:r.name)||""}o.setState({debts:n})})),(0,Z.Z)((0,g.Z)(o),"handleChangeBoxInput",(function(e,t){var n=L()(o.state.debts);n[t]=e,o.setState({debts:n})})),(0,Z.Z)((0,g.Z)(o),"onSearchCustomer",(function(e){var t=e.target&&e.target?e.target.value:e;t&&(o.setState({customerLoading:!0}),o.sendRequestSearchCustomer(t))})),(0,Z.Z)((0,g.Z)(o),"sendRequestSearchCustomer",(function(e){var t=o.props,n=t.shopId,r=t.accessToken,s="".concat((0,ee.LpH)(),"/shops/").concat(n,"/customers?access_token=").concat(r,"&search=").concat(e);be().get(s).then((function(e){e.data&&!0===e.data.success&&o.setState({customerInfo:e.data.data}),o.setState({customerLoading:!1})})).catch((function(){o.setState({customerLoading:!1})}))})),(0,Z.Z)((0,g.Z)(o),"renderDataSourceCustomer",(function(){var e,t=o.props.t,n=o.state.customerLoading;return e=o.state.customerInfo,o.state.customerName&&!n&&0==e.length?[{label:ye("b",null,t("components.productSearchBar.noResult")),value:"",disable:!0}]:e.map((function(e){var n=e.fb_id,r=e.id,s=e.name,a=e.shop_customer;return{label:ye(j.Fragment,null,ye("div",{className:"form-customer-identical"},ye(he.Z,{avatar_url:(0,te.E$)(e,o.props.accessToken),id:n,name:s,size:[20,20],seed:r}),ye("span",{style:{marginLeft:5}},e.name)),a&&ye("div",{style:{borderLeft:"2px solid #ff3860",paddingLeft:5}},t("containers.customerInfo.purchased"),": ",a.order_count," ",t("containers.customerInfo.count"),ye("br",null),t("phoneNumber"),": ",a.phone_numbers[0])),value:e.id}}))})),(0,Z.Z)((0,g.Z)(o),"handleCustomerChange",(function(e){var t=e.target&&e.target.value?e.target.value:e;o.setState({customerName:t})})),(0,Z.Z)((0,g.Z)(o),"handleSelectCustomer",(function(e){var t,n=o.state.customerInfo,r=L()(o.state.debts),s=n.find((function(t){return t.id==e}))||{};r.shop_customer_id=null===(t=s.shop_customer)||void 0===t?void 0:t.id,r.dealer_name=s.name,o.setState({debts:r,customerName:s.name||""})})),(0,Z.Z)((0,g.Z)(o),"renderSelectDealerName",(function(){var e=o.state,t=e.debts,n=e.customerLoading,r=e.customerName,s=o.props,a=s.supplier_products,i=s.t;return ye("div",null,0==t.type?ye(k.default,{style:{marginTop:4},value:t.supplier_products_id,placeholder:i("components.productPurchaseDetail.selectSupplier"),onChange:function(e){return o.handleOnChangeInput("supplier_products_id",e)}},a.data.map((function(e){return ye(k.default.Option,{key:e.id,value:e.id},e.name)}))):ye("span",null,ye(ne.Z,{value:r,onSearch:o.onSearchCustomer,options:o.renderDataSourceCustomer(),onChange:o.handleCustomerChange,onSelect:function(e){return o.handleSelectCustomer(e)},style:{width:"100%",marginTop:4}},ye(pe.Z$,{suffix:ye("span",null,n?ye(se.Z,null):null),value:r,placeholder:"T\xecm t\xean kh\xe1ch h\xe0ng/S\u0110T",style:{backgroundColor:"#F5F5F5"}}))))})),(0,Z.Z)((0,g.Z)(o),"handleDraftDebt",(function(){var e=o.props.shopId,t=o.state.debts;t&&!t.display_id&&localStorage["draft_debt_shop_".concat(e)]&&localStorage.removeItem("draft_debt_shop_".concat(e)),!t||t.display_id||""==t.name_debt&&"1"!=t.type&&!t.supplier_products_id&&0==t.money_must_pay_or_collect&&""==t.description||localStorage.setItem("draft_debt_shop_".concat(e),JSON.stringify(t))})),o.initDebts={name_debt:"",description:"",type:0,status:0,expired_at:ce()().add(30,"days").endOf("day"),dealer_name:"",deal_date:ce()(),money_must_pay_or_collect:0,money_payed_or_collected:0,extra_amount:0,order_id:null,shop_customer_id:null},o.state={debts:e.debts||o.initDebts,isCreating:!e.debts,isLoading:!1,customerLoading:!1,customerInfo:[],customerName:""},o.sendRequestSearchCustomer=O()(o.sendRequestSearchCustomer.bind((0,g.Z)(o)),400),o}return(0,y.Z)(n,[{key:"render",value:function(){var e,t,n,o,r=this,s=this.props,l=s.t,c=s.visible,d=s.close,p=s.currentShop,u=this.state,h=u.isCreating,f=u.debts,m=u.isLoading,b=(null===f||void 0===f?void 0:f.id)&&!0;return ye("div",null,c&&ye(S.Z,{wrapClassName:"debts-detail",visible:c,width:520,title:h?l("components.debtDetail.newDebts"):"".concat(l("containers.customerInfo.detailDebt")," #").concat(null===f||void 0===f?void 0:f.display_id),maskClosable:!m,closable:!m,onCancel:function(){r.handleDraftDebt(),d()},footer:ye("div",{className:"debts-footer"},ye(a.default,{style:{borderRadius:4},type:"primary",icon:ye(ae.Z,null),onClick:this.handleSave,disabled:!(0==f.status&&!m&&""!=f.name_debt&&""!=f.dealer_name)},l(h?"components.debtDetail.create":"components.debtDetail.save")))},ye("div",{className:"containers"},ye("div",{className:"debts-info"},ye("div",{className:"item-info"},ye("span",null,!b&&(!f.name_debt||""==f.name_debt)&&ye(ge.Z,{icon:ye(ie.Z,{style:{color:"red",marginRight:5}}),tip:l("components.orderSourceDetail.nameNotEmpty")}),"".concat(l("components.debtDetail.debtsName"),":")),ye(i.default,{style:{marginTop:4,backgroundColor:"#FAFAFA"},value:f.name_debt,onChange:function(e){return r.handleOnChangeInput("name_debt",e.target.value)},className:"enter-input",placeholder:l("components.debtDetail.enterDebtName")})),ye("div",{className:"item-info"},ye("div",{style:{display:"flex",justifyContent:"space-between"}},ye("span",null,"".concat(l("components.debtDetail.debtsType"),":")),b?ye("span",{style:{color:0==f.type?"#f04134":"#096dd9"}},(0,ee.jhQ)(f.type)):ye(D.default.Group,{onChange:function(e){return r.handleOnChangeType(e.target.value)},value:f.type+""},ye(D.default,{value:"0"},(0,ee.jhQ)(0)),ye(D.default,{value:"1"},(0,ee.jhQ)(1))))),ye("div",{className:"item-info"},ye("div",{style:{display:"".concat(b?"flex":"")}},ye("span",{style:b?{width:"30%"}:{}},"".concat((0,ee.Hhg)(f).text4,":")),ye("div",{style:b?{display:"flex",justifyContent:"end",width:"70%"}:{}},b?ye("span",null,f.shop_customer?ye("div",{style:{alignItems:"center",display:"flex"}},ye(he.Z,{seed:null===(e=f.shop_customer)||void 0===e?void 0:e.customer_id,name:f.shop_customer.name||(null===(t=f.shop_customer.customer)||void 0===t?void 0:t.name),id:null===(n=f.shop_customer.customer)||void 0===n?void 0:n.fb_id,size:[22,22]}),"\xa0",ye("span",null,f.shop_customer.name||(null===(o=f.shop_customer.customer)||void 0===o?void 0:o.name))):f.dealer_name):this.renderSelectDealerName()))),ye("div",{className:"item-info"},ye("span",null,"".concat((0,ee.Hhg)(f).text3,":")),ye(w.default,{style:{marginTop:4,backgroundColor:"#FAFAFA"},className:"select-time",format:"DD/MM/YYYY",value:f.deal_date?ce().utc(f.deal_date).utcOffset(parseFloat(p.timezone)||7):void 0,placeholder:(0,ee.Hhg)(f).text3,onChange:function(e,t){return r.handleSelectDate(e,t,"deal_date")}})),ye("div",{className:"item-info"},ye("span",null,"".concat((0,ee.Hhg)(f).text5,":")),ye(w.default,{style:{marginTop:4,backgroundColor:"#FAFAFA"},className:"select-time",format:"DD/MM/YYYY",value:f.expired_at?ce().utc(f.expired_at).utcOffset(parseFloat(p.timezone)||7):void 0,placeholder:(0,ee.Hhg)(f).text5,onChange:function(e,t){return r.handleSelectDate(e,t,"expired_at")}})),ye("div",{className:"item-info"},ye("div",{style:{display:"".concat(b?"flex":""),justifyContent:"".concat(b?"space-between":""),alignItems:"".concat(b?"center":"")}},ye("span",null,"".concat((0,ee.Hhg)(f).text1,":")),b?ye("span",null,(0,ee.ufS)(f.money_must_pay_or_collect,p.currency)):ye("div",null,ye(re.default,{style:{marginTop:4},isMoney:!0,currency:p.currency,value:f.money_must_pay_or_collect,min:f.money_payed_or_collected,suffix:(0,ee.jKf)(p.currency),callBack:function(e){return r.handleChangeBoxInput(e,"money_must_pay_or_collect")}})))),!h&&ye(j.Fragment,null,ye("div",{className:"item-info"},ye("div",{style:{display:"".concat(b?"flex":""),justifyContent:"".concat(b?"space-between":""),alignItems:"".concat(b?"center":"")}},ye("span",null,"".concat((0,ee.Hhg)(f).text2,":")),ye("div",null,(0,ee.ufS)(f.money_payed_or_collected,p.currency)))),ye("div",{className:"item-info"},ye("span",null,1==f.type?l("components.debtDetail.extraAmount"):l("components.debtDetail.extraPaymentAmount"),":"),ye("div",null,ye(re.default,{isMoney:!0,max:f.money_must_pay_or_collect-f.money_payed_or_collected,currency:p.currency,value:f.extra_amount||0,suffix:(0,ee.jKf)(p.currency),callBack:function(e){return r.handleChangeBoxInput(e,"extra_amount")}}))),ye("div",{className:"item-info"},ye("div",{style:{justifyContent:"space-between",display:"flex"}},ye("span",null,"".concat(l("components.productPurchaseDetail.rest"),":")),ye("span",null,(0,ee.ufS)(f.money_must_pay_or_collect-f.money_payed_or_collected-(f.extra_amount||0),p.currency))))),ye("div",{className:"item-info",style:b?{display:"flex",alignItems:"start",marginBottom:0}:{marginBottom:0}},ye("span",{style:b?{width:"20%"}:{}},"".concat(l("components.debtDetail.description"),": ")),b?ye("div",{style:{width:"80%",textAlign:"right"}},f.description):ye(i.default.TextArea,{style:{marginTop:4,backgroundColor:"#FAFAFA"},value:f.description,onChange:function(e){return r.handleOnChangeInput("description",e.target.value)},className:"enter-input-text-area",id:"focus",placeholder:l("components.debtDetail.descriptionAboutDebt"),rows:3}))))))}}]),n}(j.Component))||o,Se=(0,A.$j)((function(e){return _e({currentShop:e.shop.currentShop},(0,fe.zN)(e))}),{createDebts:J.mnN,updateDebts:J.AgW,fetchListOfDebt:J._xZ})(Ze),ke=n(12386),De=n(57254),we=j.createElement;function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){(0,Z.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var Pe,Ne=function(e){(0,v.Z)(n,e);var t=Ie(n);function n(e){var o;return(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"getStatus",(function(){if(!o.props.debt.id)return[0,1,2];switch(o.state.status){case 0:return[1,2];case 1:return[2];case 2:default:return[]}})),(0,Z.Z)((0,g.Z)(o),"onClick",(function(e){var t=e.key;o.setState({isLoading:!0});var n=o.props,r=n.debt;(0,n.updateDebts)(n.accessToken,n.shopId,Oe(Oe({},r),{},{status:t})).then((function(){return o.setState({isLoading:!1,status:parseInt(t)})}))})),o.state={isLoading:!1,status:e.debt.status},o}return(0,y.Z)(n,[{key:"componentDidUpdate",value:function(e){P()(e.debt.status,this.props.debt.status)||this.setState({status:this.props.debt.status})}},{key:"render",value:function(){var e=this.state.isLoading,t=this.props,n=t.size,o=t.debt,r=(0,te.rQ)()[o.status],i=this.getStatus();return we(s.default,{content:we(ke.default,{className:"dropdown-container",onClick:this.onClick},i.map((function(t){var n=(0,te.rQ)()[t];return we(ke.default.Item,{disabled:e,key:t},n.icon," ",n.text)}))),placement:"bottomRight",overlayClassName:"order-action-list"},we(a.default,{type:"primary",style:{fontSize:"large"==n?14:12,width:"large"==n?170:130,height:"large"==n?32:22,background:r.bgColor,borderColor:r.bgColor,position:"relative",overflow:"hidden",padding:"0 5px"}},r.text,i.length>0&&we(De.Z,{size:"small",style:{position:"absolute",right:5,top:"calc((100% / 2) - 6px)"}})))}}]),n}(j.Component),Le=(0,A.$j)(null,{updateDebts:J.AgW})(Ne),Te=n(11187),je=j.createElement;function Re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var Ee,ze=(0,oe.Z)()(Pe=function(e){(0,v.Z)(n,e);var t=Re(n);function n(){var e;(0,b.Z)(this,n);for(var o=arguments.length,r=new Array(o),s=0;s<o;s++)r[s]=arguments[s];return e=t.call.apply(t,[this].concat(r)),(0,Z.Z)((0,g.Z)(e),"setupCopyLink",(function(){var t=document.getElementById("copy-".concat(e.props.debt.id));t&&(e.handleEvent=function(t){t.preventDefault(),t.clipboardData&&(t.clipboardData.setData("text/plain","".concat((0,ee.q7x)(),"/shop/product/show-debt?link_key=").concat(e.props.debt.link_key)),e.showTextCopy(e.props.debt))},t.addEventListener("copy",e.handleEvent))})),(0,Z.Z)((0,g.Z)(e),"handleCopyLink",(function(){"undefined"!=typeof document&&document.execCommand("copy")})),e}return(0,y.Z)(n,[{key:"componentDidMount",value:function(){this.setupCopyLink()}},{key:"showTextCopy",value:function(e){return Te.default.success("".concat((0,ee.q7x)(),"/shop/product/show-debt?link_key=").concat(e.link_key))}},{key:"render",value:function(){var e=this,t=this.props,n=t.debt,o=t.t;return je(p.default,{title:o("components.noteDebt")},je(d.default,{id:"copy-".concat(n.id),onClick:function(){return e.handleCopyLink()},style:{cursor:"pointer"},color:"blue"},o("pages.shop.copy")))}}]),n}(j.Component))||Pe,Ae=(0,A.$j)((function(e){return{currentShop:e.shop.currentShop}}))(ze),Fe=n(83847),Me=n(49485),Be=n(74806),He=n(31731),Ke=n(78598),Ye=j.createElement;function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){(0,Z.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function We(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var Xe,Qe=(0,oe.Z)()(Ee=function(e){(0,v.Z)(n,e);var t=We(n);function n(e){var o;return(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"handleDownload",(function(){var e=o.props,t=e.params,n=e.shopId,r=e.accessToken,s=e.selectedRowKeys,a=e.selectedDebts,i="".concat((0,ee.LpH)(),"/shops/").concat(n,"/debt?access_token=").concat(r);o.setState({isDownloading:!0});var l=[];s&&s.length>0?o.handleExport(a):function e(t){return be()({method:"get",url:i,params:t}).then((function(n){return l=l.concat(n.data.data),o.setState({currentDebts:l.length,totalEntries:n.data.total_entries}),0==n.data.data.length||l.length==n.data.total_entries?l:(t.page=t.page+1,e(t))}))}(t).then((function(e){o.handleExport(e)}))})),(0,Z.Z)((0,g.Z)(o),"handleExport",(function(e){o.setState({isDownloading:!1});var t=new ExcelJS.Workbook,n=t.addWorksheet("Sheet 1");return n.columns=[{header:"ID",key:"id",width:20},{header:o.props.t("pages.shop.debt.nameDebt"),key:"name_debt",width:20},{header:o.props.t("pages.shop.debt.description"),key:"description",width:20},{header:o.props.t("pages.shop.debt.type"),key:"type",width:20},{header:o.props.t("pages.shop.debt.expired_at"),key:"expired_at",width:20},{header:o.props.t("pages.shop.debt.debtMustPay"),key:"debt_must_pay",width:20},{header:o.props.t("pages.shop.debt.debtPayed"),key:"debt_payed",width:20},{header:o.props.t("pages.shop.debt.debtMustCollect"),key:"debt_must_collect",width:20},{header:o.props.t("pages.shop.debt.debtCollected"),key:"debt_collected",width:20},{header:o.props.t("pages.shop.debt.supplierProducts"),key:"supplier_products",width:20},{header:o.props.t("pages.shop.debt.phoneNumber"),key:"phone_numbers",width:20},{header:o.props.t("customers.title"),key:"customers",width:20},{header:o.props.t("pages.shop.debt.creator"),key:"creator_id",width:20},{header:o.props.t("pages.shop.debt.insertedAt"),key:"inserted_at",width:20},{header:o.props.t("status"),key:"status",width:20}],e.map((function(e){var t,r,s,a,i=o.props.supplier_products?(o.props.supplier_products.data.find((function(t){return t.id==e.supplier_products_id}))||{}).name:"",l=o.props.users.find((function(t){return t.user_id==e.creator_id})),c=null!==(t=e.shop_customer)&&void 0!==t&&t.phone_numbers?null===(r=e.shop_customer)||void 0===r?void 0:r.phone_numbers.join(", "):"",d=(0,te.rQ)()[e.status];n.addRow({id:e.display_id,name_debt:e.name_debt,description:e.description,type:(0,ee.jhQ)(e.type),expired_at:(0,ee.o0x)(o.props.timezone,e.expired_at),debt_must_pay:0==e.type?e.money_must_pay_or_collect:0,debt_payed:0==e.type?1==e.status?e.money_must_pay_or_collect:e.money_payed_or_collected:0,debt_must_collect:1==e.type?e.money_must_pay_or_collect:0,debt_collected:1==e.type?1==e.status?e.money_must_pay_or_collect:e.money_payed_or_collected:0,supplier_products:i,customers:(null===(s=e.shop_customer)||void 0===s||null===(a=s.customer)||void 0===a?void 0:a.name)||"",creator_id:l?l.user.name:"",inserted_at:(0,ee.o0x)(o.props.timezone,e.inserted_at),phone_numbers:c,status:d.text})})),t.xlsx.writeBuffer().then((function(e){(0,Ke.saveAs)(new Blob([e],{type:"application/octet-stream"}),"debt.xlsx")}))})),(0,Z.Z)((0,g.Z)(o),"getProgress",(function(){var e=o.state,t=e.currentDebts,n=e.totalEntries;return 0==t||0==n?0:Math.floor(100*t/n)})),(0,Z.Z)((0,g.Z)(o),"renderContent",(function(){var e=o.state.isDownloading;return Ye(j.Fragment,null,Ye(a.default,{onClick:function(){return o.handleDownload()},type:"primary",icon:Ye(M.Z,null),style:{width:"100%"},disabled:e},"T\u1ea3i xu\u1ed1ng"),e&&Ye("div",null,Ye(Be.default,{percent:o.getProgress()})))})),o.state={currentDebts:0,totalEntries:0,isDownloading:!1},o}return(0,y.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.t,n=e.selectedRowKeys,o=e.title,r=e.isButton;return Ye(s.default,{title:t("components.debtExportExcel.exportDebtToExcel"),content:this.renderContent(),trigger:"click"},Ye(He.Z,{icon:Ye(M.Z,null),isButton:r,title:o,tooltip:"".concat(t("components.debtExportExcel.export")," ").concat(n.length>0?n.length+" "+t("components.debtExportExcel.selectedDebt"):t("components.debtExportExcel.allDebt")," ").concat(t("components.productExportExcel.toExcel"))}))}}]),n}(j.Component))||Ee,Ge=(0,A.$j)((function(e){return $e($e({currentShop:e.shop.currentShop,timezone:e.navigation.user.timezone},(0,fe.zN)(e)),{},{users:e.user.users})}),{})(Qe),Ve=n(28465),Ue=n(4863),Je=n(79508),et=n(48176),tt=j.createElement;function nt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(n),!0).forEach((function(t){(0,Z.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function rt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var st,at={modalVisible:!1,fileName:"",isImporting:!1,resultArr:[],dataError:[],disableImportBtn:!1,debtImportFile:[],fileNoNameDebt:[]},it=(0,oe.Z)()(Xe=function(e){(0,v.Z)(n,e);var t=rt(n);function n(e){var o;return(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"onDrop",(function(e){var t=e.file,n=o.props.t,r=new FileReader;r.readAsBinaryString(t),r.onload=function(e){var r=e.target.result,s=XLSX.read(r,{type:"binary"}),a=s.SheetNames[0],i=XLSX.utils.sheet_to_json(s.Sheets[a],{raw:!0,defval:null});if(0!=i.length){var l=(0,ee.wOl)(s.Sheets[a]),c=o.checkFields(l);if(0!=c.length)ue.Z.error(n("error"),"".concat(n("pages.shop.product.accessories.import.fieldsNotFound"),": ").concat(c.join())),o.setState({debtImportFile:[],fileName:"",disableImportBtn:!0,isImporting:!1,resultArr:[]});else{var d=o.handleFileNoNameDebt(i);o.setState({debtImportFile:d,fileName:t.name,importedCount:0,disableImportBtn:!1,isImporting:!1})}}else ue.Z.error(n("error"),n("components.productImportExcel.index.fileExcelEmpty")),o.setState({disableImportBtn:!0,selectedFile:!1,isImporting:!1,resultArr:[]})}})),(0,Z.Z)((0,g.Z)(o),"checkFields",(function(e){return function(e){return[e("pages.shop.debt.import.nameDebt"),e("pages.shop.debt.import.type")]}(o.props.t).reduce((function(t,n){return-1==e.findIndex((function(e){return e==n}))&&t.push(n),t}),[])})),(0,Z.Z)((0,g.Z)(o),"handleFileNoNameDebt",(function(e){var t=o.props.t,n=[],r=[];return e.map((function(e){e[t("pages.shop.debt.import.nameDebt")]?n.push(e):r.push(e)})),o.setState({fileNoNameDebt:r}),n})),(0,Z.Z)((0,g.Z)(o),"confirmImport",(function(){o.setState({disableImportBtn:!0,isImporting:!0,importedCount:0},(function(){o.sendRequest(0)}))})),(0,Z.Z)((0,g.Z)(o),"sendRequest",(function(e){var t=o.props,n=t.shopId,r=t.accessToken,s=t.t,a=t.supplier_products,i=t.currentShop,l=i.timezone,c=i.country_code,d=o.state,p=d.debtImportFile,u=d.dataError;if(!(e>p.length-1)){var h=p[e],f={name_debt:h[s("pages.shop.debt.import.nameDebt")],description:h[s("pages.shop.debt.import.description")],money_must_pay_or_collect:h[s("pages.shop.debt.import.moneyMustPay")]||0,money_payed_or_collected:h[s("pages.shop.debt.import.moneyPayed")]||0,supplier_products_id:h[s("pages.shop.debt.import.supplierProducts")],dealer_name:h[s("pages.shop.debt.import.insertedAt")],type:h[s("pages.shop.debt.import.type")],deal_date:h[s("pages.shop.debt.import.insertedAt")],expired_at:h[s("pages.shop.debt.import.expiredAt")],customer:h[s("customers.title")],phone_number:h[s("pages.shop.debt.import.phoneNumber")]},m=o.validateFields(e,h);if(!!m)return o.setState((function(e){return{resultArr:e.resultArr.concat([{message:m,success:!1}]),importedCount:e.importedCount+1}})),u.push(f),o.sendRequest(e+1);var b=(0,ee.Mle)(h[s("pages.shop.debt.import.type")])==(0,ee.Mle)(s("pages.shop.debt.debtMustPay"))?0:(0,ee.Mle)(h[s("pages.shop.debt.import.type")])==(0,ee.Mle)(s("pages.shop.debt.debtMustCollect"))?1:null,g=h[s("customers.title")]&&1==b?h[s("customers.title")]:null,y=((null===a||void 0===a?void 0:a.data)||[]).find((function(e){return(0,ee.Mle)(e.name)==(0,ee.Mle)(h[s("pages.shop.debt.import.supplierProducts")])})),v=h[s("pages.shop.debt.import.expiredAt")]?(0,ee._MS)(h[s("pages.shop.debt.import.expiredAt")],l):ce()().add(30,"days").endOf("day").unix(),_=h[s("pages.shop.debt.import.insertedAt")]?(0,ee._MS)(h[s("pages.shop.debt.import.insertedAt")],l):ce()().unix(),x=h[s("pages.shop.debt.import.phoneNumber")]&&1==b?(0,ee.SRG)(h[s("pages.shop.debt.import.phoneNumber")],!1,c):null;f=ot(ot({},f),{},{line_number:e+2,supplier_products_id:1==b?null:y.id,dealer_name:1==b?null:y.name,type:b,deal_date:_,expired_at:v,customer:g,phone_number:x});var Z="".concat((0,ee.LpH)(),"/shops/").concat(n,"/debt/import?access_token=").concat(r);be().post(Z,{debt:f}).then((function(t){var n=t.data;return n.success?(o.setState((function(e){return{resultArr:e.resultArr.concat([{message:null,success:!0}]),importedCount:e.importedCount+1}})),o.props.fetchDebt(n.data)):(u.push(f),o.setState((function(e){return{resultArr:e.resultArr.concat([{message:n.message,success:!1}]),importedCount:e.importedCount+1}}))),o.sendRequest(e+1)})).catch((function(t){return u.push(f),o.setState((function(e){return{resultArr:e.resultArr.concat([{message:s("action.unknownError"),success:!1}]),importedCount:e.importedCount+1}})),o.sendRequest(e+1)}))}})),(0,Z.Z)((0,g.Z)(o),"validateFields",(function(e,t){var n=o.props,r=n.t,s=n.currentShop.currency,a=n.supplier_products,i=ee.cvg.includes(s),l=(0,ee.Mle)(t[r("pages.shop.debt.import.type")])==(0,ee.Mle)(r("pages.shop.debt.debtMustPay"))?0:(0,ee.Mle)(t[r("pages.shop.debt.import.type")])==(0,ee.Mle)(r("pages.shop.debt.debtMustCollect"))?1:null,c=t[r("customers.title")]&&1==l?t[r("customers.title")]:null,d=((null===a||void 0===a?void 0:a.data)||[]).find((function(e){return(0,ee.Mle)(e.name)==(0,ee.Mle)(t[r("pages.shop.debt.import.supplierProducts")])})),p=t[r("pages.shop.debt.import.nameDebt")],u="".concat(r("pages.shop.product.accessories.import.errorNumber")," ").concat(e+2,": ");return p||(u+=r("pages.shop.debt.errorNameDebt")),null==l&&(u+=r("pages.shop.debt.errorType")),c||1!=l||(u+=r("pages.shop.debt.notExistCustomer")),d||0!=l||(u+=r("pages.shop.debt.notExistSupplier")),t[r("pages.shop.debt.import.moneyMustPay")]&&(!Number.isInteger((0,ee.WNN)(t[r("pages.shop.debt.import.moneyMustPay")]))&&i||t[r("pages.shop.debt.import.moneyMustPay")]<0)&&(u+=r("pages.shop.debt.moneyMustPayValue")),t[r("pages.shop.debt.import.moneyPayed")]&&(!Number.isInteger((0,ee.WNN)(t[r("pages.shop.debt.import.moneyPayed")]))&&i||t[r("pages.shop.debt.import.moneyPayed")]<0)&&(u+=r("pages.shop.debt.moneyPayedValue")),t[r("pages.shop.debt.import.phoneNumber")]&&(!Number.isInteger((0,ee.WNN)(t[r("pages.shop.debt.import.phoneNumber")]))||t[r("pages.shop.debt.import.phoneNumber")]<0)&&(u+=r("pages.shop.debt.phoneNumberValue")),u!="".concat(r("pages.shop.product.accessories.import.errorNumber")," ").concat(e+2,": ")&&u})),(0,Z.Z)((0,g.Z)(o),"renderError",(function(){return o.state.resultArr.map((function(e,t){var n=t+1;return e.success?void 0:tt("div",{key:t,style:{width:"100%",color:"red"}},tt("span",null," ",tt("strong",null,"#".concat(n))," "),"\xa0",tt("span",{className:"text-danger"}," ",e.message," "))}))})),(0,Z.Z)((0,g.Z)(o),"renderSuccess",(function(){var e=o.state.resultArr,t=o.props.t;return e.map((function(e,n){var o=n+1;return e.success?tt("div",{key:n,style:{width:"100%",color:"green"}},tt("span",null," ",tt("strong",null,"#".concat(o))," "),"\xa0",tt("span",{className:"text-success"},t("success"))):void 0}))})),(0,Z.Z)((0,g.Z)(o),"renderListFileError",(function(){var e=o.props.t;return tt("div",{style:{marginTop:10,display:"flex",alignItems:"center",justifyContent:"center"}},tt("span",{style:{fontSize:15}},"".concat(e("pages.shop.product.accessories.import.downloadErrorListFile"),": ")),tt("strong",{style:{cursor:"pointer",color:"#003399",fontWeight:"bold"},onClick:function(){return o.downloadListError()}},tt(M.Z,null)," ",e("components.productPurchaseImportExcel.here")))})),(0,Z.Z)((0,g.Z)(o),"downloadListError",(function(){var e=o.state.dataError,t=o.props.t,n=L()(o.state.fileNoNameDebt);e.map((function(e,o){var r;n.push((r={STT:o+1},(0,Z.Z)(r,t("pages.shop.debt.import.nameDebt"),e.name_debt),(0,Z.Z)(r,t("pages.shop.debt.import.type"),e.type),(0,Z.Z)(r,t("pages.shop.debt.import.insertedAt"),e.deal_date),(0,Z.Z)(r,t("pages.shop.debt.import.expiredAt"),e.expired_at),(0,Z.Z)(r,t("pages.shop.debt.import.supplierProducts"),e.supplier_products_id),(0,Z.Z)(r,t("customers.title"),e.customer),(0,Z.Z)(r,t("pages.shop.debt.import.phoneNumber"),e.phone_number),(0,Z.Z)(r,t("pages.shop.debt.import.description"),e.description),(0,Z.Z)(r,t("pages.shop.debt.import.moneyMustPay"),e.money_must_pay_or_collect),(0,Z.Z)(r,t("pages.shop.debt.import.moneyPayed"),e.money_payed_or_collected),r))}));var r={SheetNames:[],Sheets:{}},s=XLSX.utils.json_to_sheet(n);n.length&&(s["!cols"]=Object.keys(n[0]).map((function(e){var t=e?10*e.toString().length:150;return{wpx:t>120?t:120}})));XLSX.utils.book_append_sheet(r,s,"DataSheet 1");var a=XLSX.write(r,{bookType:"xlsx",bookSST:!1,type:"binary"});(0,Ke.saveAs)(new Blob([(0,ee.$iI)(a)],{type:""}),"error_file_debts.xlsx")})),o.state=L()(at),o}return(0,y.Z)(n,[{key:"render",value:function(){var e=this,t=this.props,n=t.t,o=t.i18n,r=t.isButton,s=t.title,i=this.state,l=i.modalVisible,c=i.isImporting,d=i.disableImportBtn,p=i.fileName,u=i.importedCount,h=i.debtImportFile,f=i.resultArr,m=i.fileNoNameDebt,b=f.filter((function(e){return e.success})).length,g=f.filter((function(e){return!e.success})).length,y=h.filter((function(e){return e[n("pages.shop.debt.import.nameDebt")]})).length||h.length,v="vi"==o.language?"/static/files/import_debts.xlsx":"/static/files/import_debts_english.xlsx",_=this.state.dataError.concat(m);return tt("div",{style:{display:"inline"}},tt(He.Z,{icon:tt(B.Z,null),color:"#00d1b2",onClick:function(){return e.setState({modalVisible:!0})},isButton:r,title:s}),tt(S.Z,{title:n("pages.shop.debt.importExcel"),visible:l,footer:null,onCancel:function(){return e.setState(L()(at))}},!c&&tt(Ue.default,{message:n("notes"),description:tt("div",null,tt("div",{style:{fontSize:14}},"- ",n("pages.shop.debt.writtenInTheCorrectFormat")," (",tt("a",{target:"_blank",href:v},n("components.productImportExcel.index.sampleFile")),")")),type:"warning",showIcon:!0}),c?null:tt("div",{style:{display:"flex",justifyContent:"space-between",marginTop:10}},tt(Ve.Z,{accept:".xlsx, .xls",showUploadList:!1,multiple:!1,customRequest:this.onDrop},tt(a.default,{style:{maxWidth:150,textOverflow:"ellipsis",overflow:"hidden"}},p?tt("span",null,tt(Je.Z,null),p):tt("span",null,tt(et.Z,null)," ",n("pages.shop.product.accessories.import.chooseFile")))),tt(a.default,{type:"primary",onClick:this.confirmImport,disabled:d},n("pages.shop.product.accessories.import.start"))),tt("div",null,u<=h.length&&c?tt("div",{style:{width:520,display:"flex",flexDirection:"column",alignItems:"center"}},tt(Be.default,{type:"circle",percent:Math.floor(100*u/y),style:{marginBottom:10}})):null,c&&u==y&&u>0?tt("h4",{style:{textAlign:"center"}},tt("span",{style:{color:"#00a854"}},"".concat(n("components.productImportExcel.index.importSuccess")," ").concat(b," ").concat(n("debts.title").toLowerCase())),tt("span",{style:{color:"#f04134"}},"".concat(g>0?", ".concat(n("pages.admin.failure")," ").concat(g," ").concat(n("debts.title").toLowerCase()):"")),m.length>0&&tt("span",{style:{color:"#ff002e"}},", ".concat(m.length," file ").concat(n("pages.shop.debt.errorNameDebt").toLowerCase()))):null,c?tt("div",{style:{maxHeight:700,width:"100%",display:"flex",flexDirection:"column",border:"1px solid #d9d9d9",borderRadius:2,marginTop:10,padding:10,overflow:"auto"},id:"importing-info"},this.renderError(),this.renderSuccess()):null),tt("div",null,(null===_||void 0===_?void 0:_.length)>0&&c?this.renderListFileError():"")))}}]),n}(j.Component))||Xe,lt=(0,A.$j)((function(e){return ot({currentShop:e.shop.currentShop},(0,fe.zN)(e))}),{fetchDebt:J.H4Z})(it),ct=function(e,t,n){var o,r,s;return'<div class="debt-printer">\n      <div class="title">\n      <strong>'.concat(1==e.type?"C\xd4NG N\u1ee2 PH\u1ea2I THU":"C\xd4NG N\u1ee2 PH\u1ea2I TR\u1ea2",'</strong>\n      </div>\n      <div class="info">\n        <div style="display: grid; grid-template-columns: 50% 50%">\n          <div>M\xe3 phi\u1ebfu c\xf4ng n\u1ee3: <strong>').concat(e.display_id,"</strong></div>\n          <div>Ng\u01b0\u1eddi t\u1ea1o: <strong>").concat(e.user?e.user.name:"H\u1ec7 Th\u1ed1ng","</strong></div>\n          <div>").concat(1==e.type?"Ng\xe0y b\xe1n":"Ng\xe0y mua",": ").concat((0,ee.o0x)(n||7,e.inserted_at,!1,"DD/MM/YYYY HH:mm"),"</div>\n          <div>").concat(1==e.type?"Ng\xe0y ph\u1ea3i thu":"Ng\xe0y ph\u1ea3i tr\u1ea3",": ").concat((0,ee.o0x)(n||7,e.deal_date,!1,"DD/MM/YYYY HH:mm"),"</div>\n          <div>Lo\u1ea1i c\xf4ng n\u1ee3: ").concat(1==e.type?"C\xf4ng n\u1ee3 ph\u1ea3i thu":"C\xf4ng n\u1ee3 ph\u1ea3i tr\u1ea3",'</div>\n        </div>\n        <div>\n          <div style="margin-top: 4px; font-weight: 600"><i>KH\xc1CH H\xc0NG</i></div>\n          <div style="display: grid; grid-template-columns: 50% 50%">\n            <div>T\xean: <strong>').concat(null===e||void 0===e?void 0:e.dealer_name,"</strong></div>\n            <div>S\u1ed1 \u0111i\u1ec7n tho\u1ea1i: ").concat(null!==e&&void 0!==e&&null!==(o=e.shop_customer)&&void 0!==o&&null!==(r=o.phone_numbers)&&void 0!==r&&r.length?(0,ee.xAZ)(null===e||void 0===e||null===(s=e.shop_customer)||void 0===s?void 0:s.phone_numbers[0]):"",'</div>\n          </div>\n        </div>\n      </div>\n      <div class="note-transfer">\n        ').concat(e.description?'<div style="margin-top: 4px;">\n            <span style="font-weight: 600"><i>GHI CH\xda: </i></span> <span><i>'.concat(e.description,"</i></span>\n          </div>"):"<div></div>",'\n      </div>\n      <table class="table" ><tbody>\n        <thead>\n          <tr style="text-align: center; height: 25px">\n            <th>T\xean c\xf4ng n\u1ee3</th>\n            <th>\u0110\u01a1n h\xe0ng</th>\n            <th width="17%">').concat(1==e.type?"S\u1ed1 ti\u1ec1n ph\u1ea3i thu":"S\u1ed1 ti\u1ec1n ph\u1ea3i tr\u1ea3",'</th>\n            <th width="17%">').concat(1==e.type?"S\u1ed1 ti\u1ec1n \u0111\xe3 thu":"S\u1ed1 ti\u1ec1n \u0111\xe3 tr\u1ea3",'</th>\n            <th width="17%">C\xf2n l\u1ea1i</th>\n          </tr>\n        </thead>\n        <tr>\n          <td>').concat(null===e||void 0===e?void 0:e.name_debt,"</td>\n          <td>").concat(e.order_id||"",'</td>\n          <td class="display-number">').concat((0,ee.ufS)(e.money_must_pay_or_collect,t.currency,!1),'</td>\n          <td class="display-number">').concat((0,ee.ufS)(e.money_payed_or_collected,t.currency,!1),'</td>\n          <td class="display-number">').concat((0,ee.ufS)(e.money_must_pay_or_collect-e.money_payed_or_collected,t.currency,!1),'</td>\n        </tr>\n      </tbody></table>\n      <div style="display: flex; justify-content: space-around; margin-top: 10px;">\n        <div>\n          <div>Ng\u01b0\u1eddi l\u1eadp phi\u1ebfu</div>\n          <div style="font-size: 10px; text-align: center;">(K\xfd, h\u1ecd t\xean)</div>\n        </div>\n        <div>\n          <div>Kh\xe1ch h\xe0ng</div>\n          <div style="font-size: 10px; text-align: center;">(K\xfd, h\u1ecd t\xean)</div>\n        </div>\n      </div>\n    </div>\n  ')},dt=n(36409),pt=n.n(dt),ut=j.createElement;function ht(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var ft=(0,oe.Z)()(st=function(e){(0,v.Z)(n,e);var t=ht(n);function n(e){var o;return(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"handlePrintTransfer",(function(){var e=o.props,t=e.accessToken,n=e.shopId,r=e.selectedDebts,s=e.params;if(r.length>0)o.setState({debtsPrint:r,isPrinting:!0},(function(){return o.handlePrint()}));else{var a="".concat((0,ee.LpH)(),"/shops/").concat(n,"/debt?access_token=").concat(t);be().get(a,{params:s}).then((function(e){e.data.success&&(o.setState({debtsPrint:e.data.data,isPrinting:!0}),o.handlePrint())}))}})),(0,Z.Z)((0,g.Z)(o),"handlePrint",(function(){var e=document.getElementById(o.printDivId).innerHTML,t=document.createElement("iframe");t.name="frame1",t.style.position="absolute",t.style.top="-1000000px",document.body.appendChild(t);var n=t.contentWindow?t.contentWindow:t.contentDocument.documnet?t.contentDocument.document:t.contentDocument;n.document.open(),n.document.write("\n      <!DOCTYPE html>\n            <head>\n                <style type='text/css'>\n                  @media print {\n                    @page {\n                      size: auto;\n                      margin: 6mm;\n                    }\n                  }\n                </style>\n            </head>\n            <body>\n              ".concat(e,"\n            </body>\n        </html>\n      ")),n.document.close(),setTimeout((function(){window.frames.frame1.focus(),window.frames.frame1.print(),document.body.removeChild(t)}),500),o.setState({isPrinting:!1})})),o.state={debtsPrint:[],isPrinting:!1},o.printDivId=(0,ee.uuG)(),o}return(0,y.Z)(n,[{key:"render",value:function(){var e=this.props,t=e.currentShop,n=e.timezone,o=(e.t,e.isButton),r=e.title,s=this.state,a=s.isPrinting,i=s.debtsPrint,l={pageBreakInside:"avoid",minHeight:"190mm",padding:"1mm"};return ut(j.Fragment,null,ut(He.Z,{icon:ut(a?se.Z:H.Z,null),title:r,onClick:this.handlePrintTransfer,isButton:o}),a&&ut("div",{id:this.printDivId},i.map((function(e){return ut("div",{key:e.id,style:l},ut("div",{dangerouslySetInnerHTML:{__html:ct(e,t,n)}}),ut("style",{dangerouslySetInnerHTML:{__html:pt()}}))}))))}}]),n}(j.Component))||st,mt=(0,A.$j)((function(e){return{timezone:e.navigation.user.timezone}}),null)(ft),bt=n(24781),gt=n(43745),yt=n(41850),vt=n(45812),_t=j.createElement;function xt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Zt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xt(Object(n),!0).forEach((function(t){(0,Z.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=(0,x.Z)(e);if(t){var r=(0,x.Z)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return(0,_.Z)(this,n)}}var kt={page:1,page_size:30,filter_by:"expired_at"},Dt=["30","50","100"],wt=w.default.RangePicker,Ct=D.default.Group,Ot=(k.default.Option,S.Z.confirm),It=function(e){(0,v.Z)(n,e);var t=St(n);function n(e){var o;(0,b.Z)(this,n),o=t.call(this,e),(0,Z.Z)((0,g.Z)(o),"fetchListOfDebt",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Zt({},kt),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=o.props,r=n.accessToken,s=n.shopId;o.setState({params:e,isLoading:t}),o.props.calTotalDebt(r,s,e),o.props.fetchListOfDebt(r,s,e).then((function(){return o.setState({isLoading:!1})}))})),(0,Z.Z)((0,g.Z)(o),"handleTableChange",(function(e){var t=o.state.params;t.page=e.current,o.setState({pageSize:e.pageSize},(function(){localStorage.setItem("debtPageSize",e.pageSize),t.page_size=e.pageSize,o.fetchListOfDebt(t)}))})),(0,Z.Z)((0,g.Z)(o),"handleRowClick",(function(e){var t=e.action;o.setState({visible:!0,selectedDebt:t})})),(0,Z.Z)((0,g.Z)(o),"handleDeleteDebt",(function(){var e=o.props,t=e.t,n=e.debts,r=o.state.selectedRowKeys;S.Z.confirm({title:t("pages.shop.debt.confirmDeleteDebt"),content:function(){var e=n.data.filter((function(e){return r.includes(e.id)&&e.is_locked}));return _t(j.Fragment,null,_t("div",null,t("pages.shop.debt.wantToDelete")," ",r.length-e.length," ",t("pages.shop.debt.selectedDebt")),e.map((function(e){return _t("div",null,"#",e.display_id," ",t("pages.shop.debt.debtIsLocked"))})))}(),okText:t("delete"),cancelText:t("cancel"),onOk:function(){var e=o.props,t=e.accessToken,n=e.shopId;(0,e.deleteDebts)(t,n,{debt_ids:r}).then((function(){return o.setState({selectedRowKeys:[]})}))}})})),(0,Z.Z)((0,g.Z)(o),"createLinkDebt",(0,m.Z)(f().mark((function e(){var t,n,r,s,a,i,l;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.state.selectedRowKeys,n=o.props,r=n.t,s=n.accessToken,a=n.shopId,i={debt_ids:t},l="".concat((0,ee.LpH)(),"/shops/").concat(a,"/debt/create_link?access_token=").concat(s),o.setState({isLoading:!0}),e.next=7,be().post(l,i).then((function(e){e.data.success?(o.fetchListOfDebt(),o.setState({selectedRowKeys:[]}),ue.Z.success(r("success"),r("pages.shop.debt.createLinkSuccess"))):ue.Z.error(r("pages.admin.failure"),r("pages.shop.debt.createLinkFailure"))}));case 7:case"end":return e.stop()}}),e)})))),(0,Z.Z)((0,g.Z)(o),"columns",[{title:"",dataIndex:"is_locked",ellipsis:!0,width:"20px",fixed:"left",align:"center"},{title:"ID",dataIndex:"id",ellipsis:!0,width:"5%",fixed:"left"},{title:o.props.t("pages.shop.debt.nameDebt"),dataIndex:"name_debt",align:"left",width:"7%"},{title:o.props.t("pages.shop.debt.description"),dataIndex:"description",align:"left",width:"13%"},{title:o.props.t("pages.shop.debt.type"),dataIndex:"type",align:"center",width:"7%"},{title:"Link public",dataIndex:"link_public",align:"center"},{title:o.props.t("pages.shop.debt.expired_at"),dataIndex:"expired_at",align:"center",width:"7%"},{title:o.props.t("pages.shop.debt.remainMoney"),dataIndex:"remain",align:"right",ellipsis:!0,width:"7%"},{title:o.props.t("pages.shop.debt.supplierProducts"),dataIndex:"supplier_products",align:"right",ellipsis:!0,width:"7%"},{title:o.props.t("pages.shop.debt.phoneNumber"),dataIndex:"phone_numbers",align:"left",width:"7%"},{title:o.props.t("customers.title"),dataIndex:"customers",ellipsis:!0,align:"left",width:"8%"},{title:o.props.t("pages.shop.debt.creator"),dataIndex:"creator_id",ellipsis:!0,align:"left",width:"7%"},{title:o.props.t("pages.shop.debt.insertedAt"),dataIndex:"inserted_at",className:"ellipsis-column align-right-column",width:"7%"},{title:o.props.t("status"),dataIndex:"status",align:"center",fixed:"right",width:"150px",render:function(e,t){return _t("span",{onClick:function(e){return e.stopPropagation()}},_t(Le,{accessToken:o.props.accessToken,shopId:o.props.shopId,debt:t.action,size:"small"}))}}]),(0,Z.Z)((0,g.Z)(o),"renderPopoverFilterByTime",(function(){var e,t=o.state.params,n=o.props.t,r={display:"block",height:"30px",lineHeight:"30px"};return _t("div",null,_t(Ct,{style:{display:"inline-block"},value:t.filter_by?t.filter_by:"",onChange:o.onChangeRadioGroup},_t(D.default,{style:r,value:"expired_at"},n("components.timeToDue")),_t(D.default,{style:r,value:"inserted_at"},n("components.creationTime")),_t(D.default,{style:r,value:"deal_date"},n("components.buyTime"))),_t("div",null,_t(wt,{format:"DD/MM/YYYY",style:{width:350},ranges:(e={},(0,Z.Z)(e,n("pages.shop.statistic.yesterday"),[ce()().add(-1,"days"),ce()().add(-1,"days")]),(0,Z.Z)(e,n("pages.shop.statistic.today"),[ce()(),ce()()]),(0,Z.Z)(e,n("pages.shop.statistic.lastWeek"),[ce()().add(-7,"days"),ce()()]),(0,Z.Z)(e,n("pages.shop.statistic.lastMonth"),[ce()().add(-30,"days"),ce()()]),(0,Z.Z)(e,n("pages.shop.statistic.thisMonth"),[ce()().startOf("month"),ce()().endOf("month")]),e),value:t.start_time&&t.end_time?[ce()(1e3*t.start_time).subtract(o.props.timezone||7,"hours"),ce()(1e3*t.end_time).subtract(o.props.timezone||7,"hours")]:"",onChange:o.onChangeFilterByTime})))})),(0,Z.Z)((0,g.Z)(o),"onChangeRadioGroup",(function(e){var t=Zt(Zt({},o.state.params),{},{filter_by:e.target.value});o.setState({params:t})})),(0,Z.Z)((0,g.Z)(o),"onChangeFilterByTime",(function(e){var t=e&&e[0]?e[0].startOf("day").add(o.props.timezone||7,"hours").unix():null,n=e&&e[1]?e[1].endOf("day").add(o.props.timezone||7,"hours").unix():null,r=Zt(Zt({},o.state.params),{},{start_time:t,end_time:n});o.setState({params:r},(function(){o.fetchListOfDebt(o.state.params)}))})),(0,Z.Z)((0,g.Z)(o),"handleLockDebt",(function(e,t){var n=o.props,r=n.updateDebts,s=n.accessToken,a=n.shopId,i=Zt({},t);i.is_locked=!e,r(s,a,i)})),(0,Z.Z)((0,g.Z)(o),"getData",(function(){var e=o.props.t,t=[],n=[],r=[],s=[];o.props.debts.data.map((function(e){0==e.type?r.push(e):s.push(e)})),r.sort((function(e,t){return ce()(e.expired_at).unix()-ce()(t.expired_at).unix()})),r=r.filter((function(e){return ce()(e.expired_at).unix()>=ce()().startOf("day").unix()})),s.sort((function(e,t){return ce()(e.expired_at).unix()-ce()(t.expired_at).unix()})),s=s.filter((function(e){return ce()(e.expired_at).unix()>=ce()().startOf("day").unix()})),o.props.debts&&o.props.debts.data.map((function(a){var i,l,c,h,f,m,b,g,y,v=o.props.users.find((function(e){return e.user_id==a.creator_id})),_=null!==(i=a.shop_customer)&&void 0!==i&&i.phone_numbers?null===(l=a.shop_customer)||void 0===l?void 0:l.phone_numbers.join(", "):"",x=o.props.supplier_products?(o.props.supplier_products.data.find((function(e){return e.id==a.supplier_products_id}))||{}).name:"";t.push({key:a.id,is_locked:_t(p.default,{placement:"bottom",title:e("pages.shop.debt.canNotDeleteLockedDebt")},_t("div",{onClick:function(e){return e.stopPropagation()}},_t(u.Z,{size:"small",checked:0==a.is_locked||null==a.is_locked,onChange:function(e){return o.handleLockDebt(e,a)}}))),id:a.display_id,name_debt:a.name_debt,description:_t(p.default,{title:a.description},a.description&&a.description.length>20?a.description.substring(0,20)+"...":a.description),type:_t("span",{style:{color:0==a.type?"#f04134":"#096dd9"}},(0,ee.jhQ)(a.type)),expired_at:a.expired_at?_t("span",null,(0,ee.o0x)(o.props.timezone||7,a.expired_at),"\xa0",ce()(a.expired_at).unix()>ce()().unix()&&ce()(a.expired_at).unix()<=ce()(0==a.type?r[0].expired_at:s[0].expired_at).unix()&&_t(p.default,{title:0==a.type?o.props.t("pages.shop.debt.mustPayNearest"):o.props.t("pages.shop.debt.mustCollectNearest")},_t(F.Z,{style:{color:"#f04134"}}))):"",remain:_t("span",{style:{color:0==a.type?"#f04134":"#096dd9"}},(0,ee.ufS)(a.money_must_pay_or_collect-a.money_payed_or_collected,o.props.currentShop.currency)),link_public:a.link_key?_t("span",{onClick:function(e){return e.stopPropagation()}},_t(Ae,{debt:a})):_t(d.default,{style:{cursor:"pointer"},color:"red"},"Ch\u01b0a c\xf3"),supplier_products:_t(p.default,{title:x},x),customers:null!==(c=a.shop_customer)&&void 0!==c&&c.customer?_t("span",{style:{display:"flex",alignItems:"center",float:"left"}},_t(he.Z,{seed:null===(h=a.shop_customer)||void 0===h?void 0:h.customer_id,id:null===(f=a.shop_customer)||void 0===f?void 0:f.customer.fb_id,size:[20,20],name:null===(m=a.shop_customer)||void 0===m?void 0:m.customer.name}),"\xa0",_t("span",null,null===(b=a.shop_customer)||void 0===b?void 0:b.customer.name)):"",creator_id:v?_t("span",{style:{display:"flex",alignItems:"center",float:"left"}},_t(he.Z,{id:v.user.fb_id,size:[20,20],name:v.user.name}),"\xa0",_t("span",null,v.user.name)):"",inserted_at:(0,ee.o0x)(o.props.timezone||7,a.inserted_at),phone_numbers:_,action:a}),n.push({is_locked:2.5,id:o.lengthData(a.display_id),name_debt:o.lengthData(a.name_debt),description:o.lengthData(a.description),type:o.lengthData((0,ee.jhQ)(a.type)),expired_at:o.lengthData((0,ee.o0x)(o.props.timezone||7,a.expired_at)),remain:o.lengthData((0,ee.ufS)(a.money_must_pay_or_collect-a.money_payed_or_collected,o.props.currentShop.currency)),link_public:o.lengthData(a.link_key||e("components.orderAdvanceFilter.notYet")),supplier_products:o.lengthData(x),customers:o.lengthData((null===(g=a.shop_customer)||void 0===g?void 0:g.customer)&&(null===(y=a.shop_customer)||void 0===y?void 0:y.customer.name)),phone_numbers:o.lengthData(_||e("components.orderAdvanceFilter.notYet")),creator_id:o.lengthData((null===v||void 0===v?void 0:v.user)&&(null===v||void 0===v?void 0:v.user.name)),inserted_at:o.lengthData((0,ee.o0x)(o.props.timezone||7,a.inserted_at))})}));var a=(0,ee.Owf)(n,o.columns);return[t,a]})),(0,Z.Z)((0,g.Z)(o),"lengthData",(function(e){return(null===e||void 0===e?void 0:e.toString().length)||0})),(0,Z.Z)((0,g.Z)(o),"handleDeleteFilter",(function(){P()(o.state.params,kt)||o.setState({params:Zt(Zt({},kt),{},{page_size:o.state.pageSize}),filters:[],searchTerm:""},(function(){o.fetchListOfDebt(o.state.params)}))})),(0,Z.Z)((0,g.Z)(o),"handleSearchInputChange",(function(e){var t=o.state.filters,n="search",r=t.findIndex((function(e){return e.key==n}));-1!=r?t[r].value=e:t.push({key:n,value:e}),o.setState({filters:t});var s=L()(o.state.params);s.search=e,o.fetchListOfDebt(s)})),(0,Z.Z)((0,g.Z)(o),"handleAdvanceFilter",(function(e){var t=L()(o.state.params),n={};Object.keys(kt).map((function(e){n=Zt(Zt({},n),{},(0,Z.Z)({},e,t[e]))})),t=n;var r={};e.length&&(e.map((function(e){r[e.key]?r[e.key].push(e.value):r[e.key]=[e.value]})),t=Zt(Zt({},t),r)),o.setState({filters:e}),o.fetchListOfDebt(t)})),(0,Z.Z)((0,g.Z)(o),"debtTableHeighStyle",(function(e){return e?_t(T.default,{id:"1012892335"},[".debt-table .ant-table-body,.debt-table .ant-table-body-inner{min-height:calc(100vh - 219px);}"]):_t(T.default,{id:"720295914"},[".debt-table .ant-table-body,.debt-table .ant-table-body-inner{min-height:calc(100vh - 181px);}"])})),(0,Z.Z)((0,g.Z)(o),"renderFilter",(function(e,t){var n;if(!["search"].includes(e.key)){var r,s=o.state.filters,a=o.props,i=a.supplier_products,l=a.t;switch(e.key){case"shop_customer_id":var c=s.find((function(t){return t.key==e.key&&t.value==e.value})).customer_info;r=_t("div",{style:{display:"flex"}},_t("span",null,l("customers.title"),":"),"\xa0\xa0",_t("span",{style:{display:"flex",alignItems:"center"}},_t(he.Z,{avatar_url:(0,te.E$)(c,o.props.accessToken),id:c.fb_id,name:c.name,size:[15,15],seed:c.id}),_t("strong",{style:{marginLeft:5}},c.name)));break;case"supplier_products_id":r=_t("div",null,_t("span",null,"".concat(l("pages.shop.product.variation.supplierProducts"),": ")),_t("strong",null,null===i||void 0===i||null===(n=i.data.find((function(t){return t.id==e.value})))||void 0===n?void 0:n.name));break;case"status":var p;switch(e.value){case"0":p=l("pages.shop.debt.notTraded");break;case"1":p=l("pages.shop.debt.traded");break;case"2":p=l("pages.shop.debt.canceled")}r=_t("div",null,_t("span",null,"".concat(l("pages.shop.debt.debtStatus"),": ")),_t("strong",null,p));break;case"shop_customer_tags":var u="include"==e.value[0];r=_t("div",null,_t("span",null,l(u?"pages.shop.debt.filterByTag":"pages.shop.debt.filterExclude"),":"),"\xa0",_t("strong",{style:{color:u?"#096dd9":"#F04134"}},e.value[1]));break;case"is_adjust_debts":r=_t("div",null,_t("strong",null,l("pages.shop.debt.debtsAjusted")));break;case"has_debts":r=_t("div",null,_t("strong",null,l("pages.shop.debt.stillOwe")));break;case"onlineOrOffline":r=_t("div",null,_t("span",null,l("customers.title"),":"),"\xa0",_t("strong",null,"online"==e.value?"facebook":"offline"));break;case"type":var h;switch(e.value){case"0":h=l("pages.shop.debt.debtMustPay");break;case"1":h=l("pages.shop.debt.debtMustCollect")}r=_t("div",null,_t("span",null,"".concat(l("pages.shop.debt.type"),": ")),_t("strong",null,h))}return _t(d.default,{key:t,closable:!0,onClose:function(){return o.handleCloseTag(t)}},r)}})),(0,Z.Z)((0,g.Z)(o),"onSelectChange",(function(e,t){var n=o.props.debts,r=t&&t.length>0?t:n.data,s=o.state,a=s.selectedRowKeys,i=s.selectedDebts.concat(e.filter((function(e){return!a.includes(e)})).map((function(e){return r.find((function(t){return t.id==e}))}))).filter((function(t){return e.includes(t.id)}));o.setState({selectedRowKeys:e,selectedDebts:i})})),(0,Z.Z)((0,g.Z)(o),"handleCloseTag",(function(e){var t=L()(o.state.filters);t.splice(e,1),o.handleAdvanceFilter(t)})),(0,Z.Z)((0,g.Z)(o),"onChangeColumns",(function(e){-1!=e.findIndex((function(e){return"id"==e}))&&-1!=e.findIndex((function(e){return"name_debt"==e}))&&-1!=e.findIndex((function(e){return"status"==e}))&&(o.setState({checkedList:e}),localStorage.setItem("debt-columns",JSON.stringify(e)))})),(0,Z.Z)((0,g.Z)(o),"getListActionTools",(function(){var e=o.state,t=e.isLoading,n=e.selectedRowKeys,r=e.params,s=e.selectedDebts,a=o.props,i=a.t,l=a.accessToken,c=a.shopId,d=a.currentShop,p=(0,ee.HUL)(o.columns.filter((function(e){return"is_locked"!=e.dataIndex}))),u=p.translate,h=p.allColumns,f=o.state.checkedList.filter((function(e){return"is_locked"!=e}));return[{icon:_t(M.Z,null),title:i("pages.shop.statistic.inventory.exportExcel"),key:"debt_export_excel",content:function(e){return _t(Ge,{accessToken:l,shopId:c,params:r,selectedRowKeys:n,selectedDebts:s,isButton:e,title:i("pages.shop.statistic.inventory.exportExcel")})}},{icon:_t(B.Z,null),title:i("pages.shop.actionTools.importExcel"),key:"debt_import_excel",content:function(e){return _t(lt,{accessToken:l,shopId:c,isButton:e,title:i("pages.shop.actionTools.importExcel")})}},{icon:_t(H.Z,null),title:i("pages.shop.debt.printDebts"),key:"debt_print",content:function(e){return _t(mt,{accessToken:l,shopId:c,selectedRowKeys:n,selectedDebts:s,currentShop:d,params:r,isButton:e,title:i("pages.shop.debt.printDebts")})}},{icon:_t(K.Z,null),title:"Link public",key:"link_debt",content:function(e){return _t(He.Z,{disabled:t||n.length<=0,icon:_t(K.Z,null),title:"Link public",onClick:function(){return o.createLinkDebt()},isButton:e})}},{icon:_t(Y.Z,null),title:i("pages.shop.actionTools.quickUpdate"),key:"quick_update",content:function(e){return _t(gt.Z,{shopId:c,accessToken:l,selectedRowKeys:n,clearSelectedKeys:function(){return o.setState({selectedRowKeys:[],selectedDebts:[]})},handleCallbackFetchData:function(){return o.fetchListOfDebt()},selectedData:s,name:"debts",isButton:e,title:i("pages.shop.actionTools.quickUpdate")})}},{icon:_t(K.Z,null),title:i("pages.shop.setting.crmProfile.columnsSetting"),key:"setting_column",content:function(e){return _t(Me.Z,{t:i,defaultCheckedList:["id","name_debt","status","description"],displayColumns:f,addOptionColumns:h.filter((function(e){return!f.includes(e)})),translate:u,onChange:o.onChangeColumns,isButton:e,isTools:!0,title:i("pages.shop.setting.crmProfile.columnsSetting")})}}]})),(0,Z.Z)((0,g.Z)(o),"onSelectRow",(function(){var e=o.props,t=e.shopId,n=e.accessToken,r=o.state.params,s="".concat((0,ee.LpH)(),"/shops/").concat(t,"/debt?access_token=").concat(n);o.setState({loadingData:!0});(function e(t){return be().get(s,{params:t}).then((function(n){var r=o.state,s=r.loadingData,a=r.selectedRowKeys,i=n.data.data,l=i.map((function(e){return e.id})),c=a.filter((function(e){return!l.includes(e)})).concat(l);return s&&o.onSelectChange(onSelectChange,i),(c||[]).length>=n.data.total_entries||0==i.length||!s?void 0:(t.page+=1,e(t))}))})(Zt(Zt({},r),{},{page:1})).then((function(e){return o.setState({loadingData:!1})}))})),(0,Z.Z)((0,g.Z)(o),"setSelectDebt",(function(){var e=o.props,t=e.shopId,n=e.t,r=JSON.parse(localStorage.getItem("draft_debt_shop_".concat(t)))||null;localStorage["draft_debt_shop_".concat(t)]?Ot({title:n("pages.shop.product.purchase.alert"),content:n("components.debtDetail.contentDebt"),okText:n("pages.shop.product.export.yes"),cancelText:n("pages.shop.product.export.delete"),onOk:function(){return o.setState({selectedDebt:r,visible:!0})},onCancel:function(){o.setState({selectedDebt:null,visible:!0}),localStorage.removeItem("draft_debt_shop_".concat(t))}}):o.setState({selectedDebt:null,visible:!0})}));var r=(0,ee.VKr)(Zt(Zt({},e),{},{columns:o.columns,localKey:"debt-columns",haveStatus:!0}));return o.state={params:Zt({},kt),visible:!1,selectedDebt:null,isLoading:!1,selectedRowKeys:[],filters:[],checkedList:r,searchTerm:"",pageSize:parseInt(localStorage.getItem("debtPageSize")||30),selectedDebts:[]},o.handleSearchInputChange=O()(o.handleSearchInputChange,400),o}return(0,y.Z)(n,null,[{key:"getInitialProps",value:function(){var e=(0,m.Z)(f().mark((function e(t,n){var o,r;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t.store.dispatch,r=t.query.shopId,!t.isServer){e.next=8;break}return e.next=4,o((0,J._xZ)(n,r,kt));case 4:return e.next=6,o((0,J.FvM)(n,r));case 6:e.next=9;break;case 8:o((0,J.FvM)(n,r));case 9:return e.abrupt("return",{});case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()}]),(0,y.Z)(n,[{key:"componentDidMount",value:function(){var e=this.state,t=e.params,n=e.pageSize,o=localStorage.getItem("debt-columns");o&&this.setState({checkedList:JSON.parse(o).filter((function(e){return"status"!=e})).concat(["status"])}),t.page_size=n,this.fetchListOfDebt(t)}},{key:"render",value:function(){var e,t,n=this,o=this.state,d=o.visible,p=o.selectedDebt,u=o.isLoading,h=o.selectedRowKeys,f=o.params,m=o.filters,b=o.searchTerm,g=o.pageSize,y=o.loadingData,v=this.props,_=v.t,x=v.accessToken,Z=v.shopId,S=v.debts.total_entries,k=v.currentShop,D=v.debts,w={selectedRowKeys:h,onChange:function(e){return n.onSelectChange(e)},preserveSelectedRowKeys:!0,isSelection:!0,onSelectRow:this.onSelectRow},C=this.getData(),O=(0,c.Z)(C,2),I=O[0],N=O[1],L=(this.state.checkedList.find((function(e){return"is_locked"==e}))?this.state.checkedList:["is_locked"].concat((0,l.Z)(this.state.checkedList))).map((function(e){var t=n.columns.find((function(t){return t.dataIndex==e}));return t.width=N[e]||"150px",t})),T=(0,ee.f2Q)(L);L.map((function(e){return"description"==e.dataIndex&&delete e.width,e}));var j=!D.data.filter((function(e){return h.includes(e.id)&&1!=e.is_locked})).length;return _t(U.Z,{className:"product-debt",style:{overflow:"visible"}},_t("div",{className:"tools-container"},_t(G.Z,{icon:_t(q.Z,null),color:"#096DD9",title:_("pages.shop.debt.createDebt"),onClick:function(){return n.setSelectDebt()}}),_t(He.Z,{icon:_t($.Z,null),disabled:u,onClick:function(){return n.fetchListOfDebt(f)},title:_("pages.shop.orderControlInfo.sync"),isButton:!0}),_t(bt.Z,{listActionTools:this.getListActionTools(),defaultActiveKeys:this.getListActionTools().map((function(e){return e.key})),keyView:"debt"}),h.length>0&&_t(He.Z,{icon:_t(W.Z,null),disabled:j,tooltip:j?"".concat(_("pages.shop.debt.canNotDeleteLockedDebt")):"".concat(_("delete")," ").concat(h.length," ").concat(_("pages.shop.debt.selectedDebt")," "),onClick:this.handleDeleteDebt,isButton:!0,title:_("delete")}),_t(vt.Z,{selectedLength:h.length,loadingData:y,total:S,onClick:function(){return n.setState({loadingData:!1,selectedRowKeys:[],selectedDebts:[]})}}),_t("div",{className:"filter"},_t(i.default,{placeholder:_("pages.shop.debt.filterByDebts"),value:b,prefix:_t(X.Z,null),onChange:function(e){n.setState({searchTerm:e.target.value}),n.handleSearchInputChange(e.target.value)}}),!P()(this.state.params,Zt(Zt({},kt),{},{page_size:this.state.pageSize}))&&_t(a.default,{className:"delete",danger:!0,onClick:function(){return n.handleDeleteFilter()}},_("pages.shop.debt.deleteFilter")),_t(s.default,{trigger:"click",content:this.renderPopoverFilterByTime(),placement:"bottomLeft"},_t(G.Z,{icon:_t(Q.Z,null),title:_("pages.shop.customer.filterByPeriod")})),_t(Fe.Z,{accessToken:x,shopId:Z,fetch:function(e){return n.handleAdvanceFilter(e)},filters:this.state.filters})),m&&m.length>0&&_t("div",{className:"show-filter"},m.map((function(e,t){return n.renderFilter(e,t)})))),_t(yt.Z,{size:"small",columns:L,onChange:this.handleTableChange,dataSource:I,pagination:{size:"small",pageSize:g,total:S,current:f.page,pageSizeOptions:Dt,showSizeChanger:!0},scroll:{x:T,y:m&&m.length>0?"calc(100vh - 219px)":"calc(100vh - 181px)"},onRow:function(e){return{onClick:function(t){return n.handleRowClick(e)}}},rowSelection:w,className:"debt-table"}),_t("div",{style:{position:"absolute",zIndex:100,left:10,bottom:10,display:"flex"}},_t("div",{style:{display:"flex",alignItems:"center"}},_t("strong",null,"".concat(_("pages.shop.debt.totalDebtMustCollect"),": ")),_t("div",{style:{color:"#096dd9",marginLeft:5}},u?_t(r.default,{className:"skeleton-small",active:!0,paragraph:{rows:1,width:100},title:!1}):_t("div",null,this.props.total_debts&&this.props.total_debts.data?(0,ee.ufS)(null===(e=this.props.total_debts.data.debt_must_collect)||void 0===e?void 0:e.sum_must_collect,k.currency):0))),"\xa0\xa0",_t("div",{style:{display:"flex",alignItems:"center"}},_t("strong",null,"".concat(_("pages.shop.debt.totalDebtMustpay"),": ")),_t("div",{style:{color:"#f04134",marginLeft:5}},u?_t(r.default,{className:"skeleton-small",active:!0,paragraph:{rows:1,width:100},title:!1}):_t("div",null,this.props.total_debts&&this.props.total_debts.data?(0,ee.ufS)(null===(t=this.props.total_debts.data.debt_must_pay)||void 0===t?void 0:t.sum_must_pay,k.currency):0)))),d&&_t(Se,{accessToken:x,shopId:Z,visible:d,close:function(){return n.setState({visible:!1})},debts:p,fetchListOfDebt:function(){return n.fetchListOfDebt()}}),u&&_t(V.Z,null),this.debtTableHeighStyle(m&&m.length>0))}}]),n}(j.Component);(0,Z.Z)(It,"pageInfo",{title:"debts.title",sassStyle:z()});var Pt=(0,A.$j)((function(e){return Zt(Zt(Zt(Zt({timezone:e.navigation.user.timezone},(0,fe.Bd)(e)),(0,fe.$n)(e)),(0,fe.zN)(e)),{},{users:e.user.users})}),{fetchListOfDebt:J._xZ,deleteDebts:J.C8$,calTotalDebt:J.FvM,updateDebts:J.AgW})((0,R.Z)(It))},87631:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/shop/product/debt",function(){return n(84535)}])}},function(e){e.O(0,[5460,8414,2902,4517,3745,9774,2888,179],(function(){return t=87631,e(e.s=t);var t}));var t=e.O();_N_E=t}]);